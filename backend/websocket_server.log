2025-05-17 11:17:24,080 - websocket_server - WARNING - Kh√¥ng th·ªÉ import t·ª´ chatbot.py. S·ª≠ d·ª•ng h√†m mock.
2025-05-17 11:17:24,081 - websocket_server - WARNING - Kh√¥ng th·ªÉ import DepartmentInfoTool. S·ª≠ d·ª•ng mock class.
2025-05-17 11:17:24,084 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-17 11:17:24,145 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 11:17:24,145 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-17 11:17:24,145 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-17 11:17:58,030 - websockets.server - INFO - connection open
2025-05-17 11:18:00,782 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"test alo alo /no_think","session_id":""}
2025-05-17 11:18:00,783 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,783 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,784 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: test alo alo /no_think...
2025-05-17 11:18:00,784 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: test alo alo /no_think, enable_thinking=False
2025-05-17 11:18:00,784 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:18:00,785 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 11:18:00,785 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'test alo alo /no_think', ph√≤ng ban: None, session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,785 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,786 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: test alo alo
2025-05-17 11:18:00,786 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'test alo alo', Mode thinking: False
2025-05-17 11:18:00,786 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:18:00,786 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 11:18:00,787 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: test alo alo /no_think
2025-05-17 11:18:00,787 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-17 11:18:00,787 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:18,362 - websockets.server - INFO - connection open
2025-05-17 11:19:19,935 - websockets.server - INFO - connection open
2025-05-17 11:19:22,491 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alo /no_think","session_id":""}
2025-05-17 11:19:22,492 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,492 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,493 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alo /no_think...
2025-05-17 11:19:22,493 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alo /no_think, enable_thinking=False
2025-05-17 11:19:22,493 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 11:19:22,495 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_111922.txt
2025-05-17 11:19:22,496 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 11:19:22,496 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alo /no_think', ph√≤ng ban: None, session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,497 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,497 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: alo
2025-05-17 11:19:22,497 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:19:22,498 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 11:19:22,499 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_111922.txt
2025-05-17 11:19:22,499 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 11:19:22,499 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: alo /no_think
2025-05-17 11:19:22,500 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-17 11:19:22,500 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:24,785 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-17 11:19:24,785 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Mock response for general query: alo /no_think
2025-05-17 11:19:24,786 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 11:19:24,787 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_111924.txt
2025-05-17 11:19:24,787 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-17 11:19:24,788 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-17 11:19:24,788 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747455564784_zgioz0p
2025-05-17 11:19:24,789 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (304 k√Ω t·ª±)
2025-05-17 11:21:28,193 - websockets.server - INFO - server closing
2025-05-17 11:21:28,256 - websockets.server - INFO - server closed
2025-05-17 11:21:28,257 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-17 11:21:30,523 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-17 11:21:30,558 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 11:21:30,558 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-17 11:21:30,558 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-17 11:23:52,845 - websockets.server - INFO - connection open
2025-05-17 11:23:53,834 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alo /no_think","session_id":""}
2025-05-17 11:23:53,834 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,834 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,835 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alo /no_think...
2025-05-17 11:23:53,835 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alo /no_think, enable_thinking=False
2025-05-17 11:23:53,835 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:23:53,835 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: alo /no_think, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,837 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:23:53,838 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:23:53,838 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:23:53,839 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c genera...
2025-05-17 11:23:53,839 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 486 k√Ω t·ª±
2025-05-17 11:23:53,839 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:23:53,839 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4667 k√Ω t·ª±
2025-05-17 11:23:53,841 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_112353.txt
2025-05-17 11:23:53,842 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:23:53,842 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c genera...
2025-05-17 11:23:53,843 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:24:07,324 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:24:07,325 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-17 11:24:07,330 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_112407.txt
2025-05-17 11:24:07,334 - chatbot_rag - INFO - [analysis_20250517_112407] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_112407_raw.txt
2025-05-17 11:24:07,335 - chatbot_rag - INFO - [analysis_20250517_112407] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-17 11:24:07,335 - chatbot_rag - WARNING - [analysis_20250517_112407] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:24:07,336 - chatbot_rag - INFO - [analysis_20250517_112407] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-17 11:24:07,337 - chatbot_rag - INFO - [analysis_20250517_112407] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-17 11:24:07,337 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=Kinh doanh, Lo·∫°i=department_specific, Thinking=False
2025-05-17 11:24:07,338 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alo /no_think', ph√≤ng ban: Kinh doanh, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,338 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,339 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: alo
2025-05-17 11:24:07,339 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:24:07,341 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:24:07,341 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=Kinh doanh, Lo·∫°i=department_specific, Thinking=False
2025-05-17 11:24:07,342 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: alo /no_think
2025-05-17 11:24:07,342 - websocket_server - INFO - C√¢u h·ªèi v·ªÅ ph√≤ng ban c·ª• th·ªÉ: Kinh doanh, ch·∫ø ƒë·ªô thinking: False
2025-05-17 11:24:07,342 - chatbot_rag - INFO - Truy v·∫•n Smart RAG - Giai ƒëo·∫°n: None, Ph√≤ng ban: Kinh doanh, Session: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,356 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:24:07,357 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: Kinh doanh
2025-05-17 11:24:07,358 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, k√≠ch th∆∞·ªõc: 16485 bytes
2025-05-17 11:24:07,379 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 5 giai ƒëo·∫°n v√† 24 c√¥ng vi·ªác cho ph√≤ng ban Kinh doanh
2025-05-17 11:24:07,379 - chatbot_rag - INFO - T·∫°o prompt LLM cho ph√≤ng ban: Kinh doanh, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,380 - chatbot_rag - INFO - S·ªë task: 24
2025-05-17 11:24:07,380 - chatbot_rag - INFO - L·∫•y l·ªãch s·ª≠ h·ªôi tho·∫°i t·ª´ phi√™n d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,381 - chatbot_rag - WARNING - [create_llm_prompt] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server. Th·ª≠ get_chat_history (c·ª•c b·ªô).
2025-05-17 11:24:07,381 - chatbot_rag - INFO - [create_llm_prompt] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ get_chat_history (c·ª•c b·ªô).
2025-05-17 11:24:07,384 - chatbot_rag - INFO - G·ªçi LLM:  t·∫°i 
2025-05-17 11:24:07,386 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_20250517_112407.txt
2025-05-17 11:24:07,387 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 12219 k√Ω t·ª±
2025-05-17 11:24:07,387 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2631 k√Ω t·ª±
2025-05-17 11:24:07,387 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 14850 k√Ω t·ª±
2025-05-17 11:24:07,389 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_112407.txt
2025-05-17 11:24:07,389 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ c√¥ng vi·ªác c·ªßa c√°c ph√≤ng ban trong c√¥ng ty. 
Nhi·ªám v·ª• c·ªßa b·∫°n l√† ph√¢n t√≠ch th√¥ng tin v·ªÅ c√°c task trong ph√≤ng ban v√† cung c·∫•p th√¥ng tin h·ªØu √≠ch cho ng∆∞·ªùi d√πng.

D·ª± √°n ƒë∆∞·ª£c ch...
2025-05-17 11:24:07,390 - chatbot_rag - INFO - User prompt: 
Vai tr√≤ c·ªßa b·∫°n: Tr·ª£ l√Ω th√¥ng minh cung c·∫•p th√¥ng tin v·ªÅ ph√≤ng ban v√† c√¥ng vi·ªác trong c√¥ng ty.


C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Th√¥ng tin v·ªÅ ph√≤ng ban Kinh doanh:
S·ªë l∆∞·ª£ng tasks: 24
C√°...
2025-05-17 11:24:07,390 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 11:24:51,101 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:24:51,102 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

**Alo!** üòÑ  
B·∫°n ƒëang c·∫ßn th√¥ng tin g√¨ v·ªÅ ph√≤ng ban **Kinh doanh**? M√¨nh s·∫µn s√†ng h·ªó tr·ª£ b·∫°n ngay l·∫≠p t·ª©c nh√©! N·∫øu b·∫°n mu·ªën bi·∫øt chi ti·∫øt v·ªÅ c√°c task, giai ƒëo·∫°n ho·∫∑c quy tr√¨nh li√™n 
2025-05-17 11:24:51,104 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_112451.txt
2025-05-17 11:24:51,106 - chatbot_rag - INFO - ƒê√£ l∆∞u response v√†o file: data/logs/response_20250517_112407.txt
2025-05-17 11:24:51,106 - chatbot_rag - INFO - Th·ªùi gian truy v·∫•n LLM: 43.75 gi√¢y
2025-05-17 11:24:51,700 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: Kinh doanh
2025-05-17 11:24:51,701 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, k√≠ch th∆∞·ªõc: 16485 bytes
2025-05-17 11:24:51,703 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 5 giai ƒëo·∫°n v√† 24 c√¥ng vi·ªác cho ph√≤ng ban Kinh doanh
2025-05-17 11:24:55,500 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 218 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-17 11:24:55,501 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-17 11:24:55,501 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i ph√≤ng ban Kinh doanh v√†o l·ªãch s·ª≠ c·ªßa session d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:25:55,751 - websockets.server - INFO - connection open
2025-05-17 11:29:12,047 - websockets.server - INFO - connection open
2025-05-17 11:43:10,391 - websockets.server - INFO - connection open
2025-05-17 11:43:25,110 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alo /no_think","session_id":"cf6e5d85-f403-4c4d-8afc-06ff092bdf8c"}
2025-05-17 11:43:25,110 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:25,111 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alo /no_think...
2025-05-17 11:43:25,112 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alo /no_think, enable_thinking=False
2025-05-17 11:43:25,112 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:43:25,113 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: alo /no_think, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:25,117 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:43:25,121 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:43:25,121 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:43:25,122 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c genera...
2025-05-17 11:43:25,123 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 486 k√Ω t·ª±
2025-05-17 11:43:25,124 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:43:25,124 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4667 k√Ω t·ª±
2025-05-17 11:43:25,129 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114325.txt
2025-05-17 11:43:25,130 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:43:25,130 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c genera...
2025-05-17 11:43:25,131 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:43:38,245 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:43:38,246 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-17 11:43:38,247 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114338.txt
2025-05-17 11:43:38,249 - chatbot_rag - INFO - [analysis_20250517_114338] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_114338_raw.txt
2025-05-17 11:43:38,249 - chatbot_rag - INFO - [analysis_20250517_114338] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-17 11:43:38,250 - chatbot_rag - WARNING - [analysis_20250517_114338] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:43:38,250 - chatbot_rag - INFO - [analysis_20250517_114338] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-17 11:43:38,251 - chatbot_rag - INFO - [analysis_20250517_114338] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-17 11:43:38,251 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=Kinh doanh, Lo·∫°i=department_specific, Thinking=False
2025-05-17 11:43:38,252 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alo /no_think', ph√≤ng ban: Kinh doanh, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,252 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,252 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: alo
2025-05-17 11:43:38,253 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:43:38,253 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:43:38,253 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=Kinh doanh, Lo·∫°i=department_specific, Thinking=False
2025-05-17 11:43:38,254 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: alo /no_think
2025-05-17 11:43:38,254 - websocket_server - INFO - C√¢u h·ªèi v·ªÅ ph√≤ng ban c·ª• th·ªÉ: Kinh doanh, ch·∫ø ƒë·ªô thinking: False
2025-05-17 11:43:38,254 - chatbot_rag - INFO - Truy v·∫•n Smart RAG - Giai ƒëo·∫°n: None, Ph√≤ng ban: Kinh doanh, Session: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,264 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:43:38,266 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: Kinh doanh
2025-05-17 11:43:38,267 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, k√≠ch th∆∞·ªõc: 16485 bytes
2025-05-17 11:43:38,272 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 5 giai ƒëo·∫°n v√† 24 c√¥ng vi·ªác cho ph√≤ng ban Kinh doanh
2025-05-17 11:43:38,273 - chatbot_rag - INFO - T·∫°o prompt LLM cho ph√≤ng ban: Kinh doanh, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,274 - chatbot_rag - INFO - S·ªë task: 24
2025-05-17 11:43:38,274 - chatbot_rag - INFO - L·∫•y l·ªãch s·ª≠ h·ªôi tho·∫°i t·ª´ phi√™n cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,275 - chatbot_rag - WARNING - [create_llm_prompt] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server. Th·ª≠ get_chat_history (c·ª•c b·ªô).
2025-05-17 11:43:38,276 - chatbot_rag - INFO - [create_llm_prompt] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ get_chat_history (c·ª•c b·ªô).
2025-05-17 11:43:38,280 - chatbot_rag - INFO - G·ªçi LLM:  t·∫°i 
2025-05-17 11:43:38,283 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_20250517_114338.txt
2025-05-17 11:43:38,283 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 12219 k√Ω t·ª±
2025-05-17 11:43:38,284 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2631 k√Ω t·ª±
2025-05-17 11:43:38,284 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 14850 k√Ω t·ª±
2025-05-17 11:43:38,287 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114338.txt
2025-05-17 11:43:38,287 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ c√¥ng vi·ªác c·ªßa c√°c ph√≤ng ban trong c√¥ng ty. 
Nhi·ªám v·ª• c·ªßa b·∫°n l√† ph√¢n t√≠ch th√¥ng tin v·ªÅ c√°c task trong ph√≤ng ban v√† cung c·∫•p th√¥ng tin h·ªØu √≠ch cho ng∆∞·ªùi d√πng.

D·ª± √°n ƒë∆∞·ª£c ch...
2025-05-17 11:43:38,287 - chatbot_rag - INFO - User prompt: 
Vai tr√≤ c·ªßa b·∫°n: Tr·ª£ l√Ω th√¥ng minh cung c·∫•p th√¥ng tin v·ªÅ ph√≤ng ban v√† c√¥ng vi·ªác trong c√¥ng ty.


C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /no_think"

Th√¥ng tin v·ªÅ ph√≤ng ban Kinh doanh:
S·ªë l∆∞·ª£ng tasks: 24
C√°...
2025-05-17 11:43:38,288 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 11:44:21,342 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:44:21,344 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

**Alo!** üéâ  
T√¥i ƒë√¢y, b·∫°n mu·ªën bi·∫øt g√¨ v·ªÅ ph√≤ng ban **Kinh doanh** v√† c√°c giai ƒëo·∫°n li√™n quan? D√π l√† task, m·ª•c ti√™u hay quy tr√¨nh, m√¨nh s·∫Ω gi·∫£i th√≠ch r√µ r√†ng cho b·∫°n nh√©! üíº‚ú®
2025-05-17 11:44:21,346 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114421.txt
2025-05-17 11:44:21,348 - chatbot_rag - INFO - ƒê√£ l∆∞u response v√†o file: data/logs/response_20250517_114338.txt
2025-05-17 11:44:21,349 - chatbot_rag - INFO - Th·ªùi gian truy v·∫•n LLM: 43.08 gi√¢y
2025-05-17 11:44:21,358 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: Kinh doanh
2025-05-17 11:44:21,359 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, k√≠ch th∆∞·ªõc: 16485 bytes
2025-05-17 11:44:21,363 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 5 giai ƒëo·∫°n v√† 24 c√¥ng vi·ªác cho ph√≤ng ban Kinh doanh
2025-05-17 11:44:21,371 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 173 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-17 11:44:21,372 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-17 11:44:21,372 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i ph√≤ng ban Kinh doanh v√†o l·ªãch s·ª≠ c·ªßa session cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:45:53,285 - websockets.server - INFO - connection open
2025-05-17 11:46:04,838 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alo /think","session_id":"284b52f9-dae0-4001-98fc-1e425fa03bf9"}
2025-05-17 11:46:04,839 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:04,839 - websocket_server - INFO - B·∫≠t ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alo /think...
2025-05-17 11:46:04,839 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alo /think, enable_thinking=True
2025-05-17 11:46:04,840 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:46:04,840 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: alo /think, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:04,842 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c general h...
2025-05-17 11:46:04,844 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 483 k√Ω t·ª±
2025-05-17 11:46:04,849 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:46:04,855 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4664 k√Ω t·ª±
2025-05-17 11:46:04,872 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114604.txt
2025-05-17 11:46:04,879 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:46:04,886 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo /think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c general h...
2025-05-17 11:46:04,892 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:46:23,452 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:46:23,453 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current message is "alo". First, I need to check the history to see if there was a previous department mentioned. Since the history is empty, there's 
2025-05-17 11:46:23,455 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114623.txt
2025-05-17 11:46:23,458 - chatbot_rag - INFO - [analysis_20250517_114623] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_114623_raw.txt
2025-05-17 11:46:23,458 - chatbot_rag - INFO - [analysis_20250517_114623] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current message is "alo". First, I need to check t...
2025-05-17 11:46:23,459 - chatbot_rag - WARNING - [analysis_20250517_114623] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:46:23,459 - chatbot_rag - INFO - [analysis_20250517_114623] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 11:46:23,461 - chatbot_rag - INFO - [analysis_20250517_114623] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:46:23,461 - chatbot_rag - INFO - [analysis_20250517_114623] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 11:46:23,462 - chatbot_rag - WARNING - [analysis_20250517_114623] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 11:46:23,463 - chatbot_rag - INFO - [analysis_20250517_114623] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 11:46:23,480 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:46:23,482 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:46:23,488 - chatbot_rag - INFO - [analysis_20250517_114623] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:46:23,489 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=True
2025-05-17 11:46:23,489 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alo /think', ph√≤ng ban: None, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,490 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,492 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /think, b·∫≠t ch·∫ø ƒë·ªô thinking cho: alo
2025-05-17 11:46:23,493 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alo', Mode thinking: True
2025-05-17 11:46:23,493 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 11:46:23,493 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: alo, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,494 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c general ho·∫∑c nul...
2025-05-17 11:46:23,497 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 476 k√Ω t·ª±
2025-05-17 11:46:23,498 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:46:23,499 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4657 k√Ω t·ª±
2025-05-17 11:46:23,502 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114623.txt
2025-05-17 11:46:23,503 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:46:23,504 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "alo"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_specific ho·∫∑c general ho·∫∑c nul...
2025-05-17 11:46:23,505 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:46:33,627 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:46:33,628 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current message is "alo", which is a casual way of saying "hello" in Vietnamese. The history doesn't mention any previous department or context.

Firs
2025-05-17 11:46:33,630 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114633.txt
2025-05-17 11:46:33,632 - chatbot_rag - INFO - [analysis_20250517_114633] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_114633_raw.txt
2025-05-17 11:46:33,632 - chatbot_rag - INFO - [analysis_20250517_114633] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current message is "alo", which is a casual way of...
2025-05-17 11:46:33,633 - chatbot_rag - WARNING - [analysis_20250517_114633] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:46:33,633 - chatbot_rag - INFO - [analysis_20250517_114633] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 11:46:33,633 - chatbot_rag - INFO - [analysis_20250517_114633] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:46:33,634 - chatbot_rag - INFO - [analysis_20250517_114633] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 11:46:33,634 - chatbot_rag - WARNING - [analysis_20250517_114633] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 11:46:33,636 - chatbot_rag - INFO - [analysis_20250517_114633] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 11:46:33,645 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:46:33,645 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:46:33,647 - chatbot_rag - INFO - [analysis_20250517_114633] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:46:33,648 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=True
2025-05-17 11:46:33,649 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: alo /think
2025-05-17 11:46:33,649 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: True
2025-05-17 11:46:33,651 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:33,657 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:46:33,658 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:46:33,660 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:33,661 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250517_114633.txt
2025-05-17 11:46:33,663 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1622 k√Ω t·ª±
2025-05-17 11:46:33,663 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1059 k√Ω t·ª±
2025-05-17 11:46:33,664 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2681 k√Ω t·ª±
2025-05-17 11:46:33,665 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114633.txt
2025-05-17 11:46:33,665 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-17 11:46:33,666 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "alo /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-...
2025-05-17 11:46:33,667 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 11:46:57,002 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:46:57,003 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, the user asked "alo /think" which is a casual way of saying "hello" or "what's up?" in Vietnamese. They mentioned it's a general question about the process or stages. I need to respond b
2025-05-17 11:46:57,005 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114657.txt
2025-05-17 11:46:57,010 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1472 k√Ω t·ª±) v√† c√≤n l·∫°i 465 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-17 11:46:57,011 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1472 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-17 11:46:57,012 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,120 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"m√†y l√† ai /think","session_id":"284b52f9-dae0-4001-98fc-1e425fa03bf9"}
2025-05-17 11:48:34,121 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,121 - websocket_server - INFO - B·∫≠t ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: m√†y l√† ai /think...
2025-05-17 11:48:34,121 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: m√†y l√† ai /think, enable_thinking=True
2025-05-17 11:48:34,122 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 11:48:34,124 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_114834.txt
2025-05-17 11:48:34,125 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai /think, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,126 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai /think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_t...
2025-05-17 11:48:34,128 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 524 k√Ω t·ª±
2025-05-17 11:48:34,128 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:48:34,129 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4705 k√Ω t·ª±
2025-05-17 11:48:34,131 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114834.txt
2025-05-17 11:48:34,132 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:48:34,132 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai /think"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_t...
2025-05-17 11:48:34,134 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:48:52,863 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:48:52,866 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current question is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng: alo m√†y l√† ai /think". First, I need to parse the input correctly.

The user is asking about their 
2025-05-17 11:48:52,870 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114852.txt
2025-05-17 11:48:52,872 - chatbot_rag - INFO - [analysis_20250517_114852] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_114852_raw.txt
2025-05-17 11:48:52,873 - chatbot_rag - INFO - [analysis_20250517_114852] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current question is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng:...
2025-05-17 11:48:52,873 - chatbot_rag - WARNING - [analysis_20250517_114852] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:48:52,873 - chatbot_rag - INFO - [analysis_20250517_114852] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 11:48:52,874 - chatbot_rag - INFO - [analysis_20250517_114852] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:48:52,874 - chatbot_rag - INFO - [analysis_20250517_114852] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 11:48:52,874 - chatbot_rag - WARNING - [analysis_20250517_114852] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 11:48:52,875 - chatbot_rag - INFO - [analysis_20250517_114852] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 11:48:52,879 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:48:52,880 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:48:52,880 - chatbot_rag - INFO - [analysis_20250517_114852] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:48:52,880 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=True
2025-05-17 11:48:52,881 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'm√†y l√† ai /think', ph√≤ng ban: None, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,881 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,881 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /think, b·∫≠t ch·∫ø ƒë·ªô thinking cho: m√†y l√† ai
2025-05-17 11:48:52,882 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'm√†y l√† ai', Mode thinking: True
2025-05-17 11:48:52,883 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 11:48:52,885 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_114852.txt
2025-05-17 11:48:52,886 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,887 - chatbot_rag - WARNING - [analyze_query_with_llm] Kh√¥ng th·ªÉ import get_session_history t·ª´ websocket_server, s·ª≠ d·ª•ng get_chat_history
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] L·∫•y l·ªãch s·ª≠ t·ª´ get_chat_history: 0 b·∫£n ghi
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "...
2025-05-17 11:48:52,889 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 517 k√Ω t·ª±
2025-05-17 11:48:52,889 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 4181 k√Ω t·ª±
2025-05-17 11:48:52,889 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 4698 k√Ω t·ª±
2025-05-17 11:48:52,890 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114852.txt
2025-05-17 11:48:52,891 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n ph√¢n t√≠ch n·ªôi dung c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
1. Ph√≤ng ban m√† ng∆∞·ªùi d√πng ƒëang h·ªèi v·ªÅ (department)
2. Ph√¢n lo·∫°i c√¢u h·ªèi l√† v·ªÅ ph√≤ng ban c·ª• th·ªÉ hay c√¢u h·ªèi chung (query_type)
3. X√°c ƒë...
2025-05-17 11:48:52,891 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:

C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alo

m√†y l√† ai"

Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
{"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "...
2025-05-17 11:48:52,891 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 11:49:02,907 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:49:02,908 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current message is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng: alo m√†y l√† ai". First, I need to parse the history and the current question.

Looking at the history
2025-05-17 11:49:02,915 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114902.txt
2025-05-17 11:49:02,917 - chatbot_rag - INFO - [analysis_20250517_114902] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_114902_raw.txt
2025-05-17 11:49:02,917 - chatbot_rag - INFO - [analysis_20250517_114902] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current message is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng: ...
2025-05-17 11:49:02,918 - chatbot_rag - WARNING - [analysis_20250517_114902] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-17 11:49:02,918 - chatbot_rag - INFO - [analysis_20250517_114902] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 11:49:02,918 - chatbot_rag - INFO - [analysis_20250517_114902] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:49:02,919 - chatbot_rag - INFO - [analysis_20250517_114902] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 11:49:02,919 - chatbot_rag - WARNING - [analysis_20250517_114902] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 11:49:02,919 - chatbot_rag - INFO - [analysis_20250517_114902] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 11:49:02,927 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:49:02,928 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:49:02,928 - chatbot_rag - INFO - [analysis_20250517_114902] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:49:02,929 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=True
2025-05-17 11:49:02,929 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: m√†y l√† ai /think
2025-05-17 11:49:02,929 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: True
2025-05-17 11:49:02,929 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:49:02,932 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 11:49:02,932 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 11:49:02,933 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:49:02,934 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250517_114902.txt
2025-05-17 11:49:02,936 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1628 k√Ω t·ª±
2025-05-17 11:49:02,936 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1059 k√Ω t·ª±
2025-05-17 11:49:02,937 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2687 k√Ω t·ª±
2025-05-17 11:49:02,938 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_114902.txt
2025-05-17 11:49:02,939 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-17 11:49:02,939 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "m√†y l√† ai /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. ...
2025-05-17 11:49:02,940 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://localhost:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 11:49:27,720 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-17 11:49:27,722 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user asked "m√†y l√† ai" which is a general question about the process or stages. I need to follow the strict rules provided.

First, the instructions say not to create conn
2025-05-17 11:49:27,724 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250517_114927.txt
2025-05-17 11:49:27,729 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (895 k√Ω t·ª±) v√† c√≤n l·∫°i 1006 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-17 11:49:27,729 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (895 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-17 11:49:27,737 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 13:36:45,708 - websockets.server - INFO - server closing
2025-05-17 13:36:45,735 - websockets.server - INFO - server closed
2025-05-17 13:36:45,777 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-17 15:31:56,478 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-17 15:31:56,502 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 15:31:56,502 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-17 15:31:56,503 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-17 15:33:32,560 - websockets.server - INFO - connection open
2025-05-17 15:33:32,815 - websockets.server - INFO - connection open
2025-05-17 15:33:35,223 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-17 15:33:35,225 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,226 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,226 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-17 15:33:35,226 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-17 15:33:35,227 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 15:33:35,227 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,278 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,280 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 15:33:35,281 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-17 15:33:35,281 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-17 15:33:35,282 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-17 15:33:35,282 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2603 k√Ω t·ª±
2025-05-17 15:33:35,284 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_153335.txt
2025-05-17 15:33:35,285 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-17 15:33:35,286 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-17 15:33:35,292 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 15:33:37,370 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6BBA10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:37,373 - chatbot_rag - INFO - [analysis_20250517_153337] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_153337_raw.txt
2025-05-17 15:33:37,374 - chatbot_rag - INFO - [analysis_20250517_153337] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 15:33:37,376 - chatbot_rag - INFO - [analysis_20250517_153337] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 15:33:37,378 - chatbot_rag - INFO - [analysis_20250517_153337] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 15:33:37,379 - chatbot_rag - INFO - [analysis_20250517_153337] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 15:33:37,384 - chatbot_rag - WARNING - [analysis_20250517_153337] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 15:33:37,385 - chatbot_rag - INFO - [analysis_20250517_153337] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 15:33:37,406 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 15:33:37,407 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 15:33:37,407 - chatbot_rag - INFO - [analysis_20250517_153337] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 15:33:37,408 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 15:33:37,408 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,408 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,412 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-17 15:33:37,413 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-17 15:33:37,414 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-17 15:33:37,415 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,415 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,415 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 15:33:37,416 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-17 15:33:37,417 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-17 15:33:37,418 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-17 15:33:37,418 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2593 k√Ω t·ª±
2025-05-17 15:33:37,421 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_153337.txt
2025-05-17 15:33:37,421 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-17 15:33:37,421 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-17 15:33:37,422 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 15:33:39,461 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6EE5D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:39,463 - chatbot_rag - INFO - [analysis_20250517_153339] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_153339_raw.txt
2025-05-17 15:33:39,464 - chatbot_rag - INFO - [analysis_20250517_153339] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 15:33:39,466 - chatbot_rag - WARNING - [analysis_20250517_153339] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 15:33:39,466 - chatbot_rag - INFO - [analysis_20250517_153339] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 15:33:39,470 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 15:33:39,471 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 15:33:39,471 - chatbot_rag - INFO - [analysis_20250517_153339] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 15:33:39,472 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 15:33:39,472 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-17 15:33:39,472 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-17 15:33:39,473 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:39,476 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 15:33:39,477 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 15:33:39,478 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:39,479 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250517_153339.txt
2025-05-17 15:33:39,480 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1630 k√Ω t·ª±
2025-05-17 15:33:39,480 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-17 15:33:39,481 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2835 k√Ω t·ª±
2025-05-17 15:33:39,482 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_153339.txt
2025-05-17 15:33:39,482 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-17 15:33:39,483 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-17 15:33:39,484 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 15:33:41,526 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6EEC10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:41,796 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:37:00,203 - websockets.server - INFO - connection open
2025-05-17 16:37:00,380 - websockets.server - INFO - connection open
2025-05-17 16:47:00,854 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-17 16:47:00,869 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,877 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,878 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-17 16:47:00,881 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-17 16:47:00,883 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 16:47:00,902 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_164700.txt
2025-05-17 16:47:00,905 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,911 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,914 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 16:47:00,915 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-17 16:47:00,918 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 639 k√Ω t·ª±
2025-05-17 16:47:00,919 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-17 16:47:00,919 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2643 k√Ω t·ª±
2025-05-17 16:47:00,926 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_164700.txt
2025-05-17 16:47:00,927 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-17 16:47:00,929 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-17 16:47:00,931 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 16:47:03,018 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A8AD6E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:03,027 - chatbot_rag - INFO - [analysis_20250517_164703] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_164703_raw.txt
2025-05-17 16:47:03,029 - chatbot_rag - INFO - [analysis_20250517_164703] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 16:47:03,031 - chatbot_rag - INFO - [analysis_20250517_164703] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 16:47:03,033 - chatbot_rag - INFO - [analysis_20250517_164703] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 16:47:03,034 - chatbot_rag - INFO - [analysis_20250517_164703] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 16:47:03,040 - chatbot_rag - WARNING - [analysis_20250517_164703] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 16:47:03,045 - chatbot_rag - INFO - [analysis_20250517_164703] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 16:47:03,073 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 16:47:03,074 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 16:47:03,075 - chatbot_rag - INFO - [analysis_20250517_164703] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 16:47:03,076 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 16:47:03,078 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,079 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,081 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-17 16:47:03,081 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-17 16:47:03,082 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-17 16:47:03,086 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250517_164703.txt
2025-05-17 16:47:03,086 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n p...
2025-05-17 16:47:03,088 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 629 k√Ω t·ª±
2025-05-17 16:47:03,088 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-17 16:47:03,088 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2633 k√Ω t·ª±
2025-05-17 16:47:03,092 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_164703.txt
2025-05-17 16:47:03,093 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-17 16:47:03,093 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n p...
2025-05-17 16:47:03,094 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-17 16:47:05,126 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A8ADF30>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:05,130 - chatbot_rag - INFO - [analysis_20250517_164705] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250517_164705_raw.txt
2025-05-17 16:47:05,131 - chatbot_rag - INFO - [analysis_20250517_164705] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 16:47:05,132 - chatbot_rag - INFO - [analysis_20250517_164705] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-17 16:47:05,133 - chatbot_rag - INFO - [analysis_20250517_164705] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-17 16:47:05,134 - chatbot_rag - INFO - [analysis_20250517_164705] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-17 16:47:05,135 - chatbot_rag - WARNING - [analysis_20250517_164705] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-17 16:47:05,136 - chatbot_rag - INFO - [analysis_20250517_164705] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-17 16:47:05,152 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 16:47:05,153 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 16:47:05,154 - chatbot_rag - INFO - [analysis_20250517_164705] B∆Ø·ªöC 3: K·∫øt qu·∫£ ph√¢n t√≠ch th·ªß c√¥ng: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 16:47:05,155 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-17 16:47:05,156 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-17 16:47:05,158 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-17 16:47:05,160 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:05,170 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-17 16:47:05,173 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-17 16:47:05,174 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:05,176 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250517_164705.txt
2025-05-17 16:47:05,177 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1630 k√Ω t·ª±
2025-05-17 16:47:05,177 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-17 16:47:05,178 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2835 k√Ω t·ª±
2025-05-17 16:47:05,181 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250517_164705.txt
2025-05-17 16:47:05,182 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-17 16:47:05,183 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-17 16:47:05,184 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-17 16:47:07,229 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A87DFD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:07,285 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 17:15:19,590 - websockets.server - INFO - server closing
2025-05-17 17:15:19,624 - websockets.server - INFO - server closed
2025-05-17 17:15:19,644 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-17 17:55:10,389 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-17 17:55:10,452 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 17:55:10,452 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-17 17:55:10,453 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-17 17:55:12,734 - websockets.server - INFO - server closing
2025-05-17 17:55:12,735 - websockets.server - INFO - server closed
2025-05-17 17:55:12,735 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 16:38:50,623 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 16:38:50,684 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:38:50,685 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 16:38:50,685 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 16:38:54,200 - websockets.server - INFO - server closing
2025-05-18 16:38:54,201 - websockets.server - INFO - server closed
2025-05-18 16:38:54,202 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 16:44:04,478 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 16:44:04,515 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:44:04,515 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 16:44:04,515 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 16:45:14,834 - websockets.server - INFO - connection open
2025-05-18 16:45:17,147 - websockets.server - INFO - connection open
2025-05-18 16:45:19,051 - websockets.server - INFO - connection closed
2025-05-18 16:45:19,052 - websockets.server - INFO - connection closed
2025-05-18 16:45:19,900 - websockets.server - INFO - connection open
2025-05-18 16:45:20,900 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-18 16:45:20,901 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,901 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,902 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 16:45:20,902 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-18 16:45:20,903 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 16:45:20,903 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,917 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,919 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:45:20,919 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:45:20,920 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 16:45:20,920 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:45:20,921 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2603 k√Ω t·ª±
2025-05-18 16:45:20,923 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164520.txt
2025-05-18 16:45:20,923 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:45:20,924 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:45:20,924 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:45:42,000 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0A98BB0>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:45:42,008 - chatbot_rag - INFO - [analysis_20250518_164542] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_164542_raw.txt
2025-05-18 16:45:42,008 - chatbot_rag - INFO - [analysis_20250518_164542] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:45:42,009 - chatbot_rag - INFO - [analysis_20250518_164542] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:45:42,011 - chatbot_rag - INFO - [analysis_20250518_164542] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:45:42,012 - chatbot_rag - INFO - [analysis_20250518_164542] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:45:42,013 - chatbot_rag - WARNING - [analysis_20250518_164542] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:45:42,014 - chatbot_rag - INFO - [analysis_20250518_164542] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:45:42,032 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:45:42,032 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:45:42,033 - chatbot_rag - ERROR - [analysis_20250518_164542] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:45:42,034 - chatbot_rag - WARNING - [analysis_20250518_164542] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:45:42,034 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:45:42,035 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,035 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,036 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 16:45:42,036 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 16:45:42,036 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 16:45:42,036 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,036 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,037 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:45:42,037 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 16:45:42,037 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-18 16:45:42,037 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:45:42,038 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2593 k√Ω t·ª±
2025-05-18 16:45:42,039 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164542.txt
2025-05-18 16:45:42,039 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:45:42,040 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 16:45:42,040 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:46:03,078 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0C847C0>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:46:03,085 - chatbot_rag - INFO - [analysis_20250518_164603] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_164603_raw.txt
2025-05-18 16:46:03,086 - chatbot_rag - INFO - [analysis_20250518_164603] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:46:03,088 - chatbot_rag - INFO - [analysis_20250518_164603] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:46:03,090 - chatbot_rag - INFO - [analysis_20250518_164603] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:46:03,092 - chatbot_rag - INFO - [analysis_20250518_164603] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:46:03,093 - chatbot_rag - WARNING - [analysis_20250518_164603] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:46:03,094 - chatbot_rag - INFO - [analysis_20250518_164603] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:46:03,102 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:46:03,102 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:46:03,103 - chatbot_rag - ERROR - [analysis_20250518_164603] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:46:03,103 - chatbot_rag - WARNING - [analysis_20250518_164603] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:46:03,104 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:46:03,104 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-18 16:46:03,105 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 16:46:03,105 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:46:03,116 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:46:03,118 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:46:03,118 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:46:03,121 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_164603.txt
2025-05-18 16:46:03,122 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1630 k√Ω t·ª±
2025-05-18 16:46:03,123 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:46:03,124 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2835 k√Ω t·ª±
2025-05-18 16:46:03,126 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164603.txt
2025-05-18 16:46:03,128 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:46:03,129 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 16:46:03,130 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:46:24,187 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0A75880>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:46:24,746 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:08,818 - websockets.server - INFO - connection closed
2025-05-18 16:48:35,719 - websockets.server - INFO - connection open
2025-05-18 16:48:36,876 - websockets.server - INFO - connection closed
2025-05-18 16:48:37,295 - websockets.server - INFO - connection open
2025-05-18 16:48:39,719 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-18 16:48:39,720 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,720 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,720 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 16:48:39,721 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-18 16:48:39,721 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:48:39,723 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_164839.txt
2025-05-18 16:48:39,724 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-18 16:48:39,726 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 639 k√Ω t·ª±
2025-05-18 16:48:39,726 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:48:39,727 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2643 k√Ω t·ª±
2025-05-18 16:48:39,729 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164839.txt
2025-05-18 16:48:39,729 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:48:39,729 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-18 16:48:39,730 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:49:00,809 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D43400>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_164900_raw.txt
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:49:00,812 - chatbot_rag - INFO - [analysis_20250518_164900] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:49:00,812 - chatbot_rag - INFO - [analysis_20250518_164900] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:49:00,813 - chatbot_rag - WARNING - [analysis_20250518_164900] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:49:00,813 - chatbot_rag - INFO - [analysis_20250518_164900] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:49:00,817 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:49:00,817 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:49:00,818 - chatbot_rag - ERROR - [analysis_20250518_164900] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:49:00,818 - chatbot_rag - WARNING - [analysis_20250518_164900] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:49:00,818 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:49:00,819 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,819 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,819 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 16:49:00,819 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 16:49:00,820 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:49:00,821 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_164900.txt
2025-05-18 16:49:00,821 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n p...
2025-05-18 16:49:00,823 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 629 k√Ω t·ª±
2025-05-18 16:49:00,823 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:49:00,823 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2633 k√Ω t·ª±
2025-05-18 16:49:00,825 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164900.txt
2025-05-18 16:49:00,825 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:49:00,825 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n p...
2025-05-18 16:49:00,826 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:49:21,859 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D43C70>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:21,861 - chatbot_rag - INFO - [analysis_20250518_164921] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_164921_raw.txt
2025-05-18 16:49:21,861 - chatbot_rag - INFO - [analysis_20250518_164921] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:49:21,862 - chatbot_rag - INFO - [analysis_20250518_164921] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:49:21,862 - chatbot_rag - INFO - [analysis_20250518_164921] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:49:21,863 - chatbot_rag - INFO - [analysis_20250518_164921] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:49:21,863 - chatbot_rag - WARNING - [analysis_20250518_164921] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:49:21,863 - chatbot_rag - INFO - [analysis_20250518_164921] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:49:21,868 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:49:21,868 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:49:21,869 - chatbot_rag - ERROR - [analysis_20250518_164921] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:49:21,869 - chatbot_rag - WARNING - [analysis_20250518_164921] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:49:21,870 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:49:21,870 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-18 16:49:21,870 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 16:49:21,871 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:21,876 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:49:21,876 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:49:21,877 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:21,879 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_164921.txt
2025-05-18 16:49:21,880 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1630 k√Ω t·ª±
2025-05-18 16:49:21,880 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:49:21,881 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2835 k√Ω t·ª±
2025-05-18 16:49:21,883 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_164921.txt
2025-05-18 16:49:21,883 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:49:21,884 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 16:49:21,885 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:49:42,928 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D4B820>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:42,934 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:42,936 - websockets.server - INFO - connection open
2025-05-18 16:51:46,475 - websockets.server - INFO - connection closed
2025-05-18 16:51:46,488 - websockets.server - INFO - connection closed
2025-05-18 16:51:46,491 - websockets.server - INFO - server closing
2025-05-18 16:51:46,493 - websockets.server - INFO - server closed
2025-05-18 16:51:46,504 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 16:51:50,273 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 16:51:50,333 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:51:50,333 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 16:51:50,335 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 16:51:55,890 - websockets.server - INFO - connection open
2025-05-18 16:51:58,265 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-18 16:51:58,266 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,266 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,267 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 16:51:58,267 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-18 16:51:58,267 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 16:51:58,268 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,282 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,283 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:51:58,283 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:51:58,284 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 16:51:58,285 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:51:58,285 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2603 k√Ω t·ª±
2025-05-18 16:51:58,288 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165158.txt
2025-05-18 16:51:58,288 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:51:58,289 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:51:58,289 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:52:14,152 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:52:14,152 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:52:14,154 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165214.txt
2025-05-18 16:52:14,155 - chatbot_rag - INFO - [analysis_20250518_165214] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165214_raw.txt
2025-05-18 16:52:14,156 - chatbot_rag - INFO - [analysis_20250518_165214] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:52:14,156 - chatbot_rag - WARNING - [analysis_20250518_165214] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:52:14,158 - chatbot_rag - INFO - [analysis_20250518_165214] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 16:52:14,158 - chatbot_rag - INFO - [analysis_20250518_165214] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:52:14,159 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:52:14,161 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,162 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,162 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 16:52:14,163 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 16:52:14,163 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 16:52:14,163 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,164 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,164 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:52:14,165 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 16:52:14,165 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-18 16:52:14,166 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:52:14,166 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2593 k√Ω t·ª±
2025-05-18 16:52:14,168 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165214.txt
2025-05-18 16:52:14,168 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:52:14,168 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 16:52:14,169 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:52:26,134 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:52:26,135 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user's current question is "xin ch√†o", which means "hello" in Vietnamese. I need to analyze this based on the provided guidelines.

First, checking the history of messages
2025-05-18 16:52:26,136 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165226.txt
2025-05-18 16:52:26,138 - chatbot_rag - INFO - [analysis_20250518_165226] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165226_raw.txt
2025-05-18 16:52:26,139 - chatbot_rag - INFO - [analysis_20250518_165226] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's see. The user's current question is "xin ch√†o", which means "hello" in Vietnames...
2025-05-18 16:52:26,139 - chatbot_rag - WARNING - [analysis_20250518_165226] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:52:26,139 - chatbot_rag - INFO - [analysis_20250518_165226] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:52:26,140 - chatbot_rag - INFO - [analysis_20250518_165226] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:52:26,140 - chatbot_rag - INFO - [analysis_20250518_165226] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:52:26,140 - chatbot_rag - WARNING - [analysis_20250518_165226] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:52:26,141 - chatbot_rag - INFO - [analysis_20250518_165226] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:52:26,150 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:52:26,150 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:52:26,150 - chatbot_rag - ERROR - [analysis_20250518_165226] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:52:26,151 - chatbot_rag - WARNING - [analysis_20250518_165226] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:52:26,151 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:52:26,151 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-18 16:52:26,152 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 16:52:26,152 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:26,155 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:52:26,155 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:52:26,156 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:26,157 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_165226.txt
2025-05-18 16:52:26,157 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1630 k√Ω t·ª±
2025-05-18 16:52:26,157 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:52:26,157 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2835 k√Ω t·ª±
2025-05-18 16:52:26,158 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165226.txt
2025-05-18 16:52:26,159 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:52:26,159 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 16:52:26,160 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:52:53,301 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:52:53,301 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

# C·∫•u tr√∫c giai ƒëo·∫°n v√† quy tr√¨nh l√†m vi·ªác

## Giai ƒëo·∫°n ch√≠nh:
1. **MKT-SALES**: Marketing, Kinh doanh  
2. **PROPOSAL**: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n  
3. **CONSTRUCT
2025-05-18 16:52:53,303 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165253.txt
2025-05-18 16:52:53,603 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 791 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 16:52:53,603 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 16:52:53,603 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,075 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"t√¥i ƒë·∫πp trai kh√¥ng /no_think","session_id":""}
2025-05-18 16:53:15,076 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,077 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,077 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: t√¥i ƒë·∫πp trai kh√¥ng /no_think...
2025-05-18 16:53:15,077 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: t√¥i ƒë·∫πp trai kh√¥ng /no_think, enable_thinking=False
2025-05-18 16:53:15,078 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:53:15,079 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_165315.txt
2025-05-18 16:53:15,079 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {...
2025-05-18 16:53:15,081 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 649 k√Ω t·ª±
2025-05-18 16:53:15,081 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:53:15,082 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2653 k√Ω t·ª±
2025-05-18 16:53:15,083 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165315.txt
2025-05-18 16:53:15,083 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:53:15,084 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {...
2025-05-18 16:53:15,084 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:53:27,321 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:53:27,322 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:53:27,323 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165327.txt
2025-05-18 16:53:27,326 - chatbot_rag - INFO - [analysis_20250518_165327] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165327_raw.txt
2025-05-18 16:53:27,327 - chatbot_rag - INFO - [analysis_20250518_165327] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:53:27,327 - chatbot_rag - WARNING - [analysis_20250518_165327] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:53:27,328 - chatbot_rag - INFO - [analysis_20250518_165327] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 16:53:27,328 - chatbot_rag - INFO - [analysis_20250518_165327] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:53:27,328 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:53:27,329 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 't√¥i ƒë·∫πp trai kh√¥ng /no_think', ph√≤ng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,329 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,330 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: t√¥i ƒë·∫πp trai kh√¥ng
2025-05-18 16:53:27,330 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 't√¥i ƒë·∫πp trai kh√¥ng', Mode thinking: False
2025-05-18 16:53:27,330 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:53:27,332 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_165327.txt
2025-05-18 16:53:27,332 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-18 16:53:27,334 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 639 k√Ω t·ª±
2025-05-18 16:53:27,334 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:53:27,334 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2643 k√Ω t·ª±
2025-05-18 16:53:27,337 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165327.txt
2025-05-18 16:53:27,337 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:53:27,338 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

t√¥i ƒë·∫πp trai kh√¥ng"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departmen...
2025-05-18 16:53:27,338 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:53:38,907 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:53:38,907 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user provided a conversation history where the first message is "xin ch√†o" (hello) and then asks "t√¥i ƒë·∫πp trai kh√¥ng" (am I handsome?). There's no mention of a
2025-05-18 16:53:38,910 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165338.txt
2025-05-18 16:53:38,912 - chatbot_rag - INFO - [analysis_20250518_165338] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165338_raw.txt
2025-05-18 16:53:38,912 - chatbot_rag - INFO - [analysis_20250518_165338] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's break this down. The user provided a conversation history where the first messag...
2025-05-18 16:53:38,912 - chatbot_rag - WARNING - [analysis_20250518_165338] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:53:38,913 - chatbot_rag - INFO - [analysis_20250518_165338] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 16:53:38,913 - chatbot_rag - INFO - [analysis_20250518_165338] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:53:38,914 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:53:38,914 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: t√¥i ƒë·∫πp trai kh√¥ng /no_think
2025-05-18 16:53:38,914 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 16:53:38,915 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:38,917 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:53:38,918 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:53:38,918 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:38,920 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_165338.txt
2025-05-18 16:53:38,921 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1640 k√Ω t·ª±
2025-05-18 16:53:38,921 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:53:38,922 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2845 k√Ω t·ª±
2025-05-18 16:53:38,923 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165338.txt
2025-05-18 16:53:38,923 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:53:38,924 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "t√¥i ƒë·∫πp trai kh√¥ng /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong qu...
2025-05-18 16:53:38,924 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:53:59,027 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:53:59,028 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n ho·∫∑c ph√≤ng ban.

üòéüî• *T√îI ƒê·∫∏P TRAI!* üî•üòé  
üëâ N·∫øu b·∫°n mu·ªën bi·∫øt c√¥ng ty l√†m g√¨ trong t·ª´ng giai ƒëo·∫°n, vui l√≤ng h·ªèi v·ªÅ m·ªôt 
2025-05-18 16:53:59,029 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165359.txt
2025-05-18 16:53:59,032 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 397 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 16:53:59,033 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 16:53:59,033 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,121 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 16:56:19,122 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: ```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n ho·∫∑c ph√≤ng ban.

üòéüî• *T√îI ƒê·∫∏P TRAI!* üî•
2025-05-18 16:56:19,123 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:56:19,124 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_165619.txt
2025-05-18 16:56:19,125 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 16:56:19,126 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n ho·∫∑c ph√≤ng ban.

üòéüî• *T√îI ƒê·∫∏P TRAI!* üî•üòé  
üëâ N·∫øu b·∫°n mu·ªën bi·∫øt c√¥ng ty l√†m g√¨ trong t·ª´ng giai ƒëo·∫°n, vui l√≤ng h·ªèi v·ªÅ m·ªôt giai ƒëo·∫°n c·ª• th·ªÉ.  
üëâ N·∫øu b·∫°n mu·ªën bi·∫øt ph√≤ng ban n√†o l√†m g√¨, h√£y h·ªèi ri√™ng v·ªÅ m·ªôt ph√≤ng ban!  
üëâ V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o?" ho·∫∑c "Giai ƒëo·∫°n MKT-SALES g·ªìm nh·ªØng b∆∞·ªõc g√¨?"

üí¨ H√£y th·ª≠ l·∫°i nh√©!
```, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,127 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,127 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:56:19,128 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n h...
2025-05-18 16:56:19,129 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1049 k√Ω t·ª±
2025-05-18 16:56:19,130 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:56:19,130 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3053 k√Ω t·ª±
2025-05-18 16:56:19,133 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165619.txt
2025-05-18 16:56:19,134 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:56:19,134 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n h...
2025-05-18 16:56:19,135 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:56:43,522 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:56:43,523 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current question is about their own appearance, asking "t√¥i ƒë·∫πp trai kh√¥ng" which translates to "Am I handsome?" The history shows previous messages w
2025-05-18 16:56:43,525 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165643.txt
2025-05-18 16:56:43,527 - chatbot_rag - INFO - [analysis_20250518_165643] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165643_raw.txt
2025-05-18 16:56:43,528 - chatbot_rag - INFO - [analysis_20250518_165643] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current question is about their own appearance, as...
2025-05-18 16:56:43,528 - chatbot_rag - WARNING - [analysis_20250518_165643] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:56:43,530 - chatbot_rag - WARNING - [analysis_20250518_165643] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:56:43,530 - chatbot_rag - INFO - [analysis_20250518_165643] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:56:43,533 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:56:43,534 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:56:43,534 - chatbot_rag - INFO - [analysis_20250518_165643] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: Marketing
2025-05-18 16:56:43,535 - chatbot_rag - ERROR - [analysis_20250518_165643] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:56:43,535 - chatbot_rag - WARNING - [analysis_20250518_165643] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:56:43,536 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 16:56:43,536 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:43,538 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:56:43,539 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:56:43,539 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:43,540 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_165643.txt
2025-05-18 16:56:43,541 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 2016 k√Ω t·ª±
2025-05-18 16:56:43,541 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:56:43,541 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3221 k√Ω t·ª±
2025-05-18 16:56:43,543 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165643.txt
2025-05-18 16:56:43,543 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:56:43,544 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "```markdown
# C√¢u h·ªèi kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh, giai ƒëo·∫°n ho·∫∑c ph√≤ng ban.

üòéüî• *T√îI ƒê·∫∏P TRAI!* üî•üòé  
üëâ N·∫øu b·∫°n mu·ªën bi·∫øt c√¥ng ty l√†m g√¨ trong t·ª´ng giai ƒëo·∫°n, vui l√≤ng h·ªèi v·ªÅ m·ªôt giai ƒëo·∫°...
2025-05-18 16:56:43,544 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:57:26,651 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:57:26,652 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, the user provided a detailed query about their company's process and departments. They want me to structure the answer according to specific rules: no creating connections between depart
2025-05-18 16:57:26,654 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165726.txt
2025-05-18 16:57:26,665 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1018 k√Ω t·ª±) v√† c√≤n l·∫°i 764 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 16:57:26,666 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1018 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 16:57:26,666 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747562179121_hy1v07z
2025-05-18 16:57:26,669 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1018 k√Ω t·ª±)
2025-05-18 16:57:26,671 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"·ªßa m·∫Øc g√¨ /no_think","session_id":""}
2025-05-18 16:57:26,671 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,672 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,672 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: ·ªßa m·∫Øc g√¨ /no_think...
2025-05-18 16:57:26,673 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: ·ªßa m·∫Øc g√¨ /no_think, enable_thinking=False
2025-05-18 16:57:26,673 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:57:26,675 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_165726.txt
2025-05-18 16:57:26,676 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨ /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨ /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c...
2025-05-18 16:57:26,679 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 671 k√Ω t·ª±
2025-05-18 16:57:26,680 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:57:26,680 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2675 k√Ω t·ª±
2025-05-18 16:57:26,682 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165726.txt
2025-05-18 16:57:26,683 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:57:26,689 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨ /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c...
2025-05-18 16:57:26,690 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:57:39,187 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:57:39,187 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:57:39,188 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165739.txt
2025-05-18 16:57:39,190 - chatbot_rag - INFO - [analysis_20250518_165739] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165739_raw.txt
2025-05-18 16:57:39,190 - chatbot_rag - INFO - [analysis_20250518_165739] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:57:39,191 - chatbot_rag - WARNING - [analysis_20250518_165739] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:57:39,191 - chatbot_rag - INFO - [analysis_20250518_165739] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 16:57:39,192 - chatbot_rag - INFO - [analysis_20250518_165739] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:57:39,193 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:57:39,193 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: '·ªßa m·∫Øc g√¨ /no_think', ph√≤ng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,193 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,194 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: ·ªßa m·∫Øc g√¨
2025-05-18 16:57:39,194 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: '·ªßa m·∫Øc g√¨', Mode thinking: False
2025-05-18 16:57:39,194 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 16:57:39,196 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_165739.txt
2025-05-18 16:57:39,196 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,196 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,197 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:57:39,197 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°n...
2025-05-18 16:57:39,198 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 661 k√Ω t·ª±
2025-05-18 16:57:39,198 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2004 k√Ω t·ª±
2025-05-18 16:57:39,199 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2665 k√Ω t·ª±
2025-05-18 16:57:39,201 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165739.txt
2025-05-18 16:57:39,202 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay chung (query_type)
        3. N·∫øu c√¢u h·ªèi ƒë...
2025-05-18 16:57:39,202 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: t√¥i ƒë·∫πp trai kh√¥ng

·ªßa m·∫Øc g√¨"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°n...
2025-05-18 16:57:39,202 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 16:57:51,576 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:57:51,576 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a history of messages where the user asked "xin ch√†o" (hello) and then "t√¥i ƒë·∫πp trai kh√¥ng" (am I handsome?). Now, the current question is "·ªßa m·∫Øc g√¨", which
2025-05-18 16:57:51,578 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165751.txt
2025-05-18 16:57:51,581 - chatbot_rag - INFO - [analysis_20250518_165751] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_165751_raw.txt
2025-05-18 16:57:51,582 - chatbot_rag - INFO - [analysis_20250518_165751] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's see. The user provided a history of messages where the user asked "xin ch√†o" (he...
2025-05-18 16:57:51,582 - chatbot_rag - WARNING - [analysis_20250518_165751] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 16:57:51,583 - chatbot_rag - INFO - [analysis_20250518_165751] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 16:57:51,583 - chatbot_rag - INFO - [analysis_20250518_165751] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:57:51,584 - chatbot_rag - INFO - [analysis_20250518_165751] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 16:57:51,584 - chatbot_rag - WARNING - [analysis_20250518_165751] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 16:57:51,585 - chatbot_rag - INFO - [analysis_20250518_165751] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 16:57:51,592 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:57:51,593 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:57:51,593 - chatbot_rag - ERROR - [analysis_20250518_165751] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 16:57:51,594 - chatbot_rag - WARNING - [analysis_20250518_165751] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 16:57:51,594 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 16:57:51,595 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: ·ªßa m·∫Øc g√¨ /no_think
2025-05-18 16:57:51,595 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 16:57:51,595 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:51,600 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 16:57:51,600 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 16:57:51,601 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:51,602 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_165751.txt
2025-05-18 16:57:51,603 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1631 k√Ω t·ª±
2025-05-18 16:57:51,603 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 16:57:51,604 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2836 k√Ω t·ª±
2025-05-18 16:57:51,606 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_165751.txt
2025-05-18 16:57:51,606 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 16:57:51,607 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "·ªßa m·∫Øc g√¨ /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
...
2025-05-18 16:57:51,607 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 16:58:22,889 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 16:58:22,890 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

```markdown
# C·∫•u tr√∫c giai ƒëo·∫°n v√† quy tr√¨nh

## Giai ƒëo·∫°n ch√≠nh:
1. **MKT-SALES**
2. **PROPOSAL**
3. **CONSTRUCTION**
4. **DEFECT-HANDOVER**
5. **AFTERSALE-MAINTENANCE**

## Giai 
2025-05-18 16:58:22,893 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_165822.txt
2025-05-18 16:58:22,898 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 898 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 16:58:22,898 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 16:58:22,898 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:58:22,915 - websocket_server - INFO - WebSocket connection closed
2025-05-18 16:58:22,915 - websockets.server - INFO - connection closed
2025-05-18 16:58:22,924 - websockets.server - INFO - connection open
2025-05-18 17:03:10,270 - websockets.server - INFO - connection closed
2025-05-18 17:03:10,273 - websockets.server - INFO - server closing
2025-05-18 17:03:10,274 - websockets.server - INFO - server closed
2025-05-18 17:03:10,281 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 17:03:12,253 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 17:03:12,287 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:03:12,288 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 17:03:12,288 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 17:04:05,838 - websockets.server - INFO - connection open
2025-05-18 17:04:06,677 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think","session_id":""}
2025-05-18 17:04:06,678 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,678 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,679 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think...
2025-05-18 17:04:06,679 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think, enable_thinking=False
2025-05-18 17:04:06,679 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 17:04:06,680 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,683 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,684 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:04:06,684 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ...
2025-05-18 17:04:06,684 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 620 k√Ω t·ª±
2025-05-18 17:04:06,685 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:04:06,685 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2626 k√Ω t·ª±
2025-05-18 17:04:06,687 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170406.txt
2025-05-18 17:04:06,687 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:04:06,688 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ...
2025-05-18 17:04:06,688 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:04:19,632 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:04:19,633 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:04:19,634 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170419.txt
2025-05-18 17:04:19,636 - chatbot_rag - INFO - [analysis_20250518_170419] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170419_raw.txt
2025-05-18 17:04:19,636 - chatbot_rag - INFO - [analysis_20250518_170419] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:04:19,637 - chatbot_rag - WARNING - [analysis_20250518_170419] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:04:19,637 - chatbot_rag - INFO - [analysis_20250518_170419] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 17:04:19,638 - chatbot_rag - INFO - [analysis_20250518_170419] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:04:19,639 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:04:19,639 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think', ph√≤ng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,639 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,639 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
2025-05-18 17:04:19,640 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o, nay ƒëi l√†m ch√°n qu√°', Mode thinking: False
2025-05-18 17:04:19,640 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 17:04:19,640 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, nay ƒëi l√†m ch√°n qu√°, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,640 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,641 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:04:19,641 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o, nay ƒëi l√†m ch√°n qu√°"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null"...
2025-05-18 17:04:19,641 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 610 k√Ω t·ª±
2025-05-18 17:04:19,642 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:04:19,642 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2616 k√Ω t·ª±
2025-05-18 17:04:19,645 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170419.txt
2025-05-18 17:04:19,646 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:04:19,646 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o, nay ƒëi l√†m ch√°n qu√°"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null"...
2025-05-18 17:04:19,647 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:04:29,916 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:04:29,917 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user's current question is "xin ch√†o, nay ƒëi l√†m ch√°n qu√°." First, I need to determine the department. Since there's no mention of any specific department in t
2025-05-18 17:04:29,918 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170429.txt
2025-05-18 17:04:29,921 - chatbot_rag - INFO - [analysis_20250518_170429] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170429_raw.txt
2025-05-18 17:04:29,921 - chatbot_rag - INFO - [analysis_20250518_170429] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's break this down. The user's current question is "xin ch√†o, nay ƒëi l√†m ch√°n qu√°."...
2025-05-18 17:04:29,921 - chatbot_rag - WARNING - [analysis_20250518_170429] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:04:29,922 - chatbot_rag - INFO - [analysis_20250518_170429] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 17:04:29,922 - chatbot_rag - INFO - [analysis_20250518_170429] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:04:29,923 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:04:29,923 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think
2025-05-18 17:04:29,923 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 17:04:29,923 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:29,928 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:04:29,929 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:04:29,929 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:29,930 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_170429.txt
2025-05-18 17:04:29,931 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1155 k√Ω t·ª±
2025-05-18 17:04:29,932 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 17:04:29,932 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2360 k√Ω t·ª±
2025-05-18 17:04:29,935 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170429.txt
2025-05-18 17:04:29,936 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 17:04:29,937 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o, nay ƒëi l√†m ch√°n qu√° /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠...
2025-05-18 17:04:29,938 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:04:44,431 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:04:44,431 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

 Xin ch√†o üòé  
ƒêi l√†m ch√°n qu√° √†? üôÉ ƒê·ª´ng bu·ªìn nha, c√≥ g√¨ c·ª© n√≥i cho m√¨nh bi·∫øt nh√©! üí¨‚ú®  
Ch√∫c b·∫°n lu√¥n vui v·∫ª v√† h·ª©ng th√∫ v·ªõi c√¥ng vi·ªác c·ªßa m√¨nh nh√©! üåüüåà
2025-05-18 17:04:44,433 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170444.txt
2025-05-18 17:04:44,668 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 149 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:04:44,669 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 17:04:44,669 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,848 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"nay tui b·ªã s·∫øp la /no_think","session_id":""}
2025-05-18 17:05:13,849 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,849 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,850 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: nay tui b·ªã s·∫øp la /no_think...
2025-05-18 17:05:13,850 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: nay tui b·ªã s·∫øp la /no_think, enable_thinking=False
2025-05-18 17:05:13,851 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:05:13,853 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_170513.txt
2025-05-18 17:05:13,854 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,854 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,855 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:05:13,856 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ...
2025-05-18 17:05:13,856 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 669 k√Ω t·ª±
2025-05-18 17:05:13,857 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:05:13,857 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2675 k√Ω t·ª±
2025-05-18 17:05:13,859 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170513.txt
2025-05-18 17:05:13,860 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:05:13,860 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ...
2025-05-18 17:05:13,861 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:05:26,448 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:05:26,449 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:05:26,451 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170526.txt
2025-05-18 17:05:26,452 - chatbot_rag - INFO - [analysis_20250518_170526] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170526_raw.txt
2025-05-18 17:05:26,452 - chatbot_rag - INFO - [analysis_20250518_170526] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:05:26,452 - chatbot_rag - WARNING - [analysis_20250518_170526] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:05:26,454 - chatbot_rag - INFO - [analysis_20250518_170526] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 17:05:26,454 - chatbot_rag - INFO - [analysis_20250518_170526] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:05:26,454 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:05:26,455 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'nay tui b·ªã s·∫øp la /no_think', ph√≤ng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,455 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,455 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: nay tui b·ªã s·∫øp la
2025-05-18 17:05:26,455 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'nay tui b·ªã s·∫øp la', Mode thinking: False
2025-05-18 17:05:26,455 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:05:26,456 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_170526.txt
2025-05-18 17:05:26,457 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,459 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,459 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:05:26,461 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:...
2025-05-18 17:05:26,462 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 659 k√Ω t·ª±
2025-05-18 17:05:26,462 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:05:26,463 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2665 k√Ω t·ª±
2025-05-18 17:05:26,464 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170526.txt
2025-05-18 17:05:26,464 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:05:26,465 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°

nay tui b·ªã s·∫øp la"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:...
2025-05-18 17:05:26,465 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:05:39,056 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:05:39,056 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me try to figure this out. The user's current question is about their work history and being scolded by their boss. They mentioned "nay tui b·ªã s·∫øp la" which translates to something l
2025-05-18 17:05:39,060 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170539.txt
2025-05-18 17:05:39,064 - chatbot_rag - INFO - [analysis_20250518_170539] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170539_raw.txt
2025-05-18 17:05:39,064 - chatbot_rag - INFO - [analysis_20250518_170539] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me try to figure this out. The user's current question is about their work history...
2025-05-18 17:05:39,064 - chatbot_rag - WARNING - [analysis_20250518_170539] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:05:39,066 - chatbot_rag - WARNING - [analysis_20250518_170539] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:05:39,066 - chatbot_rag - INFO - [analysis_20250518_170539] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:05:39,070 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:05:39,070 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:05:39,070 - chatbot_rag - ERROR - [analysis_20250518_170539] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:05:39,071 - chatbot_rag - WARNING - [analysis_20250518_170539] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:05:39,071 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:05:39,071 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: nay tui b·ªã s·∫øp la /no_think
2025-05-18 17:05:39,072 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 17:05:39,072 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:39,076 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:05:39,077 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:05:39,077 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:39,079 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_170539.txt
2025-05-18 17:05:39,079 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1143 k√Ω t·ª±
2025-05-18 17:05:39,080 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 17:05:39,080 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2348 k√Ω t·ª±
2025-05-18 17:05:39,082 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170539.txt
2025-05-18 17:05:39,082 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 17:05:39,083 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "nay tui b·ªã s·∫øp la /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy...
2025-05-18 17:05:39,084 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:05:57,647 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:05:57,648 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

üòÖ *"Nay tui b·ªã s·∫øp la" ‚Äî c√≥ th·ªÉ l√† do tui ch∆∞a l√†m ƒë√∫ng vai tr√≤ trong quy tr√¨nh üòÖ*  
üëâ ƒê·ªÉ bi·∫øt m√¨nh ƒëang ·ªü giai ƒëo·∫°n n√†o v√† ph√≤ng ban n√†o ph·ª• tr√°ch, vui l√≤ng h·ªèi c·ª• th·ªÉ h∆°n nh√©!  
üí¨
2025-05-18 17:05:57,659 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170557.txt
2025-05-18 17:05:57,663 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 393 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:05:57,663 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 17:05:57,664 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,913 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"do tui s·ªù m√¥ng s·∫øp /no_think","session_id":""}
2025-05-18 17:09:04,938 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,950 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,951 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: do tui s·ªù m√¥ng s·∫øp /no_think...
2025-05-18 17:09:04,952 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: do tui s·ªù m√¥ng s·∫øp /no_think, enable_thinking=False
2025-05-18 17:09:04,954 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:09:04,969 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_170904.txt
2025-05-18 17:09:04,972 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,976 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,977 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:09:04,977 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp /no_think"

        Ph√¢n ...
2025-05-18 17:09:04,981 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 700 k√Ω t·ª±
2025-05-18 17:09:04,981 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:09:04,982 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2706 k√Ω t·ª±
2025-05-18 17:09:04,985 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170904.txt
2025-05-18 17:09:04,986 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:09:04,987 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp /no_think"

        Ph√¢n ...
2025-05-18 17:09:04,988 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:09:20,890 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:09:20,891 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:09:20,894 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170920.txt
2025-05-18 17:09:20,897 - chatbot_rag - INFO - [analysis_20250518_170920] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170920_raw.txt
2025-05-18 17:09:20,898 - chatbot_rag - INFO - [analysis_20250518_170920] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:09:20,898 - chatbot_rag - WARNING - [analysis_20250518_170920] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:09:20,900 - chatbot_rag - INFO - [analysis_20250518_170920] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 17:09:20,901 - chatbot_rag - INFO - [analysis_20250518_170920] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:09:20,902 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:09:20,902 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'do tui s·ªù m√¥ng s·∫øp /no_think', ph√≤ng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,903 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,903 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: do tui s·ªù m√¥ng s·∫øp
2025-05-18 17:09:20,903 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'do tui s·ªù m√¥ng s·∫øp', Mode thinking: False
2025-05-18 17:09:20,904 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:09:20,905 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_170920.txt
2025-05-18 17:09:20,906 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp"

        Ph√¢n t√≠ch c√¢u h...
2025-05-18 17:09:20,909 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 690 k√Ω t·ª±
2025-05-18 17:09:20,909 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:09:20,910 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2696 k√Ω t·ª±
2025-05-18 17:09:20,914 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170920.txt
2025-05-18 17:09:20,914 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:09:20,915 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o, nay ƒëi l√†m ch√°n qu√°
Ng∆∞·ªùi d√πng: nay tui b·ªã s·∫øp la

do tui s·ªù m√¥ng s·∫øp"

        Ph√¢n t√≠ch c√¢u h...
2025-05-18 17:09:20,915 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:09:34,241 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:09:34,243 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they're talking about being upset with their boss and some inappropriate behavior. Now, the current question 
2025-05-18 17:09:34,246 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170934.txt
2025-05-18 17:09:34,249 - chatbot_rag - INFO - [analysis_20250518_170934] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_170934_raw.txt
2025-05-18 17:09:34,250 - chatbot_rag - INFO - [analysis_20250518_170934] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they're t...
2025-05-18 17:09:34,251 - chatbot_rag - WARNING - [analysis_20250518_170934] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:09:34,251 - chatbot_rag - INFO - [analysis_20250518_170934] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:09:34,254 - chatbot_rag - INFO - [analysis_20250518_170934] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:09:34,254 - chatbot_rag - INFO - [analysis_20250518_170934] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:09:34,255 - chatbot_rag - WARNING - [analysis_20250518_170934] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:09:34,255 - chatbot_rag - INFO - [analysis_20250518_170934] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:09:34,280 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:09:34,281 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:09:34,283 - chatbot_rag - ERROR - [analysis_20250518_170934] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:09:34,284 - chatbot_rag - WARNING - [analysis_20250518_170934] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:09:34,284 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:09:34,285 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: do tui s·ªù m√¥ng s·∫øp /no_think
2025-05-18 17:09:34,285 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 17:09:34,287 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:34,294 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:09:34,294 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:09:34,296 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:34,298 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_170934.txt
2025-05-18 17:09:34,298 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1144 k√Ω t·ª±
2025-05-18 17:09:34,298 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1205 k√Ω t·ª±
2025-05-18 17:09:34,299 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2349 k√Ω t·ª±
2025-05-18 17:09:34,302 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_170934.txt
2025-05-18 17:09:34,303 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

C√ÅC PH√íNG BAN THAM GIA THEO GIAI ƒêO·∫†N:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, D·ª± to√°n, Thi·∫øt k·∫ø, Team d·ª± √°n
- CON...
2025-05-18 17:09:34,303 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "do tui s·ªù m√¥ng s·∫øp /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong qu...
2025-05-18 17:09:34,304 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:09:54,571 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:09:54,572 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

ü§£ *Do tui s·ªù m√¥ng s·∫øp* ‚Äî ƒë√¢y l√† c√¢u h·ªèi ho√†n to√†n kh√¥ng li√™n quan ƒë·∫øn quy tr√¨nh l√†m vi·ªác, giai ƒëo·∫°n hay ph√≤ng ban ƒë√¢u nha! üòÇ  
üëâ Vui v·∫ª h∆°n th√¨ h√£y h·ªèi: "S·∫øp c√≥ th√≠ch b·ªã s·ªù m√¥ng kh√¥
2025-05-18 17:09:54,575 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_170954.txt
2025-05-18 17:09:54,609 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 327 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:09:54,610 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 17:09:54,610 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:14:59,328 - websockets.server - INFO - connection open
2025-05-18 17:14:59,399 - websockets.server - INFO - connection closed
2025-05-18 17:14:59,399 - websockets.server - INFO - connection closed
2025-05-18 17:15:01,889 - websockets.server - INFO - connection open
2025-05-18 17:18:30,404 - websockets.server - INFO - connection closed
2025-05-18 17:18:30,409 - websockets.server - INFO - server closing
2025-05-18 17:18:30,414 - websockets.server - INFO - server closed
2025-05-18 17:18:30,425 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 17:18:33,345 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 17:18:33,381 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:18:33,381 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 17:18:33,381 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 17:18:44,617 - websockets.server - INFO - connection open
2025-05-18 17:19:04,153 - websockets.server - INFO - connection closed
2025-05-18 17:19:04,965 - websockets.server - INFO - connection open
2025-05-18 17:19:48,881 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alu alu /no_think","session_id":"","mode":"basic","basic_prompt":"B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h
2025-05-18 17:19:48,882 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,882 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,883 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alu alu /no_think...
2025-05-18 17:19:48,884 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alu alu /no_think, enable_thinking=False, mode=basic
2025-05-18 17:19:48,884 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:19:48,885 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alu alu /no_think', ph√≤ng ban: None, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41, mode: basic
2025-05-18 17:19:48,885 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,885 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: alu alu
2025-05-18 17:19:48,886 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alu alu', Mode thinking: False
2025-05-18 17:19:48,886 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:19:48,887 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 17:19:48,888 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 7 k√Ω t·ª±
2025-05-18 17:19:48,888 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 203 k√Ω t·ª±
2025-05-18 17:19:48,888 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 210 k√Ω t·ª±
2025-05-18 17:19:48,888 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 17:19:59,603 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 17:19:59,604 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 17:19:59,605 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:22,013 - websockets.server - INFO - connection closed
2025-05-18 17:21:23,227 - websockets.server - INFO - connection open
2025-05-18 17:21:23,893 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"alu alu /no_think","session_id":"","mode":"workflow"}
2025-05-18 17:21:23,894 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,894 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,895 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: alu alu /no_think...
2025-05-18 17:21:23,895 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: alu alu /no_think, enable_thinking=False, mode=workflow
2025-05-18 17:21:23,895 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:21:23,903 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172123.txt
2025-05-18 17:21:23,907 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu /no_think, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,968 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,969 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:21:23,969 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department"...
2025-05-18 17:21:23,970 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 637 k√Ω t·ª±
2025-05-18 17:21:23,970 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:21:23,970 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2643 k√Ω t·ª±
2025-05-18 17:21:23,972 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172123.txt
2025-05-18 17:21:23,972 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:21:23,972 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department"...
2025-05-18 17:21:23,973 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:21:37,083 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:21:37,083 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:21:37,086 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172137.txt
2025-05-18 17:21:37,088 - chatbot_rag - INFO - [analysis_20250518_172137] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_172137_raw.txt
2025-05-18 17:21:37,089 - chatbot_rag - INFO - [analysis_20250518_172137] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:21:37,089 - chatbot_rag - WARNING - [analysis_20250518_172137] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:21:37,092 - chatbot_rag - INFO - [analysis_20250518_172137] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 17:21:37,093 - chatbot_rag - INFO - [analysis_20250518_172137] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:21:37,094 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:21:37,094 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'alu alu /no_think', ph√≤ng ban: None, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41, mode: None
2025-05-18 17:21:37,094 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,096 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: alu alu
2025-05-18 17:21:37,096 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'alu alu', Mode thinking: False
2025-05-18 17:21:37,096 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:21:37,098 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172137.txt
2025-05-18 17:21:37,099 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,099 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,099 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:21:37,100 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤...
2025-05-18 17:21:37,100 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 627 k√Ω t·ª±
2025-05-18 17:21:37,100 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:21:37,100 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2633 k√Ω t·ª±
2025-05-18 17:21:37,102 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172137.txt
2025-05-18 17:21:37,103 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:21:37,103 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu

alu alu"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤...
2025-05-18 17:21:37,103 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:21:48,760 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:21:48,760 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a message that's just "alu alu" repeated. That seems like a placeholder or maybe a test input. Now, I need to analyze this based on the given rules.

First, 
2025-05-18 17:21:48,763 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172148.txt
2025-05-18 17:21:48,764 - chatbot_rag - INFO - [analysis_20250518_172148] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_172148_raw.txt
2025-05-18 17:21:48,766 - chatbot_rag - INFO - [analysis_20250518_172148] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's see. The user provided a message that's just "alu alu" repeated. That seems like...
2025-05-18 17:21:48,766 - chatbot_rag - WARNING - [analysis_20250518_172148] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:21:48,767 - chatbot_rag - WARNING - [analysis_20250518_172148] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:21:48,768 - chatbot_rag - INFO - [analysis_20250518_172148] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:21:48,774 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:21:48,776 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:21:48,777 - chatbot_rag - ERROR - [analysis_20250518_172148] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:21:48,777 - chatbot_rag - WARNING - [analysis_20250518_172148] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:21:48,778 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 17:21:48,778 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: alu alu /no_think
2025-05-18 17:21:48,778 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 17:21:48,778 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:48,781 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:21:48,781 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:21:48,782 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:48,784 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_172148.txt
2025-05-18 17:21:48,784 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1032 k√Ω t·ª±
2025-05-18 17:21:48,784 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 17:21:48,784 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1948 k√Ω t·ª±
2025-05-18 17:21:48,787 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172148.txt
2025-05-18 17:21:48,787 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 17:21:48,788 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "alu alu /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1....
2025-05-18 17:21:48,788 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:22:05,921 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:22:05,921 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• tr√°ch |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | D·ª± to√°n, 
2025-05-18 17:22:05,924 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172205.txt
2025-05-18 17:22:06,284 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 479 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:22:06,284 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 17:22:06,285 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,375 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 17:22:55,375 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: ```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• tr√°ch |
|-----------|---
2025-05-18 17:22:55,375 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:22:55,377 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172255.txt
2025-05-18 17:22:55,377 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 17:22:55,378 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu
Ng∆∞·ªùi d√πng: alu alu

```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• tr√°ch |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | D·ª± to√°n, Thi·∫øt k·∫ø, 2D |
| CONSTRUCTION | Thi c√¥ng, Team d·ª± √°n |
| DEFECT-HANDOVER | Kh√°ch h√†ng, Mua h√†ng, K·∫ø to√°n |
| AFTERSALE-MAINTENANCE | Kinh doanh, Kh√°ch h√†ng |

ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: "Ph√≤ng Kinh doanh l√†m g√¨ trong giai ƒëo·∫°n PROPOSAL?" üòéüèóÔ∏è
```, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,378 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,379 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:22:55,379 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu
Ng∆∞·ªùi d√πng: alu alu

```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• ...
2025-05-18 17:22:55,379 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1119 k√Ω t·ª±
2025-05-18 17:22:55,380 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:22:55,380 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3125 k√Ω t·ª±
2025-05-18 17:22:55,382 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172255.txt
2025-05-18 17:22:55,383 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:22:55,383 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: alu alu
Ng∆∞·ªùi d√πng: alu alu

```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• ...
2025-05-18 17:22:55,384 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:23:21,128 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:23:21,129 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages and the current question. First, I need to parse the current question carefully.

The current message is a markdown table
2025-05-18 17:23:21,131 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172321.txt
2025-05-18 17:23:21,133 - chatbot_rag - INFO - [analysis_20250518_172321] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_172321_raw.txt
2025-05-18 17:23:21,133 - chatbot_rag - INFO - [analysis_20250518_172321] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages and the current quest...
2025-05-18 17:23:21,134 - chatbot_rag - WARNING - [analysis_20250518_172321] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:23:21,134 - chatbot_rag - INFO - [analysis_20250518_172321] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:23:21,134 - chatbot_rag - INFO - [analysis_20250518_172321] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:23:21,135 - chatbot_rag - INFO - [analysis_20250518_172321] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:23:21,136 - chatbot_rag - WARNING - [analysis_20250518_172321] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:23:21,136 - chatbot_rag - INFO - [analysis_20250518_172321] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:23:21,139 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:23:21,140 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:23:21,141 - chatbot_rag - INFO - [analysis_20250518_172321] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: 2D
2025-05-18 17:23:21,141 - chatbot_rag - ERROR - [analysis_20250518_172321] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:23:21,141 - chatbot_rag - WARNING - [analysis_20250518_172321] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:23:21,142 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 17:23:21,142 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:23:21,146 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:23:21,146 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:23:21,147 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:23:21,148 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_172321.txt
2025-05-18 17:23:21,149 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1501 k√Ω t·ª±
2025-05-18 17:23:21,149 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 17:23:21,149 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2417 k√Ω t·ª±
2025-05-18 17:23:21,151 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172321.txt
2025-05-18 17:23:21,152 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 17:23:21,153 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "```markdown
# Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan

| Giai ƒëo·∫°n | Ph√≤ng ban ph·ª• tr√°ch |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | D·ª± to√°n, Thi·∫øt k·∫ø...
2025-05-18 17:23:21,153 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:24:00,996 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:24:00,997 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, the user has provided a query about the stages and responsible departments in a company. They have given a markdown table showing each stage and the departments involved. The user is ask
2025-05-18 17:24:00,999 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172400.txt
2025-05-18 17:24:01,002 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1814 k√Ω t·ª±) v√† c√≤n l·∫°i 479 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:24:01,003 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1814 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 17:24:01,003 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747563775374_y7dovox
2025-05-18 17:24:01,004 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1814 k√Ω t·ª±)
2025-05-18 17:26:09,072 - websockets.server - INFO - connection open
2025-05-18 17:27:18,025 - websockets.server - INFO - connection open
2025-05-18 17:28:06,716 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,719 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,720 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,726 - websockets.server - INFO - server closing
2025-05-18 17:28:06,729 - websockets.server - INFO - server closed
2025-05-18 17:28:06,738 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 17:28:10,916 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 17:28:11,004 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:28:11,005 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 17:28:11,007 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 17:28:12,709 - websockets.server - INFO - connection open
2025-05-18 17:28:13,034 - websockets.server - INFO - connection open
2025-05-18 17:28:17,683 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o","session_id":"","mode":"basic","basic_prompt":"B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√†
2025-05-18 17:28:17,684 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,684 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,684 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o, enable_thinking=False, mode=basic
2025-05-18 17:28:17,684 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:28:17,684 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o', ph√≤ng ban: None, session_id: 755c7188-5b94-47b0-beb7-4006c742db63, mode: basic
2025-05-18 17:28:17,685 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,685 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 17:28:17,685 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:28:17,686 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 17:28:17,686 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 17:28:17,686 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 17:28:17,686 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 182 k√Ω t·ª±
2025-05-18 17:28:17,687 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 17:28:25,799 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 17:28:25,800 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 17:28:25,801 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,388 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 17:28:27,389 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 17:28:27,389 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:28:27,391 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172827.txt
2025-05-18 17:28:27,392 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 17:28:27,393 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 17:28:27,416 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 621 k√Ω t·ª±
2025-05-18 17:28:27,416 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:28:27,416 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2627 k√Ω t·ª±
2025-05-18 17:28:27,418 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172827.txt
2025-05-18 17:28:27,418 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:28:27,418 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 17:28:27,419 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:28:51,640 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:28:51,641 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user provided a history of messages where the initial message is "xin ch√†o" (which means "hello"). Now, the current question is asking to analyze this and retu
2025-05-18 17:28:51,643 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172851.txt
2025-05-18 17:28:51,645 - chatbot_rag - INFO - [analysis_20250518_172851] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_172851_raw.txt
2025-05-18 17:28:51,646 - chatbot_rag - INFO - [analysis_20250518_172851] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's break this down. The user provided a history of messages where the initial messa...
2025-05-18 17:28:51,646 - chatbot_rag - WARNING - [analysis_20250518_172851] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:28:51,647 - chatbot_rag - INFO - [analysis_20250518_172851] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:28:51,648 - chatbot_rag - INFO - [analysis_20250518_172851] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:28:51,649 - chatbot_rag - INFO - [analysis_20250518_172851] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:28:51,649 - chatbot_rag - WARNING - [analysis_20250518_172851] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:28:51,649 - chatbot_rag - INFO - [analysis_20250518_172851] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:28:51,659 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:28:51,660 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:28:51,660 - chatbot_rag - ERROR - [analysis_20250518_172851] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:28:51,660 - chatbot_rag - WARNING - [analysis_20250518_172851] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:28:51,663 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 17:28:51,663 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:51,666 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:28:51,667 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:28:51,667 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:51,669 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_172851.txt
2025-05-18 17:28:51,669 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 17:28:51,670 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 17:28:51,670 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 17:28:51,673 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172851.txt
2025-05-18 17:28:51,674 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 17:28:51,675 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 17:28:51,676 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:29:20,756 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:29:20,758 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me process this. The user is asking a general question about the workflow or stages. They provided some structure and departments.

First, I need to follow the strict rules: don't cr
2025-05-18 17:29:20,760 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172920.txt
2025-05-18 17:29:21,147 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1003 k√Ω t·ª±) v√† c√≤n l·∫°i 416 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:29:21,147 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1003 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 17:29:21,147 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747564107387_cokuwo7
2025-05-18 17:29:21,148 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1003 k√Ω t·ª±)
2025-05-18 17:29:21,151 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o","session_id":"","mode":"basic","basic_prompt":"B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√†
2025-05-18 17:29:21,151 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,151 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,151 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o, enable_thinking=False, mode=basic
2025-05-18 17:29:21,152 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:29:21,153 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o', ph√≤ng ban: None, session_id: 755c7188-5b94-47b0-beb7-4006c742db63, mode: basic
2025-05-18 17:29:21,154 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,154 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 17:29:21,154 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 17:29:21,155 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:29:21,158 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172921.txt
2025-05-18 17:29:21,158 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 48 k√Ω t·ª±
2025-05-18 17:29:21,159 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 17:29:21,160 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 222 k√Ω t·ª±
2025-05-18 17:29:21,160 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 17:29:26,393 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 17:29:26,395 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 17:29:26,396 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,961 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 17:29:27,961 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 17:29:27,961 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 17:29:27,963 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_172927.txt
2025-05-18 17:29:27,964 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 17:29:27,964 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,964 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,965 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 17:29:27,965 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depart...
2025-05-18 17:29:27,966 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 642 k√Ω t·ª±
2025-05-18 17:29:27,966 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 17:29:27,966 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2648 k√Ω t·ª±
2025-05-18 17:29:27,968 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172927.txt
2025-05-18 17:29:27,969 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 17:29:27,969 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depart...
2025-05-18 17:29:27,970 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 17:29:51,378 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:29:51,379 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me tackle this query step by step. The user provided a history of messages where the conversation is just "xin ch√†o" repeated twice. The current question is asking for an analysis ba
2025-05-18 17:29:51,381 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_172951.txt
2025-05-18 17:29:51,384 - chatbot_rag - INFO - [analysis_20250518_172951] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_172951_raw.txt
2025-05-18 17:29:51,384 - chatbot_rag - INFO - [analysis_20250518_172951] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me tackle this query step by step. The user provided a history of messages where t...
2025-05-18 17:29:51,384 - chatbot_rag - WARNING - [analysis_20250518_172951] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 17:29:51,385 - chatbot_rag - INFO - [analysis_20250518_172951] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 17:29:51,385 - chatbot_rag - INFO - [analysis_20250518_172951] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:29:51,386 - chatbot_rag - INFO - [analysis_20250518_172951] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 17:29:51,386 - chatbot_rag - WARNING - [analysis_20250518_172951] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 17:29:51,387 - chatbot_rag - INFO - [analysis_20250518_172951] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 17:29:51,399 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:29:51,400 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:29:51,403 - chatbot_rag - ERROR - [analysis_20250518_172951] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 17:29:51,403 - chatbot_rag - WARNING - [analysis_20250518_172951] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 17:29:51,404 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 17:29:51,404 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:51,413 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 17:29:51,413 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 17:29:51,414 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:51,416 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_172951.txt
2025-05-18 17:29:51,416 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 17:29:51,417 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 17:29:51,417 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 17:29:51,420 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_172951.txt
2025-05-18 17:29:51,421 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 17:29:51,421 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 17:29:51,422 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 17:30:41,779 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 17:30:41,781 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me process this. The user provided a query that's asking about the general process or stages of work in a company. They mentioned specific departments and stages. According to the in
2025-05-18 17:30:41,785 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_173041.txt
2025-05-18 17:30:41,791 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (2403 k√Ω t·ª±) v√† c√≤n l·∫°i 408 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 17:30:41,792 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (2403 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 17:30:41,793 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747564167960_t3vsoaw
2025-05-18 17:30:41,794 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (2403 k√Ω t·ª±)
2025-05-18 17:31:18,088 - websockets.server - INFO - connection open
2025-05-18 17:31:18,113 - websockets.server - INFO - connection open
2025-05-18 17:32:49,119 - websockets.server - INFO - connection open
2025-05-18 17:32:49,215 - websockets.server - INFO - connection open
2025-05-18 17:33:00,256 - websockets.server - INFO - connection open
2025-05-18 17:33:00,393 - websockets.server - INFO - connection open
2025-05-18 17:33:18,965 - websockets.server - INFO - connection open
2025-05-18 17:33:19,062 - websockets.server - INFO - connection open
2025-05-18 17:33:54,957 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,959 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:56,333 - websockets.server - INFO - connection open
2025-05-18 17:40:51,769 - websockets.server - INFO - connection open
2025-05-18 17:40:51,793 - websockets.server - INFO - connection open
2025-05-18 17:40:51,814 - websockets.server - INFO - connection open
2025-05-18 17:40:51,837 - websockets.server - INFO - connection open
2025-05-18 17:42:26,551 - websockets.server - INFO - connection open
2025-05-18 17:42:26,706 - websockets.server - INFO - connection open
2025-05-18 17:44:52,591 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,595 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,598 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,598 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,773 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,776 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,778 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,779 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,783 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,786 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,787 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,788 - websockets.server - INFO - connection closed
2025-05-18 17:44:55,028 - websockets.server - INFO - connection open
2025-05-18 17:44:55,094 - websockets.server - INFO - connection open
2025-05-18 17:45:22,450 - websockets.server - INFO - connection open
2025-05-18 17:45:22,502 - websockets.server - INFO - connection open
2025-05-18 17:46:48,937 - websockets.server - INFO - connection open
2025-05-18 17:46:49,045 - websockets.server - INFO - connection open
2025-05-18 17:47:02,899 - websockets.server - INFO - connection open
2025-05-18 17:47:02,922 - websockets.server - INFO - connection open
2025-05-18 17:47:21,627 - websockets.server - INFO - connection open
2025-05-18 17:47:21,770 - websockets.server - INFO - connection open
2025-05-18 17:52:29,727 - websockets.server - INFO - connection open
2025-05-18 17:52:29,794 - websockets.server - INFO - connection open
2025-05-18 17:53:11,717 - websockets.server - INFO - connection open
2025-05-18 17:53:11,833 - websockets.server - INFO - connection open
2025-05-18 17:54:31,425 - websockets.server - INFO - connection open
2025-05-18 17:54:31,567 - websockets.server - INFO - connection open
2025-05-18 17:54:44,356 - websockets.server - INFO - connection open
2025-05-18 17:54:44,373 - websockets.server - INFO - connection open
2025-05-18 17:56:09,416 - websockets.server - INFO - connection open
2025-05-18 17:56:09,429 - websockets.server - INFO - connection open
2025-05-18 17:56:22,629 - websockets.server - INFO - connection open
2025-05-18 17:56:22,802 - websockets.server - INFO - connection open
2025-05-18 17:56:40,395 - websockets.server - INFO - connection open
2025-05-18 17:56:40,412 - websockets.server - INFO - connection open
2025-05-18 19:12:41,685 - websockets.server - INFO - connection open
2025-05-18 19:12:41,702 - websockets.server - INFO - connection open
2025-05-18 19:12:58,585 - websockets.server - INFO - connection open
2025-05-18 19:12:58,599 - websockets.server - INFO - connection open
2025-05-18 19:13:14,975 - websockets.server - INFO - connection open
2025-05-18 19:13:15,039 - websockets.server - INFO - connection open
2025-05-18 19:32:41,356 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,363 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,365 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,367 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,369 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,370 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,372 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,372 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,373 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,374 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,374 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,375 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,375 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,376 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,376 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,377 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,379 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,380 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,380 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,381 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,381 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,382 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,383 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,383 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,384 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,384 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,385 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,387 - websockets.server - INFO - server closing
2025-05-18 19:32:41,392 - websockets.server - INFO - server closed
2025-05-18 19:32:41,436 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 19:32:43,889 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 19:32:43,919 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:32:43,919 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 19:32:43,919 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 19:32:54,374 - websockets.server - INFO - connection open
2025-05-18 19:32:54,499 - websockets.server - INFO - connection open
2025-05-18 19:32:54,585 - websockets.server - INFO - connection open
2025-05-18 19:32:54,770 - websockets.server - INFO - connection closed
2025-05-18 19:32:55,158 - websockets.server - INFO - connection closed
2025-05-18 19:33:22,017 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"","mode":"basic","basic_prompt":"b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªá
2025-05-18 19:33:22,018 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,018 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,019 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 19:33:22,019 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 19:33:22,020 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªán t√¥i, h√£y ph·∫£n bi·ªán m·ªçi th·ª© t√¥i n√≥i...
2025-05-18 19:33:22,020 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:33:22,020 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,021 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:33:22,021 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 19:33:22,022 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªán t√¥i, h√£y ph·∫£n bi·ªán m·ªçi th·ª© t√¥i n√≥i...
2025-05-18 19:33:22,022 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 19:33:22,022 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 19:33:22,023 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 57 k√Ω t·ª±
2025-05-18 19:33:22,023 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 65 k√Ω t·ª±
2025-05-18 19:33:22,023 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:33:29,390 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:33:29,391 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:33:29,392 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:33:29,392 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,112 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /think","session_id":"","mode":"basic","basic_prompt":"b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªán t
2025-05-18 19:34:02,113 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,113 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,114 - websocket_server - INFO - B·∫≠t ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /think...
2025-05-18 19:34:02,114 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /think, enable_thinking=True, mode=basic
2025-05-18 19:34:02,115 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªán t√¥i, h√£y ph·∫£n bi·ªán m·ªçi th·ª© t√¥i n√≥i...
2025-05-18 19:34:02,115 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /think', ph√≤ng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:34:02,116 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,116 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /think, b·∫≠t ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:34:02,116 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: True
2025-05-18 19:34:02,117 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: b·∫°n l√† ng∆∞·ªùi ph·∫£n bi·ªán t√¥i, h√£y ph·∫£n bi·ªán m·ªçi th·ª© t√¥i n√≥i...
2025-05-18 19:34:02,117 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:34:02,119 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193402.txt
2025-05-18 19:34:02,119 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 48 k√Ω t·ª±
2025-05-18 19:34:02,119 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 57 k√Ω t·ª±
2025-05-18 19:34:02,119 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 105 k√Ω t·ª±
2025-05-18 19:34:02,120 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:34:18,919 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:34:18,919 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:34:18,920 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:34:18,921 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,421 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 19:34:42,422 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 19:34:42,422 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:34:42,423 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193442.txt
2025-05-18 19:34:42,424 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:34:42,425 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,451 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,452 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:34:42,452 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depart...
2025-05-18 19:34:42,453 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 642 k√Ω t·ª±
2025-05-18 19:34:42,454 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:34:42,454 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2648 k√Ω t·ª±
2025-05-18 19:34:42,455 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193442.txt
2025-05-18 19:34:42,456 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:34:42,456 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depart...
2025-05-18 19:34:42,457 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:35:02,651 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:35:02,652 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where they just said "xin ch√†o" twice. Now, the current question is asking about the conversation history. 

First, I nee
2025-05-18 19:35:02,653 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193502.txt
2025-05-18 19:35:02,655 - chatbot_rag - INFO - [analysis_20250518_193502] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_193502_raw.txt
2025-05-18 19:35:02,655 - chatbot_rag - INFO - [analysis_20250518_193502] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where they just said ...
2025-05-18 19:35:02,656 - chatbot_rag - WARNING - [analysis_20250518_193502] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:35:02,657 - chatbot_rag - INFO - [analysis_20250518_193502] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 19:35:02,657 - chatbot_rag - INFO - [analysis_20250518_193502] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 19:35:02,657 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 19:35:02,658 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:02,663 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:35:02,664 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:35:02,664 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:02,665 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_193502.txt
2025-05-18 19:35:02,665 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 19:35:02,666 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:35:02,666 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 19:35:02,667 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193502.txt
2025-05-18 19:35:02,668 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:35:02,668 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 19:35:02,668 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:35:30,480 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:35:30,481 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user asked a general question about the process or stages. They provided some info on the main stages and the list of departments. The instructions say to focus on the str
2025-05-18 19:35:30,482 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193530.txt
2025-05-18 19:35:30,762 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (913 k√Ω t·ª±) v√† c√≤n l·∫°i 595 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:35:30,762 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (913 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 19:35:30,763 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747571682420_2owz3qr
2025-05-18 19:35:30,763 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (913 k√Ω t·ª±)
2025-05-18 19:35:30,765 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:35:30,765 - websockets.server - INFO - connection closed
2025-05-18 19:35:30,766 - websockets.server - INFO - connection open
2025-05-18 19:35:30,767 - websockets.server - INFO - connection open
2025-05-18 19:35:30,768 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:35:30,769 - websockets.server - INFO - connection closed
2025-05-18 19:35:31,088 - websockets.server - INFO - connection closed
2025-05-18 19:35:31,747 - websockets.server - INFO - connection open
2025-05-18 19:35:33,183 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think","session_id":"","mode":"workf
2025-05-18 19:35:33,183 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,184 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,184 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /n...
2025-05-18 19:35:33,184 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think, enable_thinking=False, mode=workflow
2025-05-18 19:35:33,185 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:35:33,186 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193533.txt
2025-05-18 19:35:33,187 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,187 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,188 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:35:33,188 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think"

        Ph√¢n t...
2025-05-18 19:35:33,188 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 699 k√Ω t·ª±
2025-05-18 19:35:33,189 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:35:33,189 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2705 k√Ω t·ª±
2025-05-18 19:35:33,191 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193533.txt
2025-05-18 19:35:33,191 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:35:33,192 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think"

        Ph√¢n t...
2025-05-18 19:35:33,192 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:35:46,813 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:35:46,815 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}
2025-05-18 19:35:46,817 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193546.txt
2025-05-18 19:35:46,821 - chatbot_rag - INFO - [analysis_20250518_193546] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_193546_raw.txt
2025-05-18 19:35:46,823 - chatbot_rag - INFO - [analysis_20250518_193546] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}...
2025-05-18 19:35:46,823 - chatbot_rag - WARNING - [analysis_20250518_193546] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:35:46,824 - chatbot_rag - INFO - [analysis_20250518_193546] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 19:35:46,824 - chatbot_rag - INFO - [analysis_20250518_193546] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': '2D', 'query_type': 'department_specific', 'error': False}
2025-05-18 19:35:46,825 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=2D, Lo·∫°i=department_specific, Thinking=False
2025-05-18 19:35:46,825 - websocket_server - INFO - Tin nh·∫Øn th√¥ng th∆∞·ªùng (kh√¥ng ph·∫£i JSON) ƒë∆∞·ª£c x·ª≠ l√Ω v·ªõi ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh: workflow
2025-05-18 19:35:46,826 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think', ph√≤ng ban: 2D, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: workflow
2025-05-18 19:35:46,827 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,827 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác
2025-05-18 19:35:46,828 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác', Mode: workflow, Thinking: False
2025-05-18 19:35:46,829 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:35:46,831 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193546.txt
2025-05-18 19:35:46,832 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=2D, Lo·∫°i=department_specific, Thinking=False
2025-05-18 19:35:46,835 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think
2025-05-18 19:35:46,836 - websocket_server - INFO - C√¢u h·ªèi v·ªÅ ph√≤ng ban c·ª• th·ªÉ: 2D, ch·∫ø ƒë·ªô thinking: False
2025-05-18 19:35:46,837 - chatbot_rag - INFO - Truy v·∫•n Smart RAG - Giai ƒëo·∫°n: None, Ph√≤ng ban: 2D, Session: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,842 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:35:46,843 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: 2D
2025-05-18 19:35:46,844 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, k√≠ch th∆∞·ªõc: 1707 bytes
2025-05-18 19:35:46,849 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 2 giai ƒëo·∫°n v√† 3 c√¥ng vi·ªác cho ph√≤ng ban 2D
2025-05-18 19:35:46,850 - chatbot_rag - INFO - T·∫°o prompt LLM cho ph√≤ng ban: 2D, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,850 - chatbot_rag - INFO - S·ªë task: 3
2025-05-18 19:35:46,851 - chatbot_rag - INFO - L·∫•y l·ªãch s·ª≠ h·ªôi tho·∫°i t·ª´ phi√™n b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,866 - chatbot_rag - INFO - [create_llm_prompt] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server.get_session_history cho session b5c00203-6d1b-47b4-a61a-026ae346ed95.
2025-05-18 19:35:46,869 - chatbot_rag - INFO - G·ªçi LLM:  t·∫°i 
2025-05-18 19:35:46,871 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_20250518_193546.txt
2025-05-18 19:35:46,871 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 2080 k√Ω t·ª±
2025-05-18 19:35:46,872 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 1212 k√Ω t·ª±
2025-05-18 19:35:46,872 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3292 k√Ω t·ª±
2025-05-18 19:35:46,874 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193546.txt
2025-05-18 19:35:46,874 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ c√¥ng vi·ªác c·ªßa c√°c ph√≤ng ban trong c√¥ng ty. 
Nhi·ªám v·ª•: ph√¢n t√≠ch th√¥ng tin v·ªÅ c√°c task trong ph√≤ng ban v√† cung c·∫•p th√¥ng tin h·ªØu √≠ch.

D·ª∞ √ÅN ƒê∆Ø·ª¢C CHIA TH√ÄNH C√ÅC GIAI ƒêO·∫†N CH...
2025-05-18 19:35:46,875 - chatbot_rag - INFO - User prompt: 
    Vai tr√≤: Tr·ª£ l√Ω th√¥ng minh cung c·∫•p th√¥ng tin v·ªÅ ph√≤ng ban v√† c√¥ng vi·ªác trong c√¥ng ty.

    
    C√¢u h·ªèi ng∆∞·ªùi d√πng: "T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác /no_think"

    TH√îNG TIN PH√í...
2025-05-18 19:35:46,875 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:36:38,321 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:36:38,325 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

üëã *Ch√†o anh/ch·ªã 2D!* üé®  
Anh/ch·ªã l√† th√†nh vi√™n c·ªßa **ph√≤ng ban Thi c√¥ng**, h√£y c√πng m√¨nh xem qua c√°c task v√† giai ƒëo·∫°n li√™n quan nh√©!

---

### üèóÔ∏è **GIAI ƒêO·∫†N CONSTRUCTION (THI C√îNG
2025-05-18 19:36:38,331 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193638.txt
2025-05-18 19:36:38,334 - chatbot_rag - INFO - ƒê√£ l∆∞u response v√†o file: data/logs/response_20250518_193546.txt
2025-05-18 19:36:38,335 - chatbot_rag - INFO - Th·ªùi gian truy v·∫•n LLM: 51.49 gi√¢y
2025-05-18 19:36:38,341 - department_info_tool - INFO - ƒêang tr√≠ch xu·∫•t th√¥ng tin cho ph√≤ng ban: 2D
2025-05-18 19:36:38,343 - department_info_tool - INFO - ƒê√£ ƒë·ªçc th√†nh c√¥ng file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, k√≠ch th∆∞·ªõc: 1707 bytes
2025-05-18 19:36:38,346 - department_info_tool - INFO - ƒê√£ t√¨m th·∫•y 2 giai ƒëo·∫°n v√† 3 c√¥ng vi·ªác cho ph√≤ng ban 2D
2025-05-18 19:36:42,212 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 1250 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:36:42,212 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 19:36:42,213 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i ph√≤ng ban 2D v√†o l·ªãch s·ª≠ c·ªßa session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:36:42,216 - websockets.server - INFO - connection open
2025-05-18 19:36:42,246 - websockets.server - INFO - connection open
2025-05-18 19:36:42,262 - websockets.server - INFO - connection open
2025-05-18 19:36:48,265 - websockets.server - INFO - connection open
2025-05-18 19:37:15,005 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 19:37:15,005 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: üëã *Ch√†o anh/ch·ªã 2D!* üé®  
Anh/ch·ªã l√† th√†nh vi√™n c·ªßa **ph√≤ng ban Thi c√¥ng**, h√£y c√πng m√¨nh xem qua c√°c
2025-05-18 19:37:15,006 - websocket_server - INFO - ƒê√£ th√™m 3 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:37:15,008 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193715.txt
2025-05-18 19:37:15,009 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:37:15,009 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác

üëã *Ch√†o anh/ch·ªã 2D!* üé®  
Anh/ch·ªã l√† th√†nh vi√™n c·ªßa **ph√≤ng ban Thi c√¥ng**, h√£y c√πng m√¨nh xem qua c√°c task v√† giai ƒëo·∫°n li√™n quan nh√©!

---

### üèóÔ∏è **GIAI ƒêO·∫†N CONSTRUCTION (THI C√îNG)**
**M·ª•c ti√™u:** Chu·∫©n b·ªã kick-off n·ªôi b·ªô, h·ªçp c·∫≠p nh·∫≠t d·ª± √°n, v·∫Ω b·∫£n v·∫Ω xin ph√©p.

| Task ID | T√™n task | M√¥ t·∫£ |
|--------|----------|-------|
| 2D-001 | Chu·∫©n b·ªã kick-off n·ªôi b·ªô/ Chu·∫©n b·ªã h·ªçp c·∫≠p nh·∫≠t d·ª± √°n | Kh·∫£o s√°t m·∫∑t b·∫±ng. ƒê·∫ßu ra: Bi√™n b·∫£n kh·∫£o s√°t m·∫∑t b·∫±ng |
| 2D-002 | Chu·∫©n b·ªã kick-off n·ªôi b·ªô/ Chu·∫©n b·ªã h·ªçp c·∫≠p nh·∫≠t d·ª± √°n | V·∫Ω b·∫£n v·∫Ω xin ph√©p. ƒê·∫ßu ra: B·∫£n v·∫Ω xin ph√©p |

---

### üìã **GIAI ƒêO·∫†N DEFECT-HANDOVER (X·ª¨ L√ù L·ªñI & B√ÄN GIAO)**
**M·ª•c ti√™u:** Ho√†n c√¥ng v·ªõi t√≤a nh√†.

| Task ID | T√™n task | M√¥ t·∫£ |
|--------|----------|-------|
| 2D-003 | Chu·∫©n b·ªã h·ªì s∆° Quy·∫øt to√°n | ƒêi·ªÅu ch·ªânh b·∫£n v·∫Ω xin ph√©p theo th·ª±c t·∫ø ƒë·ªÉ l√†m b·∫£n v·∫Ω ho√†n c√¥ng. ƒê·∫ßu ra: B·∫£n v·∫Ω ho√†n c√¥ng |

---

üìå **L∆∞u √Ω:**  
- Task 2D-001 v√† 2D-002 thu·ªôc giai ƒëo·∫°n CONSTRUCTION, li√™n quan ƒë·∫øn chu·∫©n b·ªã tr∆∞·ªõc khi thi c√¥ng.  
- Task 2D-003 l√† task cu·ªëi c√πng trong giai ƒëo·∫°n DEFECT-HANDOVER, ƒë·∫£m b·∫£o ho√†n c√¥ng ch√≠nh x√°c.

N·∫øu anh/ch·ªã c·∫ßn h∆∞·ªõng d·∫´n chi ti·∫øt h∆°n v·ªÅ t·ª´ng task ho·∫∑c li√™n h·ªá v·ªõi ph√≤ng ban kh√°c (n·∫øu c√≥), c·ª© h·ªèi nh√©! üòÑ  
üëâ *ƒê·ª´ng qu√™n ki·ªÉm tra m·ª•c ti√™u c·ªßa t·ª´ng task ƒë·ªÉ ƒë·∫£m b·∫£o ti·∫øn ƒë·ªô!* üöÄ, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:15,013 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:15,013 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:37:15,014 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác

üëã *Ch√†o anh/ch...
2025-05-18 19:37:15,014 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1952 k√Ω t·ª±
2025-05-18 19:37:15,015 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:37:15,015 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3958 k√Ω t·ª±
2025-05-18 19:37:15,018 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193715.txt
2025-05-18 19:37:15,018 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:37:15,019 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác

üëã *Ch√†o anh/ch...
2025-05-18 19:37:15,019 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:37:47,791 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:37:47,792 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where they were greeted and given an overview of tasks related to the "Thi c√¥ng" (Construction) department. The current q
2025-05-18 19:37:47,795 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193747.txt
2025-05-18 19:37:47,798 - chatbot_rag - INFO - [analysis_20250518_193747] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_193747_raw.txt
2025-05-18 19:37:47,798 - chatbot_rag - INFO - [analysis_20250518_193747] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where they were greet...
2025-05-18 19:37:47,799 - chatbot_rag - WARNING - [analysis_20250518_193747] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:37:47,799 - chatbot_rag - INFO - [analysis_20250518_193747] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 19:37:47,800 - chatbot_rag - INFO - [analysis_20250518_193747] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:37:47,800 - chatbot_rag - INFO - [analysis_20250518_193747] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 19:37:47,800 - chatbot_rag - WARNING - [analysis_20250518_193747] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 19:37:47,801 - chatbot_rag - INFO - [analysis_20250518_193747] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 19:37:47,806 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:37:47,807 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:37:47,808 - chatbot_rag - INFO - [analysis_20250518_193747] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: 2D
2025-05-18 19:37:47,809 - chatbot_rag - ERROR - [analysis_20250518_193747] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 19:37:47,809 - chatbot_rag - WARNING - [analysis_20250518_193747] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 19:37:47,810 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 19:37:47,810 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:47,814 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:37:47,814 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:37:47,815 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:47,816 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_193747.txt
2025-05-18 19:37:47,817 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 2272 k√Ω t·ª±
2025-05-18 19:37:47,817 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:37:47,817 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3188 k√Ω t·ª±
2025-05-18 19:37:47,818 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_193747.txt
2025-05-18 19:37:47,819 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:37:47,819 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "üëã *Ch√†o anh/ch·ªã 2D!* üé®  
Anh/ch·ªã l√† th√†nh vi√™n c·ªßa **ph√≤ng ban Thi c√¥ng**, h√£y c√πng m√¨nh xem qua c√°c task v√† giai ƒëo·∫°n li√™n quan nh√©!

---

### üèóÔ∏è **GIAI ƒêO·∫†N CONSTRUCTION (THI C√îNG)**
**M·ª•...
2025-05-18 19:37:47,820 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:39:00,771 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:39:00,776 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user provided a detailed query about the construction and defect-handover phases in a company's workflow, specifically mentioning tasks related to 2D and other
2025-05-18 19:39:00,779 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_193900.txt
2025-05-18 19:39:00,814 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (2262 k√Ω t·ª±) v√† c√≤n l·∫°i 937 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:39:00,814 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (2262 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 19:39:00,815 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747571835003_8n53b3n
2025-05-18 19:39:00,823 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (2262 k√Ω t·ª±)
2025-05-18 19:39:00,838 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"","mode":"basic","basic_prompt":"B·∫°n l√† m·ªôt tr·ª£ l√Ω AI 
2025-05-18 19:39:00,838 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,839 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,839 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 19:39:00,840 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 19:39:00,841 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:39:00,842 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:39:00,842 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,842 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:39:00,843 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 19:39:00,843 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:39:00,844 - websocket_server - INFO - ƒê√£ th√™m 3 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:39:00,846 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_193900.txt
2025-05-18 19:39:00,848 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 129 k√Ω t·ª±
2025-05-18 19:39:00,849 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 19:39:00,850 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 303 k√Ω t·ª±
2025-05-18 19:39:00,850 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:39:00,871 - websockets.server - INFO - connection open
2025-05-18 19:39:00,886 - websockets.server - INFO - connection open
2025-05-18 19:39:12,595 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:39:12,598 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:39:12,599 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:39:12,599 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:17,647 - websockets.server - INFO - connection open
2025-05-18 19:39:35,609 - websockets.server - INFO - connection open
2025-05-18 19:40:00,555 - websockets.server - INFO - connection open
2025-05-18 19:46:06,164 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 19:46:06,166 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 19:46:06,167 - websocket_server - INFO - ƒê√£ th√™m 4 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:46:06,169 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_194606.txt
2025-05-18 19:46:06,170 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:46:06,170 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác
Ng∆∞·ªùi d√πng: xin...
2025-05-18 19:46:06,173 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 723 k√Ω t·ª±
2025-05-18 19:46:06,174 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:46:06,174 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2729 k√Ω t·ª±
2025-05-18 19:46:06,178 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194606.txt
2025-05-18 19:46:06,179 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:46:06,180 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: T√¥i l√† nh√¢n vi√™n 2D, h√£y h∆∞·ªõng d·∫´n t√¥i l√†m vi·ªác
Ng∆∞·ªùi d√πng: xin...
2025-05-18 19:46:06,181 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:46:27,518 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:46:27,519 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where they mentioned being a 2D employee and asked for guidance on their work. Now, the current question is just "L·ªãch s·ª≠
2025-05-18 19:46:27,520 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194627.txt
2025-05-18 19:46:27,523 - chatbot_rag - INFO - [analysis_20250518_194627] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_194627_raw.txt
2025-05-18 19:46:27,523 - chatbot_rag - INFO - [analysis_20250518_194627] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where they mentioned ...
2025-05-18 19:46:27,523 - chatbot_rag - WARNING - [analysis_20250518_194627] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:46:27,524 - chatbot_rag - INFO - [analysis_20250518_194627] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 19:46:27,524 - chatbot_rag - INFO - [analysis_20250518_194627] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:46:27,525 - chatbot_rag - INFO - [analysis_20250518_194627] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 19:46:27,525 - chatbot_rag - WARNING - [analysis_20250518_194627] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 19:46:27,525 - chatbot_rag - INFO - [analysis_20250518_194627] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 19:46:27,536 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:46:27,537 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:46:27,538 - chatbot_rag - INFO - [analysis_20250518_194627] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: 2D
2025-05-18 19:46:27,538 - chatbot_rag - ERROR - [analysis_20250518_194627] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 19:46:27,539 - chatbot_rag - WARNING - [analysis_20250518_194627] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 19:46:27,539 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 19:46:27,539 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:27,542 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:46:27,542 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:46:27,544 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:27,546 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_194627.txt
2025-05-18 19:46:27,546 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 19:46:27,546 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:46:27,547 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 19:46:27,549 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194627.txt
2025-05-18 19:46:27,549 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:46:27,550 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 19:46:27,550 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:46:51,125 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,132 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,132 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,133 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,135 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,135 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,136 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,138 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,139 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,140 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,142 - websockets.server - INFO - server closing
2025-05-18 19:46:51,144 - websockets.server - INFO - server closed
2025-05-18 19:46:51,152 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 19:46:51,382 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-81' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1341, in <module>
    ping_timeout=6000,  # TƒÉng th·ªùi gian timeout l√™n 6000 gi√¢y
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1115, in handle_message
    """X·ª≠ l√Ω c√°c tin nh·∫Øn WebSocket"""
  File "server.py", line 981, in handle_action
    session_id = data.get('session_id', current_session_id)
  File "server.py", line 849, in handle_thinking_request
    - Th√¥ng tin v·ªÅ quy tr√¨nh, nhi·ªám v·ª• ho·∫∑c tr√°ch nhi·ªám c·ªßa ph√≤ng ban {department}
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 443, in handle_general_query
    final_response = query_llm(user_prompt, system_prompt)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 19:46:54,063 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 19:46:54,086 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:46:54,087 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 19:46:54,087 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 19:47:05,963 - websockets.server - INFO - connection open
2025-05-18 19:47:12,303 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"","mode":"workflow"}
2025-05-18 19:47:12,304 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,304 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,304 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 19:47:12,305 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=workflow
2025-05-18 19:47:12,306 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 19:47:12,306 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,347 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,350 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:47:12,352 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 19:47:12,353 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 19:47:12,354 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:47:12,354 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2605 k√Ω t·ª±
2025-05-18 19:47:12,356 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194712.txt
2025-05-18 19:47:12,357 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:47:12,358 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 19:47:12,360 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:47:26,938 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:47:26,939 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 19:47:26,940 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194726.txt
2025-05-18 19:47:26,944 - chatbot_rag - INFO - [analysis_20250518_194726] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_194726_raw.txt
2025-05-18 19:47:26,945 - chatbot_rag - INFO - [analysis_20250518_194726] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 19:47:26,945 - chatbot_rag - WARNING - [analysis_20250518_194726] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:47:26,946 - chatbot_rag - INFO - [analysis_20250518_194726] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 19:47:26,946 - chatbot_rag - INFO - [analysis_20250518_194726] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 19:47:26,947 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 19:47:26,947 - websocket_server - INFO - Tin nh·∫Øn th√¥ng th∆∞·ªùng (kh√¥ng ph·∫£i JSON) ƒë∆∞·ª£c x·ª≠ l√Ω v·ªõi ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh: workflow
2025-05-18 19:47:26,947 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320, mode: workflow
2025-05-18 19:47:26,948 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,948 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:47:26,948 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: workflow, Thinking: False
2025-05-18 19:47:26,949 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 19:47:26,949 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,950 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,950 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:47:26,951 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 19:47:26,951 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-18 19:47:26,951 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:47:26,952 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2595 k√Ω t·ª±
2025-05-18 19:47:26,953 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194726.txt
2025-05-18 19:47:26,953 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:47:26,954 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 19:47:26,954 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:47:39,936 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:47:39,937 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this. The user's current question is "xin ch√†o" which means "hello" in Vietnamese. The history of messages is empty, so there's no prior context about any department or spec
2025-05-18 19:47:39,938 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194739.txt
2025-05-18 19:47:39,941 - chatbot_rag - INFO - [analysis_20250518_194739] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_194739_raw.txt
2025-05-18 19:47:39,942 - chatbot_rag - INFO - [analysis_20250518_194739] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this. The user's current question is "xin ch√†o" which means "hello" in Vi...
2025-05-18 19:47:39,943 - chatbot_rag - WARNING - [analysis_20250518_194739] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:47:39,944 - chatbot_rag - INFO - [analysis_20250518_194739] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 19:47:39,945 - chatbot_rag - INFO - [analysis_20250518_194739] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:47:39,945 - chatbot_rag - INFO - [analysis_20250518_194739] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 19:47:39,945 - chatbot_rag - WARNING - [analysis_20250518_194739] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 19:47:39,946 - chatbot_rag - INFO - [analysis_20250518_194739] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 19:47:39,956 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:47:39,956 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:47:39,957 - chatbot_rag - ERROR - [analysis_20250518_194739] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 19:47:39,957 - chatbot_rag - WARNING - [analysis_20250518_194739] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 19:47:39,958 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 19:47:39,963 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-18 19:47:39,964 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 19:47:39,964 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:39,968 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:47:39,969 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:47:39,969 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:39,971 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_194739.txt
2025-05-18 19:47:39,972 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1033 k√Ω t·ª±
2025-05-18 19:47:39,972 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:47:39,972 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1949 k√Ω t·ª±
2025-05-18 19:47:39,974 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194739.txt
2025-05-18 19:47:39,974 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:47:39,975 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 19:47:39,976 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:47:58,938 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:47:58,939 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

 Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Ma
2025-05-18 19:47:58,944 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194758.txt
2025-05-18 19:47:59,295 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 469 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:47:59,296 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m ...
2025-05-18 19:47:59,296 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 19:47:59,296 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,095 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /think","session_id":"","mode":"basic","basic_prompt":"B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu
2025-05-18 19:48:17,096 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,096 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,096 - websocket_server - INFO - B·∫≠t ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /think...
2025-05-18 19:48:17,097 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /think, enable_thinking=True, mode=basic
2025-05-18 19:48:17,097 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:48:17,098 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /think', ph√≤ng ban: None, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320, mode: basic
2025-05-18 19:48:17,098 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,099 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /think, b·∫≠t ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:48:17,099 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: True
2025-05-18 19:48:17,100 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:48:17,100 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:48:17,102 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_194817.txt
2025-05-18 19:48:17,103 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 48 k√Ω t·ª±
2025-05-18 19:48:17,103 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 19:48:17,104 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 222 k√Ω t·ª±
2025-05-18 19:48:17,104 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:48:26,200 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:48:26,201 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:48:26,203 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:48:26,203 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,214 - websocket_server - WARNING - Session  kh√¥ng t·ªìn t·∫°i, s·ª≠ d·ª•ng session hi·ªán t·∫°i
2025-05-18 19:48:26,215 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai t
2025-05-18 19:48:26,224 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:48:26,234 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_194826.txt
2025-05-18 19:48:26,235 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:48:26,235 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o?" ho·∫∑c "Ph√≤ng Kinh doanh c√≥ nh·ªØng b∆∞·ªõc g√¨?"  

ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: **"Ph√≤ng X l√†m g√¨ trong giai ƒëo·∫°n Y?"** üí°

---  
üåü *N·∫øu b·∫°n mu·ªën n√≥i chuy·ªán vui v·∫ª thay v√¨ h·ªèi v·ªÅ c√¥ng vi·ªác, m√¨nh c≈©ng s·∫µn s√†ng! üòÑ*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:48:26,237 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1111 k√Ω t·ª±
2025-05-18 19:48:26,237 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:48:26,238 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3117 k√Ω t·ª±
2025-05-18 19:48:26,239 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194826.txt
2025-05-18 19:48:26,239 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:48:26,240 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:48:26,240 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:48:51,584 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:48:51,585 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted and the assistant responded with an introduction about the company's workflow. The current question is
2025-05-18 19:48:51,587 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194851.txt
2025-05-18 19:48:51,590 - chatbot_rag - INFO - [analysis_20250518_194851] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_194851_raw.txt
2025-05-18 19:48:51,591 - chatbot_rag - INFO - [analysis_20250518_194851] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted an...
2025-05-18 19:48:51,591 - chatbot_rag - WARNING - [analysis_20250518_194851] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:48:51,591 - chatbot_rag - INFO - [analysis_20250518_194851] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 19:48:51,592 - chatbot_rag - INFO - [analysis_20250518_194851] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:48:51,592 - chatbot_rag - INFO - [analysis_20250518_194851] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 19:48:51,593 - chatbot_rag - WARNING - [analysis_20250518_194851] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 19:48:51,593 - chatbot_rag - INFO - [analysis_20250518_194851] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 19:48:51,597 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:48:51,598 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:48:51,599 - chatbot_rag - INFO - [analysis_20250518_194851] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: Kinh doanh
2025-05-18 19:48:51,599 - chatbot_rag - ERROR - [analysis_20250518_194851] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 19:48:51,600 - chatbot_rag - WARNING - [analysis_20250518_194851] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 19:48:51,600 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 19:48:51,600 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:51,604 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:48:51,605 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:48:51,605 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:51,607 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_194851.txt
2025-05-18 19:48:51,609 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1491 k√Ω t·ª±
2025-05-18 19:48:51,609 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:48:51,610 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2407 k√Ω t·ª±
2025-05-18 19:48:51,611 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194851.txt
2025-05-18 19:48:51,612 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:48:51,613 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing t...
2025-05-18 19:48:51,613 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:49:33,686 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:49:33,687 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a detailed query about the company's workflow and departments. They want me to follow specific rules: not create connections between departments and stages, 
2025-05-18 19:49:33,688 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_194933.txt
2025-05-18 19:49:33,695 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1466 k√Ω t·ª±) v√† c√≤n l·∫°i 522 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:49:33,695 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: ### Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan  
- **MKT-SAL...
2025-05-18 19:49:33,695 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1466 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 19:49:33,696 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747572505514_fh4su4a
2025-05-18 19:49:33,697 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1466 k√Ω t·ª±)
2025-05-18 19:49:33,705 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:49:33,706 - websockets.server - INFO - connection closed
2025-05-18 19:49:33,708 - websockets.server - INFO - connection open
2025-05-18 19:49:46,596 - websockets.server - INFO - connection closed
2025-05-18 19:49:47,465 - websockets.server - INFO - connection open
2025-05-18 19:49:56,938 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai t
2025-05-18 19:49:56,939 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:49:56,941 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_194956.txt
2025-05-18 19:49:56,942 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:49:56,942 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o?" ho·∫∑c "Ph√≤ng Kinh doanh c√≥ nh·ªØng b∆∞·ªõc g√¨?"  

ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: **"Ph√≤ng X l√†m g√¨ trong giai ƒëo·∫°n Y?"** üí°

---  
üåü *N·∫øu b·∫°n mu·ªën n√≥i chuy·ªán vui v·∫ª thay v√¨ h·ªèi v·ªÅ c√¥ng vi·ªác, m√¨nh c≈©ng s·∫µn s√†ng! üòÑ*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:49:56,943 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:49:56,944 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:49:56,944 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:49:56,944 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1111 k√Ω t·ª±
2025-05-18 19:49:56,945 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:49:56,945 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3117 k√Ω t·ª±
2025-05-18 19:49:56,947 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_194956.txt
2025-05-18 19:49:56,947 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:49:56,948 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:49:56,948 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:50:24,494 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:50:24,495 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this. The user provided a history of messages where they greeted and the assistant responded with an introduction about the workflow process. The current question is the sam
2025-05-18 19:50:24,497 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_195024.txt
2025-05-18 19:50:24,500 - chatbot_rag - INFO - [analysis_20250518_195024] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_195024_raw.txt
2025-05-18 19:50:24,501 - chatbot_rag - INFO - [analysis_20250518_195024] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this. The user provided a history of messages where they greeted and the ...
2025-05-18 19:50:24,501 - chatbot_rag - WARNING - [analysis_20250518_195024] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 19:50:24,501 - chatbot_rag - INFO - [analysis_20250518_195024] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 19:50:24,502 - chatbot_rag - INFO - [analysis_20250518_195024] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:50:24,502 - chatbot_rag - INFO - [analysis_20250518_195024] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 19:50:24,502 - chatbot_rag - WARNING - [analysis_20250518_195024] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 19:50:24,503 - chatbot_rag - INFO - [analysis_20250518_195024] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 19:50:24,514 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:50:24,515 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:50:24,516 - chatbot_rag - INFO - [analysis_20250518_195024] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: Kinh doanh
2025-05-18 19:50:24,516 - chatbot_rag - ERROR - [analysis_20250518_195024] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 19:50:24,516 - chatbot_rag - WARNING - [analysis_20250518_195024] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 19:50:24,517 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 19:50:24,518 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:50:24,523 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 19:50:24,523 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 19:50:24,523 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:50:24,527 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_195024.txt
2025-05-18 19:50:24,527 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1491 k√Ω t·ª±
2025-05-18 19:50:24,528 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 19:50:24,528 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2407 k√Ω t·ª±
2025-05-18 19:50:24,530 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_195024.txt
2025-05-18 19:50:24,531 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 19:50:24,532 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing t...
2025-05-18 19:50:24,532 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 19:53:12,960 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 19:53:12,970 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a detailed prompt about the company's departments and processes. They want me to act as an AI assistant that focuses on describing stages and responsible dep
2025-05-18 19:53:12,975 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_195312.txt
2025-05-18 19:53:13,010 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (8613 k√Ω t·ª±) v√† c√≤n l·∫°i 583 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 19:53:13,013 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: # Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh l√†m vi·ªác  
1. **...
2025-05-18 19:53:13,014 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (8613 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 19:53:13,014 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747572596937_9xj74fv
2025-05-18 19:53:13,023 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (8613 k√Ω t·ª±)
2025-05-18 19:53:13,045 - websockets.server - INFO - connection open
2025-05-18 19:53:13,065 - websockets.server - INFO - connection open
2025-05-18 19:53:13,091 - websockets.server - INFO - connection open
2025-05-18 19:53:13,120 - websockets.server - INFO - connection open
2025-05-18 19:53:13,137 - websockets.server - INFO - connection open
2025-05-18 19:53:18,270 - websockets.server - INFO - connection open
2025-05-18 19:53:26,049 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai t
2025-05-18 19:53:26,050 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:53:26,052 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_195326.txt
2025-05-18 19:53:26,052 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:53:26,053 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

N·∫øu b·∫°n mu·ªën bi·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban trong c√°c giai ƒëo·∫°n c·ª• th·ªÉ, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o?" ho·∫∑c "Ph√≤ng Kinh doanh c√≥ nh·ªØng b∆∞·ªõc g√¨?"  

ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: **"Ph√≤ng X l√†m g√¨ trong giai ƒëo·∫°n Y?"** üí°

---  
üåü *N·∫øu b·∫°n mu·ªën n√≥i chuy·ªán vui v·∫ª thay v√¨ h·ªèi v·ªÅ c√¥ng vi·ªác, m√¨nh c≈©ng s·∫µn s√†ng! üòÑ*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:53:26,054 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:53:26,054 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:53:26,055 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:53:26,056 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1111 k√Ω t·ª±
2025-05-18 19:53:26,056 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:53:26,056 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3117 k√Ω t·ª±
2025-05-18 19:53:26,059 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_195326.txt
2025-05-18 19:53:26,060 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:53:26,061 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  

...
2025-05-18 19:53:26,061 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 19:53:53,583 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,592 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,593 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,594 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,598 - websockets.server - INFO - server closing
2025-05-18 19:53:53,599 - websockets.server - INFO - server closed
2025-05-18 19:53:53,605 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 19:53:53,701 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-47' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1356, in <module>
    asyncio.run(main())
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1130, in handle_message
    await handle_action(websocket, data['action'], data)
  File "server.py", line 996, in handle_action
    await handle_thinking_request(websocket, query, session_id, request_id)
  File "server.py", line 778, in handle_thinking_request
    analysis_result = analyze_query_with_llm(content_with_history, session_id)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 1059, in analyze_query_with_llm
    response_text = query_llm(prompt, system_prompt, max_tokens=200, stream=False)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 19:54:03,498 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 19:54:03,543 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:54:03,544 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 19:54:03,545 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 19:54:21,836 - websockets.server - INFO - connection open
2025-05-18 19:54:30,823 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","bas
2025-05-18 19:54:30,824 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:54:30,825 - websocket_server - INFO - B·∫≠t ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /think...
2025-05-18 19:54:30,826 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /think, enable_thinking=True, mode=basic
2025-05-18 19:54:30,826 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:54:30,827 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /think', ph√≤ng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 19:54:30,827 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:54:30,827 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /think, b·∫≠t ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 19:54:30,828 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: True
2025-05-18 19:54:30,828 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:54:30,829 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 19:54:30,830 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 19:54:30,830 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 19:54:30,830 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 182 k√Ω t·ª±
2025-05-18 19:54:30,831 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:54:40,426 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:54:40,428 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:54:40,429 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:54:40,429 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:55:23,506 - websockets.server - INFO - connection closed
2025-05-18 19:55:24,490 - websockets.server - INFO - connection open
2025-05-18 19:55:27,083 - websockets.server - INFO - connection closed
2025-05-18 19:55:27,944 - websockets.server - INFO - connection open
2025-05-18 19:55:30,938 - websockets.server - INFO - connection closed
2025-05-18 19:55:31,714 - websockets.server - INFO - connection open
2025-05-18 19:56:25,724 - websockets.server - INFO - connection open
2025-05-18 19:57:03,702 - websockets.server - INFO - connection open
2025-05-18 19:57:33,876 - websockets.server - INFO - connection open
2025-05-18 19:58:35,737 - websockets.server - INFO - connection open
2025-05-18 19:58:59,226 - websockets.server - INFO - connection open
2025-05-18 19:59:11,618 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,619 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,619 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:12,896 - websockets.server - INFO - connection open
2025-05-18 19:59:23,349 - websockets.server - INFO - connection closed
2025-05-18 19:59:24,094 - websockets.server - INFO - connection open
2025-05-18 19:59:31,703 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"m√†y l√† ai /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic",
2025-05-18 19:59:31,706 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:31,706 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: m√†y l√† ai /no_think...
2025-05-18 19:59:31,708 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: m√†y l√† ai /no_think, enable_thinking=False, mode=basic
2025-05-18 19:59:31,708 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:59:31,710 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'm√†y l√† ai /no_think', ph√≤ng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 19:59:31,711 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:31,711 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: m√†y l√† ai
2025-05-18 19:59:31,712 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'm√†y l√† ai', Mode: basic, Thinking: False
2025-05-18 19:59:31,713 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 19:59:31,714 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:59:31,726 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_195931.txt
2025-05-18 19:59:31,727 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 49 k√Ω t·ª±
2025-05-18 19:59:31,728 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 19:59:31,728 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 223 k√Ω t·ª±
2025-05-18 19:59:31,729 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 19:59:40,797 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 19:59:40,800 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 19:59:40,801 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:59:40,801 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,632 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 19:59:55,633 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 19:59:55,635 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_195955.txt
2025-05-18 19:59:55,635 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 19:59:55,640 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai

, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,684 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,685 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 19:59:55,686 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depar...
2025-05-18 19:59:55,687 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 643 k√Ω t·ª±
2025-05-18 19:59:55,687 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 19:59:55,687 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2649 k√Ω t·ª±
2025-05-18 19:59:55,690 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_195955.txt
2025-05-18 19:59:55,690 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 19:59:55,692 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depar...
2025-05-18 19:59:55,692 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 20:00:17,075 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 20:00:17,077 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted and asked "m√†y l√† ai" (which means "who are you" in Vietnamese). Now, the current question is about an
2025-05-18 20:00:17,079 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_200017.txt
2025-05-18 20:00:17,081 - chatbot_rag - INFO - [analysis_20250518_200017] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_200017_raw.txt
2025-05-18 20:00:17,081 - chatbot_rag - INFO - [analysis_20250518_200017] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted an...
2025-05-18 20:00:17,082 - chatbot_rag - WARNING - [analysis_20250518_200017] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 20:00:17,083 - chatbot_rag - INFO - [analysis_20250518_200017] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 20:00:17,084 - chatbot_rag - INFO - [analysis_20250518_200017] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 20:00:17,084 - chatbot_rag - INFO - [analysis_20250518_200017] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 20:00:17,085 - chatbot_rag - WARNING - [analysis_20250518_200017] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 20:00:17,085 - chatbot_rag - INFO - [analysis_20250518_200017] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 20:00:17,092 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 20:00:17,092 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 20:00:17,093 - chatbot_rag - ERROR - [analysis_20250518_200017] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 20:00:17,094 - chatbot_rag - WARNING - [analysis_20250518_200017] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 20:00:17,094 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 20:00:17,094 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:00:17,097 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 20:00:17,097 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 20:00:17,098 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:00:17,099 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_200017.txt
2025-05-18 20:00:17,099 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 20:00:17,100 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 20:00:17,100 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 20:00:17,101 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_200017.txt
2025-05-18 20:00:17,101 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 20:00:17,102 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 20:00:17,102 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 20:00:37,159 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 20:00:37,167 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break down the user's query. They provided a structure of departments and process stages but didn't ask a specific question. The previous response was in Vietnamese, so I need to m
2025-05-18 20:00:37,169 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_200037.txt
2025-05-18 20:00:37,814 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (742 k√Ω t·ª±) v√† c√≤n l·∫°i 220 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 20:00:37,815 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: üòÖ *C√¢u h·ªèi ch∆∞a r√µ r√†ng l·∫Øm nha! B·∫°n mu·ªën bi·∫øt g√¨ ...
2025-05-18 20:00:37,815 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (742 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 20:00:37,816 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747573195630_dcnwq96
2025-05-18 20:00:37,817 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (742 k√Ω t·ª±)
2025-05-18 20:03:40,755 - websockets.server - INFO - connection open
2025-05-18 20:04:20,973 - websockets.server - INFO - connection closed
2025-05-18 20:04:20,974 - websockets.server - INFO - connection closed
2025-05-18 20:04:22,346 - websockets.server - INFO - connection open
2025-05-18 20:04:42,427 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","
2025-05-18 20:04:42,429 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:04:42,430 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 20:04:42,431 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 20:04:42,432 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:04:42,433 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 20:04:42,434 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:04:42,434 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 20:04:42,435 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 20:04:42,435 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:04:42,436 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 20:04:42,444 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_200442.txt
2025-05-18 20:04:42,446 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 70 k√Ω t·ª±
2025-05-18 20:04:42,449 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 20:04:42,450 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 244 k√Ω t·ª±
2025-05-18 20:04:42,450 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 20:04:52,670 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 20:04:52,673 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 20:04:52,674 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:04:52,676 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,290 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 20:05:07,291 - websocket_server - INFO - ƒê√£ th√™m 3 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 20:05:07,300 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_200507.txt
2025-05-18 20:05:07,300 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 20:05:07,301 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,302 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,302 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 20:05:07,303 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh ...
2025-05-18 20:05:07,304 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 664 k√Ω t·ª±
2025-05-18 20:05:07,305 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 20:05:07,307 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2670 k√Ω t·ª±
2025-05-18 20:05:07,311 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_200507.txt
2025-05-18 20:05:07,312 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 20:05:07,313 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: m√†y l√† ai
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh ...
2025-05-18 20:05:07,314 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 20:05:28,821 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 20:05:28,822 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they just said "xin ch√†o" (hello) multiple times and asked "m√†y l√† ai" (who are you). Now, the current questi
2025-05-18 20:05:28,823 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_200528.txt
2025-05-18 20:05:28,825 - chatbot_rag - INFO - [analysis_20250518_200528] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_200528_raw.txt
2025-05-18 20:05:28,826 - chatbot_rag - INFO - [analysis_20250518_200528] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they just...
2025-05-18 20:05:28,826 - chatbot_rag - WARNING - [analysis_20250518_200528] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 20:05:28,827 - chatbot_rag - INFO - [analysis_20250518_200528] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 20:05:28,827 - chatbot_rag - INFO - [analysis_20250518_200528] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 20:05:28,828 - chatbot_rag - INFO - [analysis_20250518_200528] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 20:05:28,828 - chatbot_rag - WARNING - [analysis_20250518_200528] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 20:05:28,829 - chatbot_rag - INFO - [analysis_20250518_200528] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 20:05:28,838 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 20:05:28,839 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 20:05:28,841 - chatbot_rag - ERROR - [analysis_20250518_200528] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 20:05:28,842 - chatbot_rag - WARNING - [analysis_20250518_200528] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 20:05:28,842 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 20:05:28,842 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:28,845 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 20:05:28,845 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 20:05:28,846 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:28,847 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_200528.txt
2025-05-18 20:05:28,847 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 20:05:28,848 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 20:05:28,848 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 20:05:28,850 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_200528.txt
2025-05-18 20:05:28,850 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 20:05:28,851 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 20:05:28,851 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 20:05:56,527 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 20:05:56,528 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a query that's a general question about the process or stages of work. They mentioned the main stages: MKT-SALES, PROPOSAL, CONSTRUCTION, DEFECT-HANDOVER, AF
2025-05-18 20:05:56,530 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_200556.txt
2025-05-18 20:05:56,548 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1123 k√Ω t·ª±) v√† c√≤n l·∫°i 328 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 20:05:56,548 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: üåü *C√¢u h·ªèi chung? Kh√¥ng sao ƒë√¢u!* üòé  
*ƒê·ª´ng lo, m√¨...
2025-05-18 20:05:56,548 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1123 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 20:05:56,549 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747573507287_4w2bk6z
2025-05-18 20:05:56,549 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1123 k√Ω t·ª±)
2025-05-18 20:06:29,276 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","
2025-05-18 20:06:29,278 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:06:29,278 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 20:06:29,292 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 20:06:29,293 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:06:29,293 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 20:06:29,293 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:06:29,294 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 20:06:29,294 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 20:06:29,295 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:06:29,295 - websocket_server - INFO - ƒê√£ th√™m 3 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 20:06:29,296 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_200629.txt
2025-05-18 20:06:29,297 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 91 k√Ω t·ª±
2025-05-18 20:06:29,297 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 20:06:29,298 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 265 k√Ω t·ª±
2025-05-18 20:06:29,298 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 20:06:41,777 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 20:06:41,778 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 20:06:41,779 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:06:41,780 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:07:09,262 - websockets.server - INFO - connection open
2025-05-18 20:07:09,282 - websockets.server - INFO - connection open
2025-05-18 20:07:32,807 - websockets.server - INFO - connection open
2025-05-18 20:08:39,387 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"ch√†o m√†y /no_think","session_id":"81024cdc-6ee1-4e5a-b07d-d73db4f11a0a","mode":"basic","
2025-05-18 20:08:39,400 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:08:39,406 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: ch√†o m√†y /no_think...
2025-05-18 20:08:39,407 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: ch√†o m√†y /no_think, enable_thinking=False, mode=basic
2025-05-18 20:08:39,408 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:08:39,409 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'ch√†o m√†y /no_think', ph√≤ng ban: None, session_id: 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a, mode: basic
2025-05-18 20:08:39,410 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:08:39,411 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: ch√†o m√†y
2025-05-18 20:08:39,421 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'ch√†o m√†y', Mode: basic, Thinking: False
2025-05-18 20:08:39,422 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 20:08:39,425 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 20:08:39,427 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 20:08:39,429 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 20:08:39,430 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 182 k√Ω t·ª±
2025-05-18 20:08:39,430 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 20:08:44,852 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 20:08:44,855 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 20:08:44,857 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:08:44,859 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:15:25,138 - websockets.server - INFO - connection open
2025-05-18 20:15:25,251 - websockets.server - INFO - connection open
2025-05-18 20:16:29,673 - websockets.server - INFO - connection open
2025-05-18 20:16:29,741 - websockets.server - INFO - connection open
2025-05-18 20:17:21,474 - websockets.server - INFO - connection open
2025-05-18 20:17:21,508 - websockets.server - INFO - connection open
2025-05-18 20:18:07,177 - websockets.server - INFO - connection open
2025-05-18 20:18:07,198 - websockets.server - INFO - connection open
2025-05-18 20:20:16,301 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,304 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,311 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,311 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,315 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,315 - websockets.server - INFO - connection closed
2025-05-18 20:20:18,236 - websockets.server - INFO - connection open
2025-05-18 20:20:38,209 - websockets.server - INFO - connection open
2025-05-18 20:21:03,893 - websockets.server - INFO - connection open
2025-05-18 20:21:31,808 - websockets.server - INFO - connection open
2025-05-18 20:22:04,762 - websockets.server - INFO - connection open
2025-05-18 20:22:32,632 - websockets.server - INFO - connection open
2025-05-18 20:22:52,279 - websockets.server - INFO - connection open
2025-05-18 20:24:28,340 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,344 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,345 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,345 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:36,900 - websockets.server - INFO - connection open
2025-05-18 20:26:44,022 - websockets.server - INFO - connection open
2025-05-18 20:26:53,240 - websockets.server - INFO - connection closed
2025-05-18 20:26:53,241 - websockets.server - INFO - connection closed
2025-05-18 20:26:54,658 - websockets.server - INFO - connection open
2025-05-18 20:29:30,574 - websockets.server - INFO - connection open
2025-05-18 20:29:54,882 - websockets.server - INFO - connection open
2025-05-18 20:30:42,242 - websockets.server - INFO - connection open
2025-05-18 20:31:04,403 - websockets.server - INFO - connection open
2025-05-18 20:31:37,826 - websockets.server - INFO - connection open
2025-05-18 20:35:25,716 - websockets.server - INFO - connection open
2025-05-18 20:42:29,588 - websockets.server - INFO - connection open
2025-05-18 20:55:18,432 - websockets.server - INFO - connection open
2025-05-18 20:58:48,319 - websockets.server - INFO - connection open
2025-05-18 21:04:31,270 - websockets.server - INFO - connection open
2025-05-18 21:05:22,630 - websockets.server - INFO - connection open
2025-05-18 21:05:40,385 - websockets.server - INFO - connection open
2025-05-18 21:06:06,276 - websockets.server - INFO - connection open
2025-05-18 21:06:27,074 - websockets.server - INFO - connection open
2025-05-18 21:08:44,064 - websockets.server - INFO - connection open
2025-05-18 21:09:02,498 - websockets.server - INFO - connection open
2025-05-18 21:09:24,009 - websockets.server - INFO - connection open
2025-05-18 21:09:45,999 - websockets.server - INFO - connection open
2025-05-18 21:10:15,799 - websockets.server - INFO - connection open
2025-05-18 21:10:34,998 - websockets.server - INFO - connection open
2025-05-18 21:11:01,374 - websockets.server - INFO - connection open
2025-05-18 21:11:23,260 - websockets.server - INFO - connection open
2025-05-18 21:11:53,006 - websockets.server - INFO - connection open
2025-05-18 21:19:36,966 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,970 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,970 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,978 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,979 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,979 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,984 - websockets.server - INFO - server closing
2025-05-18 21:19:36,986 - websockets.server - INFO - server closed
2025-05-18 21:19:37,011 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 21:19:39,521 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 21:19:39,549 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:19:39,549 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 21:19:39,550 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 21:19:59,371 - websockets.server - INFO - connection open
2025-05-18 21:20:07,713 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"ch√†o m√†y /no_think","session_id":"273c7f89-714d-440a-841d-c86c21de1269","mode":"basic","
2025-05-18 21:20:07,714 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:07,714 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: ch√†o m√†y /no_think...
2025-05-18 21:20:07,715 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session 273c7f89-714d-440a-841d-c86c21de1269 t·ª´ workflow th√†nh basic
2025-05-18 21:20:07,715 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: ch√†o m√†y /no_think, enable_thinking=False, mode=basic
2025-05-18 21:20:07,715 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:20:07,716 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'ch√†o m√†y /no_think', ph√≤ng ban: None, session_id: 273c7f89-714d-440a-841d-c86c21de1269, mode: basic
2025-05-18 21:20:07,716 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:07,717 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: ch√†o m√†y
2025-05-18 21:20:07,717 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'ch√†o m√†y', Mode: basic, Thinking: False
2025-05-18 21:20:07,717 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:20:07,718 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:20:07,718 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 21:20:07,718 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 21:20:07,719 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 182 k√Ω t·ª±
2025-05-18 21:20:07,719 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:20:13,344 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:20:13,345 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:20:13,346 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:20:13,347 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:13,347 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session 273c7f89-714d-440a-841d-c86c21de1269 th√†nh basic
2025-05-18 21:21:54,486 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"ch√†o m√†y /no_think","session_id":"b63c05c6-4ded-416a-a0d1-e39b50024ddf","mode":"basic","
2025-05-18 21:21:54,488 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:21:54,489 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: ch√†o m√†y /no_think...
2025-05-18 21:21:54,489 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session b63c05c6-4ded-416a-a0d1-e39b50024ddf t·ª´ workflow th√†nh basic
2025-05-18 21:21:54,490 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: ch√†o m√†y /no_think, enable_thinking=False, mode=basic
2025-05-18 21:21:54,490 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:21:54,491 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'ch√†o m√†y /no_think', ph√≤ng ban: None, session_id: b63c05c6-4ded-416a-a0d1-e39b50024ddf, mode: basic
2025-05-18 21:21:54,492 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:21:54,492 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: ch√†o m√†y
2025-05-18 21:21:54,493 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'ch√†o m√†y', Mode: basic, Thinking: False
2025-05-18 21:21:54,493 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:21:54,493 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:21:54,494 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 8 k√Ω t·ª±
2025-05-18 21:21:54,495 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 21:21:54,495 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 182 k√Ω t·ª±
2025-05-18 21:21:54,496 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:22:00,230 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:22:00,231 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:22:00,231 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:22:00,232 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:22:00,232 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session b63c05c6-4ded-416a-a0d1-e39b50024ddf th√†nh basic
2025-05-18 21:25:20,294 - websockets.server - INFO - connection closed
2025-05-18 21:25:21,717 - websockets.server - INFO - connection open
2025-05-18 21:25:26,408 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"aea1cba8-b5bb-47f5-9bf2-413941d3f4a9","mode":"workflow
2025-05-18 21:25:26,410 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,411 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 21:25:26,411 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=workflow
2025-05-18 21:25:26,412 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:25:26,414 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,494 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,495 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:25:26,496 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 21:25:26,496 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 21:25:26,497 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:25:26,497 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2605 k√Ω t·ª±
2025-05-18 21:25:26,501 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212526.txt
2025-05-18 21:25:26,502 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:25:26,503 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 21:25:26,505 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:25:37,993 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:25:37,994 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 21:25:37,995 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212537.txt
2025-05-18 21:25:37,996 - chatbot_rag - INFO - [analysis_20250518_212537] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_212537_raw.txt
2025-05-18 21:25:37,996 - chatbot_rag - INFO - [analysis_20250518_212537] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 21:25:37,997 - chatbot_rag - WARNING - [analysis_20250518_212537] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:25:38,000 - chatbot_rag - INFO - [analysis_20250518_212537] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 21:25:38,000 - chatbot_rag - INFO - [analysis_20250518_212537] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:25:38,001 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 21:25:38,001 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9, mode: workflow
2025-05-18 21:25:38,002 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,002 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 21:25:38,002 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: workflow, Thinking: False
2025-05-18 21:25:38,002 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:25:38,003 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,003 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,004 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:25:38,004 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 21:25:38,004 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-18 21:25:38,005 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:25:38,005 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2595 k√Ω t·ª±
2025-05-18 21:25:38,007 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212538.txt
2025-05-18 21:25:38,007 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:25:38,007 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 21:25:38,008 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:25:47,461 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:25:47,462 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user sent "xin ch√†o", which is a greeting in Vietnamese. The history doesn't mention any department or specific process. According to the rules, if there's no 
2025-05-18 21:25:47,464 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212547.txt
2025-05-18 21:25:47,485 - chatbot_rag - INFO - [analysis_20250518_212547] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_212547_raw.txt
2025-05-18 21:25:47,486 - chatbot_rag - INFO - [analysis_20250518_212547] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's break this down. The user sent "xin ch√†o", which is a greeting in Vietnamese. Th...
2025-05-18 21:25:47,504 - chatbot_rag - WARNING - [analysis_20250518_212547] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:25:47,504 - chatbot_rag - INFO - [analysis_20250518_212547] ƒê√£ t√¨m th·∫•y 2 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 21:25:47,504 - chatbot_rag - INFO - [analysis_20250518_212547] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:25:47,505 - websocket_server - INFO - TH√îNG TIN X·ª¨ L√ù TIN NH·∫ÆN:
2025-05-18 21:25:47,505 - websocket_server - INFO - - Ch·∫ø ƒë·ªô: workflow
2025-05-18 21:25:47,505 - websocket_server - INFO - - Session ID: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,505 - websocket_server - INFO - - Tr·∫°ng th√°i thinking: False
2025-05-18 21:25:47,506 - websocket_server - INFO - - Query ch√≠nh: 'xin ch√†o'
2025-05-18 21:25:47,506 - websocket_server - INFO - - Query g·ª≠i ƒë·∫øn model: 'xin ch√†o /no_think'
2025-05-18 21:25:47,506 - websocket_server - INFO - - Ph√≤ng ban ph√°t hi·ªán: None
2025-05-18 21:25:47,522 - websocket_server - INFO - - Lo·∫°i query: general
2025-05-18 21:25:47,523 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 21:25:47,531 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 21:25:47,554 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,594 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:25:47,595 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:25:47,597 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,599 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_212547.txt
2025-05-18 21:25:47,600 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1033 k√Ω t·ª±
2025-05-18 21:25:47,600 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:25:47,601 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1949 k√Ω t·ª±
2025-05-18 21:25:47,603 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212547.txt
2025-05-18 21:25:47,603 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:25:47,604 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 21:25:47,605 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:26:04,809 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:26:04,812 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

 Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v·ªÅ giai ƒëo·∫°n hay ph√≤ng ban n√†o ƒë√≥, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai
2025-05-18 21:26:04,813 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212604.txt
2025-05-18 21:26:05,204 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 439 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:26:05,204 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m ...
2025-05-18 21:26:05,204 - websocket_server - INFO - enable_thinking=False, b·ªè qua n·ªôi dung thinking
2025-05-18 21:26:05,205 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:05,205 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 th√†nh workflow
2025-05-18 21:26:05,207 - websocket_server - INFO - WebSocket connection closed
2025-05-18 21:26:05,207 - websockets.server - INFO - connection closed
2025-05-18 21:26:05,208 - websockets.server - INFO - connection open
2025-05-18 21:26:13,326 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v·ªÅ gia
2025-05-18 21:26:13,326 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:26:13,330 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_212613.txt
2025-05-18 21:26:13,331 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 21:26:13,331 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v·ªÅ giai ƒëo·∫°n hay ph√≤ng ban n√†o ƒë√≥, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o?" ho·∫∑c "Giai ƒëo·∫°n DEFECT-HANDOVER g·ªìm nh·ªØng b∆∞·ªõc g√¨?"  

ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: **"Ph√≤ng Kinh doanh l√†m g√¨ trong giai ƒëo·∫°n MKT-SALES?"** üìå

üí° *N·∫øu b·∫°n mu·ªën n√≥i chuy·ªán vui v·∫ª, ƒë·ª´ng ng·∫°i h·ªèi! üòÑ*, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:13,334 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:13,334 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:26:13,336 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v...
2025-05-18 21:26:13,338 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1060 k√Ω t·ª±
2025-05-18 21:26:13,339 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:26:13,339 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 3066 k√Ω t·ª±
2025-05-18 21:26:13,341 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212613.txt
2025-05-18 21:26:13,341 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:26:13,342 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v...
2025-05-18 21:26:13,342 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:26:38,349 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:26:38,350 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where the assistant greeted them and explained how to ask questions about specific departments or processes. The current 
2025-05-18 21:26:38,353 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212638.txt
2025-05-18 21:26:38,356 - chatbot_rag - INFO - [analysis_20250518_212638] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_212638_raw.txt
2025-05-18 21:26:38,356 - chatbot_rag - INFO - [analysis_20250518_212638] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where the assistant g...
2025-05-18 21:26:38,357 - chatbot_rag - WARNING - [analysis_20250518_212638] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:26:38,358 - chatbot_rag - INFO - [analysis_20250518_212638] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 21:26:38,360 - chatbot_rag - INFO - [analysis_20250518_212638] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:26:38,361 - chatbot_rag - INFO - [analysis_20250518_212638] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 21:26:38,362 - chatbot_rag - WARNING - [analysis_20250518_212638] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 21:26:38,362 - chatbot_rag - INFO - [analysis_20250518_212638] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 21:26:38,374 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:26:38,375 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:26:38,377 - chatbot_rag - INFO - [analysis_20250518_212638] B∆Ø·ªöC 3: T√¨m th·∫•y ph√≤ng ban trong c√¢u h·ªèi: Kinh doanh
2025-05-18 21:26:38,377 - chatbot_rag - ERROR - [analysis_20250518_212638] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 21:26:38,378 - chatbot_rag - WARNING - [analysis_20250518_212638] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 21:26:38,379 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 21:26:38,379 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:38,387 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:26:38,387 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:26:38,388 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:38,391 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_212638.txt
2025-05-18 21:26:38,391 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1461 k√Ω t·ª±
2025-05-18 21:26:38,391 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:26:38,392 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2377 k√Ω t·ª±
2025-05-18 21:26:38,393 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212638.txt
2025-05-18 21:26:38,394 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:26:38,394 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "Xin ch√†o!üëã‚ú®  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v·ªÅ giai ƒëo·∫°n hay ph√≤ng ban n√†o ƒë√≥, c·ª© h·ªèi nh√©!  
V√≠ d·ª•: "Ph√≤ng Marketing tham gia giai ƒëo·∫°n n√†o...
2025-05-18 21:26:38,395 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:27:26,024 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:27:26,025 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, the user provided a detailed setup about the company's departments and processes. They want me to respond in Vietnamese using Markdown, focusing on structure without explaining specific 
2025-05-18 21:27:26,027 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212726.txt
2025-05-18 21:27:26,031 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1827 k√Ω t·ª±) v√† c√≤n l·∫°i 582 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:27:26,032 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: # üìå Giai ƒëo·∫°n v√† ph√≤ng ban li√™n quan  

1. **MKT-S...
2025-05-18 21:27:26,032 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1827 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 21:27:26,033 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747578373325_x1ged8h
2025-05-18 21:27:26,034 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1827 k√Ω t·ª±)
2025-05-18 21:27:26,035 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"aea1cba8-b5bb-47f5-9bf2-413941d3f4a9","mode":"basic","
2025-05-18 21:27:26,036 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:26,037 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 21:27:26,037 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 t·ª´ workflow th√†nh basic
2025-05-18 21:27:26,037 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 21:27:26,038 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:27:26,038 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9, mode: basic
2025-05-18 21:27:26,038 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:26,040 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 21:27:26,040 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 21:27:26,041 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:27:26,041 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:27:26,042 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_212726.txt
2025-05-18 21:27:26,043 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 48 k√Ω t·ª±
2025-05-18 21:27:26,043 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 21:27:26,044 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 222 k√Ω t·ª±
2025-05-18 21:27:26,044 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:27:31,446 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:27:31,447 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:27:31,448 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:27:31,449 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:31,449 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 th√†nh basic
2025-05-18 21:27:45,740 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 21:27:45,741 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:27:45,742 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 21:27:45,743 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: , session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:27:45,744 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:27:45,744 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:27:45,745 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: ""

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_s...
2025-05-18 21:27:45,745 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 581 k√Ω t·ª±
2025-05-18 21:27:45,746 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:27:45,746 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2587 k√Ω t·ª±
2025-05-18 21:27:45,749 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212745.txt
2025-05-18 21:27:45,749 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:27:45,750 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: ""

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "department_s...
2025-05-18 21:27:45,750 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:28:08,958 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:28:08,959 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this. The user provided a query where the current question is an empty string. They want me to analyze it based on the given rules.

First, I need to check if there's any me
2025-05-18 21:28:08,978 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212808.txt
2025-05-18 21:28:08,981 - chatbot_rag - INFO - [analysis_20250518_212808] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_212808_raw.txt
2025-05-18 21:28:08,981 - chatbot_rag - INFO - [analysis_20250518_212808] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this. The user provided a query where the current question is an empty st...
2025-05-18 21:28:08,982 - chatbot_rag - WARNING - [analysis_20250518_212808] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:28:08,982 - chatbot_rag - INFO - [analysis_20250518_212808] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 21:28:08,982 - chatbot_rag - INFO - [analysis_20250518_212808] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:28:08,983 - chatbot_rag - INFO - [analysis_20250518_212808] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 21:28:08,983 - chatbot_rag - WARNING - [analysis_20250518_212808] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 21:28:08,983 - chatbot_rag - INFO - [analysis_20250518_212808] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 21:28:08,989 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:28:08,990 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:28:08,997 - chatbot_rag - ERROR - [analysis_20250518_212808] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 21:28:08,997 - chatbot_rag - WARNING - [analysis_20250518_212808] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 21:28:08,998 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 21:28:08,998 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:28:09,003 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:28:09,004 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:28:09,004 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:28:09,027 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_212809.txt
2025-05-18 21:28:09,028 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 21:28:09,028 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:28:09,029 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 21:28:09,030 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212809.txt
2025-05-18 21:28:09,032 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:28:09,032 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 21:28:09,033 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:28:28,569 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:28:28,569 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, the user is asking a general question about the process or stages. Let me check if it's related to their work.

The info provided lists main stages and departments. The user's query is j
2025-05-18 21:28:28,571 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_212828.txt
2025-05-18 21:28:28,578 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (558 k√Ω t·ª±) v√† c√≤n l·∫°i 194 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:28:28,579 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: ü§î *ƒêang suy ng·∫´m...*  
B·∫°n c√≥ mu·ªën h·ªèi g√¨ v·ªÅ quy t...
2025-05-18 21:28:28,579 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (558 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 21:28:28,579 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747578465739_2fraiv4
2025-05-18 21:28:28,582 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (558 k√Ω t·ª±)
2025-05-18 21:29:10,684 - websockets.server - INFO - connection closed
2025-05-18 21:29:10,685 - websockets.server - INFO - server closing
2025-05-18 21:29:10,686 - websockets.server - INFO - server closed
2025-05-18 21:29:10,690 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 21:29:13,845 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 21:29:13,890 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:29:13,890 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 21:29:13,891 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 21:29:18,446 - websockets.server - INFO - connection open
2025-05-18 21:29:30,075 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"85ec3946-0108-4ab1-9671-76b7df2f46b1","mode":"basic","
2025-05-18 21:29:30,077 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:30,077 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 21:29:30,078 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session 85ec3946-0108-4ab1-9671-76b7df2f46b1 t·ª´ workflow th√†nh basic
2025-05-18 21:29:30,078 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 21:29:30,078 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:29:30,079 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1, mode: basic
2025-05-18 21:29:30,079 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:30,079 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 21:29:30,080 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 21:29:30,080 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: B·∫°n l√† m·ªôt tr·ª£ l√Ω AI h·ªØu √≠ch v√† th√¥ng minh. H√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng m·ªôt c√°ch chi ti·∫øt v√† ...
2025-05-18 21:29:30,080 - websocket_server - INFO - [DEBUG THINKING] Query hi·ªÉn th·ªã: 'xin ch√†o', Query g·ª≠i ƒë·∫øn model: 'xin ch√†o /no_think'
2025-05-18 21:29:30,081 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:29:30,081 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng g·ª≠i ƒë·∫øn LLM: 'xin ch√†o /no_think...'
2025-05-18 21:29:30,082 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 18 k√Ω t·ª±
2025-05-18 21:29:30,082 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 174 k√Ω t·ª±
2025-05-18 21:29:30,082 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 192 k√Ω t·ª±
2025-05-18 21:29:30,082 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:29:33,081 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:29:33,085 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:29:33,090 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:29:33,091 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:33,095 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session 85ec3946-0108-4ab1-9671-76b7df2f46b1 th√†nh basic
2025-05-18 21:29:42,844 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 21:29:42,844 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:29:42,853 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_212942.txt
2025-05-18 21:29:42,853 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng tr·∫£ v·ªÅ t·ª´ add_history_to_prompt c√≥ h·∫≠u t·ªë: 
2025-05-18 21:29:42,853 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 21:29:42,855 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:42,876 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:42,877 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:29:42,877 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 21:29:42,878 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 621 k√Ω t·ª±
2025-05-18 21:29:42,879 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:29:42,879 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2627 k√Ω t·ª±
2025-05-18 21:29:42,882 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_212942.txt
2025-05-18 21:29:42,882 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:29:42,883 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 21:29:42,883 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:30:05,317 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:30:05,319 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's break this down. The user provided a history of messages where the initial message is just "xin ch√†o" (hello). There's no mention of any specific department or process in the histo
2025-05-18 21:30:05,320 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_213005.txt
2025-05-18 21:30:05,322 - chatbot_rag - INFO - [analysis_20250518_213005] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_213005_raw.txt
2025-05-18 21:30:05,323 - chatbot_rag - INFO - [analysis_20250518_213005] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's break this down. The user provided a history of messages where the initial messa...
2025-05-18 21:30:05,323 - chatbot_rag - WARNING - [analysis_20250518_213005] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:30:05,325 - chatbot_rag - INFO - [analysis_20250518_213005] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 21:30:05,325 - chatbot_rag - INFO - [analysis_20250518_213005] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:30:05,326 - chatbot_rag - INFO - [analysis_20250518_213005] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 21:30:05,326 - chatbot_rag - WARNING - [analysis_20250518_213005] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 21:30:05,326 - chatbot_rag - INFO - [analysis_20250518_213005] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 21:30:05,336 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:30:05,336 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:30:05,337 - chatbot_rag - ERROR - [analysis_20250518_213005] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 21:30:05,337 - chatbot_rag - WARNING - [analysis_20250518_213005] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 21:30:05,338 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 21:30:05,338 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:30:05,340 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:30:05,340 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:30:05,341 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:30:05,343 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_213005.txt
2025-05-18 21:30:05,344 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 21:30:05,344 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:30:05,344 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 21:30:05,346 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_213005.txt
2025-05-18 21:30:05,346 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:30:05,347 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 21:30:05,347 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:30:37,263 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:30:37,264 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user provided a query that's pretty vague about the process or stages of work. They mentioned some general info about the company's departments and stages but didn't ask a
2025-05-18 21:30:37,266 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_213037.txt
2025-05-18 21:30:37,638 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (1580 k√Ω t·ª±) v√† c√≤n l·∫°i 308 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:30:37,638 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: **üéâ C√¢u h·ªèi chung kh√¥ng li√™n quan ƒë·∫øn c√¥ng vi·ªác? T...
2025-05-18 21:30:37,638 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (1580 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 21:30:37,639 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747578582843_a3gbte2
2025-05-18 21:30:37,639 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (1580 k√Ω t·ª±)
2025-05-18 21:32:07,803 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: 
2025-05-18 21:32:07,806 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:32:07,812 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_213207.txt
2025-05-18 21:32:07,813 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng tr·∫£ v·ªÅ t·ª´ add_history_to_prompt c√≥ h·∫≠u t·ªë: 
2025-05-18 21:32:07,813 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 21:32:07,814 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:07,815 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:07,817 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:32:07,817 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 21:32:07,819 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 621 k√Ω t·ª±
2025-05-18 21:32:07,819 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:32:07,820 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2627 k√Ω t·ª±
2025-05-18 21:32:07,831 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_213207.txt
2025-05-18 21:32:07,832 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:32:07,834 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban...
2025-05-18 21:32:07,835 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:32:34,169 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:32:34,173 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me try to figure out how to handle this user's query. The user provided a history of messages where the first message is "xin ch√†o" (which means "hello"). Now, their current question
2025-05-18 21:32:34,176 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_213234.txt
2025-05-18 21:32:34,179 - chatbot_rag - INFO - [analysis_20250518_213234] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_213234_raw.txt
2025-05-18 21:32:34,180 - chatbot_rag - INFO - [analysis_20250518_213234] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me try to figure out how to handle this user's query. The user provided a history ...
2025-05-18 21:32:34,180 - chatbot_rag - WARNING - [analysis_20250518_213234] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:32:34,181 - chatbot_rag - INFO - [analysis_20250518_213234] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 21:32:34,182 - chatbot_rag - INFO - [analysis_20250518_213234] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:32:34,183 - chatbot_rag - INFO - [analysis_20250518_213234] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 21:32:34,184 - chatbot_rag - WARNING - [analysis_20250518_213234] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 21:32:34,184 - chatbot_rag - INFO - [analysis_20250518_213234] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 21:32:34,193 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:32:34,194 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:32:34,196 - chatbot_rag - ERROR - [analysis_20250518_213234] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 21:32:34,196 - chatbot_rag - WARNING - [analysis_20250518_213234] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 21:32:34,196 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 21:32:34,197 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:34,203 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:32:34,203 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:32:34,204 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:34,205 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_213234.txt
2025-05-18 21:32:34,206 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1022 k√Ω t·ª±
2025-05-18 21:32:34,206 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:32:34,206 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1938 k√Ω t·ª±
2025-05-18 21:32:34,208 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_213234.txt
2025-05-18 21:32:34,208 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:32:34,209 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: " /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1. **MKT-SAL...
2025-05-18 21:32:34,210 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:33:10,777 - websockets.server - INFO - connection closed
2025-05-18 21:33:10,791 - websockets.server - INFO - server closing
2025-05-18 21:33:10,794 - websockets.server - INFO - server closed
2025-05-18 21:33:10,800 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 21:33:10,935 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-5' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1488, in <module>
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1237, in handle_message
    "error": str(e)
  File "server.py", line 1103, in handle_action
    await websocket.send(json.dumps(response))
  File "server.py", line 969, in handle_thinking_request
    ## Ph√¢n t√≠ch c√¢u h·ªèi v·ªÅ ph√≤ng ban {department}
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 443, in handle_general_query
    final_response = query_llm(user_prompt, system_prompt)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 21:33:46,991 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 21:33:47,032 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:33:47,033 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 21:33:47,034 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 21:33:54,812 - websockets.server - INFO - connection open
2025-05-18 21:34:28,369 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":"ca7a6388-c9b6-44eb-9c6b-3d846dc07adc","mode":"basic","
2025-05-18 21:34:28,457 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:28,513 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 21:34:28,514 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc t·ª´ workflow th√†nh basic
2025-05-18 21:34:28,520 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False, mode=basic
2025-05-18 21:34:28,521 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu...
2025-05-18 21:34:28,524 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc, mode: basic
2025-05-18 21:34:28,526 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:28,527 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 21:34:28,528 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode: basic, Thinking: False
2025-05-18 21:34:28,528 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu...
2025-05-18 21:34:28,529 - websocket_server - INFO - [DEBUG THINKING] Query hi·ªÉn th·ªã: 'xin ch√†o', Query g·ª≠i ƒë·∫øn model: 'xin ch√†o /no_think'
2025-05-18 21:34:28,533 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:34:28,534 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng g·ª≠i ƒë·∫øn LLM: 'xin ch√†o /no_think...'
2025-05-18 21:34:28,536 - websocket_server - INFO - [DEBUG THINKING] System prompt cu·ªëi c√πng: 'lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu


H∆Ø·ªöNG D·∫™N QUAN TR·ªåNG V·ªÄ THINKING:

Khi ch·∫ø ƒë·ªô thinking ƒë∆∞·ª£c B·∫¨T (th·ªÉ hi·ªán b·∫±ng h·∫≠u t·ªë '/think'):
- ƒê·∫∑t suy nghƒ©, ph√¢n t√≠ch v√† l√Ω lu·∫≠n c·ªßa b·∫°n trong th·∫ª <think>...</think>
- Th·∫ª <think> ph·∫£i lu√¥n ƒë·ª©ng TR∆Ø·ªöC ph·∫ßn c√¢u tr·∫£ l·ªùi ch√≠nh th·ª©c
- V√≠ d·ª•: "<think>ƒê√¢y l√† ph√¢n t√≠ch c·ªßa t√¥i...</think>

ƒê√¢y l√† c√¢u tr·∫£ l·ªùi ch√≠nh th·ª©c..."

Khi ch·∫ø ƒë·ªô thinking b·ªã T·∫ÆT (th·ªÉ hi·ªán b·∫±ng h·∫≠u t·ªë '/no_think'):
- KH√îNG ƒë∆∞·ª£c s·ª≠ d·ª•ng th·∫ª <think> trong b·∫•t k·ª≥ ph·∫ßn n√†o c·ªßa c√¢u tr·∫£ l·ªùi
- Ch·ªâ tr·∫£ v·ªÅ c√¢u tr·∫£ l·ªùi tr·ª±c ti·∫øp, kh√¥ng c√≥ ph·∫ßn thinking

L∆ØU √ù: 
- Lu√¥n ki·ªÉm tra cu·ªëi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ x√°c ƒë·ªãnh c√≥ h·∫≠u t·ªë '/think' hay '/no_think'
- Tu√¢n th·ªß nghi√™m ng·∫∑t quy t·∫Øc n√†y trong m·ªçi c√¢u tr·∫£ l·ªùi
'
2025-05-18 21:34:28,541 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 18 k√Ω t·ª±
2025-05-18 21:34:28,542 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 699 k√Ω t·ª±
2025-05-18 21:34:28,543 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 717 k√Ω t·ª±
2025-05-18 21:34:28,543 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:34:37,545 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:34:37,551 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:34:37,555 - websocket_server - WARNING - [DEBUG THINKING] Ph√°t hi·ªán response r·ªóng, t·∫°o ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh
2025-05-18 21:34:37,557 - websocket_server - INFO - [DEBUG THINKING] G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, content: 63 k√Ω t·ª±, thinking: False
2025-05-18 21:34:37,557 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:34:37,566 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:37,569 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc th√†nh basic
2025-05-18 21:34:50,943 - websocket_server - INFO - Nh·∫≠n y√™u c·∫ßu ph√¢n t√≠ch (thinking) cho c√¢u h·ªèi: Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i.
2025-05-18 21:34:50,944 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:34:50,956 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_213450.txt
2025-05-18 21:34:50,957 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng tr·∫£ v·ªÅ t·ª´ add_history_to_prompt c√≥ h·∫≠u t·ªë: g th·ª≠ l·∫°i.
2025-05-18 21:34:50,958 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh ph√≤ng ban ho·∫∑c lo·∫°i c√¢u h·ªèi
2025-05-18 21:34:50,960 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i., session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:51,030 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:51,030 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:34:51,031 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i."

        Ph√¢n t√≠ch c√¢u h·ªèi v√† ...
2025-05-18 21:34:51,034 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 684 k√Ω t·ª±
2025-05-18 21:34:51,035 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:34:51,035 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2690 k√Ω t·ª±
2025-05-18 21:34:51,038 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_213451.txt
2025-05-18 21:34:51,038 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:34:51,039 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i."

        Ph√¢n t√≠ch c√¢u h·ªèi v√† ...
2025-05-18 21:34:51,039 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:35:15,856 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:35:15,857 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user provided a history of messages where the previous interaction was an apology for not being able to process the request. Now, the current question is abo
2025-05-18 21:35:15,859 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_213515.txt
2025-05-18 21:35:15,862 - chatbot_rag - INFO - [analysis_20250518_213515] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_213515_raw.txt
2025-05-18 21:35:15,862 - chatbot_rag - INFO - [analysis_20250518_213515] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user provided a history of messages where the previous in...
2025-05-18 21:35:15,863 - chatbot_rag - WARNING - [analysis_20250518_213515] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:35:15,865 - chatbot_rag - INFO - [analysis_20250518_213515] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-18 21:35:15,865 - chatbot_rag - INFO - [analysis_20250518_213515] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:35:15,866 - chatbot_rag - INFO - [analysis_20250518_213515] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-18 21:35:15,866 - chatbot_rag - WARNING - [analysis_20250518_213515] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-18 21:35:15,866 - chatbot_rag - INFO - [analysis_20250518_213515] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-18 21:35:15,873 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:35:15,874 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:35:15,875 - chatbot_rag - ERROR - [analysis_20250518_213515] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-18 21:35:15,876 - chatbot_rag - WARNING - [analysis_20250518_213515] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-18 21:35:15,876 - websocket_server - INFO - L·∫•y ph√¢n t√≠ch cho c√¢u h·ªèi chung
2025-05-18 21:35:15,876 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:15,881 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:35:15,881 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:35:15,882 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:15,883 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_213515.txt
2025-05-18 21:35:15,883 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1085 k√Ω t·ª±
2025-05-18 21:35:15,883 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:35:15,884 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2001 k√Ω t·ª±
2025-05-18 21:35:15,886 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_213515.txt
2025-05-18 21:35:15,886 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:35:15,887 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "Xin l·ªói, t√¥i kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i. /think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v...
2025-05-18 21:35:15,887 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:35:39,142 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:35:39,144 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user is asking about a process or stage in the company workflow, but their message is just an error response from the system. They mentioned they can't process the request
2025-05-18 21:35:39,146 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_213539.txt
2025-05-18 21:35:39,610 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (881 k√Ω t·ª±) v√† c√≤n l·∫°i 194 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:35:39,611 - websocket_server - INFO - Ph·∫ßn n·ªôi dung c√≤n l·∫°i b·∫Øt ƒë·∫ßu b·∫±ng: üòÖ Xin l·ªói nha! C√≥ v·∫ª h·ªá th·ªëng ƒëang "ƒë√°nh nhau" v·ªõi...
2025-05-18 21:35:39,611 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (881 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi handle_general_query
2025-05-18 21:35:39,611 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi thinking v·ªõi request_id: thinking_1747578890939_xu8p9fm
2025-05-18 21:35:39,612 - websocket_server - INFO - ƒê√£ g·ª≠i n·ªôi dung thinking (881 k√Ω t·ª±)
2025-05-18 21:35:39,614 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"m√†y l√† ai /no_think","session_id":"ca7a6388-c9b6-44eb-9c6b-3d846dc07adc","mode":"basic",
2025-05-18 21:35:39,615 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:39,616 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: m√†y l√† ai /no_think...
2025-05-18 21:35:39,617 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: m√†y l√† ai /no_think, enable_thinking=False, mode=basic
2025-05-18 21:35:39,617 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu...
2025-05-18 21:35:39,618 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'm√†y l√† ai /no_think', ph√≤ng ban: None, session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc, mode: basic
2025-05-18 21:35:39,619 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:39,619 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: m√†y l√† ai
2025-05-18 21:35:39,620 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'm√†y l√† ai', Mode: basic, Thinking: False
2025-05-18 21:35:39,620 - websocket_server - INFO - Ch·∫ø ƒë·ªô Basic ƒë∆∞·ª£c k√≠ch ho·∫°t v·ªõi prompt: lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu...
2025-05-18 21:35:39,621 - websocket_server - INFO - [DEBUG THINKING] Query hi·ªÉn th·ªã: 'm√†y l√† ai', Query g·ª≠i ƒë·∫øn model: 'm√†y l√† ai /no_think'
2025-05-18 21:35:39,621 - websocket_server - INFO - Ph√°t hi·ªán h·∫≠u t·ªë /no_think trong prompt g·ªëc, gi·ªØ l·∫°i cho LLM nh∆∞ng lo·∫°i b·ªè cho log
2025-05-18 21:35:39,622 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-18 21:35:39,624 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250518_213539.txt
2025-05-18 21:35:39,624 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng tr·∫£ v·ªÅ t·ª´ add_history_to_prompt c√≥ h·∫≠u t·ªë:  /no_think
2025-05-18 21:35:39,625 - websocket_server - INFO - [DEBUG THINKING] N·ªôi dung cu·ªëi c√πng g·ª≠i ƒë·∫øn LLM: 'L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

m√†y l√† ai /no_think...'
2025-05-18 21:35:39,625 - websocket_server - INFO - [DEBUG THINKING] System prompt cu·ªëi c√πng: 'lu√¥n tr·∫£ l·ªùi t√¥i b·ªã ngu


H∆Ø·ªöNG D·∫™N QUAN TR·ªåNG V·ªÄ THINKING:

Khi ch·∫ø ƒë·ªô thinking ƒë∆∞·ª£c B·∫¨T (th·ªÉ hi·ªán b·∫±ng h·∫≠u t·ªë '/think'):
- ƒê·∫∑t suy nghƒ©, ph√¢n t√≠ch v√† l√Ω lu·∫≠n c·ªßa b·∫°n trong th·∫ª <think>...</think>
- Th·∫ª <think> ph·∫£i lu√¥n ƒë·ª©ng TR∆Ø·ªöC ph·∫ßn c√¢u tr·∫£ l·ªùi ch√≠nh th·ª©c
- V√≠ d·ª•: "<think>ƒê√¢y l√† ph√¢n t√≠ch c·ªßa t√¥i...</think>

ƒê√¢y l√† c√¢u tr·∫£ l·ªùi ch√≠nh th·ª©c..."

Khi ch·∫ø ƒë·ªô thinking b·ªã T·∫ÆT (th·ªÉ hi·ªán b·∫±ng h·∫≠u t·ªë '/no_think'):
- KH√îNG ƒë∆∞·ª£c s·ª≠ d·ª•ng th·∫ª <think> trong b·∫•t k·ª≥ ph·∫ßn n√†o c·ªßa c√¢u tr·∫£ l·ªùi
- Ch·ªâ tr·∫£ v·ªÅ c√¢u tr·∫£ l·ªùi tr·ª±c ti·∫øp, kh√¥ng c√≥ ph·∫ßn thinking

L∆ØU √ù: 
- Lu√¥n ki·ªÉm tra cu·ªëi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ x√°c ƒë·ªãnh c√≥ h·∫≠u t·ªë '/think' hay '/no_think'
- Tu√¢n th·ªß nghi√™m ng·∫∑t quy t·∫Øc n√†y trong m·ªçi c√¢u tr·∫£ l·ªùi
'
2025-05-18 21:35:39,626 - websocket_server - INFO - K√≠ch th∆∞·ªõc prompt: 59 k√Ω t·ª±
2025-05-18 21:35:39,626 - websocket_server - INFO - K√≠ch th∆∞·ªõc system prompt: 699 k√Ω t·ª±
2025-05-18 21:35:39,627 - websocket_server - INFO - T·ªïng k√≠ch th∆∞·ªõc: 758 k√Ω t·ª±
2025-05-18 21:35:39,627 - websocket_server - INFO - B·∫Øt ƒë·∫ßu g·ªçi LLM API (l·∫ßn th·ª≠ 1/3)
2025-05-18 21:35:46,067 - websocket_server - INFO - API tr·∫£ v·ªÅ status 200 OK
2025-05-18 21:35:46,067 - websocket_server - INFO - Streaming ho√†n t·∫•t th√†nh c√¥ng
2025-05-18 21:35:46,068 - websocket_server - WARNING - [DEBUG THINKING] Ph√°t hi·ªán response r·ªóng, t·∫°o ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh
2025-05-18 21:35:46,069 - websocket_server - INFO - [DEBUG THINKING] G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, content: 63 k√Ω t·ª±, thinking: False
2025-05-18 21:35:46,069 - websocket_server - INFO - G·ª≠i ph·∫£n h·ªìi cu·ªëi c√πng, ch·∫ø ƒë·ªô basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:35:46,070 - websocket_server - INFO - L∆∞u h·ªôi tho·∫°i basic mode v√†o l·ªãch s·ª≠ v·ªõi session_id=ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:46,071 - websocket_server - INFO - C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô c·ªßa session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc th√†nh basic
2025-05-18 21:36:36,031 - websockets.server - INFO - connection closed
2025-05-18 21:36:40,074 - websockets.server - INFO - server closing
2025-05-18 21:36:40,075 - websockets.server - INFO - server closed
2025-05-18 21:36:40,087 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 21:40:03,418 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 21:40:03,466 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:40:03,467 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 21:40:03,467 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 21:40:17,825 - websockets.server - INFO - connection open
2025-05-18 21:40:20,789 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-18 21:40:20,790 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,791 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,791 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 21:40:20,792 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-18 21:40:20,792 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:40:20,792 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,812 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,812 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:40:20,813 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 21:40:20,814 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 21:40:20,814 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:40:20,815 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2605 k√Ω t·ª±
2025-05-18 21:40:20,817 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_214020.txt
2025-05-18 21:40:20,818 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:40:20,819 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 21:40:20,822 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:40:36,094 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:40:36,095 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 21:40:36,105 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_214036.txt
2025-05-18 21:40:36,117 - chatbot_rag - INFO - [analysis_20250518_214036] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_214036_raw.txt
2025-05-18 21:40:36,118 - chatbot_rag - INFO - [analysis_20250518_214036] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 21:40:36,119 - chatbot_rag - WARNING - [analysis_20250518_214036] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:40:36,120 - chatbot_rag - INFO - [analysis_20250518_214036] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 21:40:36,121 - chatbot_rag - INFO - [analysis_20250518_214036] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:40:36,122 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 21:40:36,123 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,123 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,123 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-18 21:40:36,124 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-18 21:40:36,124 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 21:40:36,125 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,125 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,126 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 21:40:36,126 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 21:40:36,126 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-18 21:40:36,128 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 21:40:36,129 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2595 k√Ω t·ª±
2025-05-18 21:40:36,135 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_214036.txt
2025-05-18 21:40:36,136 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 21:40:36,137 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-18 21:40:36,139 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-18 21:40:50,212 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:40:50,218 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this query. The user's current message is "xin ch√†o", which means "hello" in Vietnamese. The history of messages is empty, so there's no previous context to reference.

Firs
2025-05-18 21:40:50,233 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_214050.txt
2025-05-18 21:40:50,243 - chatbot_rag - INFO - [analysis_20250518_214050] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250518_214050_raw.txt
2025-05-18 21:40:50,245 - chatbot_rag - INFO - [analysis_20250518_214050] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this query. The user's current message is "xin ch√†o", which means "hello"...
2025-05-18 21:40:50,276 - chatbot_rag - WARNING - [analysis_20250518_214050] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-18 21:40:50,283 - chatbot_rag - INFO - [analysis_20250518_214050] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-18 21:40:50,288 - chatbot_rag - INFO - [analysis_20250518_214050] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:40:50,291 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-18 21:40:50,293 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-18 21:40:50,294 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-18 21:40:50,300 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:50,337 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-18 21:40:50,344 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-18 21:40:50,351 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:50,353 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250518_214050.txt
2025-05-18 21:40:50,353 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1033 k√Ω t·ª±
2025-05-18 21:40:50,354 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-18 21:40:50,354 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1949 k√Ω t·ª±
2025-05-18 21:40:50,358 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_214050.txt
2025-05-18 21:40:50,360 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-18 21:40:50,361 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-18 21:40:50,364 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=True
2025-05-18 21:41:06,226 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-18 21:41:06,229 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

 Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng ta! üöÄ  
N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o v·ªÅ c√°c giai ƒëo·∫°n ho·∫∑c ph√≤ng ban, m√¨nh s·∫Ω h·ªó tr·ª£ b·∫°n ngay l·∫≠p t·ª©c! üí¨  
ƒê·ª´ng n
2025-05-18 21:41:06,232 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250518_214106.txt
2025-05-18 21:41:06,651 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 381 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-18 21:41:06,652 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-18 21:41:06,652 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:41:12,326 - websockets.server - INFO - connection closed
2025-05-18 21:41:12,327 - websockets.server - INFO - server closing
2025-05-18 21:41:12,327 - websockets.server - INFO - server closed
2025-05-18 21:41:12,330 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-18 16:30:52,188 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-18 16:30:52,222 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:30:52,223 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-18 16:30:52,224 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-18 16:32:37,841 - websockets.server - INFO - connection open
2025-05-18 16:32:40,528 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-18 16:32:40,530 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:40,531 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:40,532 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-18 16:32:40,535 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-18 16:32:40,537 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-18 16:32:40,539 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:42,293 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:42,294 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-18 16:32:42,294 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:32:42,295 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-18 16:32:42,296 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-18 16:32:42,297 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2605 k√Ω t·ª±
2025-05-18 16:32:42,486 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250518_163242.txt
2025-05-18 16:32:42,504 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-18 16:32:42,506 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-18 16:32:42,508 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.1.4:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 02:35:10,012 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-19 02:35:10,034 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 02:35:10,035 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-19 02:35:10,035 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-19 10:06:35,647 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-19 10:06:35,785 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 10:06:35,785 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-19 10:06:35,785 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-19 10:07:12,809 - websockets.server - INFO - connection open
2025-05-19 10:07:18,540 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"xin ch√†o /no_think","session_id":""}
2025-05-19 10:07:18,541 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,541 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,542 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: xin ch√†o /no_think...
2025-05-19 10:07:18,543 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: xin ch√†o /no_think, enable_thinking=False
2025-05-19 10:07:18,543 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-19 10:07:18,543 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,560 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,561 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:18,561 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-19 10:07:18,562 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 599 k√Ω t·ª±
2025-05-19 10:07:18,562 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:18,563 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2605 k√Ω t·ª±
2025-05-19 10:07:18,565 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100718.txt
2025-05-19 10:07:18,566 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:18,567 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_ty...
2025-05-19 10:07:18,567 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:19,006 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:19,007 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:19,009 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100719.txt
2025-05-19 10:07:19,012 - chatbot_rag - INFO - [analysis_20250519_100719] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100719_raw.txt
2025-05-19 10:07:19,012 - chatbot_rag - INFO - [analysis_20250519_100719] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:19,013 - chatbot_rag - WARNING - [analysis_20250519_100719] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:19,013 - chatbot_rag - INFO - [analysis_20250519_100719] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-19 10:07:19,014 - chatbot_rag - INFO - [analysis_20250519_100719] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:19,014 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:19,015 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'xin ch√†o /no_think', ph√≤ng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,015 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,015 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: xin ch√†o
2025-05-19 10:07:19,016 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'xin ch√†o', Mode thinking: False
2025-05-19 10:07:19,016 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-19 10:07:19,017 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: xin ch√†o, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,018 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,019 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:19,019 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-19 10:07:19,020 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 589 k√Ω t·ª±
2025-05-19 10:07:19,020 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:19,020 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2595 k√Ω t·ª±
2025-05-19 10:07:19,022 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100719.txt
2025-05-19 10:07:19,023 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:19,024 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "xin ch√†o"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ph√≤ng ban ho·∫∑c null", "query_type": "depa...
2025-05-19 10:07:19,026 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:20,916 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:20,916 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's tackle this. The user's current question is "xin ch√†o", which means "hello" in Vietnamese. I need to analyze this based on the provided guidelines.

First, looking at the history o
2025-05-19 10:07:21,102 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100720.txt
2025-05-19 10:07:21,122 - chatbot_rag - INFO - [analysis_20250519_100721] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100721_raw.txt
2025-05-19 10:07:21,123 - chatbot_rag - INFO - [analysis_20250519_100721] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's tackle this. The user's current question is "xin ch√†o", which means "hello" in V...
2025-05-19 10:07:21,123 - chatbot_rag - WARNING - [analysis_20250519_100721] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:21,123 - chatbot_rag - INFO - [analysis_20250519_100721] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:21,124 - chatbot_rag - INFO - [analysis_20250519_100721] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:21,124 - chatbot_rag - INFO - [analysis_20250519_100721] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:21,124 - chatbot_rag - WARNING - [analysis_20250519_100721] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-19 10:07:21,125 - chatbot_rag - INFO - [analysis_20250519_100721] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-19 10:07:21,622 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:21,622 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:21,628 - chatbot_rag - ERROR - [analysis_20250519_100721] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-19 10:07:21,628 - chatbot_rag - WARNING - [analysis_20250519_100721] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-19 10:07:21,628 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:21,629 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: xin ch√†o /no_think
2025-05-19 10:07:21,629 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-19 10:07:21,629 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:21,632 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:21,632 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:21,632 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:21,634 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250519_100721.txt
2025-05-19 10:07:21,634 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1033 k√Ω t·ª±
2025-05-19 10:07:21,634 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-19 10:07:21,635 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1949 k√Ω t·ª±
2025-05-19 10:07:21,636 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100721.txt
2025-05-19 10:07:21,636 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-19 10:07:21,636 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "xin ch√†o /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
1...
2025-05-19 10:07:21,637 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-19 10:07:23,239 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:23,239 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

 Xin ch√†o! üòä  
Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi quy tr√¨nh l√†m vi·ªác c·ªßa ch√∫ng t√¥i! üöÄ  
N·∫øu b·∫°n c√≥ th·∫Øc m·∫Øc v·ªÅ c√°c giai ƒëo·∫°n ho·∫∑c ph√≤ng ban, m√¨nh s·∫Ω h·ªó tr·ª£ ngay l·∫≠p t·ª©c nh√©! üí¨  
ƒê·ª´ng qu√™n h·ªèi ri
2025-05-19 10:07:23,241 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100723.txt
2025-05-19 10:07:23,773 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 486 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-19 10:07:23,774 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-19 10:07:23,774 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,367 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"b·∫°n l√† ai /no_think","session_id":""}
2025-05-19 10:07:31,368 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,368 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,369 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: b·∫°n l√† ai /no_think...
2025-05-19 10:07:31,369 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: b·∫°n l√† ai /no_think, enable_thinking=False
2025-05-19 10:07:31,369 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-19 10:07:31,371 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250519_100731.txt
2025-05-19 10:07:31,371 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departme...
2025-05-19 10:07:31,373 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 640 k√Ω t·ª±
2025-05-19 10:07:31,373 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:31,373 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2646 k√Ω t·ª±
2025-05-19 10:07:31,375 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100731.txt
2025-05-19 10:07:31,375 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:31,376 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"departme...
2025-05-19 10:07:31,376 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:31,766 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:31,766 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:31,768 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100731.txt
2025-05-19 10:07:31,770 - chatbot_rag - INFO - [analysis_20250519_100731] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100731_raw.txt
2025-05-19 10:07:31,771 - chatbot_rag - INFO - [analysis_20250519_100731] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:31,771 - chatbot_rag - WARNING - [analysis_20250519_100731] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:31,772 - chatbot_rag - INFO - [analysis_20250519_100731] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-19 10:07:31,772 - chatbot_rag - INFO - [analysis_20250519_100731] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:31,772 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:31,773 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'b·∫°n l√† ai /no_think', ph√≤ng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,773 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,773 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: b·∫°n l√† ai
2025-05-19 10:07:31,774 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'b·∫°n l√† ai', Mode thinking: False
2025-05-19 10:07:31,774 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-19 10:07:31,775 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250519_100731.txt
2025-05-19 10:07:31,775 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,776 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,776 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:31,777 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ...
2025-05-19 10:07:31,778 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 630 k√Ω t·ª±
2025-05-19 10:07:31,778 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:31,779 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2636 k√Ω t·ª±
2025-05-19 10:07:31,780 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100731.txt
2025-05-19 10:07:31,780 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:31,781 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o

b·∫°n l√† ai"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™n ...
2025-05-19 10:07:31,781 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:33,644 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:33,644 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let's see. The user's current question is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng: xin ch√†o b·∫°n l√† ai". So first, I need to parse this.

The history shows the user greeted with "xin ch√†o" and aske
2025-05-19 10:07:33,645 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100733.txt
2025-05-19 10:07:33,647 - chatbot_rag - INFO - [analysis_20250519_100733] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100733_raw.txt
2025-05-19 10:07:33,647 - chatbot_rag - INFO - [analysis_20250519_100733] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let's see. The user's current question is "L·ªãch s·ª≠ tin nh·∫Øn: Ng∆∞·ªùi d√πng: xin ch√†o b·∫°n ...
2025-05-19 10:07:33,647 - chatbot_rag - WARNING - [analysis_20250519_100733] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:33,649 - chatbot_rag - WARNING - [analysis_20250519_100733] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-19 10:07:33,649 - chatbot_rag - INFO - [analysis_20250519_100733] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-19 10:07:33,654 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:33,654 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:33,654 - chatbot_rag - ERROR - [analysis_20250519_100733] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-19 10:07:33,655 - chatbot_rag - WARNING - [analysis_20250519_100733] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-19 10:07:33,655 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:33,655 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: b·∫°n l√† ai /no_think
2025-05-19 10:07:33,656 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-19 10:07:33,656 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:33,660 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:33,661 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:33,661 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:33,662 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250519_100733.txt
2025-05-19 10:07:33,663 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1034 k√Ω t·ª±
2025-05-19 10:07:33,663 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-19 10:07:33,664 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1950 k√Ω t·ª±
2025-05-19 10:07:33,667 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100733.txt
2025-05-19 10:07:33,667 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-19 10:07:33,668 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "b·∫°n l√† ai /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong quy tr√¨nh:
...
2025-05-19 10:07:33,668 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-19 10:07:35,072 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:35,073 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

üëã *Ch√†o b·∫°n!*  
T√¥i l√† **AI h·ªó tr·ª£ quy tr√¨nh c√¥ng ty**, chuy√™n gi√∫p b·∫°n hi·ªÉu r√µ v·ªÅ c√°c giai ƒëo·∫°n l√†m vi·ªác v√† vai tr√≤ c·ªßa t·ª´ng ph√≤ng ban.  

üí° N·∫øu b·∫°n mu·ªën bi·∫øt m·ªôt ph√≤ng ban c·ª• th·ªÉ 
2025-05-19 10:07:35,074 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100735.txt
2025-05-19 10:07:35,078 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 433 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-19 10:07:35,078 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-19 10:07:35,078 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,749 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think","session_id":""}
2025-05-19 10:07:49,750 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,750 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,750 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think...
2025-05-19 10:07:49,751 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think, enable_thinking=False
2025-05-19 10:07:49,751 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-19 10:07:49,752 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250519_100749.txt
2025-05-19 10:07:49,753 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,753 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,753 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:49,754 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON...
2025-05-19 10:07:49,754 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 673 k√Ω t·ª±
2025-05-19 10:07:49,755 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:49,755 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2679 k√Ω t·ª±
2025-05-19 10:07:49,758 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100749.txt
2025-05-19 10:07:49,758 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:49,759 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON...
2025-05-19 10:07:49,759 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:50,145 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:50,145 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:50,146 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100750.txt
2025-05-19 10:07:50,148 - chatbot_rag - INFO - [analysis_20250519_100750] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100750_raw.txt
2025-05-19 10:07:50,149 - chatbot_rag - INFO - [analysis_20250519_100750] Ph·∫£n h·ªìi g·ªëc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:50,149 - chatbot_rag - WARNING - [analysis_20250519_100750] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:50,149 - chatbot_rag - INFO - [analysis_20250519_100750] ƒê√£ t√¨m th·∫•y 1 m·∫´u JSON ti·ªÅm nƒÉng trong ph·∫£n h·ªìi
2025-05-19 10:07:50,150 - chatbot_rag - INFO - [analysis_20250519_100750] T√¨m th·∫•y JSON h·ª£p l·ªá trong th·∫ª <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:50,151 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:50,151 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think', ph√≤ng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,152 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,153 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: n√≥i chuy·ªán vui v·∫ª ƒë√™
2025-05-19 10:07:50,153 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'n√≥i chuy·ªán vui v·∫ª ƒë√™', Mode thinking: False
2025-05-19 10:07:50,154 - websocket_server - INFO - ƒê√£ th√™m 2 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-19 10:07:50,155 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250519_100750.txt
2025-05-19 10:07:50,155 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d...
2025-05-19 10:07:50,157 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 663 k√Ω t·ª±
2025-05-19 10:07:50,158 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:07:50,158 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2669 k√Ω t·ª±
2025-05-19 10:07:50,160 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100750.txt
2025-05-19 10:07:50,161 - chatbot_rag - INFO - System prompt: 
        B·∫°n l√† tr·ª£ l√Ω AI ph√¢n t√≠ch c√¢u h·ªèi ƒë·ªÉ x√°c ƒë·ªãnh:
        1. Ph√≤ng ban ng∆∞·ªùi d√πng ƒëang h·ªèi (department)
        2. Lo·∫°i c√¢u h·ªèi: ph√≤ng ban c·ª• th·ªÉ hay general (query_type)
        3. N·∫øu c√¢u h·ªèi...
2025-05-19 10:07:50,161 - chatbot_rag - INFO - User prompt: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: xin ch√†o
Ng∆∞·ªùi d√πng: b·∫°n l√† ai

n√≥i chuy·ªán vui v·∫ª ƒë√™"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d...
2025-05-19 10:07:50,162 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=False
2025-05-19 10:07:52,042 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:52,043 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they greeted and asked who I am. Now, the current question is about the chat history itself, but it seems lik
2025-05-19 10:07:52,045 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100752.txt
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_100752_raw.txt
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] Ph·∫£n h·ªìi g·ªëc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they gree...
2025-05-19 10:07:52,048 - chatbot_rag - WARNING - [analysis_20250519_100752] Ph√°t hi·ªán th·∫ª <think> trong ph·∫£n h·ªìi. X·ª≠ l√Ω ƒë·∫∑c bi·ªát...
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:52,049 - chatbot_rag - INFO - [analysis_20250519_100752] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:52,049 - chatbot_rag - INFO - [analysis_20250519_100752] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-19 10:07:52,049 - chatbot_rag - WARNING - [analysis_20250519_100752] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-19 10:07:52,051 - chatbot_rag - INFO - [analysis_20250519_100752] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-19 10:07:52,054 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:52,055 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:52,055 - chatbot_rag - ERROR - [analysis_20250519_100752] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-19 10:07:52,055 - chatbot_rag - WARNING - [analysis_20250519_100752] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-19 10:07:52,056 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:07:52,056 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think
2025-05-19 10:07:52,056 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-19 10:07:52,057 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:52,061 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:07:52,061 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:07:52,061 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:52,063 - chatbot_rag - INFO - ƒê√£ l∆∞u prompt v√†o file: data/logs/prompt_general_20250519_100752.txt
2025-05-19 10:07:52,065 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 1045 k√Ω t·ª±
2025-05-19 10:07:52,066 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 916 k√Ω t·ª±
2025-05-19 10:07:52,067 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 1961 k√Ω t·ª±
2025-05-19 10:07:52,069 - chatbot_rag - INFO - ƒê√£ l∆∞u full prompt v√†o file: data/logs/llm_full_prompt_20250519_100752.txt
2025-05-19 10:07:52,069 - chatbot_rag - INFO - System prompt: 
B·∫°n l√† tr·ª£ l√Ω AI chuy√™n v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n trong c√¥ng ty.

DANH S√ÅCH PH√íNG BAN:
- 2D
- D·ª± to√°n
- Kh√°ch h√†ng
- Kinh doanh
- K·∫ø to√°n
- Marketing
- Mua h√†ng
- Team d·ª± √°n
- Thi c√¥ng
- Thi·∫øt k·∫ø
- ƒê...
2025-05-19 10:07:52,070 - chatbot_rag - INFO - User prompt: 
C√¢u h·ªèi: "n√≥i chuy·ªán vui v·∫ª ƒë√™ /no_think"

ƒê√¢y l√† c√¢u h·ªèi chung v·ªÅ quy tr√¨nh ho·∫∑c giai ƒëo·∫°n l√†m vi·ªác.

Th√¥ng tin c∆° b·∫£n:
### Th√¥ng tin t·ªïng quan v·ªÅ quy tr√¨nh v√† giai ƒëo·∫°n

#### Giai ƒëo·∫°n ch√≠nh trong ...
2025-05-19 10:07:52,070 - chatbot_rag - INFO - G·ª≠i truy v·∫•n ƒë·∫øn LLM API t·∫°i http://192.168.0.43:1234/v1/chat/completions v·ªõi stream=True
2025-05-19 10:07:52,891 - chatbot_rag - INFO - M√£ ph·∫£n h·ªìi t·ª´ API: 200
2025-05-19 10:07:52,892 - chatbot_rag - INFO - Ph·∫£n h·ªìi g·ªëc t·ª´ LLM API (200 k√Ω t·ª± ƒë·∫ßu): <think>

</think>

üí¨ *C∆∞·ªùi toe to√©t* üòÑ  
ƒê·ªÉ bi·∫øt chi ti·∫øt c√¥ng vi·ªác c·ª• th·ªÉ, vui l√≤ng h·ªèi v·ªÅ m·ªôt ph√≤ng ban c·ª• th·ªÉ, v√≠ d·ª•: "Ph√≤ng Marketing l√†m g√¨ trong giai ƒëo·∫°n MKT-SALES?" üéâ  

*(spam icon)* üíÉüï∫üéâüéäüî•üí•‚ú®üåü
2025-05-19 10:07:52,893 - chatbot_rag - INFO - ƒê√£ l∆∞u ph·∫£n h·ªìi ƒë·∫ßy ƒë·ªß v√†o file: data/logs/llm_response_20250519_100752.txt
2025-05-19 10:07:52,896 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t thinking (0 k√Ω t·ª±) v√† c√≤n l·∫°i 185 k√Ω t·ª± ph·∫£n h·ªìi
2025-05-19 10:07:52,896 - websocket_server - INFO - ƒê√£ tr√≠ch xu·∫•t ph·∫ßn thinking (0 k√Ω t·ª±) t·ª´ ph·∫£n h·ªìi
2025-05-19 10:07:52,897 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:08:04,565 - websockets.server - INFO - connection closed
2025-05-19 10:08:04,566 - websockets.server - INFO - server closing
2025-05-19 10:08:04,566 - websockets.server - INFO - server closed
2025-05-19 10:08:04,568 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
2025-05-19 10:09:59,287 - websocket_server - INFO - Kh·ªüi ƒë·ªông server WebSocket t·∫°i 0.0.0.0:8090
2025-05-19 10:09:59,322 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 10:09:59,323 - websocket_server - INFO - Server WebSocket ƒëang ch·∫°y t·∫°i ws://0.0.0.0:8090
2025-05-19 10:09:59,323 - websocket_server - INFO - ƒê√£ c·∫•u h√¨nh ping_timeout=6000 gi√¢y, ping_interval=60 gi√¢y
2025-05-19 10:10:07,200 - websockets.server - INFO - connection open
2025-05-19 10:10:09,083 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think","session_id":""}
2025-05-19 10:10:09,084 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,084 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,084 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhome...
2025-05-19 10:10:09,085 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think, enable_thinking=False
2025-05-19 10:10:09,085 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-19 10:10:09,086 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,090 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,091 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:10:09,092 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"depart...
2025-05-19 10:10:09,095 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 642 k√Ω t·ª±
2025-05-19 10:10:09,096 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:10:09,096 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2648 k√Ω t·ª±
2025-05-19 10:10:09,098 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: [Errno 28] No space left on device
2025-05-19 10:10:09,104 - chatbot_rag - INFO - [analysis_20250519_101009] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_101009_raw.txt
2025-05-19 10:10:09,104 - chatbot_rag - INFO - [analysis_20250519_101009] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: [Errno 28] No space left on device...
2025-05-19 10:10:09,105 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-19 10:10:09,106 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:10:09,224 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-19 10:10:09,235 - chatbot_rag - WARNING - [analysis_20250519_101009] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-19 10:10:09,250 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-19 10:10:09,266 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:10:09,277 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:10:09,286 - chatbot_rag - ERROR - [analysis_20250519_101009] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-19 10:10:09,295 - chatbot_rag - WARNING - [analysis_20250519_101009] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-19 10:10:09,305 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:10:09,309 - websocket_server - INFO - X·ª≠ l√Ω streaming response cho: 'T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think', ph√≤ng ban: None, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,319 - websocket_server - INFO - Session ID nh·∫≠n ƒë∆∞·ª£c: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,327 - websocket_server - INFO - Ph√°t hi·ªán l·ªánh /no_think, t·∫Øt ch·∫ø ƒë·ªô thinking cho: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes
2025-05-19 10:10:09,341 - websocket_server - INFO - X·ª≠ l√Ω streaming response. Query: 'T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes', Mode thinking: False
2025-05-19 10:10:09,356 - websocket_server - INFO - Kh√¥ng c√≥ l·ªãch s·ª≠ tin nh·∫Øn cho phi√™n n√†y
2025-05-19 10:10:09,367 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,378 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,390 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:10:09,402 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes"

        Ph√¢n t√≠ch c√¢u h·ªèi v√† tr·∫£ v·ªÅ JSON c√≥ ƒë·ªãnh d·∫°ng:
        {"department": "t√™...
2025-05-19 10:10:09,417 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 632 k√Ω t·ª±
2025-05-19 10:10:09,426 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc system prompt: 2006 k√Ω t·ª±
2025-05-19 10:10:09,433 - chatbot_rag - INFO - T·ªïng k√≠ch th∆∞·ªõc: 2638 k√Ω t·ª±
2025-05-19 10:10:09,448 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM: [Errno 28] No space left on device
2025-05-19 10:10:09,465 - chatbot_rag - INFO - [analysis_20250519_101009] ƒê√£ ghi ph·∫£n h·ªìi g·ªëc v√†o: data/logs/analysis_20250519_101009_raw.txt
2025-05-19 10:10:09,474 - chatbot_rag - INFO - [analysis_20250519_101009] Ph·∫£n h·ªìi g·ªëc: ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω truy v·∫•n: [Errno 28] No space left on device...
2025-05-19 10:10:09,481 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 1: Th·ª≠ parse to√†n b·ªô chu·ªói ph·∫£n h·ªìi
2025-05-19 10:10:09,488 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 1: Kh√¥ng ph·∫£i JSON h·ª£p l·ªá: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:10:09,499 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 2: T√¨m JSON trong chu·ªói ph·∫£n h·ªìi
2025-05-19 10:10:09,507 - chatbot_rag - WARNING - [analysis_20250519_101009] B∆Ø·ªöC 2: Kh√¥ng t√¨m th·∫•y m·∫´u JSON n√†o trong ph·∫£n h·ªìi
2025-05-19 10:10:09,514 - chatbot_rag - INFO - [analysis_20250519_101009] B∆Ø·ªöC 3: X·ª≠ l√Ω chu·ªói th·ªß c√¥ng ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin
2025-05-19 10:10:09,526 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:10:09,536 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:10:09,544 - chatbot_rag - ERROR - [analysis_20250519_101009] B∆Ø·ªöC 3: L·ªói khi x·ª≠ l√Ω chu·ªói th·ªß c√¥ng: local variable 'query_type' referenced before assignment
2025-05-19 10:10:09,554 - chatbot_rag - WARNING - [analysis_20250519_101009] T·∫•t c·∫£ ph∆∞∆°ng ph√°p ph√¢n t√≠ch ƒë·ªÅu th·∫•t b·∫°i, tr·∫£ v·ªÅ k·∫øt qu·∫£ m·∫∑c ƒë·ªãnh
2025-05-19 10:10:09,560 - websocket_server - INFO - Ph√¢n t√≠ch c√¢u h·ªèi: Ph√≤ng ban=None, Lo·∫°i=general, Thinking=False
2025-05-19 10:10:09,567 - websocket_server - INFO - Query th·ª±c t·∫ø g·ª≠i ƒë·∫øn m√¥ h√¨nh: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes /no_think
2025-05-19 10:10:09,572 - websocket_server - INFO - C√¢u h·ªèi chung, ch·∫ø ƒë·ªô thinking: False
2025-05-19 10:10:09,579 - chatbot_rag - INFO - X·ª≠ l√Ω c√¢u h·ªèi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,595 - department_info_tool - INFO - ƒê√£ t·∫£i 11 ph√≤ng ban
2025-05-19 10:10:09,603 - department_info_tool - INFO - ƒê√£ l·∫•y danh s√°ch 11 ph√≤ng ban
2025-05-19 10:10:09,612 - chatbot_rag - INFO - G·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,619 - chatbot_rag - ERROR - L·ªói khi g·ªçi LLM ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f: [Errno 28] No space left on device
2025-05-19 10:10:09,627 - websocket_server - INFO - ƒê√£ l∆∞u h·ªôi tho·∫°i chung v√†o l·ªãch s·ª≠ c·ªßa session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,163 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn d·∫°ng JSON: {"content":"ph√≤ng 2D l√†m nhi·ªám v·ª• g√¨ /no_think","session_id":""}
2025-05-19 10:10:15,167 - websocket_server - INFO - Session ID kh√¥ng ƒë∆∞·ª£c cung c·∫•p trong tin nh·∫Øn JSON, s·ª≠ d·ª•ng current_session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,172 - websocket_server - INFO - Session ID t·ª´ client (sau khi ki·ªÉm tra): e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,177 - websocket_server - INFO - T·∫Øt ch·∫ø ƒë·ªô thinking cho c√¢u h·ªèi: ph√≤ng 2D l√†m nhi·ªám v·ª• g√¨ /no_think...
2025-05-19 10:10:15,184 - websocket_server - INFO - Nh·∫≠n tin nh·∫Øn th√¥ng th∆∞·ªùng: ph√≤ng 2D l√†m nhi·ªám v·ª• g√¨ /no_think, enable_thinking=False
2025-05-19 10:10:15,189 - websocket_server - INFO - ƒê√£ th√™m 1 tin nh·∫Øn g·∫ßn nh·∫•t v√†o prompt
2025-05-19 10:10:15,198 - websocket_server - INFO - ƒê√£ l∆∞u l·ªãch s·ª≠ tin nh·∫Øn v√† prompt v√†o file: data/logs/history_prompt_20250519_101015.txt
2025-05-19 10:10:15,205 - chatbot_rag - INFO - ƒêang ph√¢n t√≠ch c√¢u h·ªèi v·ªõi LLM: L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes

ph√≤ng 2D l√†m nhi·ªám v·ª• g√¨ /no_think, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,210 - chatbot_rag - INFO - [analyze_query_with_llm] ƒê√£ l·∫•y ƒë∆∞·ª£c 0 b·∫£n ghi l·ªãch s·ª≠ t·ª´ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,214 - chatbot_rag - INFO - [analyze_query_with_llm] S·ª≠ d·ª•ng l·ªãch s·ª≠ h·ªôi tho·∫°i: 0 b·∫£n ghi
2025-05-19 10:10:15,220 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cu·ªëi c√πng: L·ªãch s·ª≠ tin nh·∫Øn:
        
        C√¢u h·ªèi ng∆∞·ªùi d√πng hi·ªán t·∫°i: "L·ªãch s·ª≠ tin nh·∫Øn:
Ng∆∞·ªùi d√πng: T√¥i mu·ªën bi·∫øt v·ªÅ c√°c giai ƒëo·∫°n hi·ªán t·∫°i c·ªßa DBhomes

ph√≤ng 2D l√†m nhi·ªám v·ª• g√¨ /no_think"

        Ph√¢n t√≠...
2025-05-19 10:10:15,227 - chatbot_rag - INFO - K√≠ch th∆∞·ªõc prompt: 698 k√Ω t·ª±
2025-05-19 10:21:59,733 - websockets.server - INFO - connection closed
2025-05-19 10:21:59,736 - websockets.server - INFO - server closing
2025-05-19 10:21:59,737 - websockets.server - INFO - server closed
2025-05-19 10:21:59,740 - websocket_server - INFO - Server b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng
