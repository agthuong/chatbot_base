2025-05-17 11:17:24,080 - websocket_server - WARNING - Không thể import từ chatbot.py. Sử dụng hàm mock.
2025-05-17 11:17:24,081 - websocket_server - WARNING - Không thể import DepartmentInfoTool. Sử dụng mock class.
2025-05-17 11:17:24,084 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-17 11:17:24,145 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 11:17:24,145 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-17 11:17:24,145 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-17 11:17:58,030 - websockets.server - INFO - connection open
2025-05-17 11:18:00,782 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"test alo alo /no_think","session_id":""}
2025-05-17 11:18:00,783 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,783 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,784 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: test alo alo /no_think...
2025-05-17 11:18:00,784 - websocket_server - INFO - Nhận tin nhắn thông thường: test alo alo /no_think, enable_thinking=False
2025-05-17 11:18:00,784 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:18:00,785 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 11:18:00,785 - websocket_server - INFO - Xử lý streaming response cho: 'test alo alo /no_think', phòng ban: None, session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,785 - websocket_server - INFO - Session ID nhận được: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:18:00,786 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: test alo alo
2025-05-17 11:18:00,786 - websocket_server - INFO - Xử lý streaming response. Query: 'test alo alo', Mode thinking: False
2025-05-17 11:18:00,786 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:18:00,786 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 11:18:00,787 - websocket_server - INFO - Query thực tế gửi đến mô hình: test alo alo /no_think
2025-05-17 11:18:00,787 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-17 11:18:00,787 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:18,362 - websockets.server - INFO - connection open
2025-05-17 11:19:19,935 - websockets.server - INFO - connection open
2025-05-17 11:19:22,491 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /no_think","session_id":""}
2025-05-17 11:19:22,492 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,492 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,493 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alo /no_think...
2025-05-17 11:19:22,493 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /no_think, enable_thinking=False
2025-05-17 11:19:22,493 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 11:19:22,495 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_111922.txt
2025-05-17 11:19:22,496 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 11:19:22,496 - websocket_server - INFO - Xử lý streaming response cho: 'alo /no_think', phòng ban: None, session_id: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,497 - websocket_server - INFO - Session ID nhận được: 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:22,497 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alo
2025-05-17 11:19:22,497 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:19:22,498 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 11:19:22,499 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_111922.txt
2025-05-17 11:19:22,499 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 11:19:22,499 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /no_think
2025-05-17 11:19:22,500 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-17 11:19:22,500 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 16b1f3ea-b548-4dc1-91ef-f517c74092b7
2025-05-17 11:19:24,785 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-17 11:19:24,785 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Mock response for general query: alo /no_think
2025-05-17 11:19:24,786 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-17 11:19:24,787 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_111924.txt
2025-05-17 11:19:24,787 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-17 11:19:24,788 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-17 11:19:24,788 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747455564784_zgioz0p
2025-05-17 11:19:24,789 - websocket_server - INFO - Đã gửi nội dung thinking (304 ký tự)
2025-05-17 11:21:28,193 - websockets.server - INFO - server closing
2025-05-17 11:21:28,256 - websockets.server - INFO - server closed
2025-05-17 11:21:28,257 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-17 11:21:30,523 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-17 11:21:30,558 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 11:21:30,558 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-17 11:21:30,558 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-17 11:23:52,845 - websockets.server - INFO - connection open
2025-05-17 11:23:53,834 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /no_think","session_id":""}
2025-05-17 11:23:53,834 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,834 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,835 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alo /no_think...
2025-05-17 11:23:53,835 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /no_think, enable_thinking=False
2025-05-17 11:23:53,835 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:23:53,835 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo /no_think, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:23:53,837 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:23:53,838 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:23:53,838 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:23:53,839 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /no_think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc genera...
2025-05-17 11:23:53,839 - chatbot_rag - INFO - Kích thước prompt: 486 ký tự
2025-05-17 11:23:53,839 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:23:53,839 - chatbot_rag - INFO - Tổng kích thước: 4667 ký tự
2025-05-17 11:23:53,841 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_112353.txt
2025-05-17 11:23:53,842 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:23:53,842 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /no_think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc genera...
2025-05-17 11:23:53,843 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:24:07,324 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:24:07,325 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-17 11:24:07,330 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_112407.txt
2025-05-17 11:24:07,334 - chatbot_rag - INFO - [analysis_20250517_112407] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_112407_raw.txt
2025-05-17 11:24:07,335 - chatbot_rag - INFO - [analysis_20250517_112407] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-17 11:24:07,335 - chatbot_rag - WARNING - [analysis_20250517_112407] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:24:07,336 - chatbot_rag - INFO - [analysis_20250517_112407] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-17 11:24:07,337 - chatbot_rag - INFO - [analysis_20250517_112407] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-17 11:24:07,337 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-17 11:24:07,338 - websocket_server - INFO - Xử lý streaming response cho: 'alo /no_think', phòng ban: Kinh doanh, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,338 - websocket_server - INFO - Session ID nhận được: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,339 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alo
2025-05-17 11:24:07,339 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:24:07,341 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:24:07,341 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-17 11:24:07,342 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /no_think
2025-05-17 11:24:07,342 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-17 11:24:07,342 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,356 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:24:07,357 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-17 11:24:07,358 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-17 11:24:07,379 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-17 11:24:07,379 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,380 - chatbot_rag - INFO - Số task: 24
2025-05-17 11:24:07,380 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:24:07,381 - chatbot_rag - WARNING - [create_llm_prompt] Không thể import get_session_history từ websocket_server. Thử get_chat_history (cục bộ).
2025-05-17 11:24:07,381 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ get_chat_history (cục bộ).
2025-05-17 11:24:07,384 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-17 11:24:07,386 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250517_112407.txt
2025-05-17 11:24:07,387 - chatbot_rag - INFO - Kích thước prompt: 12219 ký tự
2025-05-17 11:24:07,387 - chatbot_rag - INFO - Kích thước system prompt: 2631 ký tự
2025-05-17 11:24:07,387 - chatbot_rag - INFO - Tổng kích thước: 14850 ký tự
2025-05-17 11:24:07,389 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_112407.txt
2025-05-17 11:24:07,389 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ của bạn là phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích cho người dùng.

Dự án được ch...
2025-05-17 11:24:07,390 - chatbot_rag - INFO - User prompt: 
Vai trò của bạn: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.


Câu hỏi người dùng hiện tại: "alo /no_think"

Thông tin về phòng ban Kinh doanh:
Số lượng tasks: 24
Cá...
2025-05-17 11:24:07,390 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=True
2025-05-17 11:24:51,101 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:24:51,102 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**Alo!** 😄  
Bạn đang cần thông tin gì về phòng ban **Kinh doanh**? Mình sẵn sàng hỗ trợ bạn ngay lập tức nhé! Nếu bạn muốn biết chi tiết về các task, giai đoạn hoặc quy trình liên 
2025-05-17 11:24:51,104 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_112451.txt
2025-05-17 11:24:51,106 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250517_112407.txt
2025-05-17 11:24:51,106 - chatbot_rag - INFO - Thời gian truy vấn LLM: 43.75 giây
2025-05-17 11:24:51,700 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-17 11:24:51,701 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-17 11:24:51,703 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-17 11:24:55,500 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 218 ký tự phản hồi
2025-05-17 11:24:55,501 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-17 11:24:55,501 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session d16ec270-a709-41a4-bfe8-5f693a828ea5
2025-05-17 11:25:55,751 - websockets.server - INFO - connection open
2025-05-17 11:29:12,047 - websockets.server - INFO - connection open
2025-05-17 11:43:10,391 - websockets.server - INFO - connection open
2025-05-17 11:43:25,110 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /no_think","session_id":"cf6e5d85-f403-4c4d-8afc-06ff092bdf8c"}
2025-05-17 11:43:25,110 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:25,111 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alo /no_think...
2025-05-17 11:43:25,112 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /no_think, enable_thinking=False
2025-05-17 11:43:25,112 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:43:25,113 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo /no_think, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:25,117 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:43:25,121 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:43:25,121 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:43:25,122 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /no_think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc genera...
2025-05-17 11:43:25,123 - chatbot_rag - INFO - Kích thước prompt: 486 ký tự
2025-05-17 11:43:25,124 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:43:25,124 - chatbot_rag - INFO - Tổng kích thước: 4667 ký tự
2025-05-17 11:43:25,129 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114325.txt
2025-05-17 11:43:25,130 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:43:25,130 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /no_think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc genera...
2025-05-17 11:43:25,131 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:43:38,245 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:43:38,246 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-17 11:43:38,247 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114338.txt
2025-05-17 11:43:38,249 - chatbot_rag - INFO - [analysis_20250517_114338] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_114338_raw.txt
2025-05-17 11:43:38,249 - chatbot_rag - INFO - [analysis_20250517_114338] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-17 11:43:38,250 - chatbot_rag - WARNING - [analysis_20250517_114338] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:43:38,250 - chatbot_rag - INFO - [analysis_20250517_114338] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-17 11:43:38,251 - chatbot_rag - INFO - [analysis_20250517_114338] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-17 11:43:38,251 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-17 11:43:38,252 - websocket_server - INFO - Xử lý streaming response cho: 'alo /no_think', phòng ban: Kinh doanh, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,252 - websocket_server - INFO - Session ID nhận được: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,252 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alo
2025-05-17 11:43:38,253 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: False
2025-05-17 11:43:38,253 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:43:38,253 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-17 11:43:38,254 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /no_think
2025-05-17 11:43:38,254 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-17 11:43:38,254 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,264 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:43:38,266 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-17 11:43:38,267 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-17 11:43:38,272 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-17 11:43:38,273 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,274 - chatbot_rag - INFO - Số task: 24
2025-05-17 11:43:38,274 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:43:38,275 - chatbot_rag - WARNING - [create_llm_prompt] Không thể import get_session_history từ websocket_server. Thử get_chat_history (cục bộ).
2025-05-17 11:43:38,276 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ get_chat_history (cục bộ).
2025-05-17 11:43:38,280 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-17 11:43:38,283 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250517_114338.txt
2025-05-17 11:43:38,283 - chatbot_rag - INFO - Kích thước prompt: 12219 ký tự
2025-05-17 11:43:38,284 - chatbot_rag - INFO - Kích thước system prompt: 2631 ký tự
2025-05-17 11:43:38,284 - chatbot_rag - INFO - Tổng kích thước: 14850 ký tự
2025-05-17 11:43:38,287 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114338.txt
2025-05-17 11:43:38,287 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ của bạn là phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích cho người dùng.

Dự án được ch...
2025-05-17 11:43:38,287 - chatbot_rag - INFO - User prompt: 
Vai trò của bạn: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.


Câu hỏi người dùng hiện tại: "alo /no_think"

Thông tin về phòng ban Kinh doanh:
Số lượng tasks: 24
Cá...
2025-05-17 11:43:38,288 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=True
2025-05-17 11:44:21,342 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:44:21,344 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**Alo!** 🎉  
Tôi đây, bạn muốn biết gì về phòng ban **Kinh doanh** và các giai đoạn liên quan? Dù là task, mục tiêu hay quy trình, mình sẽ giải thích rõ ràng cho bạn nhé! 💼✨
2025-05-17 11:44:21,346 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114421.txt
2025-05-17 11:44:21,348 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250517_114338.txt
2025-05-17 11:44:21,349 - chatbot_rag - INFO - Thời gian truy vấn LLM: 43.08 giây
2025-05-17 11:44:21,358 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-17 11:44:21,359 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\test\chatbot_qwen\docker_build\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-17 11:44:21,363 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-17 11:44:21,371 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 173 ký tự phản hồi
2025-05-17 11:44:21,372 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-17 11:44:21,372 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session cf6e5d85-f403-4c4d-8afc-06ff092bdf8c
2025-05-17 11:45:53,285 - websockets.server - INFO - connection open
2025-05-17 11:46:04,838 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /think","session_id":"284b52f9-dae0-4001-98fc-1e425fa03bf9"}
2025-05-17 11:46:04,839 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:04,839 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: alo /think...
2025-05-17 11:46:04,839 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /think, enable_thinking=True
2025-05-17 11:46:04,840 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:46:04,840 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo /think, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:04,842 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:46:04,843 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc general h...
2025-05-17 11:46:04,844 - chatbot_rag - INFO - Kích thước prompt: 483 ký tự
2025-05-17 11:46:04,849 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:46:04,855 - chatbot_rag - INFO - Tổng kích thước: 4664 ký tự
2025-05-17 11:46:04,872 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114604.txt
2025-05-17 11:46:04,879 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:46:04,886 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo /think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc general h...
2025-05-17 11:46:04,892 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:46:23,452 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:46:23,453 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current message is "alo". First, I need to check the history to see if there was a previous department mentioned. Since the history is empty, there's 
2025-05-17 11:46:23,455 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114623.txt
2025-05-17 11:46:23,458 - chatbot_rag - INFO - [analysis_20250517_114623] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_114623_raw.txt
2025-05-17 11:46:23,458 - chatbot_rag - INFO - [analysis_20250517_114623] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current message is "alo". First, I need to check t...
2025-05-17 11:46:23,459 - chatbot_rag - WARNING - [analysis_20250517_114623] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:46:23,459 - chatbot_rag - INFO - [analysis_20250517_114623] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 11:46:23,461 - chatbot_rag - INFO - [analysis_20250517_114623] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:46:23,461 - chatbot_rag - INFO - [analysis_20250517_114623] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 11:46:23,462 - chatbot_rag - WARNING - [analysis_20250517_114623] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 11:46:23,463 - chatbot_rag - INFO - [analysis_20250517_114623] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 11:46:23,480 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:46:23,482 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:46:23,488 - chatbot_rag - INFO - [analysis_20250517_114623] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:46:23,489 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-17 11:46:23,489 - websocket_server - INFO - Xử lý streaming response cho: 'alo /think', phòng ban: None, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,490 - websocket_server - INFO - Session ID nhận được: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,492 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: alo
2025-05-17 11:46:23,493 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: True
2025-05-17 11:46:23,493 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 11:46:23,493 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:23,494 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:46:23,496 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc general hoặc nul...
2025-05-17 11:46:23,497 - chatbot_rag - INFO - Kích thước prompt: 476 ký tự
2025-05-17 11:46:23,498 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:46:23,499 - chatbot_rag - INFO - Tổng kích thước: 4657 ký tự
2025-05-17 11:46:23,502 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114623.txt
2025-05-17 11:46:23,503 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:46:23,504 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "alo"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "department_specific hoặc general hoặc nul...
2025-05-17 11:46:23,505 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:46:33,627 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:46:33,628 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current message is "alo", which is a casual way of saying "hello" in Vietnamese. The history doesn't mention any previous department or context.

Firs
2025-05-17 11:46:33,630 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114633.txt
2025-05-17 11:46:33,632 - chatbot_rag - INFO - [analysis_20250517_114633] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_114633_raw.txt
2025-05-17 11:46:33,632 - chatbot_rag - INFO - [analysis_20250517_114633] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current message is "alo", which is a casual way of...
2025-05-17 11:46:33,633 - chatbot_rag - WARNING - [analysis_20250517_114633] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:46:33,633 - chatbot_rag - INFO - [analysis_20250517_114633] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 11:46:33,633 - chatbot_rag - INFO - [analysis_20250517_114633] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:46:33,634 - chatbot_rag - INFO - [analysis_20250517_114633] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 11:46:33,634 - chatbot_rag - WARNING - [analysis_20250517_114633] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 11:46:33,636 - chatbot_rag - INFO - [analysis_20250517_114633] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 11:46:33,645 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:46:33,645 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:46:33,647 - chatbot_rag - INFO - [analysis_20250517_114633] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:46:33,648 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-17 11:46:33,649 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /think
2025-05-17 11:46:33,649 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-17 11:46:33,651 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:33,657 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:46:33,658 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:46:33,660 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:46:33,661 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250517_114633.txt
2025-05-17 11:46:33,663 - chatbot_rag - INFO - Kích thước prompt: 1622 ký tự
2025-05-17 11:46:33,663 - chatbot_rag - INFO - Kích thước system prompt: 1059 ký tự
2025-05-17 11:46:33,664 - chatbot_rag - INFO - Tổng kích thước: 2681 ký tự
2025-05-17 11:46:33,665 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114633.txt
2025-05-17 11:46:33,665 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-17 11:46:33,666 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "alo /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-...
2025-05-17 11:46:33,667 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=True
2025-05-17 11:46:57,002 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:46:57,003 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, the user asked "alo /think" which is a casual way of saying "hello" or "what's up?" in Vietnamese. They mentioned it's a general question about the process or stages. I need to respond b
2025-05-17 11:46:57,005 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114657.txt
2025-05-17 11:46:57,010 - websocket_server - INFO - Đã trích xuất thinking (1472 ký tự) và còn lại 465 ký tự phản hồi
2025-05-17 11:46:57,011 - websocket_server - INFO - Đã trích xuất phần thinking (1472 ký tự) từ phản hồi
2025-05-17 11:46:57,012 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,120 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"mày là ai /think","session_id":"284b52f9-dae0-4001-98fc-1e425fa03bf9"}
2025-05-17 11:48:34,121 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,121 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: mày là ai /think...
2025-05-17 11:48:34,121 - websocket_server - INFO - Nhận tin nhắn thông thường: mày là ai /think, enable_thinking=True
2025-05-17 11:48:34,122 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 11:48:34,124 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_114834.txt
2025-05-17 11:48:34,125 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo

mày là ai /think, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:34,126 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:48:34,127 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

mày là ai /think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_t...
2025-05-17 11:48:34,128 - chatbot_rag - INFO - Kích thước prompt: 524 ký tự
2025-05-17 11:48:34,128 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:48:34,129 - chatbot_rag - INFO - Tổng kích thước: 4705 ký tự
2025-05-17 11:48:34,131 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114834.txt
2025-05-17 11:48:34,132 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:48:34,132 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

mày là ai /think"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_t...
2025-05-17 11:48:34,134 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:48:52,863 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:48:52,866 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng: alo mày là ai /think". First, I need to parse the input correctly.

The user is asking about their 
2025-05-17 11:48:52,870 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114852.txt
2025-05-17 11:48:52,872 - chatbot_rag - INFO - [analysis_20250517_114852] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_114852_raw.txt
2025-05-17 11:48:52,873 - chatbot_rag - INFO - [analysis_20250517_114852] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng:...
2025-05-17 11:48:52,873 - chatbot_rag - WARNING - [analysis_20250517_114852] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:48:52,873 - chatbot_rag - INFO - [analysis_20250517_114852] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 11:48:52,874 - chatbot_rag - INFO - [analysis_20250517_114852] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:48:52,874 - chatbot_rag - INFO - [analysis_20250517_114852] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 11:48:52,874 - chatbot_rag - WARNING - [analysis_20250517_114852] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 11:48:52,875 - chatbot_rag - INFO - [analysis_20250517_114852] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 11:48:52,879 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:48:52,880 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:48:52,880 - chatbot_rag - INFO - [analysis_20250517_114852] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:48:52,880 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-17 11:48:52,881 - websocket_server - INFO - Xử lý streaming response cho: 'mày là ai /think', phòng ban: None, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,881 - websocket_server - INFO - Session ID nhận được: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,881 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: mày là ai
2025-05-17 11:48:52,882 - websocket_server - INFO - Xử lý streaming response. Query: 'mày là ai', Mode thinking: True
2025-05-17 11:48:52,883 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 11:48:52,885 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_114852.txt
2025-05-17 11:48:52,886 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo

mày là ai, session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:48:52,887 - chatbot_rag - WARNING - [analyze_query_with_llm] Không thể import get_session_history từ websocket_server, sử dụng get_chat_history
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] Lấy lịch sử từ get_chat_history: 0 bản ghi
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 11:48:52,888 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

mày là ai"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "...
2025-05-17 11:48:52,889 - chatbot_rag - INFO - Kích thước prompt: 517 ký tự
2025-05-17 11:48:52,889 - chatbot_rag - INFO - Kích thước system prompt: 4181 ký tự
2025-05-17 11:48:52,889 - chatbot_rag - INFO - Tổng kích thước: 4698 ký tự
2025-05-17 11:48:52,890 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114852.txt
2025-05-17 11:48:52,891 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên phân tích nội dung câu hỏi để xác định:
1. Phòng ban mà người dùng đang hỏi về (department)
2. Phân loại câu hỏi là về phòng ban cụ thể hay câu hỏi chung (query_type)
3. Xác đ...
2025-05-17 11:48:52,891 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:

Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

mày là ai"

Phân tích câu hỏi và trả về JSON có định dạng:
{"department": "tên phòng ban hoặc null", "query_type": "...
2025-05-17 11:48:52,891 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=False
2025-05-17 11:49:02,907 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:49:02,908 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current message is "Lịch sử tin nhắn: Người dùng: alo mày là ai". First, I need to parse the history and the current question.

Looking at the history
2025-05-17 11:49:02,915 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114902.txt
2025-05-17 11:49:02,917 - chatbot_rag - INFO - [analysis_20250517_114902] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_114902_raw.txt
2025-05-17 11:49:02,917 - chatbot_rag - INFO - [analysis_20250517_114902] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current message is "Lịch sử tin nhắn: Người dùng: ...
2025-05-17 11:49:02,918 - chatbot_rag - WARNING - [analysis_20250517_114902] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-17 11:49:02,918 - chatbot_rag - INFO - [analysis_20250517_114902] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 11:49:02,918 - chatbot_rag - INFO - [analysis_20250517_114902] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 11:49:02,919 - chatbot_rag - INFO - [analysis_20250517_114902] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 11:49:02,919 - chatbot_rag - WARNING - [analysis_20250517_114902] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 11:49:02,919 - chatbot_rag - INFO - [analysis_20250517_114902] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 11:49:02,927 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:49:02,928 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:49:02,928 - chatbot_rag - INFO - [analysis_20250517_114902] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 11:49:02,929 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-17 11:49:02,929 - websocket_server - INFO - Query thực tế gửi đến mô hình: mày là ai /think
2025-05-17 11:49:02,929 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-17 11:49:02,929 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:49:02,932 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 11:49:02,932 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 11:49:02,933 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 11:49:02,934 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250517_114902.txt
2025-05-17 11:49:02,936 - chatbot_rag - INFO - Kích thước prompt: 1628 ký tự
2025-05-17 11:49:02,936 - chatbot_rag - INFO - Kích thước system prompt: 1059 ký tự
2025-05-17 11:49:02,937 - chatbot_rag - INFO - Tổng kích thước: 2687 ký tự
2025-05-17 11:49:02,938 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_114902.txt
2025-05-17 11:49:02,939 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-17 11:49:02,939 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "mày là ai /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. ...
2025-05-17 11:49:02,940 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://localhost:1234/v1/chat/completions với stream=True
2025-05-17 11:49:27,720 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-17 11:49:27,722 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user asked "mày là ai" which is a general question about the process or stages. I need to follow the strict rules provided.

First, the instructions say not to create conn
2025-05-17 11:49:27,724 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250517_114927.txt
2025-05-17 11:49:27,729 - websocket_server - INFO - Đã trích xuất thinking (895 ký tự) và còn lại 1006 ký tự phản hồi
2025-05-17 11:49:27,729 - websocket_server - INFO - Đã trích xuất phần thinking (895 ký tự) từ phản hồi
2025-05-17 11:49:27,737 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 284b52f9-dae0-4001-98fc-1e425fa03bf9
2025-05-17 13:36:45,708 - websockets.server - INFO - server closing
2025-05-17 13:36:45,735 - websockets.server - INFO - server closed
2025-05-17 13:36:45,777 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-17 15:31:56,478 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-17 15:31:56,502 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 15:31:56,502 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-17 15:31:56,503 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-17 15:33:32,560 - websockets.server - INFO - connection open
2025-05-17 15:33:32,815 - websockets.server - INFO - connection open
2025-05-17 15:33:35,223 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-17 15:33:35,225 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,226 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,226 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-17 15:33:35,226 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-17 15:33:35,227 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 15:33:35,227 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,278 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:35,280 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 15:33:35,281 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-17 15:33:35,281 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-17 15:33:35,282 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-17 15:33:35,282 - chatbot_rag - INFO - Tổng kích thước: 2603 ký tự
2025-05-17 15:33:35,284 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_153335.txt
2025-05-17 15:33:35,285 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-17 15:33:35,286 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-17 15:33:35,292 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-17 15:33:37,370 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6BBA10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:37,373 - chatbot_rag - INFO - [analysis_20250517_153337] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_153337_raw.txt
2025-05-17 15:33:37,374 - chatbot_rag - INFO - [analysis_20250517_153337] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 15:33:37,376 - chatbot_rag - INFO - [analysis_20250517_153337] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 15:33:37,378 - chatbot_rag - INFO - [analysis_20250517_153337] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 15:33:37,379 - chatbot_rag - INFO - [analysis_20250517_153337] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 15:33:37,384 - chatbot_rag - WARNING - [analysis_20250517_153337] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 15:33:37,385 - chatbot_rag - INFO - [analysis_20250517_153337] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 15:33:37,406 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 15:33:37,407 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 15:33:37,407 - chatbot_rag - INFO - [analysis_20250517_153337] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 15:33:37,408 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 15:33:37,408 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,408 - websocket_server - INFO - Session ID nhận được: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,412 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-17 15:33:37,413 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-17 15:33:37,414 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-17 15:33:37,415 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,415 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:37,415 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 15:33:37,416 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-17 15:33:37,417 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-17 15:33:37,418 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-17 15:33:37,418 - chatbot_rag - INFO - Tổng kích thước: 2593 ký tự
2025-05-17 15:33:37,421 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_153337.txt
2025-05-17 15:33:37,421 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-17 15:33:37,421 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-17 15:33:37,422 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-17 15:33:39,461 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6EE5D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:39,463 - chatbot_rag - INFO - [analysis_20250517_153339] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_153339_raw.txt
2025-05-17 15:33:39,464 - chatbot_rag - INFO - [analysis_20250517_153339] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 15:33:39,465 - chatbot_rag - INFO - [analysis_20250517_153339] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 15:33:39,466 - chatbot_rag - WARNING - [analysis_20250517_153339] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 15:33:39,466 - chatbot_rag - INFO - [analysis_20250517_153339] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 15:33:39,470 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 15:33:39,471 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 15:33:39,471 - chatbot_rag - INFO - [analysis_20250517_153339] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 15:33:39,472 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 15:33:39,472 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-17 15:33:39,472 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-17 15:33:39,473 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:39,476 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 15:33:39,477 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 15:33:39,478 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 15:33:39,479 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250517_153339.txt
2025-05-17 15:33:39,480 - chatbot_rag - INFO - Kích thước prompt: 1630 ký tự
2025-05-17 15:33:39,480 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-17 15:33:39,481 - chatbot_rag - INFO - Tổng kích thước: 2835 ký tự
2025-05-17 15:33:39,482 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_153339.txt
2025-05-17 15:33:39,482 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-17 15:33:39,483 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-17 15:33:39,484 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-17 15:33:41,526 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A6EEC10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 15:33:41,796 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:37:00,203 - websockets.server - INFO - connection open
2025-05-17 16:37:00,380 - websockets.server - INFO - connection open
2025-05-17 16:47:00,854 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-17 16:47:00,869 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,877 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,878 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-17 16:47:00,881 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-17 16:47:00,883 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 16:47:00,902 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_164700.txt
2025-05-17 16:47:00,905 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,911 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:00,914 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 16:47:00,915 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-17 16:47:00,918 - chatbot_rag - INFO - Kích thước prompt: 639 ký tự
2025-05-17 16:47:00,919 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-17 16:47:00,919 - chatbot_rag - INFO - Tổng kích thước: 2643 ký tự
2025-05-17 16:47:00,926 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_164700.txt
2025-05-17 16:47:00,927 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-17 16:47:00,929 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-17 16:47:00,931 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-17 16:47:03,018 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A8AD6E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:03,027 - chatbot_rag - INFO - [analysis_20250517_164703] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_164703_raw.txt
2025-05-17 16:47:03,029 - chatbot_rag - INFO - [analysis_20250517_164703] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 16:47:03,031 - chatbot_rag - INFO - [analysis_20250517_164703] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 16:47:03,033 - chatbot_rag - INFO - [analysis_20250517_164703] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 16:47:03,034 - chatbot_rag - INFO - [analysis_20250517_164703] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 16:47:03,040 - chatbot_rag - WARNING - [analysis_20250517_164703] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 16:47:03,045 - chatbot_rag - INFO - [analysis_20250517_164703] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 16:47:03,073 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 16:47:03,074 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 16:47:03,075 - chatbot_rag - INFO - [analysis_20250517_164703] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 16:47:03,076 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 16:47:03,078 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,079 - websocket_server - INFO - Session ID nhận được: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,081 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-17 16:47:03,081 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-17 16:47:03,082 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-17 16:47:03,086 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250517_164703.txt
2025-05-17 16:47:03,086 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

xin chào, session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-17 16:47:03,087 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-17 16:47:03,088 - chatbot_rag - INFO - Kích thước prompt: 629 ký tự
2025-05-17 16:47:03,088 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-17 16:47:03,088 - chatbot_rag - INFO - Tổng kích thước: 2633 ký tự
2025-05-17 16:47:03,092 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_164703.txt
2025-05-17 16:47:03,093 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-17 16:47:03,093 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-17 16:47:03,094 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-17 16:47:05,126 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A8ADF30>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:05,130 - chatbot_rag - INFO - [analysis_20250517_164705] Đã ghi phản hồi gốc vào: data/logs/analysis_20250517_164705_raw.txt
2025-05-17 16:47:05,131 - chatbot_rag - INFO - [analysis_20250517_164705] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-17 16:47:05,132 - chatbot_rag - INFO - [analysis_20250517_164705] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-17 16:47:05,133 - chatbot_rag - INFO - [analysis_20250517_164705] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-17 16:47:05,134 - chatbot_rag - INFO - [analysis_20250517_164705] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-17 16:47:05,135 - chatbot_rag - WARNING - [analysis_20250517_164705] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-17 16:47:05,136 - chatbot_rag - INFO - [analysis_20250517_164705] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-17 16:47:05,152 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 16:47:05,153 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 16:47:05,154 - chatbot_rag - INFO - [analysis_20250517_164705] BƯỚC 3: Kết quả phân tích thủ công: {'department': None, 'query_type': 'general', 'error': False}
2025-05-17 16:47:05,155 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-17 16:47:05,156 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-17 16:47:05,158 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-17 16:47:05,160 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:05,170 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-17 16:47:05,173 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-17 16:47:05,174 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 16:47:05,176 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250517_164705.txt
2025-05-17 16:47:05,177 - chatbot_rag - INFO - Kích thước prompt: 1630 ký tự
2025-05-17 16:47:05,177 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-17 16:47:05,178 - chatbot_rag - INFO - Tổng kích thước: 2835 ký tự
2025-05-17 16:47:05,181 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250517_164705.txt
2025-05-17 16:47:05,182 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-17 16:47:05,183 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-17 16:47:05,184 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-17 16:47:07,229 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000029E1A87DFD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
2025-05-17 16:47:07,285 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 8d24b8d6-267c-479f-afa5-865acbc59572
2025-05-17 17:15:19,590 - websockets.server - INFO - server closing
2025-05-17 17:15:19,624 - websockets.server - INFO - server closed
2025-05-17 17:15:19,644 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-17 17:55:10,389 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-17 17:55:10,452 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-17 17:55:10,452 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-17 17:55:10,453 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-17 17:55:12,734 - websockets.server - INFO - server closing
2025-05-17 17:55:12,735 - websockets.server - INFO - server closed
2025-05-17 17:55:12,735 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 16:38:50,623 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 16:38:50,684 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:38:50,685 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 16:38:50,685 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 16:38:54,200 - websockets.server - INFO - server closing
2025-05-18 16:38:54,201 - websockets.server - INFO - server closed
2025-05-18 16:38:54,202 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 16:44:04,478 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 16:44:04,515 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:44:04,515 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 16:44:04,515 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 16:45:14,834 - websockets.server - INFO - connection open
2025-05-18 16:45:17,147 - websockets.server - INFO - connection open
2025-05-18 16:45:19,051 - websockets.server - INFO - connection closed
2025-05-18 16:45:19,052 - websockets.server - INFO - connection closed
2025-05-18 16:45:19,900 - websockets.server - INFO - connection open
2025-05-18 16:45:20,900 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-18 16:45:20,901 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,901 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,902 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 16:45:20,902 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-18 16:45:20,903 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 16:45:20,903 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,917 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:20,919 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:45:20,919 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:45:20,920 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 16:45:20,920 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:45:20,921 - chatbot_rag - INFO - Tổng kích thước: 2603 ký tự
2025-05-18 16:45:20,923 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164520.txt
2025-05-18 16:45:20,923 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:45:20,924 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:45:20,924 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-18 16:45:42,000 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0A98BB0>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:45:42,008 - chatbot_rag - INFO - [analysis_20250518_164542] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_164542_raw.txt
2025-05-18 16:45:42,008 - chatbot_rag - INFO - [analysis_20250518_164542] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:45:42,009 - chatbot_rag - INFO - [analysis_20250518_164542] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:45:42,011 - chatbot_rag - INFO - [analysis_20250518_164542] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:45:42,012 - chatbot_rag - INFO - [analysis_20250518_164542] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:45:42,013 - chatbot_rag - WARNING - [analysis_20250518_164542] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:45:42,014 - chatbot_rag - INFO - [analysis_20250518_164542] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:45:42,032 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:45:42,032 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:45:42,033 - chatbot_rag - ERROR - [analysis_20250518_164542] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:45:42,034 - chatbot_rag - WARNING - [analysis_20250518_164542] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:45:42,034 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:45:42,035 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,035 - websocket_server - INFO - Session ID nhận được: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,036 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 16:45:42,036 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 16:45:42,036 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 16:45:42,036 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,036 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:45:42,037 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:45:42,037 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 16:45:42,037 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-18 16:45:42,037 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:45:42,038 - chatbot_rag - INFO - Tổng kích thước: 2593 ký tự
2025-05-18 16:45:42,039 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164542.txt
2025-05-18 16:45:42,039 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:45:42,040 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 16:45:42,040 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-18 16:46:03,078 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0C847C0>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:46:03,085 - chatbot_rag - INFO - [analysis_20250518_164603] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_164603_raw.txt
2025-05-18 16:46:03,086 - chatbot_rag - INFO - [analysis_20250518_164603] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:46:03,088 - chatbot_rag - INFO - [analysis_20250518_164603] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:46:03,090 - chatbot_rag - INFO - [analysis_20250518_164603] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:46:03,092 - chatbot_rag - INFO - [analysis_20250518_164603] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:46:03,093 - chatbot_rag - WARNING - [analysis_20250518_164603] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:46:03,094 - chatbot_rag - INFO - [analysis_20250518_164603] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:46:03,102 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:46:03,102 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:46:03,103 - chatbot_rag - ERROR - [analysis_20250518_164603] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:46:03,103 - chatbot_rag - WARNING - [analysis_20250518_164603] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:46:03,104 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:46:03,104 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-18 16:46:03,105 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 16:46:03,105 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:46:03,116 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:46:03,118 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:46:03,118 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:46:03,121 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_164603.txt
2025-05-18 16:46:03,122 - chatbot_rag - INFO - Kích thước prompt: 1630 ký tự
2025-05-18 16:46:03,123 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:46:03,124 - chatbot_rag - INFO - Tổng kích thước: 2835 ký tự
2025-05-18 16:46:03,126 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164603.txt
2025-05-18 16:46:03,128 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:46:03,129 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 16:46:03,130 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-18 16:46:24,187 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0A75880>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:46:24,746 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:08,818 - websockets.server - INFO - connection closed
2025-05-18 16:48:35,719 - websockets.server - INFO - connection open
2025-05-18 16:48:36,876 - websockets.server - INFO - connection closed
2025-05-18 16:48:37,295 - websockets.server - INFO - connection open
2025-05-18 16:48:39,719 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-18 16:48:39,720 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,720 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,720 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 16:48:39,721 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-18 16:48:39,721 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 16:48:39,723 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_164839.txt
2025-05-18 16:48:39,724 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:48:39,725 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-18 16:48:39,726 - chatbot_rag - INFO - Kích thước prompt: 639 ký tự
2025-05-18 16:48:39,726 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:48:39,727 - chatbot_rag - INFO - Tổng kích thước: 2643 ký tự
2025-05-18 16:48:39,729 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164839.txt
2025-05-18 16:48:39,729 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:48:39,729 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-18 16:48:39,730 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-18 16:49:00,809 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D43400>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_164900_raw.txt
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:49:00,811 - chatbot_rag - INFO - [analysis_20250518_164900] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:49:00,812 - chatbot_rag - INFO - [analysis_20250518_164900] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:49:00,812 - chatbot_rag - INFO - [analysis_20250518_164900] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:49:00,813 - chatbot_rag - WARNING - [analysis_20250518_164900] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:49:00,813 - chatbot_rag - INFO - [analysis_20250518_164900] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:49:00,817 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:49:00,817 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:49:00,818 - chatbot_rag - ERROR - [analysis_20250518_164900] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:49:00,818 - chatbot_rag - WARNING - [analysis_20250518_164900] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:49:00,818 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:49:00,819 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,819 - websocket_server - INFO - Session ID nhận được: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,819 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 16:49:00,819 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 16:49:00,820 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 16:49:00,821 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_164900.txt
2025-05-18 16:49:00,821 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

xin chào, session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:49:00,822 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-18 16:49:00,823 - chatbot_rag - INFO - Kích thước prompt: 629 ký tự
2025-05-18 16:49:00,823 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:49:00,823 - chatbot_rag - INFO - Tổng kích thước: 2633 ký tự
2025-05-18 16:49:00,825 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164900.txt
2025-05-18 16:49:00,825 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:49:00,825 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-18 16:49:00,826 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-18 16:49:21,859 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D43C70>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:21,861 - chatbot_rag - INFO - [analysis_20250518_164921] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_164921_raw.txt
2025-05-18 16:49:21,861 - chatbot_rag - INFO - [analysis_20250518_164921] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries ex...
2025-05-18 16:49:21,862 - chatbot_rag - INFO - [analysis_20250518_164921] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:49:21,862 - chatbot_rag - INFO - [analysis_20250518_164921] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:49:21,863 - chatbot_rag - INFO - [analysis_20250518_164921] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:49:21,863 - chatbot_rag - WARNING - [analysis_20250518_164921] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:49:21,863 - chatbot_rag - INFO - [analysis_20250518_164921] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:49:21,868 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:49:21,868 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:49:21,869 - chatbot_rag - ERROR - [analysis_20250518_164921] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:49:21,869 - chatbot_rag - WARNING - [analysis_20250518_164921] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:49:21,870 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:49:21,870 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-18 16:49:21,870 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 16:49:21,871 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:21,876 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:49:21,876 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:49:21,877 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:21,879 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_164921.txt
2025-05-18 16:49:21,880 - chatbot_rag - INFO - Kích thước prompt: 1630 ký tự
2025-05-18 16:49:21,880 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:49:21,881 - chatbot_rag - INFO - Tổng kích thước: 2835 ký tự
2025-05-18 16:49:21,883 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_164921.txt
2025-05-18 16:49:21,883 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:49:21,884 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 16:49:21,885 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-18 16:49:42,928 - chatbot_rag - ERROR - Lỗi khi gọi LLM: HTTPConnectionPool(host='192.168.0.43', port=1234): Max retries exceeded with url: /v1/chat/completions (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x00000198A0D4B820>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond'))
2025-05-18 16:49:42,934 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session d7451eae-0fd5-4eaf-8b36-d9f533d98c77
2025-05-18 16:49:42,936 - websockets.server - INFO - connection open
2025-05-18 16:51:46,475 - websockets.server - INFO - connection closed
2025-05-18 16:51:46,488 - websockets.server - INFO - connection closed
2025-05-18 16:51:46,491 - websockets.server - INFO - server closing
2025-05-18 16:51:46,493 - websockets.server - INFO - server closed
2025-05-18 16:51:46,504 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 16:51:50,273 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 16:51:50,333 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:51:50,333 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 16:51:50,335 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 16:51:55,890 - websockets.server - INFO - connection open
2025-05-18 16:51:58,265 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-18 16:51:58,266 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,266 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,267 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 16:51:58,267 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-18 16:51:58,267 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 16:51:58,268 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,282 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:51:58,283 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:51:58,283 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:51:58,284 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 16:51:58,285 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:51:58,285 - chatbot_rag - INFO - Tổng kích thước: 2603 ký tự
2025-05-18 16:51:58,288 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165158.txt
2025-05-18 16:51:58,288 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:51:58,289 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:51:58,289 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:52:14,152 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:52:14,152 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:52:14,154 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165214.txt
2025-05-18 16:52:14,155 - chatbot_rag - INFO - [analysis_20250518_165214] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165214_raw.txt
2025-05-18 16:52:14,156 - chatbot_rag - INFO - [analysis_20250518_165214] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:52:14,156 - chatbot_rag - WARNING - [analysis_20250518_165214] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:52:14,158 - chatbot_rag - INFO - [analysis_20250518_165214] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 16:52:14,158 - chatbot_rag - INFO - [analysis_20250518_165214] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:52:14,159 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:52:14,161 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,162 - websocket_server - INFO - Session ID nhận được: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,162 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 16:52:14,163 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 16:52:14,163 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 16:52:14,163 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,164 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:14,164 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:52:14,165 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 16:52:14,165 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-18 16:52:14,166 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:52:14,166 - chatbot_rag - INFO - Tổng kích thước: 2593 ký tự
2025-05-18 16:52:14,168 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165214.txt
2025-05-18 16:52:14,168 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:52:14,168 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 16:52:14,169 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:52:26,134 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:52:26,135 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user's current question is "xin chào", which means "hello" in Vietnamese. I need to analyze this based on the provided guidelines.

First, checking the history of messages
2025-05-18 16:52:26,136 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165226.txt
2025-05-18 16:52:26,138 - chatbot_rag - INFO - [analysis_20250518_165226] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165226_raw.txt
2025-05-18 16:52:26,139 - chatbot_rag - INFO - [analysis_20250518_165226] Phản hồi gốc: <think>
Okay, let's see. The user's current question is "xin chào", which means "hello" in Vietnames...
2025-05-18 16:52:26,139 - chatbot_rag - WARNING - [analysis_20250518_165226] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:52:26,139 - chatbot_rag - INFO - [analysis_20250518_165226] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:52:26,140 - chatbot_rag - INFO - [analysis_20250518_165226] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:52:26,140 - chatbot_rag - INFO - [analysis_20250518_165226] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:52:26,140 - chatbot_rag - WARNING - [analysis_20250518_165226] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:52:26,141 - chatbot_rag - INFO - [analysis_20250518_165226] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:52:26,150 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:52:26,150 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:52:26,150 - chatbot_rag - ERROR - [analysis_20250518_165226] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:52:26,151 - chatbot_rag - WARNING - [analysis_20250518_165226] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:52:26,151 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:52:26,151 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-18 16:52:26,152 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 16:52:26,152 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:26,155 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:52:26,155 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:52:26,156 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:52:26,157 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_165226.txt
2025-05-18 16:52:26,157 - chatbot_rag - INFO - Kích thước prompt: 1630 ký tự
2025-05-18 16:52:26,157 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:52:26,157 - chatbot_rag - INFO - Tổng kích thước: 2835 ký tự
2025-05-18 16:52:26,158 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165226.txt
2025-05-18 16:52:26,159 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:52:26,159 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 16:52:26,160 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 16:52:53,301 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:52:53,301 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

# Cấu trúc giai đoạn và quy trình làm việc

## Giai đoạn chính:
1. **MKT-SALES**: Marketing, Kinh doanh  
2. **PROPOSAL**: Kinh doanh, Dự toán, Thiết kế, Team dự án  
3. **CONSTRUCT
2025-05-18 16:52:53,303 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165253.txt
2025-05-18 16:52:53,603 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 791 ký tự phản hồi
2025-05-18 16:52:53,603 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 16:52:53,603 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,075 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"tôi đẹp trai không /no_think","session_id":""}
2025-05-18 16:53:15,076 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,077 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,077 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: tôi đẹp trai không /no_think...
2025-05-18 16:53:15,077 - websocket_server - INFO - Nhận tin nhắn thông thường: tôi đẹp trai không /no_think, enable_thinking=False
2025-05-18 16:53:15,078 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 16:53:15,079 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_165315.txt
2025-05-18 16:53:15,079 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:53:15,080 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {...
2025-05-18 16:53:15,081 - chatbot_rag - INFO - Kích thước prompt: 649 ký tự
2025-05-18 16:53:15,081 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:53:15,082 - chatbot_rag - INFO - Tổng kích thước: 2653 ký tự
2025-05-18 16:53:15,083 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165315.txt
2025-05-18 16:53:15,083 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:53:15,084 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {...
2025-05-18 16:53:15,084 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:53:27,321 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:53:27,322 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:53:27,323 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165327.txt
2025-05-18 16:53:27,326 - chatbot_rag - INFO - [analysis_20250518_165327] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165327_raw.txt
2025-05-18 16:53:27,327 - chatbot_rag - INFO - [analysis_20250518_165327] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:53:27,327 - chatbot_rag - WARNING - [analysis_20250518_165327] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:53:27,328 - chatbot_rag - INFO - [analysis_20250518_165327] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 16:53:27,328 - chatbot_rag - INFO - [analysis_20250518_165327] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:53:27,328 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:53:27,329 - websocket_server - INFO - Xử lý streaming response cho: 'tôi đẹp trai không /no_think', phòng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,329 - websocket_server - INFO - Session ID nhận được: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,330 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: tôi đẹp trai không
2025-05-18 16:53:27,330 - websocket_server - INFO - Xử lý streaming response. Query: 'tôi đẹp trai không', Mode thinking: False
2025-05-18 16:53:27,330 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 16:53:27,332 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_165327.txt
2025-05-18 16:53:27,332 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:53:27,333 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-18 16:53:27,334 - chatbot_rag - INFO - Kích thước prompt: 639 ký tự
2025-05-18 16:53:27,334 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:53:27,334 - chatbot_rag - INFO - Tổng kích thước: 2643 ký tự
2025-05-18 16:53:27,337 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165327.txt
2025-05-18 16:53:27,337 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:53:27,338 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

tôi đẹp trai không"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departmen...
2025-05-18 16:53:27,338 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:53:38,907 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:53:38,907 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user provided a conversation history where the first message is "xin chào" (hello) and then asks "tôi đẹp trai không" (am I handsome?). There's no mention of a
2025-05-18 16:53:38,910 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165338.txt
2025-05-18 16:53:38,912 - chatbot_rag - INFO - [analysis_20250518_165338] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165338_raw.txt
2025-05-18 16:53:38,912 - chatbot_rag - INFO - [analysis_20250518_165338] Phản hồi gốc: <think>
Okay, let's break this down. The user provided a conversation history where the first messag...
2025-05-18 16:53:38,912 - chatbot_rag - WARNING - [analysis_20250518_165338] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:53:38,913 - chatbot_rag - INFO - [analysis_20250518_165338] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 16:53:38,913 - chatbot_rag - INFO - [analysis_20250518_165338] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:53:38,914 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:53:38,914 - websocket_server - INFO - Query thực tế gửi đến mô hình: tôi đẹp trai không /no_think
2025-05-18 16:53:38,914 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 16:53:38,915 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:38,917 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:53:38,918 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:53:38,918 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:53:38,920 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_165338.txt
2025-05-18 16:53:38,921 - chatbot_rag - INFO - Kích thước prompt: 1640 ký tự
2025-05-18 16:53:38,921 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:53:38,922 - chatbot_rag - INFO - Tổng kích thước: 2845 ký tự
2025-05-18 16:53:38,923 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165338.txt
2025-05-18 16:53:38,923 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:53:38,924 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "tôi đẹp trai không /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong qu...
2025-05-18 16:53:38,924 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 16:53:59,027 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:53:59,028 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn hoặc phòng ban.

😎🔥 *TÔI ĐẸP TRAI!* 🔥😎  
👉 Nếu bạn muốn biết công ty làm gì trong từng giai đoạn, vui lòng hỏi về một 
2025-05-18 16:53:59,029 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165359.txt
2025-05-18 16:53:59,032 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 397 ký tự phản hồi
2025-05-18 16:53:59,033 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 16:53:59,033 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,121 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 16:56:19,122 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: ```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn hoặc phòng ban.

😎🔥 *TÔI ĐẸP TRAI!* 🔥
2025-05-18 16:56:19,123 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 16:56:19,124 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_165619.txt
2025-05-18 16:56:19,125 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 16:56:19,126 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn hoặc phòng ban.

😎🔥 *TÔI ĐẸP TRAI!* 🔥😎  
👉 Nếu bạn muốn biết công ty làm gì trong từng giai đoạn, vui lòng hỏi về một giai đoạn cụ thể.  
👉 Nếu bạn muốn biết phòng ban nào làm gì, hãy hỏi riêng về một phòng ban!  
👉 Ví dụ: "Phòng Marketing tham gia giai đoạn nào?" hoặc "Giai đoạn MKT-SALES gồm những bước gì?"

💬 Hãy thử lại nhé!
```, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,127 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:19,127 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:56:19,128 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn h...
2025-05-18 16:56:19,129 - chatbot_rag - INFO - Kích thước prompt: 1049 ký tự
2025-05-18 16:56:19,130 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:56:19,130 - chatbot_rag - INFO - Tổng kích thước: 3053 ký tự
2025-05-18 16:56:19,133 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165619.txt
2025-05-18 16:56:19,134 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:56:19,134 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn h...
2025-05-18 16:56:19,135 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:56:43,522 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:56:43,523 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is about their own appearance, asking "tôi đẹp trai không" which translates to "Am I handsome?" The history shows previous messages w
2025-05-18 16:56:43,525 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165643.txt
2025-05-18 16:56:43,527 - chatbot_rag - INFO - [analysis_20250518_165643] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165643_raw.txt
2025-05-18 16:56:43,528 - chatbot_rag - INFO - [analysis_20250518_165643] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is about their own appearance, as...
2025-05-18 16:56:43,528 - chatbot_rag - WARNING - [analysis_20250518_165643] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:56:43,529 - chatbot_rag - INFO - [analysis_20250518_165643] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:56:43,530 - chatbot_rag - WARNING - [analysis_20250518_165643] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:56:43,530 - chatbot_rag - INFO - [analysis_20250518_165643] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:56:43,533 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:56:43,534 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:56:43,534 - chatbot_rag - INFO - [analysis_20250518_165643] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Marketing
2025-05-18 16:56:43,535 - chatbot_rag - ERROR - [analysis_20250518_165643] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:56:43,535 - chatbot_rag - WARNING - [analysis_20250518_165643] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:56:43,536 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 16:56:43,536 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:43,538 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:56:43,539 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:56:43,539 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:56:43,540 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_165643.txt
2025-05-18 16:56:43,541 - chatbot_rag - INFO - Kích thước prompt: 2016 ký tự
2025-05-18 16:56:43,541 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:56:43,541 - chatbot_rag - INFO - Tổng kích thước: 3221 ký tự
2025-05-18 16:56:43,543 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165643.txt
2025-05-18 16:56:43,543 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:56:43,544 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "```markdown
# Câu hỏi không liên quan đến quy trình, giai đoạn hoặc phòng ban.

😎🔥 *TÔI ĐẸP TRAI!* 🔥😎  
👉 Nếu bạn muốn biết công ty làm gì trong từng giai đoạn, vui lòng hỏi về một giai đoạ...
2025-05-18 16:56:43,544 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 16:57:26,651 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:57:26,652 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, the user provided a detailed query about their company's process and departments. They want me to structure the answer according to specific rules: no creating connections between depart
2025-05-18 16:57:26,654 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165726.txt
2025-05-18 16:57:26,665 - websocket_server - INFO - Đã trích xuất thinking (1018 ký tự) và còn lại 764 ký tự phản hồi
2025-05-18 16:57:26,666 - websocket_server - INFO - Đã trích xuất phần thinking (1018 ký tự) từ phản hồi handle_general_query
2025-05-18 16:57:26,666 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747562179121_hy1v07z
2025-05-18 16:57:26,669 - websocket_server - INFO - Đã gửi nội dung thinking (1018 ký tự)
2025-05-18 16:57:26,671 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"ủa mắc gì /no_think","session_id":""}
2025-05-18 16:57:26,671 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,672 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,672 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: ủa mắc gì /no_think...
2025-05-18 16:57:26,673 - websocket_server - INFO - Nhận tin nhắn thông thường: ủa mắc gì /no_think, enable_thinking=False
2025-05-18 16:57:26,673 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 16:57:26,675 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_165726.txt
2025-05-18 16:57:26,676 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì /no_think, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:57:26,677 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì /no_think"

        Phân tích câu hỏi và trả về JSON c...
2025-05-18 16:57:26,679 - chatbot_rag - INFO - Kích thước prompt: 671 ký tự
2025-05-18 16:57:26,680 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:57:26,680 - chatbot_rag - INFO - Tổng kích thước: 2675 ký tự
2025-05-18 16:57:26,682 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165726.txt
2025-05-18 16:57:26,683 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:57:26,689 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì /no_think"

        Phân tích câu hỏi và trả về JSON c...
2025-05-18 16:57:26,690 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:57:39,187 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:57:39,187 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 16:57:39,188 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165739.txt
2025-05-18 16:57:39,190 - chatbot_rag - INFO - [analysis_20250518_165739] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165739_raw.txt
2025-05-18 16:57:39,190 - chatbot_rag - INFO - [analysis_20250518_165739] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 16:57:39,191 - chatbot_rag - WARNING - [analysis_20250518_165739] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:57:39,191 - chatbot_rag - INFO - [analysis_20250518_165739] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 16:57:39,192 - chatbot_rag - INFO - [analysis_20250518_165739] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 16:57:39,193 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:57:39,193 - websocket_server - INFO - Xử lý streaming response cho: 'ủa mắc gì /no_think', phòng ban: None, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,193 - websocket_server - INFO - Session ID nhận được: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,194 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: ủa mắc gì
2025-05-18 16:57:39,194 - websocket_server - INFO - Xử lý streaming response. Query: 'ủa mắc gì', Mode thinking: False
2025-05-18 16:57:39,194 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 16:57:39,196 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_165739.txt
2025-05-18 16:57:39,196 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì, session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,196 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:39,197 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:57:39,197 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì"

        Phân tích câu hỏi và trả về JSON có định dạn...
2025-05-18 16:57:39,198 - chatbot_rag - INFO - Kích thước prompt: 661 ký tự
2025-05-18 16:57:39,198 - chatbot_rag - INFO - Kích thước system prompt: 2004 ký tự
2025-05-18 16:57:39,199 - chatbot_rag - INFO - Tổng kích thước: 2665 ký tự
2025-05-18 16:57:39,201 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165739.txt
2025-05-18 16:57:39,202 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay chung (query_type)
        3. Nếu câu hỏi đ...
2025-05-18 16:57:39,202 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: tôi đẹp trai không

ủa mắc gì"

        Phân tích câu hỏi và trả về JSON có định dạn...
2025-05-18 16:57:39,202 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 16:57:51,576 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:57:51,576 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a history of messages where the user asked "xin chào" (hello) and then "tôi đẹp trai không" (am I handsome?). Now, the current question is "ủa mắc gì", which
2025-05-18 16:57:51,578 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165751.txt
2025-05-18 16:57:51,581 - chatbot_rag - INFO - [analysis_20250518_165751] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_165751_raw.txt
2025-05-18 16:57:51,582 - chatbot_rag - INFO - [analysis_20250518_165751] Phản hồi gốc: <think>
Okay, let's see. The user provided a history of messages where the user asked "xin chào" (he...
2025-05-18 16:57:51,582 - chatbot_rag - WARNING - [analysis_20250518_165751] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 16:57:51,583 - chatbot_rag - INFO - [analysis_20250518_165751] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 16:57:51,583 - chatbot_rag - INFO - [analysis_20250518_165751] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 16:57:51,584 - chatbot_rag - INFO - [analysis_20250518_165751] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 16:57:51,584 - chatbot_rag - WARNING - [analysis_20250518_165751] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 16:57:51,585 - chatbot_rag - INFO - [analysis_20250518_165751] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 16:57:51,592 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:57:51,593 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:57:51,593 - chatbot_rag - ERROR - [analysis_20250518_165751] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 16:57:51,594 - chatbot_rag - WARNING - [analysis_20250518_165751] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 16:57:51,594 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 16:57:51,595 - websocket_server - INFO - Query thực tế gửi đến mô hình: ủa mắc gì /no_think
2025-05-18 16:57:51,595 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 16:57:51,595 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:51,600 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 16:57:51,600 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 16:57:51,601 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:57:51,602 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_165751.txt
2025-05-18 16:57:51,603 - chatbot_rag - INFO - Kích thước prompt: 1631 ký tự
2025-05-18 16:57:51,603 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 16:57:51,604 - chatbot_rag - INFO - Tổng kích thước: 2836 ký tự
2025-05-18 16:57:51,606 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_165751.txt
2025-05-18 16:57:51,606 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 16:57:51,607 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "ủa mắc gì /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
...
2025-05-18 16:57:51,607 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 16:58:22,889 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 16:58:22,890 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```markdown
# Cấu trúc giai đoạn và quy trình

## Giai đoạn chính:
1. **MKT-SALES**
2. **PROPOSAL**
3. **CONSTRUCTION**
4. **DEFECT-HANDOVER**
5. **AFTERSALE-MAINTENANCE**

## Giai 
2025-05-18 16:58:22,893 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_165822.txt
2025-05-18 16:58:22,898 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 898 ký tự phản hồi
2025-05-18 16:58:22,898 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 16:58:22,898 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 40b42600-e648-49f8-b00c-549ce9aeebf0
2025-05-18 16:58:22,915 - websocket_server - INFO - WebSocket connection closed
2025-05-18 16:58:22,915 - websockets.server - INFO - connection closed
2025-05-18 16:58:22,924 - websockets.server - INFO - connection open
2025-05-18 17:03:10,270 - websockets.server - INFO - connection closed
2025-05-18 17:03:10,273 - websockets.server - INFO - server closing
2025-05-18 17:03:10,274 - websockets.server - INFO - server closed
2025-05-18 17:03:10,281 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 17:03:12,253 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 17:03:12,287 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:03:12,288 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 17:03:12,288 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 17:04:05,838 - websockets.server - INFO - connection open
2025-05-18 17:04:06,677 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào, nay đi làm chán quá /no_think","session_id":""}
2025-05-18 17:04:06,678 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,678 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,679 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào, nay đi làm chán quá /no_think...
2025-05-18 17:04:06,679 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào, nay đi làm chán quá /no_think, enable_thinking=False
2025-05-18 17:04:06,679 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 17:04:06,680 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, nay đi làm chán quá /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,683 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:06,684 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:04:06,684 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào, nay đi làm chán quá /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban ...
2025-05-18 17:04:06,684 - chatbot_rag - INFO - Kích thước prompt: 620 ký tự
2025-05-18 17:04:06,685 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:04:06,685 - chatbot_rag - INFO - Tổng kích thước: 2626 ký tự
2025-05-18 17:04:06,687 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170406.txt
2025-05-18 17:04:06,687 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:04:06,688 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào, nay đi làm chán quá /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban ...
2025-05-18 17:04:06,688 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:04:19,632 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:04:19,633 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:04:19,634 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170419.txt
2025-05-18 17:04:19,636 - chatbot_rag - INFO - [analysis_20250518_170419] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170419_raw.txt
2025-05-18 17:04:19,636 - chatbot_rag - INFO - [analysis_20250518_170419] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:04:19,637 - chatbot_rag - WARNING - [analysis_20250518_170419] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:04:19,637 - chatbot_rag - INFO - [analysis_20250518_170419] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 17:04:19,638 - chatbot_rag - INFO - [analysis_20250518_170419] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:04:19,639 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:04:19,639 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào, nay đi làm chán quá /no_think', phòng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,639 - websocket_server - INFO - Session ID nhận được: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,639 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào, nay đi làm chán quá
2025-05-18 17:04:19,640 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào, nay đi làm chán quá', Mode thinking: False
2025-05-18 17:04:19,640 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 17:04:19,640 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, nay đi làm chán quá, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,640 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:19,641 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:04:19,641 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào, nay đi làm chán quá"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null"...
2025-05-18 17:04:19,641 - chatbot_rag - INFO - Kích thước prompt: 610 ký tự
2025-05-18 17:04:19,642 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:04:19,642 - chatbot_rag - INFO - Tổng kích thước: 2616 ký tự
2025-05-18 17:04:19,645 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170419.txt
2025-05-18 17:04:19,646 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:04:19,646 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào, nay đi làm chán quá"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null"...
2025-05-18 17:04:19,647 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:04:29,916 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:04:29,917 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "xin chào, nay đi làm chán quá." First, I need to determine the department. Since there's no mention of any specific department in t
2025-05-18 17:04:29,918 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170429.txt
2025-05-18 17:04:29,921 - chatbot_rag - INFO - [analysis_20250518_170429] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170429_raw.txt
2025-05-18 17:04:29,921 - chatbot_rag - INFO - [analysis_20250518_170429] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "xin chào, nay đi làm chán quá."...
2025-05-18 17:04:29,921 - chatbot_rag - WARNING - [analysis_20250518_170429] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:04:29,922 - chatbot_rag - INFO - [analysis_20250518_170429] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 17:04:29,922 - chatbot_rag - INFO - [analysis_20250518_170429] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:04:29,923 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:04:29,923 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào, nay đi làm chán quá /no_think
2025-05-18 17:04:29,923 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 17:04:29,923 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:29,928 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:04:29,929 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:04:29,929 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:04:29,930 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_170429.txt
2025-05-18 17:04:29,931 - chatbot_rag - INFO - Kích thước prompt: 1155 ký tự
2025-05-18 17:04:29,932 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 17:04:29,932 - chatbot_rag - INFO - Tổng kích thước: 2360 ký tự
2025-05-18 17:04:29,935 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170429.txt
2025-05-18 17:04:29,936 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 17:04:29,937 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào, nay đi làm chán quá /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chí...
2025-05-18 17:04:29,938 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:04:44,431 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:04:44,431 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

 Xin chào 😎  
Đi làm chán quá à? 🙃 Đừng buồn nha, có gì cứ nói cho mình biết nhé! 💬✨  
Chúc bạn luôn vui vẻ và hứng thú với công việc của mình nhé! 🌟🌈
2025-05-18 17:04:44,433 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170444.txt
2025-05-18 17:04:44,668 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 149 ký tự phản hồi
2025-05-18 17:04:44,669 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 17:04:44,669 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,848 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"nay tui bị sếp la /no_think","session_id":""}
2025-05-18 17:05:13,849 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,849 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,850 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: nay tui bị sếp la /no_think...
2025-05-18 17:05:13,850 - websocket_server - INFO - Nhận tin nhắn thông thường: nay tui bị sếp la /no_think, enable_thinking=False
2025-05-18 17:05:13,851 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:05:13,853 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_170513.txt
2025-05-18 17:05:13,854 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,854 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:13,855 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:05:13,856 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la /no_think"

        Phân tích câu hỏi và trả về JSON có ...
2025-05-18 17:05:13,856 - chatbot_rag - INFO - Kích thước prompt: 669 ký tự
2025-05-18 17:05:13,857 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:05:13,857 - chatbot_rag - INFO - Tổng kích thước: 2675 ký tự
2025-05-18 17:05:13,859 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170513.txt
2025-05-18 17:05:13,860 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:05:13,860 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la /no_think"

        Phân tích câu hỏi và trả về JSON có ...
2025-05-18 17:05:13,861 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:05:26,448 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:05:26,449 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:05:26,451 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170526.txt
2025-05-18 17:05:26,452 - chatbot_rag - INFO - [analysis_20250518_170526] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170526_raw.txt
2025-05-18 17:05:26,452 - chatbot_rag - INFO - [analysis_20250518_170526] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:05:26,452 - chatbot_rag - WARNING - [analysis_20250518_170526] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:05:26,454 - chatbot_rag - INFO - [analysis_20250518_170526] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 17:05:26,454 - chatbot_rag - INFO - [analysis_20250518_170526] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:05:26,454 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:05:26,455 - websocket_server - INFO - Xử lý streaming response cho: 'nay tui bị sếp la /no_think', phòng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,455 - websocket_server - INFO - Session ID nhận được: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,455 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: nay tui bị sếp la
2025-05-18 17:05:26,455 - websocket_server - INFO - Xử lý streaming response. Query: 'nay tui bị sếp la', Mode thinking: False
2025-05-18 17:05:26,455 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:05:26,456 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_170526.txt
2025-05-18 17:05:26,457 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,459 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:26,459 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:05:26,461 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la"

        Phân tích câu hỏi và trả về JSON có định dạng:...
2025-05-18 17:05:26,462 - chatbot_rag - INFO - Kích thước prompt: 659 ký tự
2025-05-18 17:05:26,462 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:05:26,463 - chatbot_rag - INFO - Tổng kích thước: 2665 ký tự
2025-05-18 17:05:26,464 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170526.txt
2025-05-18 17:05:26,464 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:05:26,465 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá

nay tui bị sếp la"

        Phân tích câu hỏi và trả về JSON có định dạng:...
2025-05-18 17:05:26,465 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:05:39,056 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:05:39,056 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure this out. The user's current question is about their work history and being scolded by their boss. They mentioned "nay tui bị sếp la" which translates to something l
2025-05-18 17:05:39,060 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170539.txt
2025-05-18 17:05:39,064 - chatbot_rag - INFO - [analysis_20250518_170539] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170539_raw.txt
2025-05-18 17:05:39,064 - chatbot_rag - INFO - [analysis_20250518_170539] Phản hồi gốc: <think>
Okay, let me try to figure this out. The user's current question is about their work history...
2025-05-18 17:05:39,064 - chatbot_rag - WARNING - [analysis_20250518_170539] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:05:39,065 - chatbot_rag - INFO - [analysis_20250518_170539] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:05:39,066 - chatbot_rag - WARNING - [analysis_20250518_170539] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:05:39,066 - chatbot_rag - INFO - [analysis_20250518_170539] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:05:39,070 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:05:39,070 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:05:39,070 - chatbot_rag - ERROR - [analysis_20250518_170539] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:05:39,071 - chatbot_rag - WARNING - [analysis_20250518_170539] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:05:39,071 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:05:39,071 - websocket_server - INFO - Query thực tế gửi đến mô hình: nay tui bị sếp la /no_think
2025-05-18 17:05:39,072 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 17:05:39,072 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:39,076 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:05:39,077 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:05:39,077 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:05:39,079 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_170539.txt
2025-05-18 17:05:39,079 - chatbot_rag - INFO - Kích thước prompt: 1143 ký tự
2025-05-18 17:05:39,080 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 17:05:39,080 - chatbot_rag - INFO - Tổng kích thước: 2348 ký tự
2025-05-18 17:05:39,082 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170539.txt
2025-05-18 17:05:39,082 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 17:05:39,083 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "nay tui bị sếp la /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy...
2025-05-18 17:05:39,084 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:05:57,647 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:05:57,648 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

😅 *"Nay tui bị sếp la" — có thể là do tui chưa làm đúng vai trò trong quy trình 😅*  
👉 Để biết mình đang ở giai đoạn nào và phòng ban nào phụ trách, vui lòng hỏi cụ thể hơn nhé!  
💬
2025-05-18 17:05:57,659 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170557.txt
2025-05-18 17:05:57,663 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 393 ký tự phản hồi
2025-05-18 17:05:57,663 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 17:05:57,664 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,913 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"do tui sờ mông sếp /no_think","session_id":""}
2025-05-18 17:09:04,938 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,950 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,951 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: do tui sờ mông sếp /no_think...
2025-05-18 17:09:04,952 - websocket_server - INFO - Nhận tin nhắn thông thường: do tui sờ mông sếp /no_think, enable_thinking=False
2025-05-18 17:09:04,954 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 17:09:04,969 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_170904.txt
2025-05-18 17:09:04,972 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp /no_think, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,976 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:04,977 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:09:04,977 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp /no_think"

        Phân ...
2025-05-18 17:09:04,981 - chatbot_rag - INFO - Kích thước prompt: 700 ký tự
2025-05-18 17:09:04,981 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:09:04,982 - chatbot_rag - INFO - Tổng kích thước: 2706 ký tự
2025-05-18 17:09:04,985 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170904.txt
2025-05-18 17:09:04,986 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:09:04,987 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp /no_think"

        Phân ...
2025-05-18 17:09:04,988 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:09:20,890 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:09:20,891 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:09:20,894 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170920.txt
2025-05-18 17:09:20,897 - chatbot_rag - INFO - [analysis_20250518_170920] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170920_raw.txt
2025-05-18 17:09:20,898 - chatbot_rag - INFO - [analysis_20250518_170920] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:09:20,898 - chatbot_rag - WARNING - [analysis_20250518_170920] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:09:20,900 - chatbot_rag - INFO - [analysis_20250518_170920] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 17:09:20,901 - chatbot_rag - INFO - [analysis_20250518_170920] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:09:20,902 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:09:20,902 - websocket_server - INFO - Xử lý streaming response cho: 'do tui sờ mông sếp /no_think', phòng ban: None, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,903 - websocket_server - INFO - Session ID nhận được: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,903 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: do tui sờ mông sếp
2025-05-18 17:09:20,903 - websocket_server - INFO - Xử lý streaming response. Query: 'do tui sờ mông sếp', Mode thinking: False
2025-05-18 17:09:20,904 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 17:09:20,905 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_170920.txt
2025-05-18 17:09:20,906 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp, session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:09:20,907 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp"

        Phân tích câu h...
2025-05-18 17:09:20,909 - chatbot_rag - INFO - Kích thước prompt: 690 ký tự
2025-05-18 17:09:20,909 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:09:20,910 - chatbot_rag - INFO - Tổng kích thước: 2696 ký tự
2025-05-18 17:09:20,914 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170920.txt
2025-05-18 17:09:20,914 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:09:20,915 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào, nay đi làm chán quá
Người dùng: nay tui bị sếp la

do tui sờ mông sếp"

        Phân tích câu h...
2025-05-18 17:09:20,915 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:09:34,241 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:09:34,243 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they're talking about being upset with their boss and some inappropriate behavior. Now, the current question 
2025-05-18 17:09:34,246 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170934.txt
2025-05-18 17:09:34,249 - chatbot_rag - INFO - [analysis_20250518_170934] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_170934_raw.txt
2025-05-18 17:09:34,250 - chatbot_rag - INFO - [analysis_20250518_170934] Phản hồi gốc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they're t...
2025-05-18 17:09:34,251 - chatbot_rag - WARNING - [analysis_20250518_170934] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:09:34,251 - chatbot_rag - INFO - [analysis_20250518_170934] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:09:34,254 - chatbot_rag - INFO - [analysis_20250518_170934] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:09:34,254 - chatbot_rag - INFO - [analysis_20250518_170934] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:09:34,255 - chatbot_rag - WARNING - [analysis_20250518_170934] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:09:34,255 - chatbot_rag - INFO - [analysis_20250518_170934] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:09:34,280 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:09:34,281 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:09:34,283 - chatbot_rag - ERROR - [analysis_20250518_170934] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:09:34,284 - chatbot_rag - WARNING - [analysis_20250518_170934] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:09:34,284 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:09:34,285 - websocket_server - INFO - Query thực tế gửi đến mô hình: do tui sờ mông sếp /no_think
2025-05-18 17:09:34,285 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 17:09:34,287 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:34,294 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:09:34,294 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:09:34,296 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:09:34,298 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_170934.txt
2025-05-18 17:09:34,298 - chatbot_rag - INFO - Kích thước prompt: 1144 ký tự
2025-05-18 17:09:34,298 - chatbot_rag - INFO - Kích thước system prompt: 1205 ký tự
2025-05-18 17:09:34,299 - chatbot_rag - INFO - Tổng kích thước: 2349 ký tự
2025-05-18 17:09:34,302 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_170934.txt
2025-05-18 17:09:34,303 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

CÁC PHÒNG BAN THAM GIA THEO GIAI ĐOẠN:
- MKT-SALES: Marketing, Kinh doanh
- PROPOSAL: Kinh doanh, Dự toán, Thiết kế, Team dự án
- CON...
2025-05-18 17:09:34,303 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "do tui sờ mông sếp /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong qu...
2025-05-18 17:09:34,304 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:09:54,571 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:09:54,572 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

🤣 *Do tui sờ mông sếp* — đây là câu hỏi hoàn toàn không liên quan đến quy trình làm việc, giai đoạn hay phòng ban đâu nha! 😂  
👉 Vui vẻ hơn thì hãy hỏi: "Sếp có thích bị sờ mông khô
2025-05-18 17:09:54,575 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_170954.txt
2025-05-18 17:09:54,609 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 327 ký tự phản hồi
2025-05-18 17:09:54,610 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 17:09:54,610 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e06af9f8-3be4-4fd8-83f7-e5c65fd2f9ef
2025-05-18 17:14:59,328 - websockets.server - INFO - connection open
2025-05-18 17:14:59,399 - websockets.server - INFO - connection closed
2025-05-18 17:14:59,399 - websockets.server - INFO - connection closed
2025-05-18 17:15:01,889 - websockets.server - INFO - connection open
2025-05-18 17:18:30,404 - websockets.server - INFO - connection closed
2025-05-18 17:18:30,409 - websockets.server - INFO - server closing
2025-05-18 17:18:30,414 - websockets.server - INFO - server closed
2025-05-18 17:18:30,425 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 17:18:33,345 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 17:18:33,381 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:18:33,381 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 17:18:33,381 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 17:18:44,617 - websockets.server - INFO - connection open
2025-05-18 17:19:04,153 - websockets.server - INFO - connection closed
2025-05-18 17:19:04,965 - websockets.server - INFO - connection open
2025-05-18 17:19:48,881 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alu alu /no_think","session_id":"","mode":"basic","basic_prompt":"Bạn là một trợ lý AI h
2025-05-18 17:19:48,882 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,882 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,883 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alu alu /no_think...
2025-05-18 17:19:48,884 - websocket_server - INFO - Nhận tin nhắn thông thường: alu alu /no_think, enable_thinking=False, mode=basic
2025-05-18 17:19:48,884 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:19:48,885 - websocket_server - INFO - Xử lý streaming response cho: 'alu alu /no_think', phòng ban: None, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41, mode: basic
2025-05-18 17:19:48,885 - websocket_server - INFO - Session ID nhận được: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:19:48,885 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alu alu
2025-05-18 17:19:48,886 - websocket_server - INFO - Xử lý streaming response. Query: 'alu alu', Mode thinking: False
2025-05-18 17:19:48,886 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:19:48,887 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 17:19:48,888 - websocket_server - INFO - Kích thước prompt: 7 ký tự
2025-05-18 17:19:48,888 - websocket_server - INFO - Kích thước system prompt: 203 ký tự
2025-05-18 17:19:48,888 - websocket_server - INFO - Tổng kích thước: 210 ký tự
2025-05-18 17:19:48,888 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 17:19:59,603 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 17:19:59,604 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 17:19:59,605 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:22,013 - websockets.server - INFO - connection closed
2025-05-18 17:21:23,227 - websockets.server - INFO - connection open
2025-05-18 17:21:23,893 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alu alu /no_think","session_id":"","mode":"workflow"}
2025-05-18 17:21:23,894 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,894 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,895 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alu alu /no_think...
2025-05-18 17:21:23,895 - websocket_server - INFO - Nhận tin nhắn thông thường: alu alu /no_think, enable_thinking=False, mode=workflow
2025-05-18 17:21:23,895 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:21:23,903 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172123.txt
2025-05-18 17:21:23,907 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alu alu

alu alu /no_think, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,968 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:23,969 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:21:23,969 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu

alu alu /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department"...
2025-05-18 17:21:23,970 - chatbot_rag - INFO - Kích thước prompt: 637 ký tự
2025-05-18 17:21:23,970 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:21:23,970 - chatbot_rag - INFO - Tổng kích thước: 2643 ký tự
2025-05-18 17:21:23,972 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172123.txt
2025-05-18 17:21:23,972 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:21:23,972 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu

alu alu /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department"...
2025-05-18 17:21:23,973 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:21:37,083 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:21:37,083 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 17:21:37,086 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172137.txt
2025-05-18 17:21:37,088 - chatbot_rag - INFO - [analysis_20250518_172137] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_172137_raw.txt
2025-05-18 17:21:37,089 - chatbot_rag - INFO - [analysis_20250518_172137] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 17:21:37,089 - chatbot_rag - WARNING - [analysis_20250518_172137] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:21:37,092 - chatbot_rag - INFO - [analysis_20250518_172137] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 17:21:37,093 - chatbot_rag - INFO - [analysis_20250518_172137] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 17:21:37,094 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:21:37,094 - websocket_server - INFO - Xử lý streaming response cho: 'alu alu /no_think', phòng ban: None, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41, mode: None
2025-05-18 17:21:37,094 - websocket_server - INFO - Session ID nhận được: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,096 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alu alu
2025-05-18 17:21:37,096 - websocket_server - INFO - Xử lý streaming response. Query: 'alu alu', Mode thinking: False
2025-05-18 17:21:37,096 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:21:37,098 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172137.txt
2025-05-18 17:21:37,099 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alu alu

alu alu, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,099 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:37,099 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:21:37,100 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu

alu alu"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phò...
2025-05-18 17:21:37,100 - chatbot_rag - INFO - Kích thước prompt: 627 ký tự
2025-05-18 17:21:37,100 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:21:37,100 - chatbot_rag - INFO - Tổng kích thước: 2633 ký tự
2025-05-18 17:21:37,102 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172137.txt
2025-05-18 17:21:37,103 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:21:37,103 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu

alu alu"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phò...
2025-05-18 17:21:37,103 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:21:48,760 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:21:48,760 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a message that's just "alu alu" repeated. That seems like a placeholder or maybe a test input. Now, I need to analyze this based on the given rules.

First, 
2025-05-18 17:21:48,763 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172148.txt
2025-05-18 17:21:48,764 - chatbot_rag - INFO - [analysis_20250518_172148] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_172148_raw.txt
2025-05-18 17:21:48,766 - chatbot_rag - INFO - [analysis_20250518_172148] Phản hồi gốc: <think>
Okay, let's see. The user provided a message that's just "alu alu" repeated. That seems like...
2025-05-18 17:21:48,766 - chatbot_rag - WARNING - [analysis_20250518_172148] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:21:48,767 - chatbot_rag - INFO - [analysis_20250518_172148] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:21:48,767 - chatbot_rag - WARNING - [analysis_20250518_172148] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:21:48,768 - chatbot_rag - INFO - [analysis_20250518_172148] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:21:48,774 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:21:48,776 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:21:48,777 - chatbot_rag - ERROR - [analysis_20250518_172148] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:21:48,777 - chatbot_rag - WARNING - [analysis_20250518_172148] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:21:48,778 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 17:21:48,778 - websocket_server - INFO - Query thực tế gửi đến mô hình: alu alu /no_think
2025-05-18 17:21:48,778 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 17:21:48,778 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:48,781 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:21:48,781 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:21:48,782 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:21:48,784 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_172148.txt
2025-05-18 17:21:48,784 - chatbot_rag - INFO - Kích thước prompt: 1032 ký tự
2025-05-18 17:21:48,784 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 17:21:48,784 - chatbot_rag - INFO - Tổng kích thước: 1948 ký tự
2025-05-18 17:21:48,787 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172148.txt
2025-05-18 17:21:48,787 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 17:21:48,788 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "alu alu /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1....
2025-05-18 17:21:48,788 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:22:05,921 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:22:05,921 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ trách |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | Dự toán, 
2025-05-18 17:22:05,924 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172205.txt
2025-05-18 17:22:06,284 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 479 ký tự phản hồi
2025-05-18 17:22:06,284 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 17:22:06,285 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,375 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 17:22:55,375 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: ```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ trách |
|-----------|---
2025-05-18 17:22:55,375 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 17:22:55,377 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172255.txt
2025-05-18 17:22:55,377 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 17:22:55,378 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alu alu
Người dùng: alu alu

```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ trách |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | Dự toán, Thiết kế, 2D |
| CONSTRUCTION | Thi công, Team dự án |
| DEFECT-HANDOVER | Khách hàng, Mua hàng, Kế toán |
| AFTERSALE-MAINTENANCE | Kinh doanh, Khách hàng |

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: "Phòng Kinh doanh làm gì trong giai đoạn PROPOSAL?" 😎🏗️
```, session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,378 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:22:55,379 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:22:55,379 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu
Người dùng: alu alu

```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ ...
2025-05-18 17:22:55,379 - chatbot_rag - INFO - Kích thước prompt: 1119 ký tự
2025-05-18 17:22:55,380 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:22:55,380 - chatbot_rag - INFO - Tổng kích thước: 3125 ký tự
2025-05-18 17:22:55,382 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172255.txt
2025-05-18 17:22:55,383 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:22:55,383 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alu alu
Người dùng: alu alu

```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ ...
2025-05-18 17:22:55,384 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:23:21,128 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:23:21,129 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages and the current question. First, I need to parse the current question carefully.

The current message is a markdown table
2025-05-18 17:23:21,131 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172321.txt
2025-05-18 17:23:21,133 - chatbot_rag - INFO - [analysis_20250518_172321] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_172321_raw.txt
2025-05-18 17:23:21,133 - chatbot_rag - INFO - [analysis_20250518_172321] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages and the current quest...
2025-05-18 17:23:21,134 - chatbot_rag - WARNING - [analysis_20250518_172321] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:23:21,134 - chatbot_rag - INFO - [analysis_20250518_172321] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:23:21,134 - chatbot_rag - INFO - [analysis_20250518_172321] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:23:21,135 - chatbot_rag - INFO - [analysis_20250518_172321] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:23:21,136 - chatbot_rag - WARNING - [analysis_20250518_172321] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:23:21,136 - chatbot_rag - INFO - [analysis_20250518_172321] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:23:21,139 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:23:21,140 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:23:21,141 - chatbot_rag - INFO - [analysis_20250518_172321] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: 2D
2025-05-18 17:23:21,141 - chatbot_rag - ERROR - [analysis_20250518_172321] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:23:21,141 - chatbot_rag - WARNING - [analysis_20250518_172321] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:23:21,142 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 17:23:21,142 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:23:21,146 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:23:21,146 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:23:21,147 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 31a0a6b5-8028-4275-8a2e-e9f810554a41
2025-05-18 17:23:21,148 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_172321.txt
2025-05-18 17:23:21,149 - chatbot_rag - INFO - Kích thước prompt: 1501 ký tự
2025-05-18 17:23:21,149 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 17:23:21,149 - chatbot_rag - INFO - Tổng kích thước: 2417 ký tự
2025-05-18 17:23:21,151 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172321.txt
2025-05-18 17:23:21,152 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 17:23:21,153 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "```markdown
# Giai đoạn và phòng ban liên quan

| Giai đoạn | Phòng ban phụ trách |
|-----------|---------------------|
| MKT-SALES | Marketing, Kinh doanh |
| PROPOSAL  | Dự toán, Thiết kế...
2025-05-18 17:23:21,153 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:24:00,996 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:24:00,997 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, the user has provided a query about the stages and responsible departments in a company. They have given a markdown table showing each stage and the departments involved. The user is ask
2025-05-18 17:24:00,999 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172400.txt
2025-05-18 17:24:01,002 - websocket_server - INFO - Đã trích xuất thinking (1814 ký tự) và còn lại 479 ký tự phản hồi
2025-05-18 17:24:01,003 - websocket_server - INFO - Đã trích xuất phần thinking (1814 ký tự) từ phản hồi handle_general_query
2025-05-18 17:24:01,003 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747563775374_y7dovox
2025-05-18 17:24:01,004 - websocket_server - INFO - Đã gửi nội dung thinking (1814 ký tự)
2025-05-18 17:26:09,072 - websockets.server - INFO - connection open
2025-05-18 17:27:18,025 - websockets.server - INFO - connection open
2025-05-18 17:28:06,716 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,719 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,720 - websockets.server - INFO - connection closed
2025-05-18 17:28:06,726 - websockets.server - INFO - server closing
2025-05-18 17:28:06,729 - websockets.server - INFO - server closed
2025-05-18 17:28:06,738 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 17:28:10,916 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 17:28:11,004 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 17:28:11,005 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 17:28:11,007 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 17:28:12,709 - websockets.server - INFO - connection open
2025-05-18 17:28:13,034 - websockets.server - INFO - connection open
2025-05-18 17:28:17,683 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào","session_id":"","mode":"basic","basic_prompt":"Bạn là một trợ lý AI hữu ích và
2025-05-18 17:28:17,684 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,684 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,684 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào, enable_thinking=False, mode=basic
2025-05-18 17:28:17,684 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:28:17,684 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào', phòng ban: None, session_id: 755c7188-5b94-47b0-beb7-4006c742db63, mode: basic
2025-05-18 17:28:17,685 - websocket_server - INFO - Session ID nhận được: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:17,685 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 17:28:17,685 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:28:17,686 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 17:28:17,686 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 17:28:17,686 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 17:28:17,686 - websocket_server - INFO - Tổng kích thước: 182 ký tự
2025-05-18 17:28:17,687 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 17:28:25,799 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 17:28:25,800 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 17:28:25,801 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,388 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 17:28:27,389 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 17:28:27,389 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:28:27,391 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172827.txt
2025-05-18 17:28:27,392 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 17:28:27,393 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

, session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:28:27,415 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 17:28:27,416 - chatbot_rag - INFO - Kích thước prompt: 621 ký tự
2025-05-18 17:28:27,416 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:28:27,416 - chatbot_rag - INFO - Tổng kích thước: 2627 ký tự
2025-05-18 17:28:27,418 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172827.txt
2025-05-18 17:28:27,418 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:28:27,418 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 17:28:27,419 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:28:51,640 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:28:51,641 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user provided a history of messages where the initial message is "xin chào" (which means "hello"). Now, the current question is asking to analyze this and retu
2025-05-18 17:28:51,643 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172851.txt
2025-05-18 17:28:51,645 - chatbot_rag - INFO - [analysis_20250518_172851] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_172851_raw.txt
2025-05-18 17:28:51,646 - chatbot_rag - INFO - [analysis_20250518_172851] Phản hồi gốc: <think>
Okay, let's break this down. The user provided a history of messages where the initial messa...
2025-05-18 17:28:51,646 - chatbot_rag - WARNING - [analysis_20250518_172851] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:28:51,647 - chatbot_rag - INFO - [analysis_20250518_172851] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:28:51,648 - chatbot_rag - INFO - [analysis_20250518_172851] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:28:51,649 - chatbot_rag - INFO - [analysis_20250518_172851] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:28:51,649 - chatbot_rag - WARNING - [analysis_20250518_172851] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:28:51,649 - chatbot_rag - INFO - [analysis_20250518_172851] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:28:51,659 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:28:51,660 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:28:51,660 - chatbot_rag - ERROR - [analysis_20250518_172851] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:28:51,660 - chatbot_rag - WARNING - [analysis_20250518_172851] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:28:51,663 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 17:28:51,663 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:51,666 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:28:51,667 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:28:51,667 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:28:51,669 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_172851.txt
2025-05-18 17:28:51,669 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 17:28:51,670 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 17:28:51,670 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 17:28:51,673 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172851.txt
2025-05-18 17:28:51,674 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 17:28:51,675 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 17:28:51,676 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:29:20,756 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:29:20,758 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me process this. The user is asking a general question about the workflow or stages. They provided some structure and departments.

First, I need to follow the strict rules: don't cr
2025-05-18 17:29:20,760 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172920.txt
2025-05-18 17:29:21,147 - websocket_server - INFO - Đã trích xuất thinking (1003 ký tự) và còn lại 416 ký tự phản hồi
2025-05-18 17:29:21,147 - websocket_server - INFO - Đã trích xuất phần thinking (1003 ký tự) từ phản hồi handle_general_query
2025-05-18 17:29:21,147 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747564107387_cokuwo7
2025-05-18 17:29:21,148 - websocket_server - INFO - Đã gửi nội dung thinking (1003 ký tự)
2025-05-18 17:29:21,151 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào","session_id":"","mode":"basic","basic_prompt":"Bạn là một trợ lý AI hữu ích và
2025-05-18 17:29:21,151 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,151 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,151 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào, enable_thinking=False, mode=basic
2025-05-18 17:29:21,152 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:29:21,153 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào', phòng ban: None, session_id: 755c7188-5b94-47b0-beb7-4006c742db63, mode: basic
2025-05-18 17:29:21,154 - websocket_server - INFO - Session ID nhận được: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:21,154 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 17:29:21,154 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 17:29:21,155 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 17:29:21,158 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172921.txt
2025-05-18 17:29:21,158 - websocket_server - INFO - Kích thước prompt: 48 ký tự
2025-05-18 17:29:21,159 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 17:29:21,160 - websocket_server - INFO - Tổng kích thước: 222 ký tự
2025-05-18 17:29:21,160 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 17:29:26,393 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 17:29:26,395 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 17:29:26,396 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,961 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 17:29:27,961 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 17:29:27,961 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 17:29:27,963 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_172927.txt
2025-05-18 17:29:27,964 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 17:29:27,964 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

, session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,964 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:27,965 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 17:29:27,965 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depart...
2025-05-18 17:29:27,966 - chatbot_rag - INFO - Kích thước prompt: 642 ký tự
2025-05-18 17:29:27,966 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 17:29:27,966 - chatbot_rag - INFO - Tổng kích thước: 2648 ký tự
2025-05-18 17:29:27,968 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172927.txt
2025-05-18 17:29:27,969 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 17:29:27,969 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depart...
2025-05-18 17:29:27,970 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 17:29:51,378 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:29:51,379 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me tackle this query step by step. The user provided a history of messages where the conversation is just "xin chào" repeated twice. The current question is asking for an analysis ba
2025-05-18 17:29:51,381 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_172951.txt
2025-05-18 17:29:51,384 - chatbot_rag - INFO - [analysis_20250518_172951] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_172951_raw.txt
2025-05-18 17:29:51,384 - chatbot_rag - INFO - [analysis_20250518_172951] Phản hồi gốc: <think>
Okay, let me tackle this query step by step. The user provided a history of messages where t...
2025-05-18 17:29:51,384 - chatbot_rag - WARNING - [analysis_20250518_172951] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 17:29:51,385 - chatbot_rag - INFO - [analysis_20250518_172951] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 17:29:51,385 - chatbot_rag - INFO - [analysis_20250518_172951] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 17:29:51,386 - chatbot_rag - INFO - [analysis_20250518_172951] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 17:29:51,386 - chatbot_rag - WARNING - [analysis_20250518_172951] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 17:29:51,387 - chatbot_rag - INFO - [analysis_20250518_172951] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 17:29:51,399 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:29:51,400 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:29:51,403 - chatbot_rag - ERROR - [analysis_20250518_172951] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 17:29:51,403 - chatbot_rag - WARNING - [analysis_20250518_172951] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 17:29:51,404 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 17:29:51,404 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:51,413 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 17:29:51,413 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 17:29:51,414 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 755c7188-5b94-47b0-beb7-4006c742db63
2025-05-18 17:29:51,416 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_172951.txt
2025-05-18 17:29:51,416 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 17:29:51,417 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 17:29:51,417 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 17:29:51,420 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_172951.txt
2025-05-18 17:29:51,421 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 17:29:51,421 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 17:29:51,422 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 17:30:41,779 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 17:30:41,781 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me process this. The user provided a query that's asking about the general process or stages of work in a company. They mentioned specific departments and stages. According to the in
2025-05-18 17:30:41,785 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_173041.txt
2025-05-18 17:30:41,791 - websocket_server - INFO - Đã trích xuất thinking (2403 ký tự) và còn lại 408 ký tự phản hồi
2025-05-18 17:30:41,792 - websocket_server - INFO - Đã trích xuất phần thinking (2403 ký tự) từ phản hồi handle_general_query
2025-05-18 17:30:41,793 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747564167960_t3vsoaw
2025-05-18 17:30:41,794 - websocket_server - INFO - Đã gửi nội dung thinking (2403 ký tự)
2025-05-18 17:31:18,088 - websockets.server - INFO - connection open
2025-05-18 17:31:18,113 - websockets.server - INFO - connection open
2025-05-18 17:32:49,119 - websockets.server - INFO - connection open
2025-05-18 17:32:49,215 - websockets.server - INFO - connection open
2025-05-18 17:33:00,256 - websockets.server - INFO - connection open
2025-05-18 17:33:00,393 - websockets.server - INFO - connection open
2025-05-18 17:33:18,965 - websockets.server - INFO - connection open
2025-05-18 17:33:19,062 - websockets.server - INFO - connection open
2025-05-18 17:33:54,957 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,959 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:54,960 - websockets.server - INFO - connection closed
2025-05-18 17:33:56,333 - websockets.server - INFO - connection open
2025-05-18 17:40:51,769 - websockets.server - INFO - connection open
2025-05-18 17:40:51,793 - websockets.server - INFO - connection open
2025-05-18 17:40:51,814 - websockets.server - INFO - connection open
2025-05-18 17:40:51,837 - websockets.server - INFO - connection open
2025-05-18 17:42:26,551 - websockets.server - INFO - connection open
2025-05-18 17:42:26,706 - websockets.server - INFO - connection open
2025-05-18 17:44:52,591 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,595 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,598 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,598 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,773 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,776 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,778 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,779 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,783 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,786 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,787 - websockets.server - INFO - connection closed
2025-05-18 17:44:52,788 - websockets.server - INFO - connection closed
2025-05-18 17:44:55,028 - websockets.server - INFO - connection open
2025-05-18 17:44:55,094 - websockets.server - INFO - connection open
2025-05-18 17:45:22,450 - websockets.server - INFO - connection open
2025-05-18 17:45:22,502 - websockets.server - INFO - connection open
2025-05-18 17:46:48,937 - websockets.server - INFO - connection open
2025-05-18 17:46:49,045 - websockets.server - INFO - connection open
2025-05-18 17:47:02,899 - websockets.server - INFO - connection open
2025-05-18 17:47:02,922 - websockets.server - INFO - connection open
2025-05-18 17:47:21,627 - websockets.server - INFO - connection open
2025-05-18 17:47:21,770 - websockets.server - INFO - connection open
2025-05-18 17:52:29,727 - websockets.server - INFO - connection open
2025-05-18 17:52:29,794 - websockets.server - INFO - connection open
2025-05-18 17:53:11,717 - websockets.server - INFO - connection open
2025-05-18 17:53:11,833 - websockets.server - INFO - connection open
2025-05-18 17:54:31,425 - websockets.server - INFO - connection open
2025-05-18 17:54:31,567 - websockets.server - INFO - connection open
2025-05-18 17:54:44,356 - websockets.server - INFO - connection open
2025-05-18 17:54:44,373 - websockets.server - INFO - connection open
2025-05-18 17:56:09,416 - websockets.server - INFO - connection open
2025-05-18 17:56:09,429 - websockets.server - INFO - connection open
2025-05-18 17:56:22,629 - websockets.server - INFO - connection open
2025-05-18 17:56:22,802 - websockets.server - INFO - connection open
2025-05-18 17:56:40,395 - websockets.server - INFO - connection open
2025-05-18 17:56:40,412 - websockets.server - INFO - connection open
2025-05-18 19:12:41,685 - websockets.server - INFO - connection open
2025-05-18 19:12:41,702 - websockets.server - INFO - connection open
2025-05-18 19:12:58,585 - websockets.server - INFO - connection open
2025-05-18 19:12:58,599 - websockets.server - INFO - connection open
2025-05-18 19:13:14,975 - websockets.server - INFO - connection open
2025-05-18 19:13:15,039 - websockets.server - INFO - connection open
2025-05-18 19:32:41,356 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,363 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,365 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,367 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,369 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,370 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,371 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,372 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,372 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,373 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,374 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,374 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,375 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,375 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,376 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,376 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,377 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,379 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,380 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,380 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,381 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,381 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,382 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,383 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,383 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,384 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,384 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,385 - websockets.server - INFO - connection closed
2025-05-18 19:32:41,387 - websockets.server - INFO - server closing
2025-05-18 19:32:41,392 - websockets.server - INFO - server closed
2025-05-18 19:32:41,436 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 19:32:43,889 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 19:32:43,919 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:32:43,919 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 19:32:43,919 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 19:32:54,374 - websockets.server - INFO - connection open
2025-05-18 19:32:54,499 - websockets.server - INFO - connection open
2025-05-18 19:32:54,585 - websockets.server - INFO - connection open
2025-05-18 19:32:54,770 - websockets.server - INFO - connection closed
2025-05-18 19:32:55,158 - websockets.server - INFO - connection closed
2025-05-18 19:33:22,017 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"","mode":"basic","basic_prompt":"bạn là người phản biệ
2025-05-18 19:33:22,018 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,018 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,019 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 19:33:22,019 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 19:33:22,020 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: bạn là người phản biện tôi, hãy phản biện mọi thứ tôi nói...
2025-05-18 19:33:22,020 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:33:22,020 - websocket_server - INFO - Session ID nhận được: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:33:22,021 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 19:33:22,021 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 19:33:22,022 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: bạn là người phản biện tôi, hãy phản biện mọi thứ tôi nói...
2025-05-18 19:33:22,022 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 19:33:22,022 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 19:33:22,023 - websocket_server - INFO - Kích thước system prompt: 57 ký tự
2025-05-18 19:33:22,023 - websocket_server - INFO - Tổng kích thước: 65 ký tự
2025-05-18 19:33:22,023 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:33:29,390 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:33:29,391 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:33:29,392 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:33:29,392 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,112 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /think","session_id":"","mode":"basic","basic_prompt":"bạn là người phản biện t
2025-05-18 19:34:02,113 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,113 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,114 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: xin chào /think...
2025-05-18 19:34:02,114 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /think, enable_thinking=True, mode=basic
2025-05-18 19:34:02,115 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: bạn là người phản biện tôi, hãy phản biện mọi thứ tôi nói...
2025-05-18 19:34:02,115 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /think', phòng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:34:02,116 - websocket_server - INFO - Session ID nhận được: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:02,116 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: xin chào
2025-05-18 19:34:02,116 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: True
2025-05-18 19:34:02,117 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: bạn là người phản biện tôi, hãy phản biện mọi thứ tôi nói...
2025-05-18 19:34:02,117 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 19:34:02,119 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193402.txt
2025-05-18 19:34:02,119 - websocket_server - INFO - Kích thước prompt: 48 ký tự
2025-05-18 19:34:02,119 - websocket_server - INFO - Kích thước system prompt: 57 ký tự
2025-05-18 19:34:02,119 - websocket_server - INFO - Tổng kích thước: 105 ký tự
2025-05-18 19:34:02,120 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:34:18,919 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:34:18,919 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:34:18,920 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:34:18,921 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,421 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 19:34:42,422 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 19:34:42,422 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:34:42,423 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193442.txt
2025-05-18 19:34:42,424 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:34:42,425 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,451 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:34:42,452 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:34:42,452 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depart...
2025-05-18 19:34:42,453 - chatbot_rag - INFO - Kích thước prompt: 642 ký tự
2025-05-18 19:34:42,454 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:34:42,454 - chatbot_rag - INFO - Tổng kích thước: 2648 ký tự
2025-05-18 19:34:42,455 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193442.txt
2025-05-18 19:34:42,456 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:34:42,456 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depart...
2025-05-18 19:34:42,457 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:35:02,651 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:35:02,652 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they just said "xin chào" twice. Now, the current question is asking about the conversation history. 

First, I nee
2025-05-18 19:35:02,653 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193502.txt
2025-05-18 19:35:02,655 - chatbot_rag - INFO - [analysis_20250518_193502] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_193502_raw.txt
2025-05-18 19:35:02,655 - chatbot_rag - INFO - [analysis_20250518_193502] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they just said ...
2025-05-18 19:35:02,656 - chatbot_rag - WARNING - [analysis_20250518_193502] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:35:02,657 - chatbot_rag - INFO - [analysis_20250518_193502] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 19:35:02,657 - chatbot_rag - INFO - [analysis_20250518_193502] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 19:35:02,657 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 19:35:02,658 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:02,663 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:35:02,664 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:35:02,664 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:02,665 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_193502.txt
2025-05-18 19:35:02,665 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 19:35:02,666 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:35:02,666 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 19:35:02,667 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193502.txt
2025-05-18 19:35:02,668 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:35:02,668 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 19:35:02,668 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:35:30,480 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:35:30,481 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user asked a general question about the process or stages. They provided some info on the main stages and the list of departments. The instructions say to focus on the str
2025-05-18 19:35:30,482 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193530.txt
2025-05-18 19:35:30,762 - websocket_server - INFO - Đã trích xuất thinking (913 ký tự) và còn lại 595 ký tự phản hồi
2025-05-18 19:35:30,762 - websocket_server - INFO - Đã trích xuất phần thinking (913 ký tự) từ phản hồi handle_general_query
2025-05-18 19:35:30,763 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747571682420_2owz3qr
2025-05-18 19:35:30,763 - websocket_server - INFO - Đã gửi nội dung thinking (913 ký tự)
2025-05-18 19:35:30,765 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:35:30,765 - websockets.server - INFO - connection closed
2025-05-18 19:35:30,766 - websockets.server - INFO - connection open
2025-05-18 19:35:30,767 - websockets.server - INFO - connection open
2025-05-18 19:35:30,768 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:35:30,769 - websockets.server - INFO - connection closed
2025-05-18 19:35:31,088 - websockets.server - INFO - connection closed
2025-05-18 19:35:31,747 - websockets.server - INFO - connection open
2025-05-18 19:35:33,183 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think","session_id":"","mode":"workf
2025-05-18 19:35:33,183 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,184 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,184 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /n...
2025-05-18 19:35:33,184 - websocket_server - INFO - Nhận tin nhắn thông thường: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think, enable_thinking=False, mode=workflow
2025-05-18 19:35:33,185 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:35:33,186 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193533.txt
2025-05-18 19:35:33,187 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,187 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:33,188 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:35:33,188 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think"

        Phân t...
2025-05-18 19:35:33,188 - chatbot_rag - INFO - Kích thước prompt: 699 ký tự
2025-05-18 19:35:33,189 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:35:33,189 - chatbot_rag - INFO - Tổng kích thước: 2705 ký tự
2025-05-18 19:35:33,191 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193533.txt
2025-05-18 19:35:33,191 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:35:33,192 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think"

        Phân t...
2025-05-18 19:35:33,192 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:35:46,813 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:35:46,815 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}
2025-05-18 19:35:46,817 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193546.txt
2025-05-18 19:35:46,821 - chatbot_rag - INFO - [analysis_20250518_193546] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_193546_raw.txt
2025-05-18 19:35:46,823 - chatbot_rag - INFO - [analysis_20250518_193546] Phản hồi gốc: <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}...
2025-05-18 19:35:46,823 - chatbot_rag - WARNING - [analysis_20250518_193546] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:35:46,824 - chatbot_rag - INFO - [analysis_20250518_193546] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 19:35:46,824 - chatbot_rag - INFO - [analysis_20250518_193546] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': '2D', 'query_type': 'department_specific', 'error': False}
2025-05-18 19:35:46,825 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-18 19:35:46,825 - websocket_server - INFO - Tin nhắn thông thường (không phải JSON) được xử lý với chế độ mặc định: workflow
2025-05-18 19:35:46,826 - websocket_server - INFO - Xử lý streaming response cho: 'Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think', phòng ban: 2D, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: workflow
2025-05-18 19:35:46,827 - websocket_server - INFO - Session ID nhận được: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,827 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
2025-05-18 19:35:46,828 - websocket_server - INFO - Xử lý streaming response. Query: 'Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc', Mode: workflow, Thinking: False
2025-05-18 19:35:46,829 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:35:46,831 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193546.txt
2025-05-18 19:35:46,832 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-18 19:35:46,835 - websocket_server - INFO - Query thực tế gửi đến mô hình: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think
2025-05-18 19:35:46,836 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: 2D, chế độ thinking: False
2025-05-18 19:35:46,837 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: 2D, Session: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,842 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:35:46,843 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-18 19:35:46,844 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-18 19:35:46,849 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-18 19:35:46,850 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: 2D, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,850 - chatbot_rag - INFO - Số task: 3
2025-05-18 19:35:46,851 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:35:46,866 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session b5c00203-6d1b-47b4-a61a-026ae346ed95.
2025-05-18 19:35:46,869 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-18 19:35:46,871 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250518_193546.txt
2025-05-18 19:35:46,871 - chatbot_rag - INFO - Kích thước prompt: 2080 ký tự
2025-05-18 19:35:46,872 - chatbot_rag - INFO - Kích thước system prompt: 1212 ký tự
2025-05-18 19:35:46,872 - chatbot_rag - INFO - Tổng kích thước: 3292 ký tự
2025-05-18 19:35:46,874 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193546.txt
2025-05-18 19:35:46,874 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

DỰ ÁN ĐƯỢC CHIA THÀNH CÁC GIAI ĐOẠN CH...
2025-05-18 19:35:46,875 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think"

    THÔNG TIN PHÒ...
2025-05-18 19:35:46,875 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:36:38,321 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:36:38,325 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

👋 *Chào anh/chị 2D!* 🎨  
Anh/chị là thành viên của **phòng ban Thi công**, hãy cùng mình xem qua các task và giai đoạn liên quan nhé!

---

### 🏗️ **GIAI ĐOẠN CONSTRUCTION (THI CÔNG
2025-05-18 19:36:38,331 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193638.txt
2025-05-18 19:36:38,334 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250518_193546.txt
2025-05-18 19:36:38,335 - chatbot_rag - INFO - Thời gian truy vấn LLM: 51.49 giây
2025-05-18 19:36:38,341 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-18 19:36:38,343 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-18 19:36:38,346 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-18 19:36:42,212 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 1250 ký tự phản hồi
2025-05-18 19:36:42,212 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 19:36:42,213 - websocket_server - INFO - Đã lưu hội thoại phòng ban 2D vào lịch sử của session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:36:42,216 - websockets.server - INFO - connection open
2025-05-18 19:36:42,246 - websockets.server - INFO - connection open
2025-05-18 19:36:42,262 - websockets.server - INFO - connection open
2025-05-18 19:36:48,265 - websockets.server - INFO - connection open
2025-05-18 19:37:15,005 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 19:37:15,005 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 👋 *Chào anh/chị 2D!* 🎨  
Anh/chị là thành viên của **phòng ban Thi công**, hãy cùng mình xem qua các
2025-05-18 19:37:15,006 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-18 19:37:15,008 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193715.txt
2025-05-18 19:37:15,009 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:37:15,009 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc

👋 *Chào anh/chị 2D!* 🎨  
Anh/chị là thành viên của **phòng ban Thi công**, hãy cùng mình xem qua các task và giai đoạn liên quan nhé!

---

### 🏗️ **GIAI ĐOẠN CONSTRUCTION (THI CÔNG)**
**Mục tiêu:** Chuẩn bị kick-off nội bộ, họp cập nhật dự án, vẽ bản vẽ xin phép.

| Task ID | Tên task | Mô tả |
|--------|----------|-------|
| 2D-001 | Chuẩn bị kick-off nội bộ/ Chuẩn bị họp cập nhật dự án | Khảo sát mặt bằng. Đầu ra: Biên bản khảo sát mặt bằng |
| 2D-002 | Chuẩn bị kick-off nội bộ/ Chuẩn bị họp cập nhật dự án | Vẽ bản vẽ xin phép. Đầu ra: Bản vẽ xin phép |

---

### 📋 **GIAI ĐOẠN DEFECT-HANDOVER (XỬ LÝ LỖI & BÀN GIAO)**
**Mục tiêu:** Hoàn công với tòa nhà.

| Task ID | Tên task | Mô tả |
|--------|----------|-------|
| 2D-003 | Chuẩn bị hồ sơ Quyết toán | Điều chỉnh bản vẽ xin phép theo thực tế để làm bản vẽ hoàn công. Đầu ra: Bản vẽ hoàn công |

---

📌 **Lưu ý:**  
- Task 2D-001 và 2D-002 thuộc giai đoạn CONSTRUCTION, liên quan đến chuẩn bị trước khi thi công.  
- Task 2D-003 là task cuối cùng trong giai đoạn DEFECT-HANDOVER, đảm bảo hoàn công chính xác.

Nếu anh/chị cần hướng dẫn chi tiết hơn về từng task hoặc liên hệ với phòng ban khác (nếu có), cứ hỏi nhé! 😄  
👉 *Đừng quên kiểm tra mục tiêu của từng task để đảm bảo tiến độ!* 🚀, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:15,013 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:15,013 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:37:15,014 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc

👋 *Chào anh/ch...
2025-05-18 19:37:15,014 - chatbot_rag - INFO - Kích thước prompt: 1952 ký tự
2025-05-18 19:37:15,015 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:37:15,015 - chatbot_rag - INFO - Tổng kích thước: 3958 ký tự
2025-05-18 19:37:15,018 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193715.txt
2025-05-18 19:37:15,018 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:37:15,019 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc

👋 *Chào anh/ch...
2025-05-18 19:37:15,019 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:37:47,791 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:37:47,792 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they were greeted and given an overview of tasks related to the "Thi công" (Construction) department. The current q
2025-05-18 19:37:47,795 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193747.txt
2025-05-18 19:37:47,798 - chatbot_rag - INFO - [analysis_20250518_193747] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_193747_raw.txt
2025-05-18 19:37:47,798 - chatbot_rag - INFO - [analysis_20250518_193747] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they were greet...
2025-05-18 19:37:47,799 - chatbot_rag - WARNING - [analysis_20250518_193747] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:37:47,799 - chatbot_rag - INFO - [analysis_20250518_193747] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 19:37:47,800 - chatbot_rag - INFO - [analysis_20250518_193747] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:37:47,800 - chatbot_rag - INFO - [analysis_20250518_193747] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 19:37:47,800 - chatbot_rag - WARNING - [analysis_20250518_193747] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 19:37:47,801 - chatbot_rag - INFO - [analysis_20250518_193747] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 19:37:47,806 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:37:47,807 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:37:47,808 - chatbot_rag - INFO - [analysis_20250518_193747] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: 2D
2025-05-18 19:37:47,809 - chatbot_rag - ERROR - [analysis_20250518_193747] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 19:37:47,809 - chatbot_rag - WARNING - [analysis_20250518_193747] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 19:37:47,810 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 19:37:47,810 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:47,814 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:37:47,814 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:37:47,815 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:37:47,816 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_193747.txt
2025-05-18 19:37:47,817 - chatbot_rag - INFO - Kích thước prompt: 2272 ký tự
2025-05-18 19:37:47,817 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:37:47,817 - chatbot_rag - INFO - Tổng kích thước: 3188 ký tự
2025-05-18 19:37:47,818 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_193747.txt
2025-05-18 19:37:47,819 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:37:47,819 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "👋 *Chào anh/chị 2D!* 🎨  
Anh/chị là thành viên của **phòng ban Thi công**, hãy cùng mình xem qua các task và giai đoạn liên quan nhé!

---

### 🏗️ **GIAI ĐOẠN CONSTRUCTION (THI CÔNG)**
**Mụ...
2025-05-18 19:37:47,820 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:39:00,771 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:39:00,776 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user provided a detailed query about the construction and defect-handover phases in a company's workflow, specifically mentioning tasks related to 2D and other
2025-05-18 19:39:00,779 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_193900.txt
2025-05-18 19:39:00,814 - websocket_server - INFO - Đã trích xuất thinking (2262 ký tự) và còn lại 937 ký tự phản hồi
2025-05-18 19:39:00,814 - websocket_server - INFO - Đã trích xuất phần thinking (2262 ký tự) từ phản hồi handle_general_query
2025-05-18 19:39:00,815 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747571835003_8n53b3n
2025-05-18 19:39:00,823 - websocket_server - INFO - Đã gửi nội dung thinking (2262 ký tự)
2025-05-18 19:39:00,838 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"","mode":"basic","basic_prompt":"Bạn là một trợ lý AI 
2025-05-18 19:39:00,838 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,839 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,839 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 19:39:00,840 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 19:39:00,841 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:39:00,842 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95, mode: basic
2025-05-18 19:39:00,842 - websocket_server - INFO - Session ID nhận được: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:00,842 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 19:39:00,843 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 19:39:00,843 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:39:00,844 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-18 19:39:00,846 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_193900.txt
2025-05-18 19:39:00,848 - websocket_server - INFO - Kích thước prompt: 129 ký tự
2025-05-18 19:39:00,849 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 19:39:00,850 - websocket_server - INFO - Tổng kích thước: 303 ký tự
2025-05-18 19:39:00,850 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:39:00,871 - websockets.server - INFO - connection open
2025-05-18 19:39:00,886 - websockets.server - INFO - connection open
2025-05-18 19:39:12,595 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:39:12,598 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:39:12,599 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:39:12,599 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:39:17,647 - websockets.server - INFO - connection open
2025-05-18 19:39:35,609 - websockets.server - INFO - connection open
2025-05-18 19:40:00,555 - websockets.server - INFO - connection open
2025-05-18 19:46:06,164 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 19:46:06,166 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 19:46:06,167 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-18 19:46:06,169 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_194606.txt
2025-05-18 19:46:06,170 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:46:06,170 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
Người dùng: xin chào

, session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:46:06,172 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
Người dùng: xin...
2025-05-18 19:46:06,173 - chatbot_rag - INFO - Kích thước prompt: 723 ký tự
2025-05-18 19:46:06,174 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:46:06,174 - chatbot_rag - INFO - Tổng kích thước: 2729 ký tự
2025-05-18 19:46:06,178 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194606.txt
2025-05-18 19:46:06,179 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:46:06,180 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
Người dùng: xin...
2025-05-18 19:46:06,181 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:46:27,518 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:46:27,519 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they mentioned being a 2D employee and asked for guidance on their work. Now, the current question is just "Lịch sử
2025-05-18 19:46:27,520 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194627.txt
2025-05-18 19:46:27,523 - chatbot_rag - INFO - [analysis_20250518_194627] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_194627_raw.txt
2025-05-18 19:46:27,523 - chatbot_rag - INFO - [analysis_20250518_194627] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they mentioned ...
2025-05-18 19:46:27,523 - chatbot_rag - WARNING - [analysis_20250518_194627] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:46:27,524 - chatbot_rag - INFO - [analysis_20250518_194627] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 19:46:27,524 - chatbot_rag - INFO - [analysis_20250518_194627] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:46:27,525 - chatbot_rag - INFO - [analysis_20250518_194627] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 19:46:27,525 - chatbot_rag - WARNING - [analysis_20250518_194627] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 19:46:27,525 - chatbot_rag - INFO - [analysis_20250518_194627] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 19:46:27,536 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:46:27,537 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:46:27,538 - chatbot_rag - INFO - [analysis_20250518_194627] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: 2D
2025-05-18 19:46:27,538 - chatbot_rag - ERROR - [analysis_20250518_194627] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 19:46:27,539 - chatbot_rag - WARNING - [analysis_20250518_194627] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 19:46:27,539 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 19:46:27,539 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:27,542 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:46:27,542 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:46:27,544 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b5c00203-6d1b-47b4-a61a-026ae346ed95
2025-05-18 19:46:27,546 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_194627.txt
2025-05-18 19:46:27,546 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 19:46:27,546 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:46:27,547 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 19:46:27,549 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194627.txt
2025-05-18 19:46:27,549 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:46:27,550 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 19:46:27,550 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:46:51,125 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,132 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,132 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,133 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,135 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,135 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,136 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,138 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,139 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,140 - websockets.server - INFO - connection closed
2025-05-18 19:46:51,142 - websockets.server - INFO - server closing
2025-05-18 19:46:51,144 - websockets.server - INFO - server closed
2025-05-18 19:46:51,152 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 19:46:51,382 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-81' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1341, in <module>
    ping_timeout=6000,  # Tăng thời gian timeout lên 6000 giây
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1115, in handle_message
    """Xử lý các tin nhắn WebSocket"""
  File "server.py", line 981, in handle_action
    session_id = data.get('session_id', current_session_id)
  File "server.py", line 849, in handle_thinking_request
    - Thông tin về quy trình, nhiệm vụ hoặc trách nhiệm của phòng ban {department}
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 443, in handle_general_query
    final_response = query_llm(user_prompt, system_prompt)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 19:46:54,063 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 19:46:54,086 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:46:54,087 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 19:46:54,087 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 19:47:05,963 - websockets.server - INFO - connection open
2025-05-18 19:47:12,303 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"","mode":"workflow"}
2025-05-18 19:47:12,304 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,304 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,304 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 19:47:12,305 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=workflow
2025-05-18 19:47:12,306 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 19:47:12,306 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,347 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:12,350 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:47:12,352 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 19:47:12,353 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 19:47:12,354 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:47:12,354 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-18 19:47:12,356 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194712.txt
2025-05-18 19:47:12,357 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:47:12,358 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 19:47:12,360 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:47:26,938 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:47:26,939 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 19:47:26,940 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194726.txt
2025-05-18 19:47:26,944 - chatbot_rag - INFO - [analysis_20250518_194726] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_194726_raw.txt
2025-05-18 19:47:26,945 - chatbot_rag - INFO - [analysis_20250518_194726] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 19:47:26,945 - chatbot_rag - WARNING - [analysis_20250518_194726] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:47:26,946 - chatbot_rag - INFO - [analysis_20250518_194726] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 19:47:26,946 - chatbot_rag - INFO - [analysis_20250518_194726] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 19:47:26,947 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 19:47:26,947 - websocket_server - INFO - Tin nhắn thông thường (không phải JSON) được xử lý với chế độ mặc định: workflow
2025-05-18 19:47:26,947 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320, mode: workflow
2025-05-18 19:47:26,948 - websocket_server - INFO - Session ID nhận được: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,948 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 19:47:26,948 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: workflow, Thinking: False
2025-05-18 19:47:26,949 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 19:47:26,949 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,950 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:26,950 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:47:26,951 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 19:47:26,951 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-18 19:47:26,951 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:47:26,952 - chatbot_rag - INFO - Tổng kích thước: 2595 ký tự
2025-05-18 19:47:26,953 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194726.txt
2025-05-18 19:47:26,953 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:47:26,954 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 19:47:26,954 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:47:39,936 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:47:39,937 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this. The user's current question is "xin chào" which means "hello" in Vietnamese. The history of messages is empty, so there's no prior context about any department or spec
2025-05-18 19:47:39,938 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194739.txt
2025-05-18 19:47:39,941 - chatbot_rag - INFO - [analysis_20250518_194739] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_194739_raw.txt
2025-05-18 19:47:39,942 - chatbot_rag - INFO - [analysis_20250518_194739] Phản hồi gốc: <think>
Okay, let's tackle this. The user's current question is "xin chào" which means "hello" in Vi...
2025-05-18 19:47:39,943 - chatbot_rag - WARNING - [analysis_20250518_194739] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:47:39,944 - chatbot_rag - INFO - [analysis_20250518_194739] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 19:47:39,945 - chatbot_rag - INFO - [analysis_20250518_194739] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:47:39,945 - chatbot_rag - INFO - [analysis_20250518_194739] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 19:47:39,945 - chatbot_rag - WARNING - [analysis_20250518_194739] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 19:47:39,946 - chatbot_rag - INFO - [analysis_20250518_194739] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 19:47:39,956 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:47:39,956 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:47:39,957 - chatbot_rag - ERROR - [analysis_20250518_194739] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 19:47:39,957 - chatbot_rag - WARNING - [analysis_20250518_194739] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 19:47:39,958 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 19:47:39,963 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-18 19:47:39,964 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 19:47:39,964 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:39,968 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:47:39,969 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:47:39,969 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:47:39,971 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_194739.txt
2025-05-18 19:47:39,972 - chatbot_rag - INFO - Kích thước prompt: 1033 ký tự
2025-05-18 19:47:39,972 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:47:39,972 - chatbot_rag - INFO - Tổng kích thước: 1949 ký tự
2025-05-18 19:47:39,974 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194739.txt
2025-05-18 19:47:39,974 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:47:39,975 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 19:47:39,976 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:47:58,938 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:47:58,939 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

 Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Ma
2025-05-18 19:47:58,944 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194758.txt
2025-05-18 19:47:59,295 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 469 ký tự phản hồi
2025-05-18 19:47:59,296 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: Xin chào! 😊  
Chào mừng bạn đến với quy trình làm ...
2025-05-18 19:47:59,296 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 19:47:59,296 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,095 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /think","session_id":"","mode":"basic","basic_prompt":"Bạn là một trợ lý AI hữu
2025-05-18 19:48:17,096 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,096 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,096 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: xin chào /think...
2025-05-18 19:48:17,097 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /think, enable_thinking=True, mode=basic
2025-05-18 19:48:17,097 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:48:17,098 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /think', phòng ban: None, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320, mode: basic
2025-05-18 19:48:17,098 - websocket_server - INFO - Session ID nhận được: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:17,099 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: xin chào
2025-05-18 19:48:17,099 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: True
2025-05-18 19:48:17,100 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:48:17,100 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 19:48:17,102 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_194817.txt
2025-05-18 19:48:17,103 - websocket_server - INFO - Kích thước prompt: 48 ký tự
2025-05-18 19:48:17,103 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 19:48:17,104 - websocket_server - INFO - Tổng kích thước: 222 ký tự
2025-05-18 19:48:17,104 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:48:26,200 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:48:26,201 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:48:26,203 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:48:26,203 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,214 - websocket_server - WARNING - Session  không tồn tại, sử dụng session hiện tại
2025-05-18 19:48:26,215 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai t
2025-05-18 19:48:26,224 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:48:26,234 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_194826.txt
2025-05-18 19:48:26,235 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:48:26,235 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai đoạn nào?" hoặc "Phòng Kinh doanh có những bước gì?"  

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: **"Phòng X làm gì trong giai đoạn Y?"** 💡

---  
🌟 *Nếu bạn muốn nói chuyện vui vẻ thay vì hỏi về công việc, mình cũng sẵn sàng! 😄*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:48:26,236 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:48:26,237 - chatbot_rag - INFO - Kích thước prompt: 1111 ký tự
2025-05-18 19:48:26,237 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:48:26,238 - chatbot_rag - INFO - Tổng kích thước: 3117 ký tự
2025-05-18 19:48:26,239 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194826.txt
2025-05-18 19:48:26,239 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:48:26,240 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:48:26,240 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:48:51,584 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:48:51,585 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted and the assistant responded with an introduction about the company's workflow. The current question is
2025-05-18 19:48:51,587 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194851.txt
2025-05-18 19:48:51,590 - chatbot_rag - INFO - [analysis_20250518_194851] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_194851_raw.txt
2025-05-18 19:48:51,591 - chatbot_rag - INFO - [analysis_20250518_194851] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted an...
2025-05-18 19:48:51,591 - chatbot_rag - WARNING - [analysis_20250518_194851] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:48:51,591 - chatbot_rag - INFO - [analysis_20250518_194851] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 19:48:51,592 - chatbot_rag - INFO - [analysis_20250518_194851] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:48:51,592 - chatbot_rag - INFO - [analysis_20250518_194851] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 19:48:51,593 - chatbot_rag - WARNING - [analysis_20250518_194851] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 19:48:51,593 - chatbot_rag - INFO - [analysis_20250518_194851] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 19:48:51,597 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:48:51,598 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:48:51,599 - chatbot_rag - INFO - [analysis_20250518_194851] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Kinh doanh
2025-05-18 19:48:51,599 - chatbot_rag - ERROR - [analysis_20250518_194851] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 19:48:51,600 - chatbot_rag - WARNING - [analysis_20250518_194851] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 19:48:51,600 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 19:48:51,600 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:51,604 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:48:51,605 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:48:51,605 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:48:51,607 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_194851.txt
2025-05-18 19:48:51,609 - chatbot_rag - INFO - Kích thước prompt: 1491 ký tự
2025-05-18 19:48:51,609 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:48:51,610 - chatbot_rag - INFO - Tổng kích thước: 2407 ký tự
2025-05-18 19:48:51,611 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194851.txt
2025-05-18 19:48:51,612 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:48:51,613 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing t...
2025-05-18 19:48:51,613 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:49:33,686 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:49:33,687 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a detailed query about the company's workflow and departments. They want me to follow specific rules: not create connections between departments and stages, 
2025-05-18 19:49:33,688 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_194933.txt
2025-05-18 19:49:33,695 - websocket_server - INFO - Đã trích xuất thinking (1466 ký tự) và còn lại 522 ký tự phản hồi
2025-05-18 19:49:33,695 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: ### Giai đoạn và phòng ban liên quan  
- **MKT-SAL...
2025-05-18 19:49:33,695 - websocket_server - INFO - Đã trích xuất phần thinking (1466 ký tự) từ phản hồi handle_general_query
2025-05-18 19:49:33,696 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747572505514_fh4su4a
2025-05-18 19:49:33,697 - websocket_server - INFO - Đã gửi nội dung thinking (1466 ký tự)
2025-05-18 19:49:33,705 - websocket_server - INFO - WebSocket connection closed
2025-05-18 19:49:33,706 - websockets.server - INFO - connection closed
2025-05-18 19:49:33,708 - websockets.server - INFO - connection open
2025-05-18 19:49:46,596 - websockets.server - INFO - connection closed
2025-05-18 19:49:47,465 - websockets.server - INFO - connection open
2025-05-18 19:49:56,938 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai t
2025-05-18 19:49:56,939 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:49:56,941 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_194956.txt
2025-05-18 19:49:56,942 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:49:56,942 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai đoạn nào?" hoặc "Phòng Kinh doanh có những bước gì?"  

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: **"Phòng X làm gì trong giai đoạn Y?"** 💡

---  
🌟 *Nếu bạn muốn nói chuyện vui vẻ thay vì hỏi về công việc, mình cũng sẵn sàng! 😄*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:49:56,943 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:49:56,944 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:49:56,944 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:49:56,944 - chatbot_rag - INFO - Kích thước prompt: 1111 ký tự
2025-05-18 19:49:56,945 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:49:56,945 - chatbot_rag - INFO - Tổng kích thước: 3117 ký tự
2025-05-18 19:49:56,947 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_194956.txt
2025-05-18 19:49:56,947 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:49:56,948 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:49:56,948 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:50:24,494 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:50:24,495 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this. The user provided a history of messages where they greeted and the assistant responded with an introduction about the workflow process. The current question is the sam
2025-05-18 19:50:24,497 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_195024.txt
2025-05-18 19:50:24,500 - chatbot_rag - INFO - [analysis_20250518_195024] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_195024_raw.txt
2025-05-18 19:50:24,501 - chatbot_rag - INFO - [analysis_20250518_195024] Phản hồi gốc: <think>
Okay, let's tackle this. The user provided a history of messages where they greeted and the ...
2025-05-18 19:50:24,501 - chatbot_rag - WARNING - [analysis_20250518_195024] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 19:50:24,501 - chatbot_rag - INFO - [analysis_20250518_195024] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 19:50:24,502 - chatbot_rag - INFO - [analysis_20250518_195024] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 19:50:24,502 - chatbot_rag - INFO - [analysis_20250518_195024] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 19:50:24,502 - chatbot_rag - WARNING - [analysis_20250518_195024] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 19:50:24,503 - chatbot_rag - INFO - [analysis_20250518_195024] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 19:50:24,514 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:50:24,515 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:50:24,516 - chatbot_rag - INFO - [analysis_20250518_195024] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Kinh doanh
2025-05-18 19:50:24,516 - chatbot_rag - ERROR - [analysis_20250518_195024] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 19:50:24,516 - chatbot_rag - WARNING - [analysis_20250518_195024] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 19:50:24,517 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 19:50:24,518 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:50:24,523 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 19:50:24,523 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 19:50:24,523 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:50:24,527 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_195024.txt
2025-05-18 19:50:24,527 - chatbot_rag - INFO - Kích thước prompt: 1491 ký tự
2025-05-18 19:50:24,528 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 19:50:24,528 - chatbot_rag - INFO - Tổng kích thước: 2407 ký tự
2025-05-18 19:50:24,530 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_195024.txt
2025-05-18 19:50:24,531 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 19:50:24,532 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing t...
2025-05-18 19:50:24,532 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 19:53:12,960 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 19:53:12,970 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a detailed prompt about the company's departments and processes. They want me to act as an AI assistant that focuses on describing stages and responsible dep
2025-05-18 19:53:12,975 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_195312.txt
2025-05-18 19:53:13,010 - websocket_server - INFO - Đã trích xuất thinking (8613 ký tự) và còn lại 583 ký tự phản hồi
2025-05-18 19:53:13,013 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: # Giai đoạn chính trong quy trình làm việc  
1. **...
2025-05-18 19:53:13,014 - websocket_server - INFO - Đã trích xuất phần thinking (8613 ký tự) từ phản hồi handle_general_query
2025-05-18 19:53:13,014 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747572596937_9xj74fv
2025-05-18 19:53:13,023 - websocket_server - INFO - Đã gửi nội dung thinking (8613 ký tự)
2025-05-18 19:53:13,045 - websockets.server - INFO - connection open
2025-05-18 19:53:13,065 - websockets.server - INFO - connection open
2025-05-18 19:53:13,091 - websockets.server - INFO - connection open
2025-05-18 19:53:13,120 - websockets.server - INFO - connection open
2025-05-18 19:53:13,137 - websockets.server - INFO - connection open
2025-05-18 19:53:18,270 - websockets.server - INFO - connection open
2025-05-18 19:53:26,049 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai t
2025-05-18 19:53:26,050 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:53:26,052 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_195326.txt
2025-05-18 19:53:26,052 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:53:26,053 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

Nếu bạn muốn biết về vai trò của từng phòng ban trong các giai đoạn cụ thể, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai đoạn nào?" hoặc "Phòng Kinh doanh có những bước gì?"  

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: **"Phòng X làm gì trong giai đoạn Y?"** 💡

---  
🌟 *Nếu bạn muốn nói chuyện vui vẻ thay vì hỏi về công việc, mình cũng sẵn sàng! 😄*, session_id: fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:53:26,054 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session fb0f8f95-cd33-4dba-9843-f75ba9898320
2025-05-18 19:53:26,054 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:53:26,055 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:53:26,056 - chatbot_rag - INFO - Kích thước prompt: 1111 ký tự
2025-05-18 19:53:26,056 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:53:26,056 - chatbot_rag - INFO - Tổng kích thước: 3117 ký tự
2025-05-18 19:53:26,059 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_195326.txt
2025-05-18 19:53:26,060 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:53:26,061 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: xin chào

Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  

...
2025-05-18 19:53:26,061 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 19:53:53,583 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,592 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,593 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,594 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,595 - websockets.server - INFO - connection closed
2025-05-18 19:53:53,598 - websockets.server - INFO - server closing
2025-05-18 19:53:53,599 - websockets.server - INFO - server closed
2025-05-18 19:53:53,605 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 19:53:53,701 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-47' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1356, in <module>
    asyncio.run(main())
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1130, in handle_message
    await handle_action(websocket, data['action'], data)
  File "server.py", line 996, in handle_action
    await handle_thinking_request(websocket, query, session_id, request_id)
  File "server.py", line 778, in handle_thinking_request
    analysis_result = analyze_query_with_llm(content_with_history, session_id)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 1059, in analyze_query_with_llm
    response_text = query_llm(prompt, system_prompt, max_tokens=200, stream=False)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 19:54:03,498 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 19:54:03,543 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 19:54:03,544 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 19:54:03,545 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 19:54:21,836 - websockets.server - INFO - connection open
2025-05-18 19:54:30,823 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","bas
2025-05-18 19:54:30,824 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:54:30,825 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: xin chào /think...
2025-05-18 19:54:30,826 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /think, enable_thinking=True, mode=basic
2025-05-18 19:54:30,826 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:54:30,827 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /think', phòng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 19:54:30,827 - websocket_server - INFO - Session ID nhận được: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:54:30,827 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: xin chào
2025-05-18 19:54:30,828 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: True
2025-05-18 19:54:30,828 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:54:30,829 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 19:54:30,830 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 19:54:30,830 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 19:54:30,830 - websocket_server - INFO - Tổng kích thước: 182 ký tự
2025-05-18 19:54:30,831 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:54:40,426 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:54:40,428 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:54:40,429 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: True, thinking_collected: False
2025-05-18 19:54:40,429 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:55:23,506 - websockets.server - INFO - connection closed
2025-05-18 19:55:24,490 - websockets.server - INFO - connection open
2025-05-18 19:55:27,083 - websockets.server - INFO - connection closed
2025-05-18 19:55:27,944 - websockets.server - INFO - connection open
2025-05-18 19:55:30,938 - websockets.server - INFO - connection closed
2025-05-18 19:55:31,714 - websockets.server - INFO - connection open
2025-05-18 19:56:25,724 - websockets.server - INFO - connection open
2025-05-18 19:57:03,702 - websockets.server - INFO - connection open
2025-05-18 19:57:33,876 - websockets.server - INFO - connection open
2025-05-18 19:58:35,737 - websockets.server - INFO - connection open
2025-05-18 19:58:59,226 - websockets.server - INFO - connection open
2025-05-18 19:59:11,618 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,619 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,619 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:11,620 - websockets.server - INFO - connection closed
2025-05-18 19:59:12,896 - websockets.server - INFO - connection open
2025-05-18 19:59:23,349 - websockets.server - INFO - connection closed
2025-05-18 19:59:24,094 - websockets.server - INFO - connection open
2025-05-18 19:59:31,703 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"mày là ai /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic",
2025-05-18 19:59:31,706 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:31,706 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: mày là ai /no_think...
2025-05-18 19:59:31,708 - websocket_server - INFO - Nhận tin nhắn thông thường: mày là ai /no_think, enable_thinking=False, mode=basic
2025-05-18 19:59:31,708 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:59:31,710 - websocket_server - INFO - Xử lý streaming response cho: 'mày là ai /no_think', phòng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 19:59:31,711 - websocket_server - INFO - Session ID nhận được: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:31,711 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: mày là ai
2025-05-18 19:59:31,712 - websocket_server - INFO - Xử lý streaming response. Query: 'mày là ai', Mode: basic, Thinking: False
2025-05-18 19:59:31,713 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 19:59:31,714 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 19:59:31,726 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_195931.txt
2025-05-18 19:59:31,727 - websocket_server - INFO - Kích thước prompt: 49 ký tự
2025-05-18 19:59:31,728 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 19:59:31,728 - websocket_server - INFO - Tổng kích thước: 223 ký tự
2025-05-18 19:59:31,729 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 19:59:40,797 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 19:59:40,800 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 19:59:40,801 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 19:59:40,801 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,632 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 19:59:55,633 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 19:59:55,635 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_195955.txt
2025-05-18 19:59:55,635 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 19:59:55,640 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai

, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,684 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 19:59:55,685 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 19:59:55,686 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depar...
2025-05-18 19:59:55,687 - chatbot_rag - INFO - Kích thước prompt: 643 ký tự
2025-05-18 19:59:55,687 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 19:59:55,687 - chatbot_rag - INFO - Tổng kích thước: 2649 ký tự
2025-05-18 19:59:55,690 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_195955.txt
2025-05-18 19:59:55,690 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 19:59:55,692 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depar...
2025-05-18 19:59:55,692 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 20:00:17,075 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 20:00:17,077 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted and asked "mày là ai" (which means "who are you" in Vietnamese). Now, the current question is about an
2025-05-18 20:00:17,079 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_200017.txt
2025-05-18 20:00:17,081 - chatbot_rag - INFO - [analysis_20250518_200017] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_200017_raw.txt
2025-05-18 20:00:17,081 - chatbot_rag - INFO - [analysis_20250518_200017] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they greeted an...
2025-05-18 20:00:17,082 - chatbot_rag - WARNING - [analysis_20250518_200017] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 20:00:17,083 - chatbot_rag - INFO - [analysis_20250518_200017] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 20:00:17,084 - chatbot_rag - INFO - [analysis_20250518_200017] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 20:00:17,084 - chatbot_rag - INFO - [analysis_20250518_200017] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 20:00:17,085 - chatbot_rag - WARNING - [analysis_20250518_200017] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 20:00:17,085 - chatbot_rag - INFO - [analysis_20250518_200017] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 20:00:17,092 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 20:00:17,092 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 20:00:17,093 - chatbot_rag - ERROR - [analysis_20250518_200017] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 20:00:17,094 - chatbot_rag - WARNING - [analysis_20250518_200017] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 20:00:17,094 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 20:00:17,094 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:00:17,097 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 20:00:17,097 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 20:00:17,098 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:00:17,099 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_200017.txt
2025-05-18 20:00:17,099 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 20:00:17,100 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 20:00:17,100 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 20:00:17,101 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_200017.txt
2025-05-18 20:00:17,101 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 20:00:17,102 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 20:00:17,102 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 20:00:37,159 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 20:00:37,167 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break down the user's query. They provided a structure of departments and process stages but didn't ask a specific question. The previous response was in Vietnamese, so I need to m
2025-05-18 20:00:37,169 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_200037.txt
2025-05-18 20:00:37,814 - websocket_server - INFO - Đã trích xuất thinking (742 ký tự) và còn lại 220 ký tự phản hồi
2025-05-18 20:00:37,815 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: 😅 *Câu hỏi chưa rõ ràng lắm nha! Bạn muốn biết gì ...
2025-05-18 20:00:37,815 - websocket_server - INFO - Đã trích xuất phần thinking (742 ký tự) từ phản hồi handle_general_query
2025-05-18 20:00:37,816 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747573195630_dcnwq96
2025-05-18 20:00:37,817 - websocket_server - INFO - Đã gửi nội dung thinking (742 ký tự)
2025-05-18 20:03:40,755 - websockets.server - INFO - connection open
2025-05-18 20:04:20,973 - websockets.server - INFO - connection closed
2025-05-18 20:04:20,974 - websockets.server - INFO - connection closed
2025-05-18 20:04:22,346 - websockets.server - INFO - connection open
2025-05-18 20:04:42,427 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","
2025-05-18 20:04:42,429 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:04:42,430 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 20:04:42,431 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 20:04:42,432 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:04:42,433 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 20:04:42,434 - websocket_server - INFO - Session ID nhận được: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:04:42,434 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 20:04:42,435 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 20:04:42,435 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:04:42,436 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-18 20:04:42,444 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_200442.txt
2025-05-18 20:04:42,446 - websocket_server - INFO - Kích thước prompt: 70 ký tự
2025-05-18 20:04:42,449 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 20:04:42,450 - websocket_server - INFO - Tổng kích thước: 244 ký tự
2025-05-18 20:04:42,450 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 20:04:52,670 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 20:04:52,673 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 20:04:52,674 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:04:52,676 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,290 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 20:05:07,291 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-18 20:05:07,300 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_200507.txt
2025-05-18 20:05:07,300 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 20:05:07,301 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai
Người dùng: xin chào

, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,302 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:07,302 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 20:05:07,303 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định ...
2025-05-18 20:05:07,304 - chatbot_rag - INFO - Kích thước prompt: 664 ký tự
2025-05-18 20:05:07,305 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 20:05:07,307 - chatbot_rag - INFO - Tổng kích thước: 2670 ký tự
2025-05-18 20:05:07,311 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_200507.txt
2025-05-18 20:05:07,312 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 20:05:07,313 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: mày là ai
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định ...
2025-05-18 20:05:07,314 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 20:05:28,821 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 20:05:28,822 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they just said "xin chào" (hello) multiple times and asked "mày là ai" (who are you). Now, the current questi
2025-05-18 20:05:28,823 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_200528.txt
2025-05-18 20:05:28,825 - chatbot_rag - INFO - [analysis_20250518_200528] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_200528_raw.txt
2025-05-18 20:05:28,826 - chatbot_rag - INFO - [analysis_20250518_200528] Phản hồi gốc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they just...
2025-05-18 20:05:28,826 - chatbot_rag - WARNING - [analysis_20250518_200528] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 20:05:28,827 - chatbot_rag - INFO - [analysis_20250518_200528] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 20:05:28,827 - chatbot_rag - INFO - [analysis_20250518_200528] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 20:05:28,828 - chatbot_rag - INFO - [analysis_20250518_200528] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 20:05:28,828 - chatbot_rag - WARNING - [analysis_20250518_200528] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 20:05:28,829 - chatbot_rag - INFO - [analysis_20250518_200528] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 20:05:28,838 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 20:05:28,839 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 20:05:28,841 - chatbot_rag - ERROR - [analysis_20250518_200528] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 20:05:28,842 - chatbot_rag - WARNING - [analysis_20250518_200528] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 20:05:28,842 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 20:05:28,842 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:28,845 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 20:05:28,845 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 20:05:28,846 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:05:28,847 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_200528.txt
2025-05-18 20:05:28,847 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 20:05:28,848 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 20:05:28,848 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 20:05:28,850 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_200528.txt
2025-05-18 20:05:28,850 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 20:05:28,851 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 20:05:28,851 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 20:05:56,527 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 20:05:56,528 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a query that's a general question about the process or stages of work. They mentioned the main stages: MKT-SALES, PROPOSAL, CONSTRUCTION, DEFECT-HANDOVER, AF
2025-05-18 20:05:56,530 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_200556.txt
2025-05-18 20:05:56,548 - websocket_server - INFO - Đã trích xuất thinking (1123 ký tự) và còn lại 328 ký tự phản hồi
2025-05-18 20:05:56,548 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: 🌟 *Câu hỏi chung? Không sao đâu!* 😎  
*Đừng lo, mì...
2025-05-18 20:05:56,548 - websocket_server - INFO - Đã trích xuất phần thinking (1123 ký tự) từ phản hồi handle_general_query
2025-05-18 20:05:56,549 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747573507287_4w2bk6z
2025-05-18 20:05:56,549 - websocket_server - INFO - Đã gửi nội dung thinking (1123 ký tự)
2025-05-18 20:06:29,276 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"4e3c4b1b-6071-43f1-a543-4d5ebdb161c3","mode":"basic","
2025-05-18 20:06:29,278 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:06:29,278 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 20:06:29,292 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 20:06:29,293 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:06:29,293 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3, mode: basic
2025-05-18 20:06:29,293 - websocket_server - INFO - Session ID nhận được: 4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:06:29,294 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 20:06:29,294 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 20:06:29,295 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:06:29,295 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-18 20:06:29,296 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_200629.txt
2025-05-18 20:06:29,297 - websocket_server - INFO - Kích thước prompt: 91 ký tự
2025-05-18 20:06:29,297 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 20:06:29,298 - websocket_server - INFO - Tổng kích thước: 265 ký tự
2025-05-18 20:06:29,298 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 20:06:41,777 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 20:06:41,778 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 20:06:41,779 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:06:41,780 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=4e3c4b1b-6071-43f1-a543-4d5ebdb161c3
2025-05-18 20:07:09,262 - websockets.server - INFO - connection open
2025-05-18 20:07:09,282 - websockets.server - INFO - connection open
2025-05-18 20:07:32,807 - websockets.server - INFO - connection open
2025-05-18 20:08:39,387 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"chào mày /no_think","session_id":"81024cdc-6ee1-4e5a-b07d-d73db4f11a0a","mode":"basic","
2025-05-18 20:08:39,400 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:08:39,406 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: chào mày /no_think...
2025-05-18 20:08:39,407 - websocket_server - INFO - Nhận tin nhắn thông thường: chào mày /no_think, enable_thinking=False, mode=basic
2025-05-18 20:08:39,408 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:08:39,409 - websocket_server - INFO - Xử lý streaming response cho: 'chào mày /no_think', phòng ban: None, session_id: 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a, mode: basic
2025-05-18 20:08:39,410 - websocket_server - INFO - Session ID nhận được: 81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:08:39,411 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: chào mày
2025-05-18 20:08:39,421 - websocket_server - INFO - Xử lý streaming response. Query: 'chào mày', Mode: basic, Thinking: False
2025-05-18 20:08:39,422 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 20:08:39,425 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 20:08:39,427 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 20:08:39,429 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 20:08:39,430 - websocket_server - INFO - Tổng kích thước: 182 ký tự
2025-05-18 20:08:39,430 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 20:08:44,852 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 20:08:44,855 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 20:08:44,857 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 20:08:44,859 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=81024cdc-6ee1-4e5a-b07d-d73db4f11a0a
2025-05-18 20:15:25,138 - websockets.server - INFO - connection open
2025-05-18 20:15:25,251 - websockets.server - INFO - connection open
2025-05-18 20:16:29,673 - websockets.server - INFO - connection open
2025-05-18 20:16:29,741 - websockets.server - INFO - connection open
2025-05-18 20:17:21,474 - websockets.server - INFO - connection open
2025-05-18 20:17:21,508 - websockets.server - INFO - connection open
2025-05-18 20:18:07,177 - websockets.server - INFO - connection open
2025-05-18 20:18:07,198 - websockets.server - INFO - connection open
2025-05-18 20:20:16,301 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,304 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,311 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,311 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,313 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,314 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,315 - websockets.server - INFO - connection closed
2025-05-18 20:20:16,315 - websockets.server - INFO - connection closed
2025-05-18 20:20:18,236 - websockets.server - INFO - connection open
2025-05-18 20:20:38,209 - websockets.server - INFO - connection open
2025-05-18 20:21:03,893 - websockets.server - INFO - connection open
2025-05-18 20:21:31,808 - websockets.server - INFO - connection open
2025-05-18 20:22:04,762 - websockets.server - INFO - connection open
2025-05-18 20:22:32,632 - websockets.server - INFO - connection open
2025-05-18 20:22:52,279 - websockets.server - INFO - connection open
2025-05-18 20:24:28,340 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,344 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,345 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,345 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:28,346 - websockets.server - INFO - connection closed
2025-05-18 20:24:36,900 - websockets.server - INFO - connection open
2025-05-18 20:26:44,022 - websockets.server - INFO - connection open
2025-05-18 20:26:53,240 - websockets.server - INFO - connection closed
2025-05-18 20:26:53,241 - websockets.server - INFO - connection closed
2025-05-18 20:26:54,658 - websockets.server - INFO - connection open
2025-05-18 20:29:30,574 - websockets.server - INFO - connection open
2025-05-18 20:29:54,882 - websockets.server - INFO - connection open
2025-05-18 20:30:42,242 - websockets.server - INFO - connection open
2025-05-18 20:31:04,403 - websockets.server - INFO - connection open
2025-05-18 20:31:37,826 - websockets.server - INFO - connection open
2025-05-18 20:35:25,716 - websockets.server - INFO - connection open
2025-05-18 20:42:29,588 - websockets.server - INFO - connection open
2025-05-18 20:55:18,432 - websockets.server - INFO - connection open
2025-05-18 20:58:48,319 - websockets.server - INFO - connection open
2025-05-18 21:04:31,270 - websockets.server - INFO - connection open
2025-05-18 21:05:22,630 - websockets.server - INFO - connection open
2025-05-18 21:05:40,385 - websockets.server - INFO - connection open
2025-05-18 21:06:06,276 - websockets.server - INFO - connection open
2025-05-18 21:06:27,074 - websockets.server - INFO - connection open
2025-05-18 21:08:44,064 - websockets.server - INFO - connection open
2025-05-18 21:09:02,498 - websockets.server - INFO - connection open
2025-05-18 21:09:24,009 - websockets.server - INFO - connection open
2025-05-18 21:09:45,999 - websockets.server - INFO - connection open
2025-05-18 21:10:15,799 - websockets.server - INFO - connection open
2025-05-18 21:10:34,998 - websockets.server - INFO - connection open
2025-05-18 21:11:01,374 - websockets.server - INFO - connection open
2025-05-18 21:11:23,260 - websockets.server - INFO - connection open
2025-05-18 21:11:53,006 - websockets.server - INFO - connection open
2025-05-18 21:19:36,966 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,968 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,970 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,970 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,971 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,972 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,973 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,974 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,975 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,978 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,979 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,979 - websockets.server - INFO - connection closed
2025-05-18 21:19:36,984 - websockets.server - INFO - server closing
2025-05-18 21:19:36,986 - websockets.server - INFO - server closed
2025-05-18 21:19:37,011 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 21:19:39,521 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 21:19:39,549 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:19:39,549 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 21:19:39,550 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 21:19:59,371 - websockets.server - INFO - connection open
2025-05-18 21:20:07,713 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"chào mày /no_think","session_id":"273c7f89-714d-440a-841d-c86c21de1269","mode":"basic","
2025-05-18 21:20:07,714 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:07,714 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: chào mày /no_think...
2025-05-18 21:20:07,715 - websocket_server - INFO - Cập nhật chế độ của session 273c7f89-714d-440a-841d-c86c21de1269 từ workflow thành basic
2025-05-18 21:20:07,715 - websocket_server - INFO - Nhận tin nhắn thông thường: chào mày /no_think, enable_thinking=False, mode=basic
2025-05-18 21:20:07,715 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:20:07,716 - websocket_server - INFO - Xử lý streaming response cho: 'chào mày /no_think', phòng ban: None, session_id: 273c7f89-714d-440a-841d-c86c21de1269, mode: basic
2025-05-18 21:20:07,716 - websocket_server - INFO - Session ID nhận được: 273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:07,717 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: chào mày
2025-05-18 21:20:07,717 - websocket_server - INFO - Xử lý streaming response. Query: 'chào mày', Mode: basic, Thinking: False
2025-05-18 21:20:07,717 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:20:07,718 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:20:07,718 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 21:20:07,718 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 21:20:07,719 - websocket_server - INFO - Tổng kích thước: 182 ký tự
2025-05-18 21:20:07,719 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:20:13,344 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:20:13,345 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:20:13,346 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:20:13,347 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=273c7f89-714d-440a-841d-c86c21de1269
2025-05-18 21:20:13,347 - websocket_server - INFO - Cập nhật chế độ của session 273c7f89-714d-440a-841d-c86c21de1269 thành basic
2025-05-18 21:21:54,486 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"chào mày /no_think","session_id":"b63c05c6-4ded-416a-a0d1-e39b50024ddf","mode":"basic","
2025-05-18 21:21:54,488 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:21:54,489 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: chào mày /no_think...
2025-05-18 21:21:54,489 - websocket_server - INFO - Cập nhật chế độ của session b63c05c6-4ded-416a-a0d1-e39b50024ddf từ workflow thành basic
2025-05-18 21:21:54,490 - websocket_server - INFO - Nhận tin nhắn thông thường: chào mày /no_think, enable_thinking=False, mode=basic
2025-05-18 21:21:54,490 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:21:54,491 - websocket_server - INFO - Xử lý streaming response cho: 'chào mày /no_think', phòng ban: None, session_id: b63c05c6-4ded-416a-a0d1-e39b50024ddf, mode: basic
2025-05-18 21:21:54,492 - websocket_server - INFO - Session ID nhận được: b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:21:54,492 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: chào mày
2025-05-18 21:21:54,493 - websocket_server - INFO - Xử lý streaming response. Query: 'chào mày', Mode: basic, Thinking: False
2025-05-18 21:21:54,493 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:21:54,493 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:21:54,494 - websocket_server - INFO - Kích thước prompt: 8 ký tự
2025-05-18 21:21:54,495 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 21:21:54,495 - websocket_server - INFO - Tổng kích thước: 182 ký tự
2025-05-18 21:21:54,496 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:22:00,230 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:22:00,231 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:22:00,231 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:22:00,232 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=b63c05c6-4ded-416a-a0d1-e39b50024ddf
2025-05-18 21:22:00,232 - websocket_server - INFO - Cập nhật chế độ của session b63c05c6-4ded-416a-a0d1-e39b50024ddf thành basic
2025-05-18 21:25:20,294 - websockets.server - INFO - connection closed
2025-05-18 21:25:21,717 - websockets.server - INFO - connection open
2025-05-18 21:25:26,408 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"aea1cba8-b5bb-47f5-9bf2-413941d3f4a9","mode":"workflow
2025-05-18 21:25:26,410 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,411 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 21:25:26,411 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=workflow
2025-05-18 21:25:26,412 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:25:26,414 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,494 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:26,495 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:25:26,496 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 21:25:26,496 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 21:25:26,497 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:25:26,497 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-18 21:25:26,501 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212526.txt
2025-05-18 21:25:26,502 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:25:26,503 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 21:25:26,505 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:25:37,993 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:25:37,994 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 21:25:37,995 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212537.txt
2025-05-18 21:25:37,996 - chatbot_rag - INFO - [analysis_20250518_212537] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_212537_raw.txt
2025-05-18 21:25:37,996 - chatbot_rag - INFO - [analysis_20250518_212537] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 21:25:37,997 - chatbot_rag - WARNING - [analysis_20250518_212537] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:25:38,000 - chatbot_rag - INFO - [analysis_20250518_212537] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 21:25:38,000 - chatbot_rag - INFO - [analysis_20250518_212537] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:25:38,001 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 21:25:38,001 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9, mode: workflow
2025-05-18 21:25:38,002 - websocket_server - INFO - Session ID nhận được: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,002 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 21:25:38,002 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: workflow, Thinking: False
2025-05-18 21:25:38,002 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:25:38,003 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,003 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:38,004 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:25:38,004 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 21:25:38,004 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-18 21:25:38,005 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:25:38,005 - chatbot_rag - INFO - Tổng kích thước: 2595 ký tự
2025-05-18 21:25:38,007 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212538.txt
2025-05-18 21:25:38,007 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:25:38,007 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 21:25:38,008 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:25:47,461 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:25:47,462 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user sent "xin chào", which is a greeting in Vietnamese. The history doesn't mention any department or specific process. According to the rules, if there's no 
2025-05-18 21:25:47,464 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212547.txt
2025-05-18 21:25:47,485 - chatbot_rag - INFO - [analysis_20250518_212547] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_212547_raw.txt
2025-05-18 21:25:47,486 - chatbot_rag - INFO - [analysis_20250518_212547] Phản hồi gốc: <think>
Okay, let's break this down. The user sent "xin chào", which is a greeting in Vietnamese. Th...
2025-05-18 21:25:47,504 - chatbot_rag - WARNING - [analysis_20250518_212547] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:25:47,504 - chatbot_rag - INFO - [analysis_20250518_212547] Đã tìm thấy 2 mẫu JSON tiềm năng trong phản hồi
2025-05-18 21:25:47,504 - chatbot_rag - INFO - [analysis_20250518_212547] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:25:47,505 - websocket_server - INFO - THÔNG TIN XỬ LÝ TIN NHẮN:
2025-05-18 21:25:47,505 - websocket_server - INFO - - Chế độ: workflow
2025-05-18 21:25:47,505 - websocket_server - INFO - - Session ID: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,505 - websocket_server - INFO - - Trạng thái thinking: False
2025-05-18 21:25:47,506 - websocket_server - INFO - - Query chính: 'xin chào'
2025-05-18 21:25:47,506 - websocket_server - INFO - - Query gửi đến model: 'xin chào /no_think'
2025-05-18 21:25:47,506 - websocket_server - INFO - - Phòng ban phát hiện: None
2025-05-18 21:25:47,522 - websocket_server - INFO - - Loại query: general
2025-05-18 21:25:47,523 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 21:25:47,531 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 21:25:47,554 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,594 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:25:47,595 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:25:47,597 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:25:47,599 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_212547.txt
2025-05-18 21:25:47,600 - chatbot_rag - INFO - Kích thước prompt: 1033 ký tự
2025-05-18 21:25:47,600 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:25:47,601 - chatbot_rag - INFO - Tổng kích thước: 1949 ký tự
2025-05-18 21:25:47,603 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212547.txt
2025-05-18 21:25:47,603 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:25:47,604 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 21:25:47,605 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:26:04,809 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:26:04,812 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

 Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc về giai đoạn hay phòng ban nào đó, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai
2025-05-18 21:26:04,813 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212604.txt
2025-05-18 21:26:05,204 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 439 ký tự phản hồi
2025-05-18 21:26:05,204 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm ...
2025-05-18 21:26:05,204 - websocket_server - INFO - enable_thinking=False, bỏ qua nội dung thinking
2025-05-18 21:26:05,205 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:05,205 - websocket_server - INFO - Cập nhật chế độ của session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 thành workflow
2025-05-18 21:26:05,207 - websocket_server - INFO - WebSocket connection closed
2025-05-18 21:26:05,207 - websockets.server - INFO - connection closed
2025-05-18 21:26:05,208 - websockets.server - INFO - connection open
2025-05-18 21:26:13,326 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc về gia
2025-05-18 21:26:13,326 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:26:13,330 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_212613.txt
2025-05-18 21:26:13,331 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 21:26:13,331 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc về giai đoạn hay phòng ban nào đó, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai đoạn nào?" hoặc "Giai đoạn DEFECT-HANDOVER gồm những bước gì?"  

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: **"Phòng Kinh doanh làm gì trong giai đoạn MKT-SALES?"** 📌

💡 *Nếu bạn muốn nói chuyện vui vẻ, đừng ngại hỏi! 😄*, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:13,334 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:13,334 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:26:13,336 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc v...
2025-05-18 21:26:13,338 - chatbot_rag - INFO - Kích thước prompt: 1060 ký tự
2025-05-18 21:26:13,339 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:26:13,339 - chatbot_rag - INFO - Tổng kích thước: 3066 ký tự
2025-05-18 21:26:13,341 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212613.txt
2025-05-18 21:26:13,341 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:26:13,342 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc v...
2025-05-18 21:26:13,342 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:26:38,349 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:26:38,350 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where the assistant greeted them and explained how to ask questions about specific departments or processes. The current 
2025-05-18 21:26:38,353 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212638.txt
2025-05-18 21:26:38,356 - chatbot_rag - INFO - [analysis_20250518_212638] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_212638_raw.txt
2025-05-18 21:26:38,356 - chatbot_rag - INFO - [analysis_20250518_212638] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where the assistant g...
2025-05-18 21:26:38,357 - chatbot_rag - WARNING - [analysis_20250518_212638] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:26:38,358 - chatbot_rag - INFO - [analysis_20250518_212638] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 21:26:38,360 - chatbot_rag - INFO - [analysis_20250518_212638] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:26:38,361 - chatbot_rag - INFO - [analysis_20250518_212638] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 21:26:38,362 - chatbot_rag - WARNING - [analysis_20250518_212638] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 21:26:38,362 - chatbot_rag - INFO - [analysis_20250518_212638] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 21:26:38,374 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:26:38,375 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:26:38,377 - chatbot_rag - INFO - [analysis_20250518_212638] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Kinh doanh
2025-05-18 21:26:38,377 - chatbot_rag - ERROR - [analysis_20250518_212638] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 21:26:38,378 - chatbot_rag - WARNING - [analysis_20250518_212638] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 21:26:38,379 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 21:26:38,379 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:38,387 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:26:38,387 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:26:38,388 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:26:38,391 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_212638.txt
2025-05-18 21:26:38,391 - chatbot_rag - INFO - Kích thước prompt: 1461 ký tự
2025-05-18 21:26:38,391 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:26:38,392 - chatbot_rag - INFO - Tổng kích thước: 2377 ký tự
2025-05-18 21:26:38,393 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212638.txt
2025-05-18 21:26:38,394 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:26:38,394 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Xin chào!👋✨  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc về giai đoạn hay phòng ban nào đó, cứ hỏi nhé!  
Ví dụ: "Phòng Marketing tham gia giai đoạn nào...
2025-05-18 21:26:38,395 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:27:26,024 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:27:26,025 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, the user provided a detailed setup about the company's departments and processes. They want me to respond in Vietnamese using Markdown, focusing on structure without explaining specific 
2025-05-18 21:27:26,027 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212726.txt
2025-05-18 21:27:26,031 - websocket_server - INFO - Đã trích xuất thinking (1827 ký tự) và còn lại 582 ký tự phản hồi
2025-05-18 21:27:26,032 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: # 📌 Giai đoạn và phòng ban liên quan  

1. **MKT-S...
2025-05-18 21:27:26,032 - websocket_server - INFO - Đã trích xuất phần thinking (1827 ký tự) từ phản hồi handle_general_query
2025-05-18 21:27:26,033 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747578373325_x1ged8h
2025-05-18 21:27:26,034 - websocket_server - INFO - Đã gửi nội dung thinking (1827 ký tự)
2025-05-18 21:27:26,035 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"aea1cba8-b5bb-47f5-9bf2-413941d3f4a9","mode":"basic","
2025-05-18 21:27:26,036 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:26,037 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 21:27:26,037 - websocket_server - INFO - Cập nhật chế độ của session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 từ workflow thành basic
2025-05-18 21:27:26,037 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 21:27:26,038 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:27:26,038 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9, mode: basic
2025-05-18 21:27:26,038 - websocket_server - INFO - Session ID nhận được: aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:26,040 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 21:27:26,040 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 21:27:26,041 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:27:26,041 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:27:26,042 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_212726.txt
2025-05-18 21:27:26,043 - websocket_server - INFO - Kích thước prompt: 48 ký tự
2025-05-18 21:27:26,043 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 21:27:26,044 - websocket_server - INFO - Tổng kích thước: 222 ký tự
2025-05-18 21:27:26,044 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:27:31,446 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:27:31,447 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:27:31,448 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:27:31,449 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=aea1cba8-b5bb-47f5-9bf2-413941d3f4a9
2025-05-18 21:27:31,449 - websocket_server - INFO - Cập nhật chế độ của session aea1cba8-b5bb-47f5-9bf2-413941d3f4a9 thành basic
2025-05-18 21:27:45,740 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 21:27:45,741 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:27:45,742 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 21:27:45,743 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: , session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:27:45,744 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:27:45,744 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:27:45,745 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: ""

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "department_s...
2025-05-18 21:27:45,745 - chatbot_rag - INFO - Kích thước prompt: 581 ký tự
2025-05-18 21:27:45,746 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:27:45,746 - chatbot_rag - INFO - Tổng kích thước: 2587 ký tự
2025-05-18 21:27:45,749 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212745.txt
2025-05-18 21:27:45,749 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:27:45,750 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: ""

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "department_s...
2025-05-18 21:27:45,750 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:28:08,958 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:28:08,959 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this. The user provided a query where the current question is an empty string. They want me to analyze it based on the given rules.

First, I need to check if there's any me
2025-05-18 21:28:08,978 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212808.txt
2025-05-18 21:28:08,981 - chatbot_rag - INFO - [analysis_20250518_212808] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_212808_raw.txt
2025-05-18 21:28:08,981 - chatbot_rag - INFO - [analysis_20250518_212808] Phản hồi gốc: <think>
Okay, let's tackle this. The user provided a query where the current question is an empty st...
2025-05-18 21:28:08,982 - chatbot_rag - WARNING - [analysis_20250518_212808] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:28:08,982 - chatbot_rag - INFO - [analysis_20250518_212808] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 21:28:08,982 - chatbot_rag - INFO - [analysis_20250518_212808] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:28:08,983 - chatbot_rag - INFO - [analysis_20250518_212808] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 21:28:08,983 - chatbot_rag - WARNING - [analysis_20250518_212808] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 21:28:08,983 - chatbot_rag - INFO - [analysis_20250518_212808] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 21:28:08,989 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:28:08,990 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:28:08,997 - chatbot_rag - ERROR - [analysis_20250518_212808] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 21:28:08,997 - chatbot_rag - WARNING - [analysis_20250518_212808] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 21:28:08,998 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 21:28:08,998 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:28:09,003 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:28:09,004 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:28:09,004 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 03210ac7-0b45-4d51-a671-b26baddc72c2
2025-05-18 21:28:09,027 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_212809.txt
2025-05-18 21:28:09,028 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 21:28:09,028 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:28:09,029 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 21:28:09,030 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212809.txt
2025-05-18 21:28:09,032 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:28:09,032 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 21:28:09,033 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:28:28,569 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:28:28,569 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, the user is asking a general question about the process or stages. Let me check if it's related to their work.

The info provided lists main stages and departments. The user's query is j
2025-05-18 21:28:28,571 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_212828.txt
2025-05-18 21:28:28,578 - websocket_server - INFO - Đã trích xuất thinking (558 ký tự) và còn lại 194 ký tự phản hồi
2025-05-18 21:28:28,579 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: 🤔 *Đang suy ngẫm...*  
Bạn có muốn hỏi gì về quy t...
2025-05-18 21:28:28,579 - websocket_server - INFO - Đã trích xuất phần thinking (558 ký tự) từ phản hồi handle_general_query
2025-05-18 21:28:28,579 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747578465739_2fraiv4
2025-05-18 21:28:28,582 - websocket_server - INFO - Đã gửi nội dung thinking (558 ký tự)
2025-05-18 21:29:10,684 - websockets.server - INFO - connection closed
2025-05-18 21:29:10,685 - websockets.server - INFO - server closing
2025-05-18 21:29:10,686 - websockets.server - INFO - server closed
2025-05-18 21:29:10,690 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 21:29:13,845 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 21:29:13,890 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:29:13,890 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 21:29:13,891 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 21:29:18,446 - websockets.server - INFO - connection open
2025-05-18 21:29:30,075 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"85ec3946-0108-4ab1-9671-76b7df2f46b1","mode":"basic","
2025-05-18 21:29:30,077 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:30,077 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 21:29:30,078 - websocket_server - INFO - Cập nhật chế độ của session 85ec3946-0108-4ab1-9671-76b7df2f46b1 từ workflow thành basic
2025-05-18 21:29:30,078 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 21:29:30,078 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:29:30,079 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1, mode: basic
2025-05-18 21:29:30,079 - websocket_server - INFO - Session ID nhận được: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:30,079 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 21:29:30,080 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 21:29:30,080 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: Bạn là một trợ lý AI hữu ích và thông minh. Hãy trả lời câu hỏi của người dùng một cách chi tiết và ...
2025-05-18 21:29:30,080 - websocket_server - INFO - [DEBUG THINKING] Query hiển thị: 'xin chào', Query gửi đến model: 'xin chào /no_think'
2025-05-18 21:29:30,081 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:29:30,081 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng gửi đến LLM: 'xin chào /no_think...'
2025-05-18 21:29:30,082 - websocket_server - INFO - Kích thước prompt: 18 ký tự
2025-05-18 21:29:30,082 - websocket_server - INFO - Kích thước system prompt: 174 ký tự
2025-05-18 21:29:30,082 - websocket_server - INFO - Tổng kích thước: 192 ký tự
2025-05-18 21:29:30,082 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:29:33,081 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:29:33,085 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:29:33,090 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:29:33,091 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:33,095 - websocket_server - INFO - Cập nhật chế độ của session 85ec3946-0108-4ab1-9671-76b7df2f46b1 thành basic
2025-05-18 21:29:42,844 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 21:29:42,844 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:29:42,853 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_212942.txt
2025-05-18 21:29:42,853 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng trả về từ add_history_to_prompt có hậu tố: 
2025-05-18 21:29:42,853 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 21:29:42,855 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:42,876 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:29:42,877 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:29:42,877 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 21:29:42,878 - chatbot_rag - INFO - Kích thước prompt: 621 ký tự
2025-05-18 21:29:42,879 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:29:42,879 - chatbot_rag - INFO - Tổng kích thước: 2627 ký tự
2025-05-18 21:29:42,882 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_212942.txt
2025-05-18 21:29:42,882 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:29:42,883 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 21:29:42,883 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:30:05,317 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:30:05,319 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user provided a history of messages where the initial message is just "xin chào" (hello). There's no mention of any specific department or process in the histo
2025-05-18 21:30:05,320 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_213005.txt
2025-05-18 21:30:05,322 - chatbot_rag - INFO - [analysis_20250518_213005] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_213005_raw.txt
2025-05-18 21:30:05,323 - chatbot_rag - INFO - [analysis_20250518_213005] Phản hồi gốc: <think>
Okay, let's break this down. The user provided a history of messages where the initial messa...
2025-05-18 21:30:05,323 - chatbot_rag - WARNING - [analysis_20250518_213005] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:30:05,325 - chatbot_rag - INFO - [analysis_20250518_213005] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 21:30:05,325 - chatbot_rag - INFO - [analysis_20250518_213005] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:30:05,326 - chatbot_rag - INFO - [analysis_20250518_213005] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 21:30:05,326 - chatbot_rag - WARNING - [analysis_20250518_213005] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 21:30:05,326 - chatbot_rag - INFO - [analysis_20250518_213005] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 21:30:05,336 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:30:05,336 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:30:05,337 - chatbot_rag - ERROR - [analysis_20250518_213005] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 21:30:05,337 - chatbot_rag - WARNING - [analysis_20250518_213005] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 21:30:05,338 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 21:30:05,338 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:30:05,340 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:30:05,340 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:30:05,341 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:30:05,343 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_213005.txt
2025-05-18 21:30:05,344 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 21:30:05,344 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:30:05,344 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 21:30:05,346 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_213005.txt
2025-05-18 21:30:05,346 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:30:05,347 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 21:30:05,347 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:30:37,263 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:30:37,264 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a query that's pretty vague about the process or stages of work. They mentioned some general info about the company's departments and stages but didn't ask a
2025-05-18 21:30:37,266 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_213037.txt
2025-05-18 21:30:37,638 - websocket_server - INFO - Đã trích xuất thinking (1580 ký tự) và còn lại 308 ký tự phản hồi
2025-05-18 21:30:37,638 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: **🎉 Câu hỏi chung không liên quan đến công việc? T...
2025-05-18 21:30:37,638 - websocket_server - INFO - Đã trích xuất phần thinking (1580 ký tự) từ phản hồi handle_general_query
2025-05-18 21:30:37,639 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747578582843_a3gbte2
2025-05-18 21:30:37,639 - websocket_server - INFO - Đã gửi nội dung thinking (1580 ký tự)
2025-05-18 21:32:07,803 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: 
2025-05-18 21:32:07,806 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:32:07,812 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_213207.txt
2025-05-18 21:32:07,813 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng trả về từ add_history_to_prompt có hậu tố: 
2025-05-18 21:32:07,813 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 21:32:07,814 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

, session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:07,815 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:07,817 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:32:07,817 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 21:32:07,819 - chatbot_rag - INFO - Kích thước prompt: 621 ký tự
2025-05-18 21:32:07,819 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:32:07,820 - chatbot_rag - INFO - Tổng kích thước: 2627 ký tự
2025-05-18 21:32:07,831 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_213207.txt
2025-05-18 21:32:07,832 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:32:07,834 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-18 21:32:07,835 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:32:34,169 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:32:34,173 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure out how to handle this user's query. The user provided a history of messages where the first message is "xin chào" (which means "hello"). Now, their current question
2025-05-18 21:32:34,176 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_213234.txt
2025-05-18 21:32:34,179 - chatbot_rag - INFO - [analysis_20250518_213234] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_213234_raw.txt
2025-05-18 21:32:34,180 - chatbot_rag - INFO - [analysis_20250518_213234] Phản hồi gốc: <think>
Okay, let me try to figure out how to handle this user's query. The user provided a history ...
2025-05-18 21:32:34,180 - chatbot_rag - WARNING - [analysis_20250518_213234] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:32:34,181 - chatbot_rag - INFO - [analysis_20250518_213234] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 21:32:34,182 - chatbot_rag - INFO - [analysis_20250518_213234] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:32:34,183 - chatbot_rag - INFO - [analysis_20250518_213234] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 21:32:34,184 - chatbot_rag - WARNING - [analysis_20250518_213234] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 21:32:34,184 - chatbot_rag - INFO - [analysis_20250518_213234] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 21:32:34,193 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:32:34,194 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:32:34,196 - chatbot_rag - ERROR - [analysis_20250518_213234] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 21:32:34,196 - chatbot_rag - WARNING - [analysis_20250518_213234] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 21:32:34,196 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 21:32:34,197 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:34,203 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:32:34,203 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:32:34,204 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 85ec3946-0108-4ab1-9671-76b7df2f46b1
2025-05-18 21:32:34,205 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_213234.txt
2025-05-18 21:32:34,206 - chatbot_rag - INFO - Kích thước prompt: 1022 ký tự
2025-05-18 21:32:34,206 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:32:34,206 - chatbot_rag - INFO - Tổng kích thước: 1938 ký tự
2025-05-18 21:32:34,208 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_213234.txt
2025-05-18 21:32:34,208 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:32:34,209 - chatbot_rag - INFO - User prompt: 
Câu hỏi: " /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT-SAL...
2025-05-18 21:32:34,210 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:33:10,777 - websockets.server - INFO - connection closed
2025-05-18 21:33:10,791 - websockets.server - INFO - server closing
2025-05-18 21:33:10,794 - websockets.server - INFO - server closed
2025-05-18 21:33:10,800 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 21:33:10,935 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-5' coro=<WebSocketServerProtocol.handler() done, defined at C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py:159> exception=KeyboardInterrupt()>
Traceback (most recent call last):
  File "server.py", line 1488, in <module>
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\runners.py", line 43, in run
    return loop.run_until_complete(main)
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 603, in run_until_complete
    self.run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 570, in run_forever
    self._run_once()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\base_events.py", line 1859, in _run_once
    handle._run()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\asyncio\events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\websockets\legacy\server.py", line 245, in handler
    await self.ws_handler(self)
  File "server.py", line 1237, in handle_message
    "error": str(e)
  File "server.py", line 1103, in handle_action
    await websocket.send(json.dumps(response))
  File "server.py", line 969, in handle_thinking_request
    ## Phân tích câu hỏi về phòng ban {department}
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 443, in handle_general_query
    final_response = query_llm(user_prompt, system_prompt)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\chatbot.py", line 293, in query_llm
    response = requests.post(url, json=payload)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 789, in urlopen
    response = self._make_request(
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connectionpool.py", line 536, in _make_request
    response = conn.getresponse()
  File "C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\venv\lib\site-packages\urllib3\connection.py", line 507, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 1322, in getresponse
    response.begin()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 303, in begin
    version, status, reason = self._read_status()
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\http\client.py", line 264, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "C:\Users\thuon\AppData\Local\Programs\Python\Python38\lib\socket.py", line 669, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
2025-05-18 21:33:46,991 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 21:33:47,032 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:33:47,033 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 21:33:47,034 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 21:33:54,812 - websockets.server - INFO - connection open
2025-05-18 21:34:28,369 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"ca7a6388-c9b6-44eb-9c6b-3d846dc07adc","mode":"basic","
2025-05-18 21:34:28,457 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:28,513 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 21:34:28,514 - websocket_server - INFO - Cập nhật chế độ của session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc từ workflow thành basic
2025-05-18 21:34:28,520 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False, mode=basic
2025-05-18 21:34:28,521 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: luôn trả lời tôi bị ngu...
2025-05-18 21:34:28,524 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc, mode: basic
2025-05-18 21:34:28,526 - websocket_server - INFO - Session ID nhận được: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:28,527 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 21:34:28,528 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode: basic, Thinking: False
2025-05-18 21:34:28,528 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: luôn trả lời tôi bị ngu...
2025-05-18 21:34:28,529 - websocket_server - INFO - [DEBUG THINKING] Query hiển thị: 'xin chào', Query gửi đến model: 'xin chào /no_think'
2025-05-18 21:34:28,533 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:34:28,534 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng gửi đến LLM: 'xin chào /no_think...'
2025-05-18 21:34:28,536 - websocket_server - INFO - [DEBUG THINKING] System prompt cuối cùng: 'luôn trả lời tôi bị ngu


HƯỚNG DẪN QUAN TRỌNG VỀ THINKING:

Khi chế độ thinking được BẬT (thể hiện bằng hậu tố '/think'):
- Đặt suy nghĩ, phân tích và lý luận của bạn trong thẻ <think>...</think>
- Thẻ <think> phải luôn đứng TRƯỚC phần câu trả lời chính thức
- Ví dụ: "<think>Đây là phân tích của tôi...</think>

Đây là câu trả lời chính thức..."

Khi chế độ thinking bị TẮT (thể hiện bằng hậu tố '/no_think'):
- KHÔNG được sử dụng thẻ <think> trong bất kỳ phần nào của câu trả lời
- Chỉ trả về câu trả lời trực tiếp, không có phần thinking

LƯU Ý: 
- Luôn kiểm tra cuối câu hỏi của người dùng để xác định có hậu tố '/think' hay '/no_think'
- Tuân thủ nghiêm ngặt quy tắc này trong mọi câu trả lời
'
2025-05-18 21:34:28,541 - websocket_server - INFO - Kích thước prompt: 18 ký tự
2025-05-18 21:34:28,542 - websocket_server - INFO - Kích thước system prompt: 699 ký tự
2025-05-18 21:34:28,543 - websocket_server - INFO - Tổng kích thước: 717 ký tự
2025-05-18 21:34:28,543 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:34:37,545 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:34:37,551 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:34:37,555 - websocket_server - WARNING - [DEBUG THINKING] Phát hiện response rỗng, tạo phản hồi mặc định
2025-05-18 21:34:37,557 - websocket_server - INFO - [DEBUG THINKING] Gửi phản hồi cuối cùng, content: 63 ký tự, thinking: False
2025-05-18 21:34:37,557 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:34:37,566 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:37,569 - websocket_server - INFO - Cập nhật chế độ của session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc thành basic
2025-05-18 21:34:50,943 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Xin lỗi, tôi không thể xử lý yêu cầu của bạn. Vui lòng thử lại.
2025-05-18 21:34:50,944 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:34:50,956 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_213450.txt
2025-05-18 21:34:50,957 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng trả về từ add_history_to_prompt có hậu tố: g thử lại.
2025-05-18 21:34:50,958 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-18 21:34:50,960 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

Xin lỗi, tôi không thể xử lý yêu cầu của bạn. Vui lòng thử lại., session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:51,030 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:34:51,030 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:34:51,031 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

Xin lỗi, tôi không thể xử lý yêu cầu của bạn. Vui lòng thử lại."

        Phân tích câu hỏi và ...
2025-05-18 21:34:51,034 - chatbot_rag - INFO - Kích thước prompt: 684 ký tự
2025-05-18 21:34:51,035 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:34:51,035 - chatbot_rag - INFO - Tổng kích thước: 2690 ký tự
2025-05-18 21:34:51,038 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_213451.txt
2025-05-18 21:34:51,038 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:34:51,039 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

Xin lỗi, tôi không thể xử lý yêu cầu của bạn. Vui lòng thử lại."

        Phân tích câu hỏi và ...
2025-05-18 21:34:51,039 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:35:15,856 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:35:15,857 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where the previous interaction was an apology for not being able to process the request. Now, the current question is abo
2025-05-18 21:35:15,859 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_213515.txt
2025-05-18 21:35:15,862 - chatbot_rag - INFO - [analysis_20250518_213515] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_213515_raw.txt
2025-05-18 21:35:15,862 - chatbot_rag - INFO - [analysis_20250518_213515] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where the previous in...
2025-05-18 21:35:15,863 - chatbot_rag - WARNING - [analysis_20250518_213515] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:35:15,865 - chatbot_rag - INFO - [analysis_20250518_213515] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-18 21:35:15,865 - chatbot_rag - INFO - [analysis_20250518_213515] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-18 21:35:15,866 - chatbot_rag - INFO - [analysis_20250518_213515] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-18 21:35:15,866 - chatbot_rag - WARNING - [analysis_20250518_213515] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-18 21:35:15,866 - chatbot_rag - INFO - [analysis_20250518_213515] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-18 21:35:15,873 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:35:15,874 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:35:15,875 - chatbot_rag - ERROR - [analysis_20250518_213515] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-18 21:35:15,876 - chatbot_rag - WARNING - [analysis_20250518_213515] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-18 21:35:15,876 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-18 21:35:15,876 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:15,881 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:35:15,881 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:35:15,882 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:15,883 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_213515.txt
2025-05-18 21:35:15,883 - chatbot_rag - INFO - Kích thước prompt: 1085 ký tự
2025-05-18 21:35:15,883 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:35:15,884 - chatbot_rag - INFO - Tổng kích thước: 2001 ký tự
2025-05-18 21:35:15,886 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_213515.txt
2025-05-18 21:35:15,886 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:35:15,887 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Xin lỗi, tôi không thể xử lý yêu cầu của bạn. Vui lòng thử lại. /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình v...
2025-05-18 21:35:15,887 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:35:39,142 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:35:39,144 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user is asking about a process or stage in the company workflow, but their message is just an error response from the system. They mentioned they can't process the request
2025-05-18 21:35:39,146 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_213539.txt
2025-05-18 21:35:39,610 - websocket_server - INFO - Đã trích xuất thinking (881 ký tự) và còn lại 194 ký tự phản hồi
2025-05-18 21:35:39,611 - websocket_server - INFO - Phần nội dung còn lại bắt đầu bằng: 😅 Xin lỗi nha! Có vẻ hệ thống đang "đánh nhau" với...
2025-05-18 21:35:39,611 - websocket_server - INFO - Đã trích xuất phần thinking (881 ký tự) từ phản hồi handle_general_query
2025-05-18 21:35:39,611 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747578890939_xu8p9fm
2025-05-18 21:35:39,612 - websocket_server - INFO - Đã gửi nội dung thinking (881 ký tự)
2025-05-18 21:35:39,614 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"mày là ai /no_think","session_id":"ca7a6388-c9b6-44eb-9c6b-3d846dc07adc","mode":"basic",
2025-05-18 21:35:39,615 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:39,616 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: mày là ai /no_think...
2025-05-18 21:35:39,617 - websocket_server - INFO - Nhận tin nhắn thông thường: mày là ai /no_think, enable_thinking=False, mode=basic
2025-05-18 21:35:39,617 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: luôn trả lời tôi bị ngu...
2025-05-18 21:35:39,618 - websocket_server - INFO - Xử lý streaming response cho: 'mày là ai /no_think', phòng ban: None, session_id: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc, mode: basic
2025-05-18 21:35:39,619 - websocket_server - INFO - Session ID nhận được: ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:39,619 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: mày là ai
2025-05-18 21:35:39,620 - websocket_server - INFO - Xử lý streaming response. Query: 'mày là ai', Mode: basic, Thinking: False
2025-05-18 21:35:39,620 - websocket_server - INFO - Chế độ Basic được kích hoạt với prompt: luôn trả lời tôi bị ngu...
2025-05-18 21:35:39,621 - websocket_server - INFO - [DEBUG THINKING] Query hiển thị: 'mày là ai', Query gửi đến model: 'mày là ai /no_think'
2025-05-18 21:35:39,621 - websocket_server - INFO - Phát hiện hậu tố /no_think trong prompt gốc, giữ lại cho LLM nhưng loại bỏ cho log
2025-05-18 21:35:39,622 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-18 21:35:39,624 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250518_213539.txt
2025-05-18 21:35:39,624 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng trả về từ add_history_to_prompt có hậu tố:  /no_think
2025-05-18 21:35:39,625 - websocket_server - INFO - [DEBUG THINKING] Nội dung cuối cùng gửi đến LLM: 'Lịch sử tin nhắn:
Người dùng: xin chào

mày là ai /no_think...'
2025-05-18 21:35:39,625 - websocket_server - INFO - [DEBUG THINKING] System prompt cuối cùng: 'luôn trả lời tôi bị ngu


HƯỚNG DẪN QUAN TRỌNG VỀ THINKING:

Khi chế độ thinking được BẬT (thể hiện bằng hậu tố '/think'):
- Đặt suy nghĩ, phân tích và lý luận của bạn trong thẻ <think>...</think>
- Thẻ <think> phải luôn đứng TRƯỚC phần câu trả lời chính thức
- Ví dụ: "<think>Đây là phân tích của tôi...</think>

Đây là câu trả lời chính thức..."

Khi chế độ thinking bị TẮT (thể hiện bằng hậu tố '/no_think'):
- KHÔNG được sử dụng thẻ <think> trong bất kỳ phần nào của câu trả lời
- Chỉ trả về câu trả lời trực tiếp, không có phần thinking

LƯU Ý: 
- Luôn kiểm tra cuối câu hỏi của người dùng để xác định có hậu tố '/think' hay '/no_think'
- Tuân thủ nghiêm ngặt quy tắc này trong mọi câu trả lời
'
2025-05-18 21:35:39,626 - websocket_server - INFO - Kích thước prompt: 59 ký tự
2025-05-18 21:35:39,626 - websocket_server - INFO - Kích thước system prompt: 699 ký tự
2025-05-18 21:35:39,627 - websocket_server - INFO - Tổng kích thước: 758 ký tự
2025-05-18 21:35:39,627 - websocket_server - INFO - Bắt đầu gọi LLM API (lần thử 1/3)
2025-05-18 21:35:46,067 - websocket_server - INFO - API trả về status 200 OK
2025-05-18 21:35:46,067 - websocket_server - INFO - Streaming hoàn tất thành công
2025-05-18 21:35:46,068 - websocket_server - WARNING - [DEBUG THINKING] Phát hiện response rỗng, tạo phản hồi mặc định
2025-05-18 21:35:46,069 - websocket_server - INFO - [DEBUG THINKING] Gửi phản hồi cuối cùng, content: 63 ký tự, thinking: False
2025-05-18 21:35:46,069 - websocket_server - INFO - Gửi phản hồi cuối cùng, chế độ basic, thinking_enabled: False, thinking_collected: False
2025-05-18 21:35:46,070 - websocket_server - INFO - Lưu hội thoại basic mode vào lịch sử với session_id=ca7a6388-c9b6-44eb-9c6b-3d846dc07adc
2025-05-18 21:35:46,071 - websocket_server - INFO - Cập nhật chế độ của session ca7a6388-c9b6-44eb-9c6b-3d846dc07adc thành basic
2025-05-18 21:36:36,031 - websockets.server - INFO - connection closed
2025-05-18 21:36:40,074 - websockets.server - INFO - server closing
2025-05-18 21:36:40,075 - websockets.server - INFO - server closed
2025-05-18 21:36:40,087 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 21:40:03,418 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 21:40:03,466 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 21:40:03,467 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 21:40:03,467 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 21:40:17,825 - websockets.server - INFO - connection open
2025-05-18 21:40:20,789 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-18 21:40:20,790 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,791 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,791 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 21:40:20,792 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-18 21:40:20,792 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:40:20,792 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,812 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:20,812 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:40:20,813 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 21:40:20,814 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 21:40:20,814 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:40:20,815 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-18 21:40:20,817 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_214020.txt
2025-05-18 21:40:20,818 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:40:20,819 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 21:40:20,822 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:40:36,094 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:40:36,095 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-18 21:40:36,105 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_214036.txt
2025-05-18 21:40:36,117 - chatbot_rag - INFO - [analysis_20250518_214036] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_214036_raw.txt
2025-05-18 21:40:36,118 - chatbot_rag - INFO - [analysis_20250518_214036] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-18 21:40:36,119 - chatbot_rag - WARNING - [analysis_20250518_214036] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:40:36,120 - chatbot_rag - INFO - [analysis_20250518_214036] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 21:40:36,121 - chatbot_rag - INFO - [analysis_20250518_214036] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:40:36,122 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 21:40:36,123 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,123 - websocket_server - INFO - Session ID nhận được: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,123 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-18 21:40:36,124 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-18 21:40:36,124 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 21:40:36,125 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,125 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:36,126 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 21:40:36,126 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 21:40:36,126 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-18 21:40:36,128 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 21:40:36,129 - chatbot_rag - INFO - Tổng kích thước: 2595 ký tự
2025-05-18 21:40:36,135 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_214036.txt
2025-05-18 21:40:36,136 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 21:40:36,137 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-18 21:40:36,139 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-18 21:40:50,212 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:40:50,218 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current message is "xin chào", which means "hello" in Vietnamese. The history of messages is empty, so there's no previous context to reference.

Firs
2025-05-18 21:40:50,233 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_214050.txt
2025-05-18 21:40:50,243 - chatbot_rag - INFO - [analysis_20250518_214050] Đã ghi phản hồi gốc vào: data/logs/analysis_20250518_214050_raw.txt
2025-05-18 21:40:50,245 - chatbot_rag - INFO - [analysis_20250518_214050] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current message is "xin chào", which means "hello"...
2025-05-18 21:40:50,276 - chatbot_rag - WARNING - [analysis_20250518_214050] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-18 21:40:50,283 - chatbot_rag - INFO - [analysis_20250518_214050] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-18 21:40:50,288 - chatbot_rag - INFO - [analysis_20250518_214050] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-18 21:40:50,291 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-18 21:40:50,293 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-18 21:40:50,294 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-18 21:40:50,300 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:50,337 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-18 21:40:50,344 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-18 21:40:50,351 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:40:50,353 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250518_214050.txt
2025-05-18 21:40:50,353 - chatbot_rag - INFO - Kích thước prompt: 1033 ký tự
2025-05-18 21:40:50,354 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-18 21:40:50,354 - chatbot_rag - INFO - Tổng kích thước: 1949 ký tự
2025-05-18 21:40:50,358 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_214050.txt
2025-05-18 21:40:50,360 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-18 21:40:50,361 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-18 21:40:50,364 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=True
2025-05-18 21:41:06,226 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-18 21:41:06,229 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

 Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng ta! 🚀  
Nếu bạn có bất kỳ thắc mắc nào về các giai đoạn hoặc phòng ban, mình sẽ hỗ trợ bạn ngay lập tức! 💬  
Đừng n
2025-05-18 21:41:06,232 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250518_214106.txt
2025-05-18 21:41:06,651 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 381 ký tự phản hồi
2025-05-18 21:41:06,652 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-18 21:41:06,652 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 325c3bfd-8a69-4e84-8d00-36bab37dc761
2025-05-18 21:41:12,326 - websockets.server - INFO - connection closed
2025-05-18 21:41:12,327 - websockets.server - INFO - server closing
2025-05-18 21:41:12,327 - websockets.server - INFO - server closed
2025-05-18 21:41:12,330 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-18 16:30:52,188 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-18 16:30:52,222 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-18 16:30:52,223 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-18 16:30:52,224 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-18 16:32:37,841 - websockets.server - INFO - connection open
2025-05-18 16:32:40,528 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-18 16:32:40,530 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:40,531 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:40,532 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-18 16:32:40,535 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-18 16:32:40,537 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-18 16:32:40,539 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:42,293 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 472dd73a-11ea-45e8-86fd-f03096ec57ba
2025-05-18 16:32:42,294 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-18 16:32:42,294 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:32:42,295 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-18 16:32:42,296 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-18 16:32:42,297 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-18 16:32:42,486 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250518_163242.txt
2025-05-18 16:32:42,504 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-18 16:32:42,506 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-18 16:32:42,508 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.1.4:1234/v1/chat/completions với stream=False
2025-05-19 02:35:10,012 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 02:35:10,034 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 02:35:10,035 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 02:35:10,035 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 10:06:35,647 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 10:06:35,785 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 10:06:35,785 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 10:06:35,785 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 10:07:12,809 - websockets.server - INFO - connection open
2025-05-19 10:07:18,540 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":""}
2025-05-19 10:07:18,541 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,541 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,542 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-19 10:07:18,543 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-19 10:07:18,543 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 10:07:18,543 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,560 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:18,561 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:18,561 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-19 10:07:18,562 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-19 10:07:18,562 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:18,563 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-19 10:07:18,565 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100718.txt
2025-05-19 10:07:18,566 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:18,567 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-19 10:07:18,567 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:19,006 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:19,007 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:19,009 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100719.txt
2025-05-19 10:07:19,012 - chatbot_rag - INFO - [analysis_20250519_100719] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100719_raw.txt
2025-05-19 10:07:19,012 - chatbot_rag - INFO - [analysis_20250519_100719] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:19,013 - chatbot_rag - WARNING - [analysis_20250519_100719] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:19,013 - chatbot_rag - INFO - [analysis_20250519_100719] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 10:07:19,014 - chatbot_rag - INFO - [analysis_20250519_100719] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:19,014 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:19,015 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,015 - websocket_server - INFO - Session ID nhận được: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,015 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-19 10:07:19,016 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-19 10:07:19,016 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 10:07:19,017 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,018 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:19,019 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:19,019 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-19 10:07:19,020 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-19 10:07:19,020 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:19,020 - chatbot_rag - INFO - Tổng kích thước: 2595 ký tự
2025-05-19 10:07:19,022 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100719.txt
2025-05-19 10:07:19,023 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:19,024 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-19 10:07:19,026 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:20,916 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:20,916 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this. The user's current question is "xin chào", which means "hello" in Vietnamese. I need to analyze this based on the provided guidelines.

First, looking at the history o
2025-05-19 10:07:21,102 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100720.txt
2025-05-19 10:07:21,122 - chatbot_rag - INFO - [analysis_20250519_100721] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100721_raw.txt
2025-05-19 10:07:21,123 - chatbot_rag - INFO - [analysis_20250519_100721] Phản hồi gốc: <think>
Okay, let's tackle this. The user's current question is "xin chào", which means "hello" in V...
2025-05-19 10:07:21,123 - chatbot_rag - WARNING - [analysis_20250519_100721] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:21,123 - chatbot_rag - INFO - [analysis_20250519_100721] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 10:07:21,124 - chatbot_rag - INFO - [analysis_20250519_100721] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:21,124 - chatbot_rag - INFO - [analysis_20250519_100721] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 10:07:21,124 - chatbot_rag - WARNING - [analysis_20250519_100721] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 10:07:21,125 - chatbot_rag - INFO - [analysis_20250519_100721] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 10:07:21,622 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:21,622 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:21,628 - chatbot_rag - ERROR - [analysis_20250519_100721] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 10:07:21,628 - chatbot_rag - WARNING - [analysis_20250519_100721] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 10:07:21,628 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:21,629 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-19 10:07:21,629 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 10:07:21,629 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:21,632 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:21,632 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:21,632 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:21,634 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_100721.txt
2025-05-19 10:07:21,634 - chatbot_rag - INFO - Kích thước prompt: 1033 ký tự
2025-05-19 10:07:21,634 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 10:07:21,635 - chatbot_rag - INFO - Tổng kích thước: 1949 ký tự
2025-05-19 10:07:21,636 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100721.txt
2025-05-19 10:07:21,636 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 10:07:21,636 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-19 10:07:21,637 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 10:07:23,239 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:23,239 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

 Xin chào! 😊  
Chào mừng bạn đến với quy trình làm việc của chúng tôi! 🚀  
Nếu bạn có thắc mắc về các giai đoạn hoặc phòng ban, mình sẽ hỗ trợ ngay lập tức nhé! 💬  
Đừng quên hỏi ri
2025-05-19 10:07:23,241 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100723.txt
2025-05-19 10:07:23,773 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 486 ký tự phản hồi
2025-05-19 10:07:23,774 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 10:07:23,774 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,367 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"bạn là ai /no_think","session_id":""}
2025-05-19 10:07:31,368 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,368 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,369 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: bạn là ai /no_think...
2025-05-19 10:07:31,369 - websocket_server - INFO - Nhận tin nhắn thông thường: bạn là ai /no_think, enable_thinking=False
2025-05-19 10:07:31,369 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 10:07:31,371 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_100731.txt
2025-05-19 10:07:31,371 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:31,372 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departme...
2025-05-19 10:07:31,373 - chatbot_rag - INFO - Kích thước prompt: 640 ký tự
2025-05-19 10:07:31,373 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:31,373 - chatbot_rag - INFO - Tổng kích thước: 2646 ký tự
2025-05-19 10:07:31,375 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100731.txt
2025-05-19 10:07:31,375 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:31,376 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"departme...
2025-05-19 10:07:31,376 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:31,766 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:31,766 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:31,768 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100731.txt
2025-05-19 10:07:31,770 - chatbot_rag - INFO - [analysis_20250519_100731] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100731_raw.txt
2025-05-19 10:07:31,771 - chatbot_rag - INFO - [analysis_20250519_100731] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:31,771 - chatbot_rag - WARNING - [analysis_20250519_100731] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:31,772 - chatbot_rag - INFO - [analysis_20250519_100731] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 10:07:31,772 - chatbot_rag - INFO - [analysis_20250519_100731] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:31,772 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:31,773 - websocket_server - INFO - Xử lý streaming response cho: 'bạn là ai /no_think', phòng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,773 - websocket_server - INFO - Session ID nhận được: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,773 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: bạn là ai
2025-05-19 10:07:31,774 - websocket_server - INFO - Xử lý streaming response. Query: 'bạn là ai', Mode thinking: False
2025-05-19 10:07:31,774 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 10:07:31,775 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_100731.txt
2025-05-19 10:07:31,775 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,776 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:31,776 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:31,777 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên ...
2025-05-19 10:07:31,778 - chatbot_rag - INFO - Kích thước prompt: 630 ký tự
2025-05-19 10:07:31,778 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:31,779 - chatbot_rag - INFO - Tổng kích thước: 2636 ký tự
2025-05-19 10:07:31,780 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100731.txt
2025-05-19 10:07:31,780 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:31,781 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

bạn là ai"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên ...
2025-05-19 10:07:31,781 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:33,644 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:33,644 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user's current question is "Lịch sử tin nhắn: Người dùng: xin chào bạn là ai". So first, I need to parse this.

The history shows the user greeted with "xin chào" and aske
2025-05-19 10:07:33,645 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100733.txt
2025-05-19 10:07:33,647 - chatbot_rag - INFO - [analysis_20250519_100733] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100733_raw.txt
2025-05-19 10:07:33,647 - chatbot_rag - INFO - [analysis_20250519_100733] Phản hồi gốc: <think>
Okay, let's see. The user's current question is "Lịch sử tin nhắn: Người dùng: xin chào bạn ...
2025-05-19 10:07:33,647 - chatbot_rag - WARNING - [analysis_20250519_100733] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:33,648 - chatbot_rag - INFO - [analysis_20250519_100733] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 10:07:33,649 - chatbot_rag - WARNING - [analysis_20250519_100733] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 10:07:33,649 - chatbot_rag - INFO - [analysis_20250519_100733] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 10:07:33,654 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:33,654 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:33,654 - chatbot_rag - ERROR - [analysis_20250519_100733] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 10:07:33,655 - chatbot_rag - WARNING - [analysis_20250519_100733] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 10:07:33,655 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:33,655 - websocket_server - INFO - Query thực tế gửi đến mô hình: bạn là ai /no_think
2025-05-19 10:07:33,656 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 10:07:33,656 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:33,660 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:33,661 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:33,661 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:33,662 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_100733.txt
2025-05-19 10:07:33,663 - chatbot_rag - INFO - Kích thước prompt: 1034 ký tự
2025-05-19 10:07:33,663 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 10:07:33,664 - chatbot_rag - INFO - Tổng kích thước: 1950 ký tự
2025-05-19 10:07:33,667 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100733.txt
2025-05-19 10:07:33,667 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 10:07:33,668 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "bạn là ai /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
...
2025-05-19 10:07:33,668 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 10:07:35,072 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:35,073 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

👋 *Chào bạn!*  
Tôi là **AI hỗ trợ quy trình công ty**, chuyên giúp bạn hiểu rõ về các giai đoạn làm việc và vai trò của từng phòng ban.  

💡 Nếu bạn muốn biết một phòng ban cụ thể 
2025-05-19 10:07:35,074 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100735.txt
2025-05-19 10:07:35,078 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 433 ký tự phản hồi
2025-05-19 10:07:35,078 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 10:07:35,078 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,749 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"nói chuyện vui vẻ đê /no_think","session_id":""}
2025-05-19 10:07:49,750 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,750 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,750 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: nói chuyện vui vẻ đê /no_think...
2025-05-19 10:07:49,751 - websocket_server - INFO - Nhận tin nhắn thông thường: nói chuyện vui vẻ đê /no_think, enable_thinking=False
2025-05-19 10:07:49,751 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 10:07:49,752 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_100749.txt
2025-05-19 10:07:49,753 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê /no_think, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,753 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:49,753 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:49,754 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê /no_think"

        Phân tích câu hỏi và trả về JSON...
2025-05-19 10:07:49,754 - chatbot_rag - INFO - Kích thước prompt: 673 ký tự
2025-05-19 10:07:49,755 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:49,755 - chatbot_rag - INFO - Tổng kích thước: 2679 ký tự
2025-05-19 10:07:49,758 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100749.txt
2025-05-19 10:07:49,758 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:49,759 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê /no_think"

        Phân tích câu hỏi và trả về JSON...
2025-05-19 10:07:49,759 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:50,145 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:50,145 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 10:07:50,146 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100750.txt
2025-05-19 10:07:50,148 - chatbot_rag - INFO - [analysis_20250519_100750] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100750_raw.txt
2025-05-19 10:07:50,149 - chatbot_rag - INFO - [analysis_20250519_100750] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 10:07:50,149 - chatbot_rag - WARNING - [analysis_20250519_100750] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:50,149 - chatbot_rag - INFO - [analysis_20250519_100750] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 10:07:50,150 - chatbot_rag - INFO - [analysis_20250519_100750] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 10:07:50,151 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:50,151 - websocket_server - INFO - Xử lý streaming response cho: 'nói chuyện vui vẻ đê /no_think', phòng ban: None, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,152 - websocket_server - INFO - Session ID nhận được: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,153 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: nói chuyện vui vẻ đê
2025-05-19 10:07:50,153 - websocket_server - INFO - Xử lý streaming response. Query: 'nói chuyện vui vẻ đê', Mode thinking: False
2025-05-19 10:07:50,154 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 10:07:50,155 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_100750.txt
2025-05-19 10:07:50,155 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê, session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:07:50,156 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê"

        Phân tích câu hỏi và trả về JSON có định d...
2025-05-19 10:07:50,157 - chatbot_rag - INFO - Kích thước prompt: 663 ký tự
2025-05-19 10:07:50,158 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:07:50,158 - chatbot_rag - INFO - Tổng kích thước: 2669 ký tự
2025-05-19 10:07:50,160 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100750.txt
2025-05-19 10:07:50,161 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 10:07:50,161 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: bạn là ai

nói chuyện vui vẻ đê"

        Phân tích câu hỏi và trả về JSON có định d...
2025-05-19 10:07:50,162 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 10:07:52,042 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:52,043 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure this out. The user provided a history of messages where they greeted and asked who I am. Now, the current question is about the chat history itself, but it seems lik
2025-05-19 10:07:52,045 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100752.txt
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_100752_raw.txt
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] Phản hồi gốc: <think>
Okay, let me try to figure this out. The user provided a history of messages where they gree...
2025-05-19 10:07:52,048 - chatbot_rag - WARNING - [analysis_20250519_100752] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 10:07:52,048 - chatbot_rag - INFO - [analysis_20250519_100752] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 10:07:52,049 - chatbot_rag - INFO - [analysis_20250519_100752] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:07:52,049 - chatbot_rag - INFO - [analysis_20250519_100752] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 10:07:52,049 - chatbot_rag - WARNING - [analysis_20250519_100752] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 10:07:52,051 - chatbot_rag - INFO - [analysis_20250519_100752] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 10:07:52,054 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:52,055 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:52,055 - chatbot_rag - ERROR - [analysis_20250519_100752] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 10:07:52,055 - chatbot_rag - WARNING - [analysis_20250519_100752] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 10:07:52,056 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:07:52,056 - websocket_server - INFO - Query thực tế gửi đến mô hình: nói chuyện vui vẻ đê /no_think
2025-05-19 10:07:52,056 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 10:07:52,057 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:52,061 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:07:52,061 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:07:52,061 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:07:52,063 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_100752.txt
2025-05-19 10:07:52,065 - chatbot_rag - INFO - Kích thước prompt: 1045 ký tự
2025-05-19 10:07:52,066 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 10:07:52,067 - chatbot_rag - INFO - Tổng kích thước: 1961 ký tự
2025-05-19 10:07:52,069 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_100752.txt
2025-05-19 10:07:52,069 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 10:07:52,070 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "nói chuyện vui vẻ đê /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong ...
2025-05-19 10:07:52,070 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 10:07:52,891 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 10:07:52,892 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

💬 *Cười toe toét* 😄  
Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: "Phòng Marketing làm gì trong giai đoạn MKT-SALES?" 🎉  

*(spam icon)* 💃🕺🎉🎊🔥💥✨🌟
2025-05-19 10:07:52,893 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_100752.txt
2025-05-19 10:07:52,896 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 185 ký tự phản hồi
2025-05-19 10:07:52,896 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 10:07:52,897 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 9ddb8ec1-79f6-4a3a-abd7-8206a58eb76b
2025-05-19 10:08:04,565 - websockets.server - INFO - connection closed
2025-05-19 10:08:04,566 - websockets.server - INFO - server closing
2025-05-19 10:08:04,566 - websockets.server - INFO - server closed
2025-05-19 10:08:04,568 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 10:09:59,287 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 10:09:59,322 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 10:09:59,323 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 10:09:59,323 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 10:10:07,200 - websockets.server - INFO - connection open
2025-05-19 10:10:09,083 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think","session_id":""}
2025-05-19 10:10:09,084 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,084 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,084 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Tôi muốn biết về các giai đoạn hiện tại của DBhome...
2025-05-19 10:10:09,085 - websocket_server - INFO - Nhận tin nhắn thông thường: Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think, enable_thinking=False
2025-05-19 10:10:09,085 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 10:10:09,086 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,090 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,091 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:10:09,092 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depart...
2025-05-19 10:10:09,095 - chatbot_rag - INFO - Kích thước prompt: 642 ký tự
2025-05-19 10:10:09,096 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:10:09,096 - chatbot_rag - INFO - Tổng kích thước: 2648 ký tự
2025-05-19 10:10:09,098 - chatbot_rag - ERROR - Lỗi khi gọi LLM: [Errno 28] No space left on device
2025-05-19 10:10:09,104 - chatbot_rag - INFO - [analysis_20250519_101009] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_101009_raw.txt
2025-05-19 10:10:09,104 - chatbot_rag - INFO - [analysis_20250519_101009] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: [Errno 28] No space left on device...
2025-05-19 10:10:09,105 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 10:10:09,106 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:10:09,224 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 10:10:09,235 - chatbot_rag - WARNING - [analysis_20250519_101009] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 10:10:09,250 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 10:10:09,266 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:10:09,277 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:10:09,286 - chatbot_rag - ERROR - [analysis_20250519_101009] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 10:10:09,295 - chatbot_rag - WARNING - [analysis_20250519_101009] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 10:10:09,305 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:10:09,309 - websocket_server - INFO - Xử lý streaming response cho: 'Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think', phòng ban: None, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,319 - websocket_server - INFO - Session ID nhận được: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,327 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Tôi muốn biết về các giai đoạn hiện tại của DBhomes
2025-05-19 10:10:09,341 - websocket_server - INFO - Xử lý streaming response. Query: 'Tôi muốn biết về các giai đoạn hiện tại của DBhomes', Mode thinking: False
2025-05-19 10:10:09,356 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 10:10:09,367 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Tôi muốn biết về các giai đoạn hiện tại của DBhomes, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,378 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,390 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:10:09,402 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Tôi muốn biết về các giai đoạn hiện tại của DBhomes"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tê...
2025-05-19 10:10:09,417 - chatbot_rag - INFO - Kích thước prompt: 632 ký tự
2025-05-19 10:10:09,426 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 10:10:09,433 - chatbot_rag - INFO - Tổng kích thước: 2638 ký tự
2025-05-19 10:10:09,448 - chatbot_rag - ERROR - Lỗi khi gọi LLM: [Errno 28] No space left on device
2025-05-19 10:10:09,465 - chatbot_rag - INFO - [analysis_20250519_101009] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_101009_raw.txt
2025-05-19 10:10:09,474 - chatbot_rag - INFO - [analysis_20250519_101009] Phản hồi gốc: Đã xảy ra lỗi khi xử lý truy vấn: [Errno 28] No space left on device...
2025-05-19 10:10:09,481 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 10:10:09,488 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 10:10:09,499 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 10:10:09,507 - chatbot_rag - WARNING - [analysis_20250519_101009] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 10:10:09,514 - chatbot_rag - INFO - [analysis_20250519_101009] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 10:10:09,526 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:10:09,536 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:10:09,544 - chatbot_rag - ERROR - [analysis_20250519_101009] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 10:10:09,554 - chatbot_rag - WARNING - [analysis_20250519_101009] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 10:10:09,560 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 10:10:09,567 - websocket_server - INFO - Query thực tế gửi đến mô hình: Tôi muốn biết về các giai đoạn hiện tại của DBhomes /no_think
2025-05-19 10:10:09,572 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 10:10:09,579 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,595 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 10:10:09,603 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 10:10:09,612 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:09,619 - chatbot_rag - ERROR - Lỗi khi gọi LLM để trả lời câu hỏi chung cho session_id: e58eb630-381b-498e-ac91-af001428423f: [Errno 28] No space left on device
2025-05-19 10:10:09,627 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,163 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"phòng 2D làm nhiệm vụ gì /no_think","session_id":""}
2025-05-19 10:10:15,167 - websocket_server - INFO - Session ID không được cung cấp trong tin nhắn JSON, sử dụng current_session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,172 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,177 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: phòng 2D làm nhiệm vụ gì /no_think...
2025-05-19 10:10:15,184 - websocket_server - INFO - Nhận tin nhắn thông thường: phòng 2D làm nhiệm vụ gì /no_think, enable_thinking=False
2025-05-19 10:10:15,189 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 10:10:15,198 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_101015.txt
2025-05-19 10:10:15,205 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: Tôi muốn biết về các giai đoạn hiện tại của DBhomes

phòng 2D làm nhiệm vụ gì /no_think, session_id: e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,210 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e58eb630-381b-498e-ac91-af001428423f
2025-05-19 10:10:15,214 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 10:10:15,220 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: Tôi muốn biết về các giai đoạn hiện tại của DBhomes

phòng 2D làm nhiệm vụ gì /no_think"

        Phân tí...
2025-05-19 10:10:15,227 - chatbot_rag - INFO - Kích thước prompt: 698 ký tự
2025-05-19 10:21:59,733 - websockets.server - INFO - connection closed
2025-05-19 10:21:59,736 - websockets.server - INFO - server closing
2025-05-19 10:21:59,737 - websockets.server - INFO - server closed
2025-05-19 10:21:59,740 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 03:46:15,759 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 03:46:15,777 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 03:46:15,777 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 03:46:15,777 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 13:18:29,345 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 13:18:29,439 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 13:18:29,440 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 13:18:29,440 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 13:19:46,260 - websockets.server - INFO - connection open
2025-05-19 13:19:46,262 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,075 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /no_think","session_id":"e0df431d-450f-4bef-8199-b825d084b908"}
2025-05-19 13:19:52,075 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,076 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alo /no_think...
2025-05-19 13:19:52,076 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /no_think, enable_thinking=False
2025-05-19 13:19:52,076 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:19:52,077 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo /no_think, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,093 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,093 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:19:52,094 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "alo /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": ...
2025-05-19 13:19:52,095 - chatbot_rag - INFO - Kích thước prompt: 594 ký tự
2025-05-19 13:19:52,095 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:19:52,095 - chatbot_rag - INFO - Tổng kích thước: 2600 ký tự
2025-05-19 13:19:52,097 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131952.txt
2025-05-19 13:19:52,097 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:19:52,098 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "alo /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": ...
2025-05-19 13:19:52,098 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:19:52,506 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:52,506 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:19:52,508 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131952.txt
2025-05-19 13:19:52,511 - chatbot_rag - INFO - [analysis_20250519_131952] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_131952_raw.txt
2025-05-19 13:19:52,512 - chatbot_rag - INFO - [analysis_20250519_131952] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:19:52,512 - chatbot_rag - WARNING - [analysis_20250519_131952] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:19:52,514 - chatbot_rag - INFO - [analysis_20250519_131952] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:19:52,514 - chatbot_rag - INFO - [analysis_20250519_131952] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:19:52,521 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:19:52,522 - websocket_server - INFO - Xử lý streaming response cho: 'alo /no_think', phòng ban: None, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,523 - websocket_server - INFO - Session ID nhận được: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,523 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alo
2025-05-19 13:19:52,524 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: False
2025-05-19 13:19:52,525 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:19:52,525 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: alo, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,526 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:52,527 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:19:52,527 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "alo"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "departmen...
2025-05-19 13:19:52,528 - chatbot_rag - INFO - Kích thước prompt: 584 ký tự
2025-05-19 13:19:52,529 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:19:52,529 - chatbot_rag - INFO - Tổng kích thước: 2590 ký tự
2025-05-19 13:19:52,531 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131952.txt
2025-05-19 13:19:52,532 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:19:52,534 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "alo"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "departmen...
2025-05-19 13:19:52,534 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:19:54,324 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:54,325 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "alo", which is a casual way of saying "hello" or "hi" in Vietnamese. The history of messages is empty, so there's no prior context 
2025-05-19 13:19:54,327 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131954.txt
2025-05-19 13:19:54,331 - chatbot_rag - INFO - [analysis_20250519_131954] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_131954_raw.txt
2025-05-19 13:19:54,332 - chatbot_rag - INFO - [analysis_20250519_131954] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "alo", which is a casual way of ...
2025-05-19 13:19:54,334 - chatbot_rag - WARNING - [analysis_20250519_131954] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:19:54,335 - chatbot_rag - INFO - [analysis_20250519_131954] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:19:54,336 - chatbot_rag - INFO - [analysis_20250519_131954] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:19:54,336 - chatbot_rag - INFO - [analysis_20250519_131954] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:19:54,336 - chatbot_rag - WARNING - [analysis_20250519_131954] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:19:54,337 - chatbot_rag - INFO - [analysis_20250519_131954] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:19:54,341 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:19:54,341 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:19:54,344 - chatbot_rag - ERROR - [analysis_20250519_131954] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:19:54,344 - chatbot_rag - WARNING - [analysis_20250519_131954] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:19:54,346 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:19:54,347 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /no_think
2025-05-19 13:19:54,349 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:19:54,350 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:54,353 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:19:54,354 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:19:54,354 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:54,356 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_131954.txt
2025-05-19 13:19:54,357 - chatbot_rag - INFO - Kích thước prompt: 1028 ký tự
2025-05-19 13:19:54,360 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:19:54,361 - chatbot_rag - INFO - Tổng kích thước: 1944 ký tự
2025-05-19 13:19:54,364 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131954.txt
2025-05-19 13:19:54,364 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:19:54,365 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "alo /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **M...
2025-05-19 13:19:54,366 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:19:55,321 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:55,322 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

💬 *Alo?*  
Bạn muốn hỏi gì ạ? 😎  
Nếu muốn biết quy trình, cứ hỏi rõ ràng nhé!  
Nếu muốn nói chuyện, mình cũng có thể "nói chuyện" 😏  
Để biết chi tiết công việc cụ thể, vui lòng h
2025-05-19 13:19:55,325 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131955.txt
2025-05-19 13:19:55,925 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 267 ký tự phản hồi
2025-05-19 13:19:55,925 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:19:55,928 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:55,936 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alo /no_think","session_id":"e0df431d-450f-4bef-8199-b825d084b908"}
2025-05-19 13:19:55,937 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:55,937 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alo /no_think...
2025-05-19 13:19:55,938 - websocket_server - INFO - Nhận tin nhắn thông thường: alo /no_think, enable_thinking=False
2025-05-19 13:19:55,938 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 13:19:55,940 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_131955.txt
2025-05-19 13:19:55,941 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo

alo /no_think, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:55,942 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:55,942 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:19:55,943 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

alo /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-19 13:19:55,943 - chatbot_rag - INFO - Kích thước prompt: 629 ký tự
2025-05-19 13:19:55,944 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:19:55,945 - chatbot_rag - INFO - Tổng kích thước: 2635 ký tự
2025-05-19 13:19:55,950 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131955.txt
2025-05-19 13:19:55,951 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:19:55,955 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

alo /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên p...
2025-05-19 13:19:55,957 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:19:56,334 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:56,338 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:19:56,349 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131956.txt
2025-05-19 13:19:56,369 - chatbot_rag - INFO - [analysis_20250519_131956] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_131956_raw.txt
2025-05-19 13:19:56,370 - chatbot_rag - INFO - [analysis_20250519_131956] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:19:56,371 - chatbot_rag - WARNING - [analysis_20250519_131956] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:19:56,372 - chatbot_rag - INFO - [analysis_20250519_131956] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:19:56,372 - chatbot_rag - INFO - [analysis_20250519_131956] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:19:56,373 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:19:56,373 - websocket_server - INFO - Xử lý streaming response cho: 'alo /no_think', phòng ban: None, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:56,373 - websocket_server - INFO - Session ID nhận được: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:56,374 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alo
2025-05-19 13:19:56,374 - websocket_server - INFO - Xử lý streaming response. Query: 'alo', Mode thinking: False
2025-05-19 13:19:56,374 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 13:19:56,377 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_131956.txt
2025-05-19 13:19:56,378 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo

alo, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:56,378 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:56,379 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:19:56,379 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

alo"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban h...
2025-05-19 13:19:56,379 - chatbot_rag - INFO - Kích thước prompt: 619 ký tự
2025-05-19 13:19:56,380 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:19:56,380 - chatbot_rag - INFO - Tổng kích thước: 2625 ký tự
2025-05-19 13:19:56,382 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131956.txt
2025-05-19 13:19:56,383 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:19:56,383 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo

alo"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban h...
2025-05-19 13:19:56,383 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:19:57,805 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:57,805 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user's current question is "Lịch sử tin nhắn: Người dùng: alo alo". Hmm, the history is just "alo" repeated. The user is asking about the chat history, but the content is 
2025-05-19 13:19:57,808 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131957.txt
2025-05-19 13:19:57,810 - chatbot_rag - INFO - [analysis_20250519_131957] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_131957_raw.txt
2025-05-19 13:19:57,811 - chatbot_rag - INFO - [analysis_20250519_131957] Phản hồi gốc: <think>
Okay, let's see. The user's current question is "Lịch sử tin nhắn: Người dùng: alo alo". Hmm...
2025-05-19 13:19:57,811 - chatbot_rag - WARNING - [analysis_20250519_131957] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:19:57,811 - chatbot_rag - INFO - [analysis_20250519_131957] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:19:57,812 - chatbot_rag - INFO - [analysis_20250519_131957] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:19:57,812 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:19:57,812 - websocket_server - INFO - Query thực tế gửi đến mô hình: alo /no_think
2025-05-19 13:19:57,813 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:19:57,813 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:57,816 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:19:57,816 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:19:57,817 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:57,819 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_131957.txt
2025-05-19 13:19:57,820 - chatbot_rag - INFO - Kích thước prompt: 1028 ký tự
2025-05-19 13:19:57,820 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:19:57,820 - chatbot_rag - INFO - Tổng kích thước: 1944 ký tự
2025-05-19 13:19:57,823 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_131957.txt
2025-05-19 13:19:57,823 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:19:57,823 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "alo /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **M...
2025-05-19 13:19:57,824 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:19:58,731 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:19:58,731 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

💬 *Alo?*  
👉 Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: "Phòng Marketing làm gì trong giai đoạn MKT-SALES?"  

🎉 *Chào bạn! 😄*  
Bạn muốn hỏi về
2025-05-19 13:19:58,733 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_131958.txt
2025-05-19 13:19:58,737 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 251 ký tự phản hồi
2025-05-19 13:19:58,738 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:19:58,738 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:19:58,740 - websocket_server - INFO - WebSocket connection closed
2025-05-19 13:19:58,741 - websockets.server - INFO - connection closed
2025-05-19 13:19:58,742 - websockets.server - INFO - connection open
2025-05-19 13:19:58,747 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,113 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"? /no_think","session_id":"e0df431d-450f-4bef-8199-b825d084b908"}
2025-05-19 13:20:03,114 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,114 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: ? /no_think...
2025-05-19 13:20:03,115 - websocket_server - INFO - Nhận tin nhắn thông thường: ? /no_think, enable_thinking=False
2025-05-19 13:20:03,115 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 13:20:03,117 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132003.txt
2025-05-19 13:20:03,117 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

? /no_think, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,117 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,118 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:20:03,118 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

? /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depar...
2025-05-19 13:20:03,118 - chatbot_rag - INFO - Kích thước prompt: 643 ký tự
2025-05-19 13:20:03,119 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:20:03,119 - chatbot_rag - INFO - Tổng kích thước: 2649 ký tự
2025-05-19 13:20:03,121 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132003.txt
2025-05-19 13:20:03,121 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:20:03,122 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

? /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"depar...
2025-05-19 13:20:03,122 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:20:03,487 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:20:03,488 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:20:03,488 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132003.txt
2025-05-19 13:20:03,491 - chatbot_rag - INFO - [analysis_20250519_132003] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132003_raw.txt
2025-05-19 13:20:03,491 - chatbot_rag - INFO - [analysis_20250519_132003] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:20:03,492 - chatbot_rag - WARNING - [analysis_20250519_132003] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:20:03,492 - chatbot_rag - INFO - [analysis_20250519_132003] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:20:03,492 - chatbot_rag - INFO - [analysis_20250519_132003] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:20:03,493 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:20:03,493 - websocket_server - INFO - Xử lý streaming response cho: '? /no_think', phòng ban: None, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,493 - websocket_server - INFO - Session ID nhận được: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,494 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: ?
2025-05-19 13:20:03,494 - websocket_server - INFO - Xử lý streaming response. Query: '?', Mode thinking: False
2025-05-19 13:20:03,494 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 13:20:03,496 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132003.txt
2025-05-19 13:20:03,496 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

?, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,498 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:03,499 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:20:03,499 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

?"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "t...
2025-05-19 13:20:03,500 - chatbot_rag - INFO - Kích thước prompt: 633 ký tự
2025-05-19 13:20:03,500 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:20:03,500 - chatbot_rag - INFO - Tổng kích thước: 2639 ký tự
2025-05-19 13:20:03,501 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132003.txt
2025-05-19 13:20:03,502 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:20:03,502 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo

?"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "t...
2025-05-19 13:20:03,502 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:20:05,292 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:20:05,293 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user provided a history of messages where they just said "alo" twice. The current question is asking about the history of messages, but it's unclear what exa
2025-05-19 13:20:05,297 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132005.txt
2025-05-19 13:20:05,303 - chatbot_rag - INFO - [analysis_20250519_132005] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132005_raw.txt
2025-05-19 13:20:05,304 - chatbot_rag - INFO - [analysis_20250519_132005] Phản hồi gốc: <think>
Okay, let's tackle this query. The user provided a history of messages where they just said ...
2025-05-19 13:20:05,305 - chatbot_rag - WARNING - [analysis_20250519_132005] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:20:05,305 - chatbot_rag - INFO - [analysis_20250519_132005] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:20:05,306 - chatbot_rag - INFO - [analysis_20250519_132005] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:20:05,306 - chatbot_rag - INFO - [analysis_20250519_132005] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:20:05,307 - chatbot_rag - WARNING - [analysis_20250519_132005] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:20:05,308 - chatbot_rag - INFO - [analysis_20250519_132005] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:20:05,316 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:20:05,316 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:20:05,317 - chatbot_rag - ERROR - [analysis_20250519_132005] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:20:05,317 - chatbot_rag - WARNING - [analysis_20250519_132005] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:20:05,319 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:20:05,320 - websocket_server - INFO - Query thực tế gửi đến mô hình: ? /no_think
2025-05-19 13:20:05,320 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:20:05,320 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:05,326 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:20:05,326 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:20:05,326 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:05,327 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_132005.txt
2025-05-19 13:20:05,328 - chatbot_rag - INFO - Kích thước prompt: 1026 ký tự
2025-05-19 13:20:05,329 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:20:05,329 - chatbot_rag - INFO - Tổng kích thước: 1942 ký tự
2025-05-19 13:20:05,333 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132005.txt
2025-05-19 13:20:05,333 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:20:05,334 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "? /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1. **MKT...
2025-05-19 13:20:05,335 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:20:07,913 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:20:07,915 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**❓ Câu hỏi chung về quy trình làm việc?**  
Không có vấn đề gì! Công ty chúng ta có 11 phòng ban và 5 giai đoạn chính, mỗi giai đoạn đều có vai trò quan trọng trong quy trình.  

*
2025-05-19 13:20:07,919 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132007.txt
2025-05-19 13:20:07,933 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 840 ký tự phản hồi
2025-05-19 13:20:07,935 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:20:07,937 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:09,921 - websockets.server - INFO - connection closed
2025-05-19 13:20:10,877 - websockets.server - INFO - connection open
2025-05-19 13:20:10,879 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:21,631 - websockets.server - INFO - connection closed
2025-05-19 13:20:22,652 - websockets.server - INFO - connection open
2025-05-19 13:20:22,656 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:41,515 - websockets.server - INFO - connection closed
2025-05-19 13:20:42,577 - websockets.server - INFO - connection open
2025-05-19 13:20:42,578 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:20:54,579 - websockets.server - INFO - connection closed
2025-05-19 13:20:55,821 - websockets.server - INFO - connection open
2025-05-19 13:20:55,823 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:21:10,522 - websockets.server - INFO - connection closed
2025-05-19 13:21:11,574 - websockets.server - INFO - connection open
2025-05-19 13:21:11,575 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:22:14,649 - websockets.server - INFO - connection open
2025-05-19 13:22:14,654 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:23:00,540 - websockets.server - INFO - connection open
2025-05-19 13:23:00,546 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:23:00,553 - websockets.server - INFO - connection open
2025-05-19 13:23:00,555 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:25,481 - websockets.server - INFO - connection closed
2025-05-19 13:26:25,482 - websockets.server - INFO - connection closed
2025-05-19 13:26:25,482 - websockets.server - INFO - connection closed
2025-05-19 13:26:25,483 - websockets.server - INFO - connection closed
2025-05-19 13:26:26,378 - websockets.server - INFO - connection open
2025-05-19 13:26:26,380 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,133 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"tôi là 2D /no_think","session_id":"e0df431d-450f-4bef-8199-b825d084b908"}
2025-05-19 13:26:37,134 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,134 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: tôi là 2D /no_think...
2025-05-19 13:26:37,134 - websocket_server - INFO - Nhận tin nhắn thông thường: tôi là 2D /no_think, enable_thinking=False
2025-05-19 13:26:37,135 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 13:26:37,138 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132637.txt
2025-05-19 13:26:37,139 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo
Người dùng: ?

tôi là 2D /no_think, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,141 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,142 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:26:37,143 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo
Người dùng: ?

tôi là 2D /no_think"

        Phân tích câu hỏi và trả về JSON có định...
2025-05-19 13:26:37,145 - chatbot_rag - INFO - Kích thước prompt: 665 ký tự
2025-05-19 13:26:37,146 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:26:37,146 - chatbot_rag - INFO - Tổng kích thước: 2671 ký tự
2025-05-19 13:26:37,148 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132637.txt
2025-05-19 13:26:37,148 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:26:37,149 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: alo
Người dùng: alo
Người dùng: ?

tôi là 2D /no_think"

        Phân tích câu hỏi và trả về JSON có định...
2025-05-19 13:26:37,150 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:26:37,611 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:26:37,613 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}
2025-05-19 13:26:37,616 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132637.txt
2025-05-19 13:26:37,617 - chatbot_rag - INFO - [analysis_20250519_132637] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132637_raw.txt
2025-05-19 13:26:37,618 - chatbot_rag - INFO - [analysis_20250519_132637] Phản hồi gốc: <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}...
2025-05-19 13:26:37,618 - chatbot_rag - WARNING - [analysis_20250519_132637] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:26:37,619 - chatbot_rag - INFO - [analysis_20250519_132637] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:26:37,619 - chatbot_rag - INFO - [analysis_20250519_132637] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': '2D', 'query_type': 'department_specific', 'error': False}
2025-05-19 13:26:37,619 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 13:26:37,619 - websocket_server - INFO - Xử lý streaming response cho: 'tôi là 2D /no_think', phòng ban: 2D, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,620 - websocket_server - INFO - Session ID nhận được: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,621 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: tôi là 2D
2025-05-19 13:26:37,621 - websocket_server - INFO - Xử lý streaming response. Query: 'tôi là 2D', Mode thinking: False
2025-05-19 13:26:37,621 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 13:26:37,622 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132637.txt
2025-05-19 13:26:37,622 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 13:26:37,622 - websocket_server - INFO - Query thực tế gửi đến mô hình: tôi là 2D /no_think
2025-05-19 13:26:37,623 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: 2D, chế độ thinking: False
2025-05-19 13:26:37,623 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: 2D, Session: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,637 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:26:37,639 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 13:26:37,640 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 13:26:37,645 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 13:26:37,646 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: 2D, session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,646 - chatbot_rag - INFO - Số task: 3
2025-05-19 13:26:37,647 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:37,647 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session e0df431d-450f-4bef-8199-b825d084b908.
2025-05-19 13:26:37,649 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 13:26:37,651 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_132637.txt
2025-05-19 13:26:37,651 - chatbot_rag - INFO - Kích thước prompt: 2042 ký tự
2025-05-19 13:26:37,652 - chatbot_rag - INFO - Kích thước system prompt: 1983 ký tự
2025-05-19 13:26:37,652 - chatbot_rag - INFO - Tổng kích thước: 4025 ký tự
2025-05-19 13:26:37,654 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132637.txt
2025-05-19 13:26:37,654 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 13:26:37,655 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "tôi là 2D /no_think"

    THÔNG TIN PHÒNG BAN 2D:
    - Số lượng tasks: 3
   ...
2025-05-19 13:26:37,655 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:26:41,121 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:26:41,122 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

🎯 **Chào bạn 2D!** 🎉  
Bạn đang ở phòng ban **2D** với 3 task như sau:

---

### 🏗️ **GIAI ĐOẠN CONSTRUCTION**  
**Task thuộc giai đoạn này:**  
1. **2D-001** - Chuẩn bị kick-off nộ
2025-05-19 13:26:41,126 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132641.txt
2025-05-19 13:26:41,130 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_132637.txt
2025-05-19 13:26:41,131 - chatbot_rag - INFO - Thời gian truy vấn LLM: 3.49 giây
2025-05-19 13:26:41,144 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 13:26:41,145 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 13:26:41,145 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 13:26:44,204 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 989 ký tự phản hồi
2025-05-19 13:26:44,205 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:26:44,205 - websocket_server - INFO - Đã lưu hội thoại phòng ban 2D vào lịch sử của session e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:44,207 - websocket_server - INFO - WebSocket connection closed
2025-05-19 13:26:44,207 - websockets.server - INFO - connection closed
2025-05-19 13:26:44,208 - websockets.server - INFO - connection open
2025-05-19 13:26:44,209 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: e0df431d-450f-4bef-8199-b825d084b908
2025-05-19 13:26:56,174 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"giai đoạn tiếp theo làm gì /no_think","session_id":"b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,175 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,176 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: giai đoạn tiếp theo làm gì /no_think...
2025-05-19 13:26:56,177 - websocket_server - INFO - Nhận tin nhắn thông thường: giai đoạn tiếp theo làm gì /no_think, enable_thinking=False
2025-05-19 13:26:56,177 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:26:56,178 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: giai đoạn tiếp theo làm gì /no_think, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,178 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,178 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:26:56,179 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặ...
2025-05-19 13:26:56,179 - chatbot_rag - INFO - Kích thước prompt: 617 ký tự
2025-05-19 13:26:56,179 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:26:56,179 - chatbot_rag - INFO - Tổng kích thước: 2623 ký tự
2025-05-19 13:26:56,182 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132656.txt
2025-05-19 13:26:56,183 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:26:56,183 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặ...
2025-05-19 13:26:56,183 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:26:56,547 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:26:56,547 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:26:56,549 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132656.txt
2025-05-19 13:26:56,551 - chatbot_rag - INFO - [analysis_20250519_132656] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132656_raw.txt
2025-05-19 13:26:56,552 - chatbot_rag - INFO - [analysis_20250519_132656] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:26:56,552 - chatbot_rag - WARNING - [analysis_20250519_132656] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:26:56,553 - chatbot_rag - INFO - [analysis_20250519_132656] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:26:56,553 - chatbot_rag - INFO - [analysis_20250519_132656] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:26:56,553 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:26:56,554 - websocket_server - INFO - Xử lý streaming response cho: 'giai đoạn tiếp theo làm gì /no_think', phòng ban: None, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,554 - websocket_server - INFO - Session ID nhận được: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,555 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: giai đoạn tiếp theo làm gì
2025-05-19 13:26:56,555 - websocket_server - INFO - Xử lý streaming response. Query: 'giai đoạn tiếp theo làm gì', Mode thinking: False
2025-05-19 13:26:56,555 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:26:56,556 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: giai đoạn tiếp theo làm gì, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,556 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:56,556 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:26:56,557 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "...
2025-05-19 13:26:56,558 - chatbot_rag - INFO - Kích thước prompt: 607 ký tự
2025-05-19 13:26:56,559 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:26:56,559 - chatbot_rag - INFO - Tổng kích thước: 2613 ký tự
2025-05-19 13:26:56,561 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132656.txt
2025-05-19 13:26:56,561 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:26:56,562 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "...
2025-05-19 13:26:56,562 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:26:58,350 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:26:58,351 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is "giai đoạn tiếp theo làm gì," which translates to "What's the next step?" The history of messages is empty, so there's no prior co
2025-05-19 13:26:58,353 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132658.txt
2025-05-19 13:26:58,357 - chatbot_rag - INFO - [analysis_20250519_132658] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132658_raw.txt
2025-05-19 13:26:58,358 - chatbot_rag - INFO - [analysis_20250519_132658] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is "giai đoạn tiếp theo làm gì," ...
2025-05-19 13:26:58,358 - chatbot_rag - WARNING - [analysis_20250519_132658] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:26:58,358 - chatbot_rag - INFO - [analysis_20250519_132658] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:26:58,359 - chatbot_rag - INFO - [analysis_20250519_132658] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:26:58,359 - chatbot_rag - INFO - [analysis_20250519_132658] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:26:58,359 - chatbot_rag - WARNING - [analysis_20250519_132658] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:26:58,360 - chatbot_rag - INFO - [analysis_20250519_132658] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:26:58,364 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:26:58,365 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:26:58,365 - chatbot_rag - ERROR - [analysis_20250519_132658] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:26:58,366 - chatbot_rag - WARNING - [analysis_20250519_132658] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:26:58,366 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:26:58,366 - websocket_server - INFO - Query thực tế gửi đến mô hình: giai đoạn tiếp theo làm gì /no_think
2025-05-19 13:26:58,366 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:26:58,367 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:58,372 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:26:58,373 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:26:58,373 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:26:58,375 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_132658.txt
2025-05-19 13:26:58,376 - chatbot_rag - INFO - Kích thước prompt: 1051 ký tự
2025-05-19 13:26:58,377 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:26:58,377 - chatbot_rag - INFO - Tổng kích thước: 1967 ký tự
2025-05-19 13:26:58,380 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132658.txt
2025-05-19 13:26:58,381 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:26:58,382 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "giai đoạn tiếp theo làm gì /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính ...
2025-05-19 13:26:58,382 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:27:00,155 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:00,155 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào giai đoạn hiện tại. Ví dụ:

- Nếu đang ở **MKT-SALES**, giai đoạn tiếp theo là **PROPOSAL**
- Nếu đang ở 
2025-05-19 13:27:00,158 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132700.txt
2025-05-19 13:27:00,163 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 577 ký tự phản hồi
2025-05-19 13:27:00,163 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:27:00,163 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:04,835 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: ```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào giai đoạn hiện tại. Ví d
2025-05-19 13:27:04,837 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 13:27:04,838 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132704.txt
2025-05-19 13:27:04,838 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-19 13:27:04,839 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào giai đoạn hiện tại. Ví dụ:

- Nếu đang ở **MKT-SALES**, giai đoạn tiếp theo là **PROPOSAL**
- Nếu đang ở **PROPOSAL**, giai đoạn tiếp theo là **CONSTRUCTION**
- Nếu đang ở **CONSTRUCTION**, giai đoạn tiếp theo là **DEFECT-HANDOVER**
- Nếu đang ở **DEFECT-HANDOVER**, giai đoạn tiếp theo là **AFTERSALE-MAINTENANCE**

👉 Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: "Phòng Kinh doanh làm gì trong giai đoạn PROPOSAL?" hoặc "Phòng Thi công tham gia những bước nào?"
```, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:04,839 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:04,840 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:27:04,840 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào g...
2025-05-19 13:27:04,840 - chatbot_rag - INFO - Kích thước prompt: 1216 ký tự
2025-05-19 13:27:04,841 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:27:04,841 - chatbot_rag - INFO - Tổng kích thước: 3222 ký tự
2025-05-19 13:27:04,843 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132704.txt
2025-05-19 13:27:04,844 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:27:04,845 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào g...
2025-05-19 13:27:04,845 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:27:06,797 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:06,798 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is about the next stage in a process, referencing the previous message. The history shows that the user asked, "giai đoạn tiếp theo l
2025-05-19 13:27:06,800 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132706.txt
2025-05-19 13:27:06,802 - chatbot_rag - INFO - [analysis_20250519_132706] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132706_raw.txt
2025-05-19 13:27:06,802 - chatbot_rag - INFO - [analysis_20250519_132706] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is about the next stage in a proc...
2025-05-19 13:27:06,803 - chatbot_rag - WARNING - [analysis_20250519_132706] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:27:06,803 - chatbot_rag - INFO - [analysis_20250519_132706] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:27:06,803 - chatbot_rag - INFO - [analysis_20250519_132706] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:27:06,803 - chatbot_rag - INFO - [analysis_20250519_132706] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:27:06,804 - chatbot_rag - WARNING - [analysis_20250519_132706] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:27:06,804 - chatbot_rag - INFO - [analysis_20250519_132706] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:27:06,808 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:27:06,808 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:27:06,809 - chatbot_rag - INFO - [analysis_20250519_132706] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Kinh doanh
2025-05-19 13:27:06,809 - chatbot_rag - ERROR - [analysis_20250519_132706] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:27:06,810 - chatbot_rag - WARNING - [analysis_20250519_132706] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:27:06,810 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-19 13:27:06,810 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:06,813 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:27:06,813 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:27:06,814 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:06,815 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_132706.txt
2025-05-19 13:27:06,815 - chatbot_rag - INFO - Kích thước prompt: 1599 ký tự
2025-05-19 13:27:06,815 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:27:06,816 - chatbot_rag - INFO - Tổng kích thước: 2515 ký tự
2025-05-19 13:27:06,817 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132706.txt
2025-05-19 13:27:06,818 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:27:06,819 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào giai đoạn hiện tại. Ví dụ:

- Nếu đang ở **MKT-SALES**, giai đoạn tiếp theo là **PROPOSAL**
- Nếu đang ở **PROPOS...
2025-05-19 13:27:06,819 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:27:19,633 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:19,637 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user is asking about the next phase in a process, depending on the current phase. They provided examples like MKT-SALES leading to PROPOSAL, and so on. The main task here 
2025-05-19 13:27:19,641 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132719.txt
2025-05-19 13:27:19,653 - websocket_server - INFO - Đã trích xuất thinking (6265 ký tự) và còn lại 675 ký tự phản hồi
2025-05-19 13:27:19,654 - websocket_server - INFO - Đã trích xuất phần thinking (6265 ký tự) từ phản hồi handle_general_query
2025-05-19 13:27:19,654 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747636024835_ony2v81
2025-05-19 13:27:19,656 - websocket_server - INFO - Đã gửi nội dung thinking (6265 ký tự)
2025-05-19 13:27:19,658 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"alf sao /no_think","session_id":"b2f4a882-8994-4bd2-8ce3-f220e8f787c5"}
2025-05-19 13:27:19,659 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:19,660 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: alf sao /no_think...
2025-05-19 13:27:19,660 - websocket_server - INFO - Nhận tin nhắn thông thường: alf sao /no_think, enable_thinking=False
2025-05-19 13:27:19,660 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 13:27:19,668 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132719.txt
2025-05-19 13:27:19,669 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao /no_think, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:19,670 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:19,670 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:27:19,671 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
  ...
2025-05-19 13:27:19,671 - chatbot_rag - INFO - Kích thước prompt: 656 ký tự
2025-05-19 13:27:19,672 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:27:19,672 - chatbot_rag - INFO - Tổng kích thước: 2662 ký tự
2025-05-19 13:27:19,678 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132719.txt
2025-05-19 13:27:19,680 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:27:19,682 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
  ...
2025-05-19 13:27:19,682 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:27:20,062 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:20,063 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:27:20,066 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132720.txt
2025-05-19 13:27:20,077 - chatbot_rag - INFO - [analysis_20250519_132720] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132720_raw.txt
2025-05-19 13:27:20,077 - chatbot_rag - INFO - [analysis_20250519_132720] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:27:20,081 - chatbot_rag - WARNING - [analysis_20250519_132720] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:27:20,082 - chatbot_rag - INFO - [analysis_20250519_132720] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:27:20,083 - chatbot_rag - INFO - [analysis_20250519_132720] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:27:20,085 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:27:20,088 - websocket_server - INFO - Xử lý streaming response cho: 'alf sao /no_think', phòng ban: None, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:20,093 - websocket_server - INFO - Session ID nhận được: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:20,095 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: alf sao
2025-05-19 13:27:20,096 - websocket_server - INFO - Xử lý streaming response. Query: 'alf sao', Mode thinking: False
2025-05-19 13:27:20,098 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 13:27:20,108 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_132720.txt
2025-05-19 13:27:20,109 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:20,110 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:20,111 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:27:20,115 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"de...
2025-05-19 13:27:20,119 - chatbot_rag - INFO - Kích thước prompt: 646 ký tự
2025-05-19 13:27:20,122 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:27:20,123 - chatbot_rag - INFO - Tổng kích thước: 2652 ký tự
2025-05-19 13:27:20,134 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132720.txt
2025-05-19 13:27:20,136 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:27:20,138 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

alf sao"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"de...
2025-05-19 13:27:20,146 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:27:21,950 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:21,951 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng: giai đoạn tiếp theo làm gì alf sao". First, I need to parse this. The user is asking about the next
2025-05-19 13:27:21,954 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132721.txt
2025-05-19 13:27:21,957 - chatbot_rag - INFO - [analysis_20250519_132721] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_132721_raw.txt
2025-05-19 13:27:21,959 - chatbot_rag - INFO - [analysis_20250519_132721] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng:...
2025-05-19 13:27:21,960 - chatbot_rag - WARNING - [analysis_20250519_132721] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:27:21,961 - chatbot_rag - INFO - [analysis_20250519_132721] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:27:21,961 - chatbot_rag - INFO - [analysis_20250519_132721] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:27:21,961 - chatbot_rag - INFO - [analysis_20250519_132721] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:27:21,962 - chatbot_rag - WARNING - [analysis_20250519_132721] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:27:21,962 - chatbot_rag - INFO - [analysis_20250519_132721] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:27:21,967 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:27:21,968 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:27:21,968 - chatbot_rag - ERROR - [analysis_20250519_132721] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:27:21,970 - chatbot_rag - WARNING - [analysis_20250519_132721] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:27:21,971 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:27:21,971 - websocket_server - INFO - Query thực tế gửi đến mô hình: alf sao /no_think
2025-05-19 13:27:21,971 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:27:21,972 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:21,978 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:27:21,978 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:27:21,980 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:27:21,983 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_132721.txt
2025-05-19 13:27:21,985 - chatbot_rag - INFO - Kích thước prompt: 1032 ký tự
2025-05-19 13:27:21,987 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:27:21,989 - chatbot_rag - INFO - Tổng kích thước: 1948 ký tự
2025-05-19 13:27:21,995 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_132721.txt
2025-05-19 13:27:22,005 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:27:22,010 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "alf sao /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1....
2025-05-19 13:27:22,013 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:27:23,471 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:27:23,473 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**🚨 CẢNH GIÁC! 🚨**  
"Alf sao" là một câu hỏi chung chung, không liên quan đến quy trình, giai đoạn hay phòng ban.  

🤣 *Alf sao?*  
👉 Có phải bạn đang hỏi về **Alf** - chú mèo trun
2025-05-19 13:27:23,480 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_132723.txt
2025-05-19 13:27:23,493 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 380 ký tự phản hồi
2025-05-19 13:27:23,495 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:27:23,496 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:30:25,156 - websockets.server - INFO - connection open
2025-05-19 13:30:25,158 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:31:18,680 - websockets.server - INFO - connection open
2025-05-19 13:31:18,684 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:31:41,691 - websockets.server - INFO - connection open
2025-05-19 13:31:41,692 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:32:01,617 - websockets.server - INFO - connection open
2025-05-19 13:32:01,618 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:32:24,633 - websockets.server - INFO - connection open
2025-05-19 13:32:24,638 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:32:43,728 - websockets.server - INFO - connection open
2025-05-19 13:32:43,729 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:33:13,909 - websockets.server - INFO - connection open
2025-05-19 13:33:13,910 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:38:05,845 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,846 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,847 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,847 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,847 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,848 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,848 - websockets.server - INFO - connection closed
2025-05-19 13:38:05,848 - websockets.server - INFO - connection closed
2025-05-19 13:38:06,969 - websockets.server - INFO - connection open
2025-05-19 13:38:06,972 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:38:22,960 - websockets.server - INFO - connection closed
2025-05-19 13:38:24,050 - websockets.server - INFO - connection open
2025-05-19 13:38:24,055 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:03,883 - websockets.server - INFO - connection closed
2025-05-19 13:39:05,245 - websockets.server - INFO - connection open
2025-05-19 13:39:05,248 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:14,010 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"giai đoạn tiếp theo làm gì /no_think","session_id":"b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:14,011 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:14,011 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: giai đoạn tiếp theo làm gì /no_think...
2025-05-19 13:39:14,012 - websocket_server - INFO - Nhận tin nhắn thông thường: giai đoạn tiếp theo làm gì /no_think, enable_thinking=False
2025-05-19 13:39:14,012 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 13:39:14,017 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_133914.txt
2025-05-19 13:39:14,019 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì /no_think, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:14,020 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:14,021 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:39:14,022 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì /no_think"

        Phân tích ...
2025-05-19 13:39:14,023 - chatbot_rag - INFO - Kích thước prompt: 695 ký tự
2025-05-19 13:39:14,025 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:39:14,025 - chatbot_rag - INFO - Tổng kích thước: 2701 ký tự
2025-05-19 13:39:14,030 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_133914.txt
2025-05-19 13:39:14,032 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:39:14,033 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì /no_think"

        Phân tích ...
2025-05-19 13:39:14,035 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:39:15,513 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:39:15,514 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:39:15,515 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_133915.txt
2025-05-19 13:39:15,519 - chatbot_rag - INFO - [analysis_20250519_133915] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_133915_raw.txt
2025-05-19 13:39:15,520 - chatbot_rag - INFO - [analysis_20250519_133915] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:39:15,521 - chatbot_rag - WARNING - [analysis_20250519_133915] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:39:15,521 - chatbot_rag - INFO - [analysis_20250519_133915] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:39:15,521 - chatbot_rag - INFO - [analysis_20250519_133915] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:39:15,522 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:39:15,522 - websocket_server - INFO - Xử lý streaming response cho: 'giai đoạn tiếp theo làm gì /no_think', phòng ban: None, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:15,522 - websocket_server - INFO - Session ID nhận được: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:15,523 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: giai đoạn tiếp theo làm gì
2025-05-19 13:39:15,523 - websocket_server - INFO - Xử lý streaming response. Query: 'giai đoạn tiếp theo làm gì', Mode thinking: False
2025-05-19 13:39:15,525 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 13:39:15,530 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_133915.txt
2025-05-19 13:39:15,533 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì, session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:15,534 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:15,534 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:39:15,534 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và...
2025-05-19 13:39:15,535 - chatbot_rag - INFO - Kích thước prompt: 685 ký tự
2025-05-19 13:39:15,535 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:39:15,535 - chatbot_rag - INFO - Tổng kích thước: 2691 ký tự
2025-05-19 13:39:15,540 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_133915.txt
2025-05-19 13:39:15,541 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:39:15,542 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: alf sao

giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và...
2025-05-19 13:39:15,542 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:39:24,921 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:39:24,921 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break down this query. The user is asking about the next step in a process, and they mentioned "giai đoạn tiếp theo làm gì" which translates to "what's the next step?" Looking at t
2025-05-19 13:39:24,924 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_133924.txt
2025-05-19 13:39:24,926 - chatbot_rag - INFO - [analysis_20250519_133924] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_133924_raw.txt
2025-05-19 13:39:24,927 - chatbot_rag - INFO - [analysis_20250519_133924] Phản hồi gốc: <think>
Okay, let's break down this query. The user is asking about the next step in a process, and ...
2025-05-19 13:39:24,927 - chatbot_rag - WARNING - [analysis_20250519_133924] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:39:24,928 - chatbot_rag - INFO - [analysis_20250519_133924] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:39:24,929 - chatbot_rag - INFO - [analysis_20250519_133924] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:39:24,929 - chatbot_rag - INFO - [analysis_20250519_133924] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:39:24,929 - chatbot_rag - WARNING - [analysis_20250519_133924] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:39:24,930 - chatbot_rag - INFO - [analysis_20250519_133924] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:39:24,935 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:39:24,936 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:39:24,936 - chatbot_rag - ERROR - [analysis_20250519_133924] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:39:24,937 - chatbot_rag - WARNING - [analysis_20250519_133924] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:39:24,937 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:39:24,937 - websocket_server - INFO - Query thực tế gửi đến mô hình: giai đoạn tiếp theo làm gì /no_think
2025-05-19 13:39:24,938 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:39:24,938 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:24,941 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:39:24,942 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:39:24,943 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:39:24,944 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_133924.txt
2025-05-19 13:39:24,945 - chatbot_rag - INFO - Kích thước prompt: 1051 ký tự
2025-05-19 13:39:24,946 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:39:24,947 - chatbot_rag - INFO - Tổng kích thước: 1967 ký tự
2025-05-19 13:39:24,949 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_133924.txt
2025-05-19 13:39:24,949 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:39:24,950 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "giai đoạn tiếp theo làm gì /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính ...
2025-05-19 13:39:24,950 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:39:30,190 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:39:30,191 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```markdown
# Giai đoạn tiếp theo là gì?

Giai đoạn tiếp theo phụ thuộc vào giai đoạn hiện tại. Vui lòng chỉ rõ bạn đang ở giai đoạn nào để mình có thể hỗ trợ chính xác nhé! ✨

Để b
2025-05-19 13:39:30,196 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_133930.txt
2025-05-19 13:39:30,221 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 315 ký tự phản hồi
2025-05-19 13:39:30,222 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:39:30,223 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session b2f4a882-8994-4bd2-8ce3-f220e8f787c5
2025-05-19 13:40:38,032 - websockets.server - INFO - connection closed
2025-05-19 13:40:38,033 - websockets.server - INFO - server closing
2025-05-19 13:40:38,033 - websockets.server - INFO - server closed
2025-05-19 13:40:38,035 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 13:40:39,748 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 13:40:39,776 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 13:40:39,777 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 13:40:39,777 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 13:40:48,625 - websockets.server - INFO - connection open
2025-05-19 13:40:48,629 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:48,761 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:48,762 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:51,531 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:51,531 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:51,533 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:51,533 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,669 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,669 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,690 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,690 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,697 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,697 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,704 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,705 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,711 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,712 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,718 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,718 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,723 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,724 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,731 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,732 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,738 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,739 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,747 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,747 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,753 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,754 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,761 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,762 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,767 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,768 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,774 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,775 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,781 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,781 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,788 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,789 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,794 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,795 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,801 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,801 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,806 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,807 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,814 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,814 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,820 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,820 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,826 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,826 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,832 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,832 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,837 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,838 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,844 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,844 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,851 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,851 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,857 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,858 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,864 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,864 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,869 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,870 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,876 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,876 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,888 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,889 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,897 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,897 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,909 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,909 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,916 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,917 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,923 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,923 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,935 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,935 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,941 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,942 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,950 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,950 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,957 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,958 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,968 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,968 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,974 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,974 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,984 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,985 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:53,995 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:53,995 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,002 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,003 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,016 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,017 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,021 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,021 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,030 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,030 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,038 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,038 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,047 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,048 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,055 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,056 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,062 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,063 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,069 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,070 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,076 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,076 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,084 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,085 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,092 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,092 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,100 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,100 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,107 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,108 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,114 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,116 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,122 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,123 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,130 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,132 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,140 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,140 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,148 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,148 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,155 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,155 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,159 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,159 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,166 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,166 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,172 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,173 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,179 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,179 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,186 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,187 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,194 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,194 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,201 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,201 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,209 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,210 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,215 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,216 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,222 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,222 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,227 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,227 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,235 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,235 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,240 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,241 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,247 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,247 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,252 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,253 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,260 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,261 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,267 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,267 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,274 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,274 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,279 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,280 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,285 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,286 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,291 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,292 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,297 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,297 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,303 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,304 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,308 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,309 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,316 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,317 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,325 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,326 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,334 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,334 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,341 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,341 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,349 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,349 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,364 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,365 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,369 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,369 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,382 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,382 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,385 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,386 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,391 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,392 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,396 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,396 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,403 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,403 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,408 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,409 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,414 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,415 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,419 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,420 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,427 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,427 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,431 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,432 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,438 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,438 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,445 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,446 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,452 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,452 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,457 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,457 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,462 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,462 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,467 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,467 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,472 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,472 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,477 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,478 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,482 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,482 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,487 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,488 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,492 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,492 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,497 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,498 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,502 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,502 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,507 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,507 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,512 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,513 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,518 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,519 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,523 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,524 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,530 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,530 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,535 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,536 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,540 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,541 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,544 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,546 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,554 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,554 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,561 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,561 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,567 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,568 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,573 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,573 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,577 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,578 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,582 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,582 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,586 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,587 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,592 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,592 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,597 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,597 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,602 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,603 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,607 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,608 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,612 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,613 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,618 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,619 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,624 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,625 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,630 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,630 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,635 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,635 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,642 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,642 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,648 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,648 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,658 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,659 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,665 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,666 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,670 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,670 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,679 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,679 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,686 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,686 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,693 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,693 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,698 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,699 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,707 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,708 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,716 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,717 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,722 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,723 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,731 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,731 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,738 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,739 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,745 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,745 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,751 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,751 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,756 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,757 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,763 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,763 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,771 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,772 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,778 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,779 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,786 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,786 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,792 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,793 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,799 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,800 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,809 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,810 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,817 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,818 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,825 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,826 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,833 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,834 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,839 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,840 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,846 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,847 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,853 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,853 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,859 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,860 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,864 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,864 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,869 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,869 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,874 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,874 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,879 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,879 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,883 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,884 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,888 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,889 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,893 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,894 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,898 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,898 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,902 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,902 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,907 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,908 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,914 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,915 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,920 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,921 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,926 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,926 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,931 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,931 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,938 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,938 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,944 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,944 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,951 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,951 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,956 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,957 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,962 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,962 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,966 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,967 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,973 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,973 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,978 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,978 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,983 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,984 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,988 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,989 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,994 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:54,995 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:54,999 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,000 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,006 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,007 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,020 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,020 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,024 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,025 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,030 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,031 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,037 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,037 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,043 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,044 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,049 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,049 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,054 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,055 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,059 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,060 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,065 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,065 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,071 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,071 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,076 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,076 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,082 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,082 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,086 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,087 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,091 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,092 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,097 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,097 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,103 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,103 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,108 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,109 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,114 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,115 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,121 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,122 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,127 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,128 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,133 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,134 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,139 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,140 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,147 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,147 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,152 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,153 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,158 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,159 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,165 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,165 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,171 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,172 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,179 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,179 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,187 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,187 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,196 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,197 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,206 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,206 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,213 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,213 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,220 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,221 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,227 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,228 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,235 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,236 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,242 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,242 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,250 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,250 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,257 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,257 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,270 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,270 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,276 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,276 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,282 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,283 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,288 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,288 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,294 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,295 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,300 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,301 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,308 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,309 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,313 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,314 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,321 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,321 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,326 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,326 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,333 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,334 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,339 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,340 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,346 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,346 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,352 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,352 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,358 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,359 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,369 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,369 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,376 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,376 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,380 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,381 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,387 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,387 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,395 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,395 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,405 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,406 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,415 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,415 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,426 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,426 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,435 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,436 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,446 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,447 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,454 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,454 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,459 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,460 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,465 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,465 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,471 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,471 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,477 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,477 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,483 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,483 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,488 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,489 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,494 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,494 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,499 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,499 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,504 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,504 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,509 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,509 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,513 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,514 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,519 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,519 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,524 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,525 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,530 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,531 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,536 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,537 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,543 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,543 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,549 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,549 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,553 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,554 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,558 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,558 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,564 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,564 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,569 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,570 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,575 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,576 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,580 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,580 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,586 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,586 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,591 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,592 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,596 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,597 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,603 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,603 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,608 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,609 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,614 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,615 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,621 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,621 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,629 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,630 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,637 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,638 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,643 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,644 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,649 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,650 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,657 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,658 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,665 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,665 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,672 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,673 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,685 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,685 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,690 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,690 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,696 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,696 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,701 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,702 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,709 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,709 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,715 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,716 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,726 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,727 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,735 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,736 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,741 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,742 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,749 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,749 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,756 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,756 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,764 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,764 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,775 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,776 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,782 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,782 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,789 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,790 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,795 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,796 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,801 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,802 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,808 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,809 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,813 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,814 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,820 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,821 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,826 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,827 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,832 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,833 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,839 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,839 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,845 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,845 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,851 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,851 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,857 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,858 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,865 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,866 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,872 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,873 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,881 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,881 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,889 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,889 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,896 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,896 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,902 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,902 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,909 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,910 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,916 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,916 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,923 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,924 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,929 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,930 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,936 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,936 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,943 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,943 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,950 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,951 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,957 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,957 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,964 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,964 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,970 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,971 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,979 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,980 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,985 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,985 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,990 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,991 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:55,995 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:55,996 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,002 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,003 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,009 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,010 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,015 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,016 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,021 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,021 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,027 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,028 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,038 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,039 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,045 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,046 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,052 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,052 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,056 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,056 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,065 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,065 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,071 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,072 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,078 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,078 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,085 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,086 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,093 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,093 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,104 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,105 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,111 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,111 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,120 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,120 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,127 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,127 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,131 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,132 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,139 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,139 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,144 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,145 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,153 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,154 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,160 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,161 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,169 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,169 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,175 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,176 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,182 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,183 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,190 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,191 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,197 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,198 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,204 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,204 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,210 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,211 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,217 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,218 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,225 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,226 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,231 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,232 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,238 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,239 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,248 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,248 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,264 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,265 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,271 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,271 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,276 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,276 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,280 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,281 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,285 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,286 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,290 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,291 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,297 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,298 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,304 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,305 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,313 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,313 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,323 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,324 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,334 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,335 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,343 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,344 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,348 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,349 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,358 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,358 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,365 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,366 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,374 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,375 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,381 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,381 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,388 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,389 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,395 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,395 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,402 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,402 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,413 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,413 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,418 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,418 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,425 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,425 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,429 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,430 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,435 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,436 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,441 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,442 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,448 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,449 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,454 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,455 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,459 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,459 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,464 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,464 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,469 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,470 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,475 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,476 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,482 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,482 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,491 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,491 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,495 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,496 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,499 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,500 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,504 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,504 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,510 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,510 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,515 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,515 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,522 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,522 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,529 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,529 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,534 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,534 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,539 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,540 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,547 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,547 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,553 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,553 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,561 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,561 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,566 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,566 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,572 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,573 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,578 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,578 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,585 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,585 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,590 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,591 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,596 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,597 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,602 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,602 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,608 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,609 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,613 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,614 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,619 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,620 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,625 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,625 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,632 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,632 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,638 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,639 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,646 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,646 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,651 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,652 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,658 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,658 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,664 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,664 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,670 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,670 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,675 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,676 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,681 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,681 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,688 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,688 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,693 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,693 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,698 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,699 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,703 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,704 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,714 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,714 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,719 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,719 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,726 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,726 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,730 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,731 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,737 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,737 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,744 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,744 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,754 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,754 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,762 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,762 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,768 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,769 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,775 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,775 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,783 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,783 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,789 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,789 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,795 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,795 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,800 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,801 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,807 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,807 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,817 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,818 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,823 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,823 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,832 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,832 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,840 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,840 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,846 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,846 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,851 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,851 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,855 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,856 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,861 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,862 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,866 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,867 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,873 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,873 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,879 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,879 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,884 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,884 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,889 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,890 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,894 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,895 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,899 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,900 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,905 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,906 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,910 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,911 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,916 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,917 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,923 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,923 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,929 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,929 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,934 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,935 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,945 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,946 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,953 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,953 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,960 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,961 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,969 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,969 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,976 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,977 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,982 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,982 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,988 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,989 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:56,994 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:56,994 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,003 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,003 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,009 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,009 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,015 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,015 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,021 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,021 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,029 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,029 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,034 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,035 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,044 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,045 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,050 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,050 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,060 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,061 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,065 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,065 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,072 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,073 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,077 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,078 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,084 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,085 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,090 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,091 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,099 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,099 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,106 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,106 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,111 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,112 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,124 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,124 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,131 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,132 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,139 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,140 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,146 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,147 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,153 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,154 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,160 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,160 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,172 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,173 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,178 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,178 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,187 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,187 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,193 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,193 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,198 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,198 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,204 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,204 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,209 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,209 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,216 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,217 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,222 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,222 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,228 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,228 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,233 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,233 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,238 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,239 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,243 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,244 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,251 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,252 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,260 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,260 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,268 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,269 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,274 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,275 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,279 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,280 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,285 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,286 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,292 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,293 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,299 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,299 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,304 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,304 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,311 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,312 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,316 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,316 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,322 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,322 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,327 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,328 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,334 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,335 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,340 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,341 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,347 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,348 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,354 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,354 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,361 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,362 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,368 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,369 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,377 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,378 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,384 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,385 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,392 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,392 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,398 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,399 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,403 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,404 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,410 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,410 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,415 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,416 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,423 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,424 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,429 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,429 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,436 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,436 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,447 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,447 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,452 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,452 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,459 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,460 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,464 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,465 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,470 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,470 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,475 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,476 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,481 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,482 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,487 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,488 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,493 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,493 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,499 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,499 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,504 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,505 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,509 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,510 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,521 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,521 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,525 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,525 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,530 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,530 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,534 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,535 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,540 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,541 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,550 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,552 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,558 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,558 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,565 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,566 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,573 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,573 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,580 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,580 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,587 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,587 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,595 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,596 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,602 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,602 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,608 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,608 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,615 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,615 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,621 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,622 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,630 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,630 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,638 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,639 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,648 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,649 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,657 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,658 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,667 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,667 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,677 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,677 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,683 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,684 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,690 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,690 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,694 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,695 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,703 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,703 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,708 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,708 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,713 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,713 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,718 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,719 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,725 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,726 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,731 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,732 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,739 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,740 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,746 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,747 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,753 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,754 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,759 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,760 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,767 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,768 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,774 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,775 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,780 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,781 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,784 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,785 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,789 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,790 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,795 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,796 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,801 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,801 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,806 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,806 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,811 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,811 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,816 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,817 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,823 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,823 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,828 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,829 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,834 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,835 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,839 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,840 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,844 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,845 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,849 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,850 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,854 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,855 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,860 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,860 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,865 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,866 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,871 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,871 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,879 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,879 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,886 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,887 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,892 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,892 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,898 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,898 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,903 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,903 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,908 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,909 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,914 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,914 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,920 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,921 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,926 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,926 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,930 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,931 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,936 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,936 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,942 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,943 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,947 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,947 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,953 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,954 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,962 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,962 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,968 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,969 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,974 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,974 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,978 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,979 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,983 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,983 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,988 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,989 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:57,993 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:57,994 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,000 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,000 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,007 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,007 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,014 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,014 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,020 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,020 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,025 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,026 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,031 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,031 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,036 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,037 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,043 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,043 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,050 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,051 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,057 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,057 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,063 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,063 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,070 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,071 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,075 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,075 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,081 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,081 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,086 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,086 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,095 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,096 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,105 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,105 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,116 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,117 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,139 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,140 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,145 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,145 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,150 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,150 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,156 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,157 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,161 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,161 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,167 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,167 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,173 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,174 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,179 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,180 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,185 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,185 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,190 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,191 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,196 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,197 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,202 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,203 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,209 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,209 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,216 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,217 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,223 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,223 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,231 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,232 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,242 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,243 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,255 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,256 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,264 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,264 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,275 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,276 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,282 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,283 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,294 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,295 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,301 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,301 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,322 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,322 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,334 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,335 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,344 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,345 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,352 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,352 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,360 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,360 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,368 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,368 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,376 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,377 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,390 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,390 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,393 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,393 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,399 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,399 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,405 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,405 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,410 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,411 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,416 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,416 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,421 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,422 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,427 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,427 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,433 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,433 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,439 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,440 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:40:58,441 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"giai đoạn tiếp theo làm gì /no_think","session_id":"df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,441 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,442 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: giai đoạn tiếp theo làm gì /no_think...
2025-05-19 13:40:58,442 - websocket_server - INFO - Nhận tin nhắn thông thường: giai đoạn tiếp theo làm gì /no_think, enable_thinking=False
2025-05-19 13:40:58,442 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:40:58,442 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: giai đoạn tiếp theo làm gì /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,455 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:40:58,455 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:40:58,456 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặ...
2025-05-19 13:40:58,456 - chatbot_rag - INFO - Kích thước prompt: 617 ký tự
2025-05-19 13:40:58,456 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:40:58,457 - chatbot_rag - INFO - Tổng kích thước: 2623 ký tự
2025-05-19 13:40:58,458 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_134058.txt
2025-05-19 13:40:58,459 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:40:58,460 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặ...
2025-05-19 13:40:58,460 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:41:01,034 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:41:01,034 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 13:41:01,036 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_134101.txt
2025-05-19 13:41:01,038 - chatbot_rag - INFO - [analysis_20250519_134101] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_134101_raw.txt
2025-05-19 13:41:01,038 - chatbot_rag - INFO - [analysis_20250519_134101] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 13:41:01,038 - chatbot_rag - WARNING - [analysis_20250519_134101] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:41:01,039 - chatbot_rag - INFO - [analysis_20250519_134101] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 13:41:01,039 - chatbot_rag - INFO - [analysis_20250519_134101] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 13:41:01,040 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:41:01,040 - websocket_server - INFO - Xử lý streaming response cho: 'giai đoạn tiếp theo làm gì /no_think', phòng ban: None, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:01,040 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:01,041 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: giai đoạn tiếp theo làm gì
2025-05-19 13:41:01,041 - websocket_server - INFO - Xử lý streaming response. Query: 'giai đoạn tiếp theo làm gì', Mode thinking: False
2025-05-19 13:41:01,041 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 13:41:01,041 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: giai đoạn tiếp theo làm gì, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:01,042 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:01,042 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 13:41:01,042 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "...
2025-05-19 13:41:01,043 - chatbot_rag - INFO - Kích thước prompt: 607 ký tự
2025-05-19 13:41:01,043 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 13:41:01,043 - chatbot_rag - INFO - Tổng kích thước: 2613 ký tự
2025-05-19 13:41:01,045 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_134101.txt
2025-05-19 13:41:01,045 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 13:41:01,046 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "giai đoạn tiếp theo làm gì"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "...
2025-05-19 13:41:01,046 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 13:41:10,233 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:41:10,234 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user is asking "giai đoạn tiếp theo làm gì", which translates to "What is the next stage doing?" in English. First, I need to determine the department, query
2025-05-19 13:41:10,235 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_134110.txt
2025-05-19 13:41:10,236 - chatbot_rag - INFO - [analysis_20250519_134110] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_134110_raw.txt
2025-05-19 13:41:10,236 - chatbot_rag - INFO - [analysis_20250519_134110] Phản hồi gốc: <think>
Okay, let's tackle this query. The user is asking "giai đoạn tiếp theo làm gì", which transl...
2025-05-19 13:41:10,237 - chatbot_rag - WARNING - [analysis_20250519_134110] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 13:41:10,237 - chatbot_rag - INFO - [analysis_20250519_134110] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 13:41:10,237 - chatbot_rag - INFO - [analysis_20250519_134110] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 13:41:10,237 - chatbot_rag - INFO - [analysis_20250519_134110] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 13:41:10,238 - chatbot_rag - WARNING - [analysis_20250519_134110] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 13:41:10,238 - chatbot_rag - INFO - [analysis_20250519_134110] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 13:41:10,240 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:41:10,241 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:41:10,241 - chatbot_rag - ERROR - [analysis_20250519_134110] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 13:41:10,241 - chatbot_rag - WARNING - [analysis_20250519_134110] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 13:41:10,241 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 13:41:10,242 - websocket_server - INFO - Query thực tế gửi đến mô hình: giai đoạn tiếp theo làm gì /no_think
2025-05-19 13:41:10,242 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 13:41:10,242 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:10,245 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 13:41:10,246 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 13:41:10,246 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:10,247 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_134110.txt
2025-05-19 13:41:10,247 - chatbot_rag - INFO - Kích thước prompt: 1051 ký tự
2025-05-19 13:41:10,248 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 13:41:10,248 - chatbot_rag - INFO - Tổng kích thước: 1967 ký tự
2025-05-19 13:41:10,250 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_134110.txt
2025-05-19 13:41:10,250 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 13:41:10,250 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "giai đoạn tiếp theo làm gì /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính ...
2025-05-19 13:41:10,251 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 13:41:14,467 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 13:41:14,468 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Giai đoạn tiếp theo là **AFTERSALE-MAINTENANCE**.  
Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: Phòng X làm gì trong giai đoạn Y? 😄✨
2025-05-19 13:41:14,470 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_134114.txt
2025-05-19 13:41:14,741 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 168 ký tự phản hồi
2025-05-19 13:41:14,741 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 13:41:14,742 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,742 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,743 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,743 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,743 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,744 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,744 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,774 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,775 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,787 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,787 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,795 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,796 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,805 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,806 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,812 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,814 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,823 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,823 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,831 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,832 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,838 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,838 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,846 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,847 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,854 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,854 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,860 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,861 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,867 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,868 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,875 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,875 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,885 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,885 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,891 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,892 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,900 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,900 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,907 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,907 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,915 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,916 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,925 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,925 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,932 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,933 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,939 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,939 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,946 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,947 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,954 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,954 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,961 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,962 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,968 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,968 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,975 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,975 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,983 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,983 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,988 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,988 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:14,995 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:14,996 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,002 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,002 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,009 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,010 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,016 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,017 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,024 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,025 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,036 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,036 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,050 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,051 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,059 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,060 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,070 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,070 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,083 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,083 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,091 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,091 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,096 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,097 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,102 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,103 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,109 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,109 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,118 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,118 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,126 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,126 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,136 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,137 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,145 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,146 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,155 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,155 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,162 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,162 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,168 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,169 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,173 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,174 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,179 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,179 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,185 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,185 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,190 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,191 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,197 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,198 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,206 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,206 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,211 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,212 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,221 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,222 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,228 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,228 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,236 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,237 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,245 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,246 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,268 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,269 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,283 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,284 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,298 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,299 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,304 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,305 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,314 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,315 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,322 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,322 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,330 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,330 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,337 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,338 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,345 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,346 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,353 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,353 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,366 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,366 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,372 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,373 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,392 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,393 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,399 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,400 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,409 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,409 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,417 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,418 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,428 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,428 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,437 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,438 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,447 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,447 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,457 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,457 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,465 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,466 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,478 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,479 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,486 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,486 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,494 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,494 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,502 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,503 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,519 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,520 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,524 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,524 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,537 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,537 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,544 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,545 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,552 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,553 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,559 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,560 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,568 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,569 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,576 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,577 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,583 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,584 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,590 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,590 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,596 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,596 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,602 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,603 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,608 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,608 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,614 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,614 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,620 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,620 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,626 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,626 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,632 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,632 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,640 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,640 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,646 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,647 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,654 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,654 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,659 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,660 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,669 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,670 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,676 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,676 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,682 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,683 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,688 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,689 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,697 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,697 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,701 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,702 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,707 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,708 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,715 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,716 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,723 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,723 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,730 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,731 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,741 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,741 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,749 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,750 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,759 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,760 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,770 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,771 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,777 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,778 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,785 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,786 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,793 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,794 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,802 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,802 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,807 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,808 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,816 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,816 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,825 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,825 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,835 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,836 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,844 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,844 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,849 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,850 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,856 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,857 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,862 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,863 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,869 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,870 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,875 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,875 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,884 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,884 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,896 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,897 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,900 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,901 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,908 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,908 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,913 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,913 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,919 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,920 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,925 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,925 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,932 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,932 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,938 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,939 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,944 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,944 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,951 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,952 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,960 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,960 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,967 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,967 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,973 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,974 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,983 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,984 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:15,995 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:15,996 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,002 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,003 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,006 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,006 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,013 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,014 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,023 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,025 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,039 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,040 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,047 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,048 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,059 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,060 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,075 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,076 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,098 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,100 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,103 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,104 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,121 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,121 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,128 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,128 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,139 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,140 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,147 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,148 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,155 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,155 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,162 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,162 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,172 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,174 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,189 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,190 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,205 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,205 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,217 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,218 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,240 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,241 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,260 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,265 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,273 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,274 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,305 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,308 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,316 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,317 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,326 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,327 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,339 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,340 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,349 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,350 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,358 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,359 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,367 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,367 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,381 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,382 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,389 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,391 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,400 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,402 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,412 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,414 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,426 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,426 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,436 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,437 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,457 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,457 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,467 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,467 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,474 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,475 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,483 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,484 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,490 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,491 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,499 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,500 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,506 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,507 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,510 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,511 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,517 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,518 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,526 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,526 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,536 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,536 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,543 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,544 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,550 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,551 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,558 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,559 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,564 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,565 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,573 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,575 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,579 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,579 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,587 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,587 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,593 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,593 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,598 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,599 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,604 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,605 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,611 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,612 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,616 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,617 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,624 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,624 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,630 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,630 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,636 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,637 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,643 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,643 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,649 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,649 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,655 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,655 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,660 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,661 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,665 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,666 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,671 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,672 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,677 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,677 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,684 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,684 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,690 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,691 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,695 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,696 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,700 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,700 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,705 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,705 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,711 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,711 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,718 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,718 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,724 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,725 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,730 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,731 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,736 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,737 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,741 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,742 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,748 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,749 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,754 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,755 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,762 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,762 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,769 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,769 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,775 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,775 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,782 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,782 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,788 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,789 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,794 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,795 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,801 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,801 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,809 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,810 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,817 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,818 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,822 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,823 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,829 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,829 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,835 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,836 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,851 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,851 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,858 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,859 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,865 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,866 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,873 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,874 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,882 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,883 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,888 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,889 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,897 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,897 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,907 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,908 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,920 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,921 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,928 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,928 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,937 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,937 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,944 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,945 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,954 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,954 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,960 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,960 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,969 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,969 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,973 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,973 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,980 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,981 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:16,997 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:16,998 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,007 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,008 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,021 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,021 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,027 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,028 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,040 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,040 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,047 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,047 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,060 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,061 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,068 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,069 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,081 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,082 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,088 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,089 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,099 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,099 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,108 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,109 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,117 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,118 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,127 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,128 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,134 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,135 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,144 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,144 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,152 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,153 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,159 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,160 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,167 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,168 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,173 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,174 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,180 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,180 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,186 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,187 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,195 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,196 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,203 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,203 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,209 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,210 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,220 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,221 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,237 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,238 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,243 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,244 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,250 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,250 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,259 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,259 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,265 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,265 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,272 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,272 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,278 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,279 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,285 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,286 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,292 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,292 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,301 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:17,301 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:41:17,305 - websockets.server - INFO - connection closed
2025-05-19 13:41:18,326 - websockets.server - INFO - connection open
2025-05-19 13:41:18,327 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:18,398 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 13:41:18,398 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 13:43:46,679 - websockets.server - INFO - connection closed
2025-05-19 14:23:39,271 - websockets.server - INFO - connection open
2025-05-19 14:23:39,296 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:39,339 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:39,341 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:23:44,389 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"giai đoạn tiếp theo là sao /no_think","session_id":"df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:44,390 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:44,390 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: giai đoạn tiếp theo là sao /no_think...
2025-05-19 14:23:44,391 - websocket_server - INFO - Nhận tin nhắn thông thường: giai đoạn tiếp theo là sao /no_think, enable_thinking=False
2025-05-19 14:23:44,391 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 14:23:44,395 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142344.txt
2025-05-19 14:23:44,396 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:44,399 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:44,400 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:23:44,401 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao /no_think"

        Phân tích câu hỏi và trả về JS...
2025-05-19 14:23:44,402 - chatbot_rag - INFO - Kích thước prompt: 675 ký tự
2025-05-19 14:23:44,403 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:23:44,403 - chatbot_rag - INFO - Tổng kích thước: 2681 ký tự
2025-05-19 14:23:44,407 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142344.txt
2025-05-19 14:23:44,407 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:23:44,408 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao /no_think"

        Phân tích câu hỏi và trả về JS...
2025-05-19 14:23:44,409 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:23:49,624 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:23:49,624 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 14:23:49,627 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142349.txt
2025-05-19 14:23:49,629 - chatbot_rag - INFO - [analysis_20250519_142349] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142349_raw.txt
2025-05-19 14:23:49,630 - chatbot_rag - INFO - [analysis_20250519_142349] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 14:23:49,630 - chatbot_rag - WARNING - [analysis_20250519_142349] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:23:49,631 - chatbot_rag - INFO - [analysis_20250519_142349] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:23:49,631 - chatbot_rag - INFO - [analysis_20250519_142349] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 14:23:49,632 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:23:49,633 - websocket_server - INFO - Xử lý streaming response cho: 'giai đoạn tiếp theo là sao /no_think', phòng ban: None, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:49,633 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:49,633 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: giai đoạn tiếp theo là sao
2025-05-19 14:23:49,634 - websocket_server - INFO - Xử lý streaming response. Query: 'giai đoạn tiếp theo là sao', Mode thinking: False
2025-05-19 14:23:49,634 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 14:23:49,636 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142349.txt
2025-05-19 14:23:49,636 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:49,637 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:49,637 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:23:49,637 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao"

        Phân tích câu hỏi và trả về JSON có định...
2025-05-19 14:23:49,638 - chatbot_rag - INFO - Kích thước prompt: 665 ký tự
2025-05-19 14:23:49,638 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:23:49,639 - chatbot_rag - INFO - Tổng kích thước: 2671 ký tự
2025-05-19 14:23:49,642 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142349.txt
2025-05-19 14:23:49,643 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:23:49,643 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì

giai đoạn tiếp theo là sao"

        Phân tích câu hỏi và trả về JSON có định...
2025-05-19 14:23:49,644 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:23:58,850 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:23:58,851 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "giai đoạn tiếp theo làm gì" which translates to "What is the next phase doing?" and then they ask "giai đoạn tiếp theo là sao" mean
2025-05-19 14:23:58,852 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142358.txt
2025-05-19 14:23:58,856 - chatbot_rag - INFO - [analysis_20250519_142358] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142358_raw.txt
2025-05-19 14:23:58,856 - chatbot_rag - INFO - [analysis_20250519_142358] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "giai đoạn tiếp theo làm gì" whi...
2025-05-19 14:23:58,857 - chatbot_rag - WARNING - [analysis_20250519_142358] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:23:58,858 - chatbot_rag - INFO - [analysis_20250519_142358] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:23:58,858 - chatbot_rag - INFO - [analysis_20250519_142358] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:23:58,859 - chatbot_rag - INFO - [analysis_20250519_142358] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:23:58,859 - chatbot_rag - WARNING - [analysis_20250519_142358] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:23:58,860 - chatbot_rag - INFO - [analysis_20250519_142358] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:23:58,868 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:23:58,869 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:23:58,870 - chatbot_rag - ERROR - [analysis_20250519_142358] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:23:58,870 - chatbot_rag - WARNING - [analysis_20250519_142358] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:23:58,871 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:23:58,871 - websocket_server - INFO - Query thực tế gửi đến mô hình: giai đoạn tiếp theo là sao /no_think
2025-05-19 14:23:58,871 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 14:23:58,872 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:58,880 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:23:58,883 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:23:58,885 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:23:58,887 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_142358.txt
2025-05-19 14:23:58,887 - chatbot_rag - INFO - Kích thước prompt: 1051 ký tự
2025-05-19 14:23:58,890 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:23:58,891 - chatbot_rag - INFO - Tổng kích thước: 1967 ký tự
2025-05-19 14:23:58,893 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142358.txt
2025-05-19 14:23:58,895 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:23:58,899 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "giai đoạn tiếp theo là sao /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính ...
2025-05-19 14:23:58,900 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:24:04,564 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:24:04,565 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Giai đoạn tiếp theo là sao? 😎  
Có 5 giai đoạn chính: MKT-SALES, PROPOSAL, CONSTRUCTION, DEFECT-HANDOVER, AFTERSALE-MAINTENANCE.  

Để biết chi tiết công việc cụ thể, vui lòng hỏi v
2025-05-19 14:24:04,567 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142404.txt
2025-05-19 14:24:04,577 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 248 ký tự phản hồi
2025-05-19 14:24:04,580 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:24:04,580 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:09,986 - websockets.server - INFO - connection closed
2025-05-19 14:24:11,055 - websockets.server - INFO - connection open
2025-05-19 14:24:11,057 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:11,060 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:11,061 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:24:34,103 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think","sessio
2025-05-19 14:24:34,104 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:34,104 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Một căn chung cư 76 mét vuông thì làm nội thất kho...
2025-05-19 14:24:34,105 - websocket_server - INFO - Nhận tin nhắn thông thường: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think, enable_thinking=False
2025-05-19 14:24:34,105 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:24:34,107 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142434.txt
2025-05-19 14:24:34,107 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:34,108 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:34,108 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:24:34,108 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:24:34,109 - chatbot_rag - INFO - Kích thước prompt: 757 ký tự
2025-05-19 14:24:34,110 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:24:34,110 - chatbot_rag - INFO - Tổng kích thước: 2763 ký tự
2025-05-19 14:24:34,111 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142434.txt
2025-05-19 14:24:34,112 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:24:34,112 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:24:34,113 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:24:36,723 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:24:36,724 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "null", "query_type": "general", "error": false}
2025-05-19 14:24:36,726 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142436.txt
2025-05-19 14:24:36,728 - chatbot_rag - INFO - [analysis_20250519_142436] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142436_raw.txt
2025-05-19 14:24:36,728 - chatbot_rag - INFO - [analysis_20250519_142436] Phản hồi gốc: <think>

</think>

{"department": "null", "query_type": "general", "error": false}...
2025-05-19 14:24:36,728 - chatbot_rag - WARNING - [analysis_20250519_142436] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:24:36,729 - chatbot_rag - INFO - [analysis_20250519_142436] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:24:36,729 - chatbot_rag - INFO - [analysis_20250519_142436] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'null', 'query_type': 'general', 'error': False}
2025-05-19 14:24:36,729 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=null, Loại=general, Thinking=False
2025-05-19 14:24:36,731 - websocket_server - INFO - Xử lý streaming response cho: 'Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think', phòng ban: null, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:36,731 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:36,732 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
2025-05-19 14:24:36,732 - websocket_server - INFO - Xử lý streaming response. Query: 'Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?', Mode thinking: False
2025-05-19 14:24:36,733 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:24:36,734 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142436.txt
2025-05-19 14:24:36,735 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=null, Loại=department_specific, Thinking=False
2025-05-19 14:24:36,735 - websocket_server - INFO - Query thực tế gửi đến mô hình: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think
2025-05-19 14:24:36,735 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: null, chế độ thinking: False
2025-05-19 14:24:36,736 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: null, Session: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:24:36,747 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:24:36,748 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: null
2025-05-19 14:24:36,749 - department_info_tool - WARNING - Không tìm thấy file cho 'null' tại đường dẫn C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\null.txt
2025-05-19 14:24:36,753 - department_info_tool - ERROR - Không tìm thấy file nào phù hợp cho phòng ban 'null'
2025-05-19 14:24:36,755 - websocket_server - ERROR - Lỗi khi xử lý streaming response: 'department'
2025-05-19 14:25:27,017 - websockets.server - INFO - connection closed
2025-05-19 14:25:28,424 - websockets.server - INFO - connection open
2025-05-19 14:25:28,426 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:28,427 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:28,427 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:25:34,887 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think","sessio
2025-05-19 14:25:34,888 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:34,888 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Một căn chung cư 76 mét vuông thì làm nội thất kho...
2025-05-19 14:25:34,889 - websocket_server - INFO - Nhận tin nhắn thông thường: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think, enable_thinking=False
2025-05-19 14:25:34,889 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:25:34,891 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142534.txt
2025-05-19 14:25:34,892 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:34,892 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:34,893 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:25:34,893 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:25:34,894 - chatbot_rag - INFO - Kích thước prompt: 757 ký tự
2025-05-19 14:25:34,894 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:25:34,894 - chatbot_rag - INFO - Tổng kích thước: 2763 ký tự
2025-05-19 14:25:34,896 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142534.txt
2025-05-19 14:25:34,897 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:25:34,897 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:25:34,897 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:25:36,033 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:25:36,034 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": null, "query_type": "general", "error": false}
```
2025-05-19 14:25:36,038 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142536.txt
2025-05-19 14:25:36,041 - chatbot_rag - INFO - [analysis_20250519_142536] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142536_raw.txt
2025-05-19 14:25:36,044 - chatbot_rag - INFO - [analysis_20250519_142536] Phản hồi gốc: <think>

</think>

```json
{"department": null, "query_type": "general", "error": false}
```...
2025-05-19 14:25:36,045 - chatbot_rag - WARNING - [analysis_20250519_142536] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:25:36,046 - chatbot_rag - INFO - [analysis_20250519_142536] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:25:36,046 - chatbot_rag - INFO - [analysis_20250519_142536] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 14:25:36,046 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:25:36,047 - websocket_server - INFO - Xử lý streaming response cho: 'Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think', phòng ban: None, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:36,048 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:36,048 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
2025-05-19 14:25:36,051 - websocket_server - INFO - Xử lý streaming response. Query: 'Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?', Mode thinking: False
2025-05-19 14:25:36,052 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:25:36,055 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142536.txt
2025-05-19 14:25:36,059 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:36,071 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:36,073 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:25:36,074 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:25:36,075 - chatbot_rag - INFO - Kích thước prompt: 747 ký tự
2025-05-19 14:25:36,075 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:25:36,076 - chatbot_rag - INFO - Tổng kích thước: 2753 ký tự
2025-05-19 14:25:36,095 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142536.txt
2025-05-19 14:25:36,096 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:25:36,096 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao

Một căn chung cư 76 mét vuông thì làm ...
2025-05-19 14:25:36,099 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:25:45,343 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:25:45,344 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is about the cost of interior design for a 76 square meter apartment. I need to determine if it's department-specific or general.

Firs
2025-05-19 14:25:45,346 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142545.txt
2025-05-19 14:25:45,349 - chatbot_rag - INFO - [analysis_20250519_142545] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142545_raw.txt
2025-05-19 14:25:45,349 - chatbot_rag - INFO - [analysis_20250519_142545] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is about the cost of interior desig...
2025-05-19 14:25:45,350 - chatbot_rag - WARNING - [analysis_20250519_142545] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:25:45,350 - chatbot_rag - INFO - [analysis_20250519_142545] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:25:45,350 - chatbot_rag - INFO - [analysis_20250519_142545] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:25:45,352 - chatbot_rag - INFO - [analysis_20250519_142545] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:25:45,353 - chatbot_rag - WARNING - [analysis_20250519_142545] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:25:45,353 - chatbot_rag - INFO - [analysis_20250519_142545] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:25:45,357 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:25:45,358 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:25:45,358 - chatbot_rag - ERROR - [analysis_20250519_142545] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:25:45,358 - chatbot_rag - WARNING - [analysis_20250519_142545] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:25:45,359 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:25:45,359 - websocket_server - INFO - Query thực tế gửi đến mô hình: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think
2025-05-19 14:25:45,359 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 14:25:45,360 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:45,363 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:25:45,363 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:25:45,363 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:45,364 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_142545.txt
2025-05-19 14:25:45,365 - chatbot_rag - INFO - Kích thước prompt: 1094 ký tự
2025-05-19 14:25:45,365 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:25:45,365 - chatbot_rag - INFO - Tổng kích thước: 2010 ký tự
2025-05-19 14:25:45,367 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142545.txt
2025-05-19 14:25:45,367 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:25:45,368 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền? /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về qu...
2025-05-19 14:25:45,370 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:25:51,867 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:25:51,868 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Câu hỏi của bạn không thuộc về quy trình hoặc giai đoạn làm việc trong công ty. 😄🏠💰  
Nếu bạn muốn biết chi phí nội thất cho căn chung cư 76m², mình khuyên bạn nên tham khảo các đơn
2025-05-19 14:25:51,872 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142551.txt
2025-05-19 14:25:51,879 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 377 ký tự phản hồi
2025-05-19 14:25:51,880 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:25:51,880 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:51,887 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:25:51,887 - websockets.server - INFO - connection closed
2025-05-19 14:25:51,891 - websockets.server - INFO - connection open
2025-05-19 14:25:51,893 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:51,895 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:25:51,896 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:26:13,850 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think","session_id":"df4d9d0d-0ac0-4
2025-05-19 14:26:13,851 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:13,852 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /n...
2025-05-19 14:26:13,852 - websocket_server - INFO - Nhận tin nhắn thông thường: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think, enable_thinking=False
2025-05-19 14:26:13,853 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 14:26:13,855 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142613.txt
2025-05-19 14:26:13,855 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?

Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:13,858 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:13,858 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:26:13,859 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:26:13,859 - chatbot_rag - INFO - Kích thước prompt: 817 ký tự
2025-05-19 14:26:13,859 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:26:13,860 - chatbot_rag - INFO - Tổng kích thước: 2823 ký tự
2025-05-19 14:26:13,861 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142613.txt
2025-05-19 14:26:13,862 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:26:13,862 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:26:13,863 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:26:16,542 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:26:16,543 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}
2025-05-19 14:26:16,544 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142616.txt
2025-05-19 14:26:16,546 - chatbot_rag - INFO - [analysis_20250519_142616] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142616_raw.txt
2025-05-19 14:26:16,546 - chatbot_rag - INFO - [analysis_20250519_142616] Phản hồi gốc: <think>

</think>

{"department": "2D", "query_type": "department_specific", "error": false}...
2025-05-19 14:26:16,546 - chatbot_rag - WARNING - [analysis_20250519_142616] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:26:16,547 - chatbot_rag - INFO - [analysis_20250519_142616] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:26:16,549 - chatbot_rag - INFO - [analysis_20250519_142616] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': '2D', 'query_type': 'department_specific', 'error': False}
2025-05-19 14:26:16,549 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 14:26:16,550 - websocket_server - INFO - Xử lý streaming response cho: 'Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think', phòng ban: 2D, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:16,550 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:16,550 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
2025-05-19 14:26:16,551 - websocket_server - INFO - Xử lý streaming response. Query: 'Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc', Mode thinking: False
2025-05-19 14:26:16,551 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 14:26:16,553 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142616.txt
2025-05-19 14:26:16,553 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 14:26:16,554 - websocket_server - INFO - Query thực tế gửi đến mô hình: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think
2025-05-19 14:26:16,554 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: 2D, chế độ thinking: False
2025-05-19 14:26:16,556 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: 2D, Session: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:16,561 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:26:16,561 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 14:26:16,562 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 14:26:16,570 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 14:26:16,571 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: 2D, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:16,572 - chatbot_rag - INFO - Số task: 3
2025-05-19 14:26:16,572 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:16,573 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0.
2025-05-19 14:26:16,575 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 14:26:16,577 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_142616.txt
2025-05-19 14:26:16,577 - chatbot_rag - INFO - Kích thước prompt: 2080 ký tự
2025-05-19 14:26:16,578 - chatbot_rag - INFO - Kích thước system prompt: 1983 ký tự
2025-05-19 14:26:16,578 - chatbot_rag - INFO - Tổng kích thước: 4063 ký tự
2025-05-19 14:26:16,580 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142616.txt
2025-05-19 14:26:16,580 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 14:26:16,581 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc /no_think"

    THÔNG TIN PHÒ...
2025-05-19 14:26:16,581 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:26:32,522 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:26:32,523 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Chào bạn! 👋  
Dưới đây là hướng dẫn cụ thể cho vai trò **2D** trong các giai đoạn mà bạn tham gia:

---

### 🧭 Giai đoạn **CONSTRUCTION**
- **Sub-phase**: Construction  
  - **Task 
2025-05-19 14:26:32,525 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142632.txt
2025-05-19 14:26:32,526 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_142616.txt
2025-05-19 14:26:32,527 - chatbot_rag - INFO - Thời gian truy vấn LLM: 15.97 giây
2025-05-19 14:26:32,533 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 14:26:32,533 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 14:26:32,534 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 14:26:33,854 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 885 ký tự phản hồi
2025-05-19 14:26:33,855 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:26:33,857 - websocket_server - INFO - Đã lưu hội thoại phòng ban 2D vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:34,011 - websocket_server - INFO - Nhận yêu cầu phân tích (thinking) cho câu hỏi: Câu hỏi của bạn không thuộc về quy trình hoặc giai đoạn làm việc trong công ty. 😄🏠💰  
Nếu bạn muốn b
2025-05-19 14:26:34,012 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-19 14:26:34,015 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142634.txt
2025-05-19 14:26:34,016 - websocket_server - INFO - Phân tích câu hỏi để xác định phòng ban hoặc loại câu hỏi
2025-05-19 14:26:34,016 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc

Câu hỏi của bạn không thuộc về quy trình hoặc giai đoạn làm việc trong công ty. 😄🏠💰  
Nếu bạn muốn biết chi phí nội thất cho căn chung cư 76m², mình khuyên bạn nên tham khảo các đơn vị thiết kế nội thất uy tín hoặc nhờ tư vấn từ chuyên gia! 🛋️✨  

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể, ví dụ: "Phòng Thiết kế làm gì trong giai đoạn PROPOSAL?", session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:34,017 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:34,018 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:26:34,018 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:26:34,018 - chatbot_rag - INFO - Kích thước prompt: 1197 ký tự
2025-05-19 14:26:34,019 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:26:34,019 - chatbot_rag - INFO - Tổng kích thước: 3203 ký tự
2025-05-19 14:26:34,022 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142634.txt
2025-05-19 14:26:34,023 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:26:34,024 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:26:34,024 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:26:44,147 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:26:44,147 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break down the user's question. The current query is "Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?" which translates to asking about the cost of interior d
2025-05-19 14:26:44,149 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142644.txt
2025-05-19 14:26:44,150 - chatbot_rag - INFO - [analysis_20250519_142644] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142644_raw.txt
2025-05-19 14:26:44,150 - chatbot_rag - INFO - [analysis_20250519_142644] Phản hồi gốc: <think>
Okay, let's break down the user's question. The current query is "Một căn chung cư 76 mét vu...
2025-05-19 14:26:44,150 - chatbot_rag - WARNING - [analysis_20250519_142644] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:26:44,151 - chatbot_rag - INFO - [analysis_20250519_142644] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:26:44,151 - chatbot_rag - INFO - [analysis_20250519_142644] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:26:44,152 - chatbot_rag - INFO - [analysis_20250519_142644] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:26:44,152 - chatbot_rag - WARNING - [analysis_20250519_142644] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:26:44,153 - chatbot_rag - INFO - [analysis_20250519_142644] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:26:44,157 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:26:44,158 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:26:44,162 - chatbot_rag - INFO - [analysis_20250519_142644] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: 2D
2025-05-19 14:26:44,162 - chatbot_rag - ERROR - [analysis_20250519_142644] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:26:44,163 - chatbot_rag - WARNING - [analysis_20250519_142644] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:26:44,163 - websocket_server - INFO - Lấy phân tích cho câu hỏi chung
2025-05-19 14:26:44,164 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:44,169 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:26:44,170 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:26:44,170 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:26:44,172 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_142644.txt
2025-05-19 14:26:44,173 - chatbot_rag - INFO - Kích thước prompt: 1399 ký tự
2025-05-19 14:26:44,174 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:26:44,174 - chatbot_rag - INFO - Tổng kích thước: 2315 ký tự
2025-05-19 14:26:44,175 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142644.txt
2025-05-19 14:26:44,176 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:26:44,176 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "Câu hỏi của bạn không thuộc về quy trình hoặc giai đoạn làm việc trong công ty. 😄🏠💰  
Nếu bạn muốn biết chi phí nội thất cho căn chung cư 76m², mình khuyên bạn nên tham khảo các đơn vị thiế...
2025-05-19 14:26:44,176 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:27:05,001 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:27:05,001 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user provided a question that's supposed to be about the company's process stages and departments. But their initial response was a bit off, so they want me to correct it.
2025-05-19 14:27:05,003 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142705.txt
2025-05-19 14:27:05,007 - websocket_server - INFO - Đã trích xuất thinking (1546 ký tự) và còn lại 456 ký tự phản hồi
2025-05-19 14:27:05,008 - websocket_server - INFO - Đã trích xuất phần thinking (1546 ký tự) từ phản hồi handle_general_query
2025-05-19 14:27:05,008 - websocket_server - INFO - Gửi phản hồi thinking với request_id: thinking_1747639594011_gvkjiz6
2025-05-19 14:27:05,009 - websocket_server - INFO - Đã gửi nội dung thinking (1546 ký tự)
2025-05-19 14:27:05,012 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:27:05,013 - websockets.server - INFO - connection closed
2025-05-19 14:27:05,016 - websockets.server - INFO - connection open
2025-05-19 14:27:05,017 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:05,021 - websockets.server - INFO - connection open
2025-05-19 14:27:05,023 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:05,026 - websockets.server - INFO - connection open
2025-05-19 14:27:05,027 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:05,031 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:05,032 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:27:21,872 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team kinh doanh thì làm gì /no_think","session_id":"df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:21,873 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:21,874 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team kinh doanh thì làm gì /no_think...
2025-05-19 14:27:21,874 - websocket_server - INFO - Nhận tin nhắn thông thường: team kinh doanh thì làm gì /no_think, enable_thinking=False
2025-05-19 14:27:21,875 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-19 14:27:21,877 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142721.txt
2025-05-19 14:27:21,878 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc

team kinh doanh thì làm gì /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:21,879 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:21,879 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:27:21,880 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:27:21,881 - chatbot_rag - INFO - Kích thước prompt: 856 ký tự
2025-05-19 14:27:21,881 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:27:21,882 - chatbot_rag - INFO - Tổng kích thước: 2862 ký tự
2025-05-19 14:27:21,885 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142721.txt
2025-05-19 14:27:21,885 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:27:21,886 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:27:21,886 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:27:24,643 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:27:24,644 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-19 14:27:24,648 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142724.txt
2025-05-19 14:27:24,651 - chatbot_rag - INFO - [analysis_20250519_142724] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_142724_raw.txt
2025-05-19 14:27:24,653 - chatbot_rag - INFO - [analysis_20250519_142724] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-19 14:27:24,654 - chatbot_rag - WARNING - [analysis_20250519_142724] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:27:24,655 - chatbot_rag - INFO - [analysis_20250519_142724] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:27:24,656 - chatbot_rag - INFO - [analysis_20250519_142724] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 14:27:24,656 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:27:24,657 - websocket_server - INFO - Xử lý streaming response cho: 'team kinh doanh thì làm gì /no_think', phòng ban: Kinh doanh, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:24,657 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:24,658 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team kinh doanh thì làm gì
2025-05-19 14:27:24,659 - websocket_server - INFO - Xử lý streaming response. Query: 'team kinh doanh thì làm gì', Mode thinking: False
2025-05-19 14:27:24,660 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-19 14:27:24,663 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_142724.txt
2025-05-19 14:27:24,663 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:27:24,664 - websocket_server - INFO - Query thực tế gửi đến mô hình: team kinh doanh thì làm gì /no_think
2025-05-19 14:27:24,664 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 14:27:24,664 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:24,670 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:27:24,671 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:27:24,672 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:27:24,691 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:27:24,693 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:24,694 - chatbot_rag - INFO - Số task: 24
2025-05-19 14:27:24,694 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:27:24,696 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0.
2025-05-19 14:27:24,698 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 14:27:24,710 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_142724.txt
2025-05-19 14:27:24,710 - chatbot_rag - INFO - Kích thước prompt: 10115 ký tự
2025-05-19 14:27:24,710 - chatbot_rag - INFO - Kích thước system prompt: 1983 ký tự
2025-05-19 14:27:24,711 - chatbot_rag - INFO - Tổng kích thước: 12098 ký tự
2025-05-19 14:27:24,712 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_142724.txt
2025-05-19 14:27:24,712 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 14:27:24,713 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "team kinh doanh thì làm gì /no_think"

    THÔNG TIN PHÒNG BAN Kinh doanh:
  ...
2025-05-19 14:27:24,713 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:27:24,768 - chatbot_rag - INFO - Mã phản hồi từ API: 400
2025-05-19 14:27:24,769 - chatbot_rag - ERROR - Lỗi 400 Bad Request, thử lại với prompt ngắn hơn
2025-05-19 14:27:24,773 - chatbot_rag - INFO - Thử lại với prompt ngắn hơn: 6069 ký tự
2025-05-19 14:28:08,370 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.**

---

### 🎯 **Câu hỏi người dùng:** "team kinh doanh thì làm gì"

**Trả lời:**  
Team Kinh
2025-05-19 14:28:08,375 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_142808.txt
2025-05-19 14:28:08,377 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_142724.txt
2025-05-19 14:28:08,379 - chatbot_rag - INFO - Thời gian truy vấn LLM: 43.71 giây
2025-05-19 14:28:08,385 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:28:08,388 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:28:08,393 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:28:08,397 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 2328 ký tự phản hồi
2025-05-19 14:28:08,398 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:28:08,398 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:28:18,417 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:28:18,428 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:28:18,436 - websockets.server - INFO - connection closed
2025-05-19 14:28:18,438 - websockets.server - INFO - connection closed
2025-05-19 14:28:59,367 - websockets.server - INFO - connection closed
2025-05-19 14:29:00,532 - websockets.server - INFO - connection open
2025-05-19 14:29:00,540 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:29:00,548 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:29:00,548 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:33:05,506 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"nếu team kinh doanh không ký được với hợp đồng thì sao /no_think","session_id":"df4d9d0d
2025-05-19 14:33:05,507 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:05,507 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: nếu team kinh doanh không ký được với hợp đồng thì...
2025-05-19 14:33:05,507 - websocket_server - INFO - Nhận tin nhắn thông thường: nếu team kinh doanh không ký được với hợp đồng thì sao /no_think, enable_thinking=False
2025-05-19 14:33:05,507 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 14:33:05,508 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_143305.txt
2025-05-19 14:33:05,509 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
Người dùng: team kinh doanh thì làm gì

nếu team kinh doanh không ký được với hợp đồng thì sao /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:05,510 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:05,510 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:33:05,511 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:33:05,511 - chatbot_rag - INFO - Kích thước prompt: 923 ký tự
2025-05-19 14:33:05,512 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:33:05,512 - chatbot_rag - INFO - Tổng kích thước: 2929 ký tự
2025-05-19 14:33:05,514 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_143305.txt
2025-05-19 14:33:05,515 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:33:05,516 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo làm gì
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuô...
2025-05-19 14:33:05,516 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:33:08,481 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:33:08,482 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
```
2025-05-19 14:33:08,484 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_143308.txt
2025-05-19 14:33:08,488 - chatbot_rag - INFO - [analysis_20250519_143308] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_143308_raw.txt
2025-05-19 14:33:08,489 - chatbot_rag - INFO - [analysis_20250519_143308] Phản hồi gốc: <think>

</think>

```json
{"department": "Kinh doanh", "query_type": "department_specific", "error"...
2025-05-19 14:33:08,489 - chatbot_rag - WARNING - [analysis_20250519_143308] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:33:08,491 - chatbot_rag - INFO - [analysis_20250519_143308] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:33:08,491 - chatbot_rag - INFO - [analysis_20250519_143308] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 14:33:08,491 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:33:08,492 - websocket_server - INFO - Xử lý streaming response cho: 'nếu team kinh doanh không ký được với hợp đồng thì sao /no_think', phòng ban: Kinh doanh, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:08,492 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:08,493 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: nếu team kinh doanh không ký được với hợp đồng thì sao
2025-05-19 14:33:08,493 - websocket_server - INFO - Xử lý streaming response. Query: 'nếu team kinh doanh không ký được với hợp đồng thì sao', Mode thinking: False
2025-05-19 14:33:08,494 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 14:33:08,498 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_143308.txt
2025-05-19 14:33:08,499 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:33:08,499 - websocket_server - INFO - Query thực tế gửi đến mô hình: nếu team kinh doanh không ký được với hợp đồng thì sao /no_think
2025-05-19 14:33:08,500 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 14:33:08,500 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:08,507 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:33:08,508 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:33:08,509 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:33:08,513 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:33:08,515 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:08,516 - chatbot_rag - INFO - Số task: 24
2025-05-19 14:33:08,516 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:33:08,517 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0.
2025-05-19 14:33:08,520 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 14:33:08,523 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_143308.txt
2025-05-19 14:33:08,525 - chatbot_rag - INFO - Kích thước prompt: 10143 ký tự
2025-05-19 14:33:08,525 - chatbot_rag - INFO - Kích thước system prompt: 1983 ký tự
2025-05-19 14:33:08,525 - chatbot_rag - INFO - Tổng kích thước: 12126 ký tự
2025-05-19 14:33:08,527 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_143308.txt
2025-05-19 14:33:08,529 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 14:33:08,530 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "nếu team kinh doanh không ký được với hợp đồng thì sao /no_think"

    THÔNG ...
2025-05-19 14:33:08,531 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:33:08,609 - chatbot_rag - INFO - Mã phản hồi từ API: 400
2025-05-19 14:33:08,609 - chatbot_rag - ERROR - Lỗi 400 Bad Request, thử lại với prompt ngắn hơn
2025-05-19 14:33:08,610 - chatbot_rag - INFO - Thử lại với prompt ngắn hơn: 6085 ký tự
2025-05-19 14:33:29,639 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Nếu team kinh doanh không ký được hợp đồng, thì theo thông tin về các task trong giai đoạn **PROPOSAL**, có một số bước và hành động cụ thể cần thực hiện:

---

### 🔁 **Quay lại tas
2025-05-19 14:33:29,641 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_143329.txt
2025-05-19 14:33:29,644 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_143308.txt
2025-05-19 14:33:29,644 - chatbot_rag - INFO - Thời gian truy vấn LLM: 21.14 giây
2025-05-19 14:33:29,647 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:33:29,648 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:33:29,650 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:33:29,653 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 904 ký tự phản hồi
2025-05-19 14:33:29,653 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:33:29,654 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:35:32,315 - websockets.server - INFO - connection closed
2025-05-19 14:35:33,292 - websockets.server - INFO - connection open
2025-05-19 14:35:33,296 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:35:33,317 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:35:33,318 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:37:28,226 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think","session_id":"df4d9d0d-0ac0-43
2025-05-19 14:37:28,227 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:28,227 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: một miếng đất ở hầm thủ thiêm thi công bao lâu /no...
2025-05-19 14:37:28,228 - websocket_server - INFO - Nhận tin nhắn thông thường: một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think, enable_thinking=False
2025-05-19 14:37:28,228 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 14:37:28,229 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_143728.txt
2025-05-19 14:37:28,230 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu tiền?
Người dùng: Tôi là nhân viên 2D, hãy hướng dẫn tôi làm việc
Người dùng: team kinh doanh thì làm gì
Người dùng: nếu team kinh doanh không ký được với hợp đồng thì sao

một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:28,230 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:28,230 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:37:28,230 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu ti...
2025-05-19 14:37:28,231 - chatbot_rag - INFO - Kích thước prompt: 943 ký tự
2025-05-19 14:37:28,231 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:37:28,231 - chatbot_rag - INFO - Tổng kích thước: 2949 ký tự
2025-05-19 14:37:28,232 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_143728.txt
2025-05-19 14:37:28,233 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:37:28,233 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: giai đoạn tiếp theo là sao
Người dùng: Một căn chung cư 76 mét vuông thì làm nội thất khoảng bao nhiêu ti...
2025-05-19 14:37:28,233 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:37:31,011 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:37:31,012 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": "Thi công", "query_type": "department_specific", "error": false}
```
2025-05-19 14:37:31,014 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_143731.txt
2025-05-19 14:37:31,017 - chatbot_rag - INFO - [analysis_20250519_143731] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_143731_raw.txt
2025-05-19 14:37:31,018 - chatbot_rag - INFO - [analysis_20250519_143731] Phản hồi gốc: <think>

</think>

```json
{"department": "Thi công", "query_type": "department_specific", "error": ...
2025-05-19 14:37:31,019 - chatbot_rag - WARNING - [analysis_20250519_143731] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:37:31,019 - chatbot_rag - INFO - [analysis_20250519_143731] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:37:31,020 - chatbot_rag - INFO - [analysis_20250519_143731] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Thi công', 'query_type': 'department_specific', 'error': False}
2025-05-19 14:37:31,020 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Thi công, Loại=department_specific, Thinking=False
2025-05-19 14:37:31,021 - websocket_server - INFO - Xử lý streaming response cho: 'một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think', phòng ban: Thi công, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:31,021 - websocket_server - INFO - Session ID nhận được: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:31,022 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: một miếng đất ở hầm thủ thiêm thi công bao lâu
2025-05-19 14:37:31,023 - websocket_server - INFO - Xử lý streaming response. Query: 'một miếng đất ở hầm thủ thiêm thi công bao lâu', Mode thinking: False
2025-05-19 14:37:31,023 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 14:37:31,025 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_143731.txt
2025-05-19 14:37:31,026 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Thi công, Loại=department_specific, Thinking=False
2025-05-19 14:37:31,026 - websocket_server - INFO - Query thực tế gửi đến mô hình: một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think
2025-05-19 14:37:31,027 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Thi công, chế độ thinking: False
2025-05-19 14:37:31,027 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Thi công, Session: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:31,032 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:37:31,032 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Thi công
2025-05-19 14:37:31,033 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\thi_công.txt, kích thước: 14979 bytes
2025-05-19 14:37:31,041 - department_info_tool - INFO - Đã tìm thấy 3 giai đoạn và 23 công việc cho phòng ban Thi công
2025-05-19 14:37:31,042 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Thi công, session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:31,042 - chatbot_rag - INFO - Số task: 23
2025-05-19 14:37:31,042 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:31,043 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session df4d9d0d-0ac0-4319-9828-51b9d555fcf0.
2025-05-19 14:37:31,044 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 14:37:31,045 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_143731.txt
2025-05-19 14:37:31,045 - chatbot_rag - INFO - Kích thước prompt: 9937 ký tự
2025-05-19 14:37:31,046 - chatbot_rag - INFO - Kích thước system prompt: 1983 ký tự
2025-05-19 14:37:31,046 - chatbot_rag - INFO - Tổng kích thước: 11920 ký tự
2025-05-19 14:37:31,047 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_143731.txt
2025-05-19 14:37:31,047 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 14:37:31,048 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "một miếng đất ở hầm thủ thiêm thi công bao lâu /no_think"

    THÔNG TIN PHÒN...
2025-05-19 14:37:31,048 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:37:57,049 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:37:57,050 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Câu hỏi của bạn là: **"một miếng đất ở hầm thủ thiêm thi công bao lâu"**

**Trả lời:**  
Tôi không có thông tin cụ thể về thời gian thi công cho "một miếng đất ở hầm Thủ Thiêm". Tuy
2025-05-19 14:37:57,051 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_143757.txt
2025-05-19 14:37:57,052 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_143731.txt
2025-05-19 14:37:57,053 - chatbot_rag - INFO - Thời gian truy vấn LLM: 26.02 giây
2025-05-19 14:37:57,055 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Thi công
2025-05-19 14:37:57,056 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\thi_công.txt, kích thước: 14979 bytes
2025-05-19 14:37:57,058 - department_info_tool - INFO - Đã tìm thấy 3 giai đoạn và 23 công việc cho phòng ban Thi công
2025-05-19 14:37:57,060 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 1114 ký tự phản hồi
2025-05-19 14:37:57,061 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:37:57,061 - websocket_server - INFO - Đã lưu hội thoại phòng ban Thi công vào lịch sử của session df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:57,062 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:37:57,063 - websockets.server - INFO - connection closed
2025-05-19 14:37:57,063 - websockets.server - INFO - connection open
2025-05-19 14:37:57,064 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:57,065 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:37:57,065 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:39:03,165 - websockets.server - INFO - connection open
2025-05-19 14:39:03,167 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:39:04,052 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:39:04,053 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:39:36,642 - websockets.server - INFO - connection open
2025-05-19 14:39:36,644 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:39:37,067 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: df4d9d0d-0ac0-4319-9828-51b9d555fcf0
2025-05-19 14:39:37,068 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:40:43,477 - websockets.server - INFO - connection closed
2025-05-19 14:40:43,478 - websockets.server - INFO - connection closed
2025-05-19 14:40:43,479 - websockets.server - INFO - connection closed
2025-05-19 14:40:43,479 - websockets.server - INFO - server closing
2025-05-19 14:40:43,480 - websockets.server - INFO - server closed
2025-05-19 14:40:43,482 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 14:40:45,475 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 14:40:45,512 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 14:40:45,513 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 14:40:45,514 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 14:40:49,550 - websockets.server - INFO - connection open
2025-05-19 14:40:49,551 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:49,557 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:49,558 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:40:52,584 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:52,585 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:40:52,586 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:52,586 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:40:54,225 - websockets.server - INFO - connection closed
2025-05-19 14:40:54,942 - websockets.server - INFO - connection open
2025-05-19 14:40:54,942 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:54,943 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:54,944 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:40:56,836 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"xin chào /no_think","session_id":"2180ddf0-1536-4193-8fc4-2457575f5714"}
2025-05-19 14:40:56,836 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:56,837 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: xin chào /no_think...
2025-05-19 14:40:56,837 - websocket_server - INFO - Nhận tin nhắn thông thường: xin chào /no_think, enable_thinking=False
2025-05-19 14:40:56,838 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 14:40:56,838 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:56,843 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:56,843 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:40:56,844 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-19 14:40:56,844 - chatbot_rag - INFO - Kích thước prompt: 599 ký tự
2025-05-19 14:40:56,845 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:40:56,845 - chatbot_rag - INFO - Tổng kích thước: 2605 ký tự
2025-05-19 14:40:56,847 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144056.txt
2025-05-19 14:40:56,847 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:40:56,847 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_ty...
2025-05-19 14:40:56,848 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:40:59,427 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:40:59,427 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 14:40:59,428 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144059.txt
2025-05-19 14:40:59,430 - chatbot_rag - INFO - [analysis_20250519_144059] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144059_raw.txt
2025-05-19 14:40:59,430 - chatbot_rag - INFO - [analysis_20250519_144059] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 14:40:59,430 - chatbot_rag - WARNING - [analysis_20250519_144059] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:40:59,431 - chatbot_rag - INFO - [analysis_20250519_144059] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:40:59,431 - chatbot_rag - INFO - [analysis_20250519_144059] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 14:40:59,431 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:40:59,431 - websocket_server - INFO - Xử lý streaming response cho: 'xin chào /no_think', phòng ban: None, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:59,432 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:59,432 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: xin chào
2025-05-19 14:40:59,433 - websocket_server - INFO - Xử lý streaming response. Query: 'xin chào', Mode thinking: False
2025-05-19 14:40:59,433 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 14:40:59,433 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: xin chào, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:59,433 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:40:59,434 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:40:59,434 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-19 14:40:59,434 - chatbot_rag - INFO - Kích thước prompt: 589 ký tự
2025-05-19 14:40:59,435 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:40:59,435 - chatbot_rag - INFO - Tổng kích thước: 2595 ký tự
2025-05-19 14:40:59,437 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144059.txt
2025-05-19 14:40:59,438 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:40:59,438 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "xin chào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc null", "query_type": "depa...
2025-05-19 14:40:59,439 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:41:08,620 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:41:08,621 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this. The user's current question is "xin chào", which means "Hello" in Vietnamese. I need to analyze this based on the given rules.

First, check if there's any department 
2025-05-19 14:41:08,628 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144108.txt
2025-05-19 14:41:08,632 - chatbot_rag - INFO - [analysis_20250519_144108] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144108_raw.txt
2025-05-19 14:41:08,633 - chatbot_rag - INFO - [analysis_20250519_144108] Phản hồi gốc: <think>
Okay, let's tackle this. The user's current question is "xin chào", which means "Hello" in V...
2025-05-19 14:41:08,635 - chatbot_rag - WARNING - [analysis_20250519_144108] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:41:08,635 - chatbot_rag - INFO - [analysis_20250519_144108] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:41:08,637 - chatbot_rag - INFO - [analysis_20250519_144108] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:41:08,638 - chatbot_rag - INFO - [analysis_20250519_144108] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:41:08,638 - chatbot_rag - WARNING - [analysis_20250519_144108] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:41:08,639 - chatbot_rag - INFO - [analysis_20250519_144108] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:41:08,649 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:41:08,649 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:41:08,651 - chatbot_rag - ERROR - [analysis_20250519_144108] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:41:08,653 - chatbot_rag - WARNING - [analysis_20250519_144108] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:41:08,654 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:41:08,654 - websocket_server - INFO - Query thực tế gửi đến mô hình: xin chào /no_think
2025-05-19 14:41:08,654 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 14:41:08,655 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:08,663 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:41:08,663 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:41:08,667 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:08,669 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_144108.txt
2025-05-19 14:41:08,669 - chatbot_rag - INFO - Kích thước prompt: 1033 ký tự
2025-05-19 14:41:08,670 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:41:08,672 - chatbot_rag - INFO - Tổng kích thước: 1949 ký tự
2025-05-19 14:41:08,677 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144108.txt
2025-05-19 14:41:08,679 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:41:08,683 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "xin chào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:
1...
2025-05-19 14:41:08,683 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:41:14,630 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:41:14,630 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Chào bạn! 😄😄😄  
Mình là trợ lý AI chuyên về quy trình và giai đoạn trong công ty. Nếu bạn có bất kỳ câu hỏi nào liên quan đến công việc, hãy hỏi theo dạng ví dụ như: "Phòng X làm gì
2025-05-19 14:41:14,632 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144114.txt
2025-05-19 14:41:14,870 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 306 ký tự phản hồi
2025-05-19 14:41:14,870 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:41:14,870 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:14,872 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:41:14,872 - websockets.server - INFO - connection closed
2025-05-19 14:41:14,873 - websockets.server - INFO - connection open
2025-05-19 14:41:14,873 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:14,874 - websockets.server - INFO - connection open
2025-05-19 14:41:14,874 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:15,076 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:15,077 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:41:15,077 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:15,078 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:41:18,482 - websockets.server - INFO - connection closed
2025-05-19 14:41:19,691 - websockets.server - INFO - connection open
2025-05-19 14:41:19,693 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:19,708 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:19,708 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:41:36,632 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"môt miếng dất ở thủ thim nhiêu tiền /no_think","session_id":"2180ddf0-1536-4193-8fc4-245
2025-05-19 14:41:36,632 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:36,633 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: môt miếng dất ở thủ thim nhiêu tiền /no_think...
2025-05-19 14:41:36,633 - websocket_server - INFO - Nhận tin nhắn thông thường: môt miếng dất ở thủ thim nhiêu tiền /no_think, enable_thinking=False
2025-05-19 14:41:36,633 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 14:41:36,635 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144136.txt
2025-05-19 14:41:36,635 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:36,635 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:36,636 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:41:36,636 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền /no_think"

        Phân tích câu hỏi và trả về JSON có địn...
2025-05-19 14:41:36,637 - chatbot_rag - INFO - Kích thước prompt: 666 ký tự
2025-05-19 14:41:36,637 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:41:36,637 - chatbot_rag - INFO - Tổng kích thước: 2672 ký tự
2025-05-19 14:41:36,639 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144136.txt
2025-05-19 14:41:36,640 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:41:36,640 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền /no_think"

        Phân tích câu hỏi và trả về JSON có địn...
2025-05-19 14:41:36,640 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:41:39,218 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:41:39,219 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 14:41:39,220 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144139.txt
2025-05-19 14:41:39,223 - chatbot_rag - INFO - [analysis_20250519_144139] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144139_raw.txt
2025-05-19 14:41:39,224 - chatbot_rag - INFO - [analysis_20250519_144139] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 14:41:39,226 - chatbot_rag - WARNING - [analysis_20250519_144139] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:41:39,227 - chatbot_rag - INFO - [analysis_20250519_144139] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:41:39,227 - chatbot_rag - INFO - [analysis_20250519_144139] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 14:41:39,228 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:41:39,228 - websocket_server - INFO - Xử lý streaming response cho: 'môt miếng dất ở thủ thim nhiêu tiền /no_think', phòng ban: None, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:39,229 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:39,230 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: môt miếng dất ở thủ thim nhiêu tiền
2025-05-19 14:41:39,231 - websocket_server - INFO - Xử lý streaming response. Query: 'môt miếng dất ở thủ thim nhiêu tiền', Mode thinking: False
2025-05-19 14:41:39,232 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 14:41:39,234 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144139.txt
2025-05-19 14:41:39,236 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:39,237 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:39,238 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:41:39,239 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền"

        Phân tích câu hỏi và trả về JSON có định dạng:
  ...
2025-05-19 14:41:39,239 - chatbot_rag - INFO - Kích thước prompt: 656 ký tự
2025-05-19 14:41:39,240 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:41:39,241 - chatbot_rag - INFO - Tổng kích thước: 2662 ký tự
2025-05-19 14:41:39,245 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144139.txt
2025-05-19 14:41:39,246 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:41:39,247 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào

môt miếng dất ở thủ thim nhiêu tiền"

        Phân tích câu hỏi và trả về JSON có định dạng:
  ...
2025-05-19 14:41:39,247 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:41:48,440 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:41:48,440 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng: xin chào môt miếng dất ở thủ thim nhiêu tiền". First, I need to parse the history. The user sent "x
2025-05-19 14:41:48,441 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144148.txt
2025-05-19 14:41:48,442 - chatbot_rag - INFO - [analysis_20250519_144148] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144148_raw.txt
2025-05-19 14:41:48,443 - chatbot_rag - INFO - [analysis_20250519_144148] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is "Lịch sử tin nhắn: Người dùng:...
2025-05-19 14:41:48,443 - chatbot_rag - WARNING - [analysis_20250519_144148] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:41:48,444 - chatbot_rag - INFO - [analysis_20250519_144148] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:41:48,444 - chatbot_rag - INFO - [analysis_20250519_144148] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:41:48,445 - chatbot_rag - INFO - [analysis_20250519_144148] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:41:48,445 - chatbot_rag - WARNING - [analysis_20250519_144148] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:41:48,445 - chatbot_rag - INFO - [analysis_20250519_144148] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:41:48,448 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:41:48,449 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:41:48,449 - chatbot_rag - ERROR - [analysis_20250519_144148] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:41:48,449 - chatbot_rag - WARNING - [analysis_20250519_144148] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:41:48,449 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 14:41:48,450 - websocket_server - INFO - Query thực tế gửi đến mô hình: môt miếng dất ở thủ thim nhiêu tiền /no_think
2025-05-19 14:41:48,451 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 14:41:48,452 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:48,455 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:41:48,456 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:41:48,457 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:48,460 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_144148.txt
2025-05-19 14:41:48,461 - chatbot_rag - INFO - Kích thước prompt: 1060 ký tự
2025-05-19 14:41:48,461 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:41:48,462 - chatbot_rag - INFO - Tổng kích thước: 1976 ký tự
2025-05-19 14:41:48,464 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144148.txt
2025-05-19 14:41:48,465 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:41:48,466 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "môt miếng dất ở thủ thim nhiêu tiền /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đo...
2025-05-19 14:41:48,467 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:41:55,191 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:41:55,191 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Câu hỏi của bạn không liên quan đến quy trình hoặc giai đoạn làm việc trong công ty. 😄💸🗺️

Nếu bạn muốn biết giá đất ở Thủ Thiêm, mình khuyên bạn nên tra cứu trên các trang bất động
2025-05-19 14:41:55,192 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144155.txt
2025-05-19 14:41:55,195 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 397 ký tự phản hồi
2025-05-19 14:41:55,196 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:41:55,196 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:41:55,197 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:41:55,197 - websockets.server - INFO - connection closed
2025-05-19 14:42:16,062 - websockets.server - INFO - connection closed
2025-05-19 14:42:17,259 - websockets.server - INFO - connection open
2025-05-19 14:42:17,261 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:42:17,326 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:42:17,327 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:42:20,633 - websockets.server - INFO - connection closed
2025-05-19 14:42:24,361 - websockets.server - INFO - connection open
2025-05-19 14:42:24,362 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:42:24,555 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:42:24,556 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:43:22,416 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"vậy m biết gì /think","session_id":"2180ddf0-1536-4193-8fc4-2457575f5714"}
2025-05-19 14:43:22,416 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:22,416 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: vậy m biết gì /think...
2025-05-19 14:43:22,417 - websocket_server - INFO - Nhận tin nhắn thông thường: vậy m biết gì /think, enable_thinking=True
2025-05-19 14:43:22,417 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:43:22,418 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144322.txt
2025-05-19 14:43:22,419 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì /think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:22,419 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:22,420 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:43:22,420 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì /think"

        Phân tích câu hỏ...
2025-05-19 14:43:22,420 - chatbot_rag - INFO - Kích thước prompt: 689 ký tự
2025-05-19 14:43:22,421 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:43:22,421 - chatbot_rag - INFO - Tổng kích thước: 2695 ký tự
2025-05-19 14:43:22,422 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144322.txt
2025-05-19 14:43:22,423 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:43:22,424 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì /think"

        Phân tích câu hỏ...
2025-05-19 14:43:22,424 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:43:32,477 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:43:32,478 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "vậy m biết gì", which translates to "so what do you know?" in English. Looking at the history, the user first said "xin chào" (hell
2025-05-19 14:43:32,484 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144332.txt
2025-05-19 14:43:32,488 - chatbot_rag - INFO - [analysis_20250519_144332] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144332_raw.txt
2025-05-19 14:43:32,489 - chatbot_rag - INFO - [analysis_20250519_144332] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "vậy m biết gì", which translate...
2025-05-19 14:43:32,490 - chatbot_rag - WARNING - [analysis_20250519_144332] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:43:32,490 - chatbot_rag - INFO - [analysis_20250519_144332] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:43:32,490 - chatbot_rag - INFO - [analysis_20250519_144332] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:43:32,491 - chatbot_rag - INFO - [analysis_20250519_144332] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:43:32,491 - chatbot_rag - WARNING - [analysis_20250519_144332] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:43:32,492 - chatbot_rag - INFO - [analysis_20250519_144332] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:43:32,497 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:43:32,497 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:43:32,498 - chatbot_rag - ERROR - [analysis_20250519_144332] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:43:32,498 - chatbot_rag - WARNING - [analysis_20250519_144332] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:43:32,498 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 14:43:32,499 - websocket_server - INFO - Xử lý streaming response cho: 'vậy m biết gì /think', phòng ban: None, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:32,499 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:32,499 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: vậy m biết gì
2025-05-19 14:43:32,499 - websocket_server - INFO - Xử lý streaming response. Query: 'vậy m biết gì', Mode thinking: True
2025-05-19 14:43:32,500 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 14:43:32,503 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144332.txt
2025-05-19 14:43:32,504 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:32,505 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:32,506 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:43:32,506 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì"

        Phân tích câu hỏi và tr...
2025-05-19 14:43:32,506 - chatbot_rag - INFO - Kích thước prompt: 682 ký tự
2025-05-19 14:43:32,507 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:43:32,510 - chatbot_rag - INFO - Tổng kích thước: 2688 ký tự
2025-05-19 14:43:32,513 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144332.txt
2025-05-19 14:43:32,514 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:43:32,516 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền

vậy m biết gì"

        Phân tích câu hỏi và tr...
2025-05-19 14:43:32,517 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:43:41,747 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:43:41,748 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user's current question is "vậy m biết gì", which translates to "so what do you know?" in English. Looking at the history, the user first said "xin chào" (he
2025-05-19 14:43:41,754 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144341.txt
2025-05-19 14:43:41,769 - chatbot_rag - INFO - [analysis_20250519_144341] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144341_raw.txt
2025-05-19 14:43:41,775 - chatbot_rag - INFO - [analysis_20250519_144341] Phản hồi gốc: <think>
Okay, let's tackle this query. The user's current question is "vậy m biết gì", which transla...
2025-05-19 14:43:41,776 - chatbot_rag - WARNING - [analysis_20250519_144341] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:43:41,776 - chatbot_rag - INFO - [analysis_20250519_144341] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 14:43:41,779 - chatbot_rag - INFO - [analysis_20250519_144341] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 14:43:41,782 - chatbot_rag - INFO - [analysis_20250519_144341] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 14:43:41,789 - chatbot_rag - WARNING - [analysis_20250519_144341] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 14:43:41,800 - chatbot_rag - INFO - [analysis_20250519_144341] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 14:43:41,885 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:43:41,888 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:43:41,891 - chatbot_rag - ERROR - [analysis_20250519_144341] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 14:43:41,893 - chatbot_rag - WARNING - [analysis_20250519_144341] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 14:43:41,908 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 14:43:41,914 - websocket_server - INFO - Query thực tế gửi đến mô hình: vậy m biết gì /think
2025-05-19 14:43:41,915 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-19 14:43:41,915 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:41,929 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:43:41,931 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 14:43:41,932 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:41,935 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_144341.txt
2025-05-19 14:43:41,936 - chatbot_rag - INFO - Kích thước prompt: 1035 ký tự
2025-05-19 14:43:41,938 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 14:43:41,940 - chatbot_rag - INFO - Tổng kích thước: 1951 ký tự
2025-05-19 14:43:41,946 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144341.txt
2025-05-19 14:43:41,947 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 14:43:41,949 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "vậy m biết gì /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chính trong quy trình:...
2025-05-19 14:43:41,950 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:43:53,867 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:43:53,868 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user asked "vậy m biết gì", which is a bit vague. They might be asking what I know about the company's processes or departments. But according to the rules, if the questio
2025-05-19 14:43:53,871 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144353.txt
2025-05-19 14:43:53,917 - websocket_server - INFO - Đã trích xuất thinking (833 ký tự) và còn lại 168 ký tự phản hồi
2025-05-19 14:43:53,919 - websocket_server - INFO - Đã trích xuất phần thinking (833 ký tự) từ phản hồi
2025-05-19 14:43:53,922 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:53,932 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:43:53,936 - websockets.server - INFO - connection closed
2025-05-19 14:43:53,939 - websockets.server - INFO - connection open
2025-05-19 14:43:53,942 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:53,945 - websockets.server - INFO - connection open
2025-05-19 14:43:53,947 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:54,508 - websockets.server - INFO - connection open
2025-05-19 14:43:54,511 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:54,596 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:54,607 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:43:55,831 - websockets.server - INFO - connection open
2025-05-19 14:43:55,832 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:55,872 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:43:55,874 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:44:12,107 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"vậy team kinh doanh không ký được với hợp đồng thì sao /no_think","session_id":"2180ddf0
2025-05-19 14:44:12,108 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:12,108 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: vậy team kinh doanh không ký được với hợp đồng thì...
2025-05-19 14:44:12,109 - websocket_server - INFO - Nhận tin nhắn thông thường: vậy team kinh doanh không ký được với hợp đồng thì sao /no_think, enable_thinking=False
2025-05-19 14:44:12,109 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 14:44:12,110 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144412.txt
2025-05-19 14:44:12,111 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì

vậy team kinh doanh không ký được với hợp đồng thì sao /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:12,111 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:12,112 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 14:44:12,112 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì

vậy team kinh doanh k...
2025-05-19 14:44:12,112 - chatbot_rag - INFO - Kích thước prompt: 759 ký tự
2025-05-19 14:44:12,113 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 14:44:12,114 - chatbot_rag - INFO - Tổng kích thước: 2765 ký tự
2025-05-19 14:44:12,115 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144412.txt
2025-05-19 14:44:12,116 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 14:44:12,116 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì

vậy team kinh doanh k...
2025-05-19 14:44:12,116 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 14:44:14,932 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:44:14,933 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-19 14:44:14,936 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144414.txt
2025-05-19 14:44:14,942 - chatbot_rag - INFO - [analysis_20250519_144414] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_144414_raw.txt
2025-05-19 14:44:14,943 - chatbot_rag - INFO - [analysis_20250519_144414] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-19 14:44:14,946 - chatbot_rag - WARNING - [analysis_20250519_144414] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 14:44:14,948 - chatbot_rag - INFO - [analysis_20250519_144414] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 14:44:14,949 - chatbot_rag - INFO - [analysis_20250519_144414] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 14:44:14,949 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:44:14,950 - websocket_server - INFO - Xử lý streaming response cho: 'vậy team kinh doanh không ký được với hợp đồng thì sao /no_think', phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:14,951 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:14,952 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: vậy team kinh doanh không ký được với hợp đồng thì sao
2025-05-19 14:44:14,953 - websocket_server - INFO - Xử lý streaming response. Query: 'vậy team kinh doanh không ký được với hợp đồng thì sao', Mode thinking: False
2025-05-19 14:44:14,954 - websocket_server - INFO - Đã thêm 3 tin nhắn gần nhất vào prompt
2025-05-19 14:44:14,958 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_144414.txt
2025-05-19 14:44:14,961 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 14:44:14,962 - websocket_server - INFO - Query thực tế gửi đến mô hình: vậy team kinh doanh không ký được với hợp đồng thì sao /no_think
2025-05-19 14:44:14,963 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 14:44:14,964 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:14,976 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 14:44:14,977 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:44:14,981 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:44:15,005 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:44:15,010 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:15,011 - chatbot_rag - INFO - Số task: 24
2025-05-19 14:44:15,011 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:15,012 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 2180ddf0-1536-4193-8fc4-2457575f5714.
2025-05-19 14:44:15,016 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 14:44:15,023 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_144415.txt
2025-05-19 14:44:15,024 - chatbot_rag - INFO - Kích thước prompt: 10143 ký tự
2025-05-19 14:44:15,026 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 14:44:15,031 - chatbot_rag - INFO - Tổng kích thước: 12218 ký tự
2025-05-19 14:44:15,036 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_144415.txt
2025-05-19 14:44:15,038 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 14:44:15,039 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "vậy team kinh doanh không ký được với hợp đồng thì sao /no_think"

    THÔNG ...
2025-05-19 14:44:15,041 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 14:44:32,081 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 14:44:32,081 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Nếu team kinh doanh không ký được hợp đồng, họ sẽ **quay về task KIN-001** (Tìm kiếm cơ hội bán hàng) để tiếp tục tìm kiếm và xử lý các cơ hội khác.

Cụ thể:
- Nếu bước **KIN-012 (H
2025-05-19 14:44:32,083 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_144432.txt
2025-05-19 14:44:32,084 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_144415.txt
2025-05-19 14:44:32,085 - chatbot_rag - INFO - Thời gian truy vấn LLM: 17.11 giây
2025-05-19 14:44:32,087 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 14:44:32,088 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 14:44:32,091 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 14:44:33,417 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 437 ký tự phản hồi
2025-05-19 14:44:33,417 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 14:44:33,417 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:33,424 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:44:33,425 - websockets.server - INFO - connection closed
2025-05-19 14:44:33,428 - websockets.server - INFO - connection open
2025-05-19 14:44:33,433 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:33,434 - websockets.server - INFO - connection closed
2025-05-19 14:44:33,594 - websockets.server - INFO - connection open
2025-05-19 14:44:33,597 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:33,627 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:44:33,628 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:44:43,430 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:44:43,431 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:44:43,431 - websockets.server - INFO - connection closed
2025-05-19 14:44:43,432 - websockets.server - INFO - connection closed
2025-05-19 14:45:03,454 - websocket_server - INFO - WebSocket connection closed
2025-05-19 14:45:03,454 - websockets.server - INFO - connection closed
2025-05-19 14:46:02,724 - websockets.server - INFO - connection open
2025-05-19 14:46:02,725 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:46:02,741 - websockets.server - INFO - connection open
2025-05-19 14:46:02,742 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:46:02,744 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:46:02,745 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 14:46:17,105 - websockets.server - INFO - connection open
2025-05-19 14:46:17,107 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:46:17,110 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 14:46:17,111 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:08:28,533 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"vậy giai đoạn 1 họ làm gì /no_think","session_id":"2180ddf0-1536-4193-8fc4-2457575f5714"
2025-05-19 15:08:28,547 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:28,551 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: vậy giai đoạn 1 họ làm gì /no_think...
2025-05-19 15:08:28,552 - websocket_server - INFO - Nhận tin nhắn thông thường: vậy giai đoạn 1 họ làm gì /no_think, enable_thinking=False
2025-05-19 15:08:28,554 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-19 15:08:28,573 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_150828.txt
2025-05-19 15:08:28,577 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao

vậy giai đoạn 1 họ làm gì /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:28,580 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:28,582 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:08:28,583 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team k...
2025-05-19 15:08:28,586 - chatbot_rag - INFO - Kích thước prompt: 797 ký tự
2025-05-19 15:08:28,587 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 15:08:28,587 - chatbot_rag - INFO - Tổng kích thước: 2803 ký tự
2025-05-19 15:08:28,593 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_150828.txt
2025-05-19 15:08:28,593 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:08:28,594 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team k...
2025-05-19 15:08:28,595 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:08:31,469 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:08:31,472 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-19 15:08:31,475 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_150831.txt
2025-05-19 15:08:31,481 - chatbot_rag - INFO - [analysis_20250519_150831] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_150831_raw.txt
2025-05-19 15:08:31,482 - chatbot_rag - INFO - [analysis_20250519_150831] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-19 15:08:31,483 - chatbot_rag - WARNING - [analysis_20250519_150831] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:08:31,486 - chatbot_rag - INFO - [analysis_20250519_150831] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:08:31,488 - chatbot_rag - INFO - [analysis_20250519_150831] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:08:31,489 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 15:08:31,489 - websocket_server - INFO - Xử lý streaming response cho: 'vậy giai đoạn 1 họ làm gì /no_think', phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:31,490 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:31,491 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: vậy giai đoạn 1 họ làm gì
2025-05-19 15:08:31,491 - websocket_server - INFO - Xử lý streaming response. Query: 'vậy giai đoạn 1 họ làm gì', Mode thinking: False
2025-05-19 15:08:31,492 - websocket_server - INFO - Đã thêm 4 tin nhắn gần nhất vào prompt
2025-05-19 15:08:31,494 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_150831.txt
2025-05-19 15:08:31,495 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 15:08:31,495 - websocket_server - INFO - Query thực tế gửi đến mô hình: vậy giai đoạn 1 họ làm gì /no_think
2025-05-19 15:08:31,495 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 15:08:31,496 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:31,515 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:08:31,516 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 15:08:31,517 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 15:08:31,526 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 15:08:31,528 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:31,529 - chatbot_rag - INFO - Số task: 24
2025-05-19 15:08:31,530 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:08:31,530 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 2180ddf0-1536-4193-8fc4-2457575f5714.
2025-05-19 15:08:31,534 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 15:08:31,536 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_150831.txt
2025-05-19 15:08:31,536 - chatbot_rag - INFO - Kích thước prompt: 10114 ký tự
2025-05-19 15:08:31,536 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 15:08:31,537 - chatbot_rag - INFO - Tổng kích thước: 12189 ký tự
2025-05-19 15:08:31,538 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_150831.txt
2025-05-19 15:08:31,539 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 15:08:31,539 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "vậy giai đoạn 1 họ làm gì /no_think"

    THÔNG TIN PHÒNG BAN Kinh doanh:
   ...
2025-05-19 15:08:31,540 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:08:47,224 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:08:47,225 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Giai đoạn 1 là **MKT-SALES**. Trong giai đoạn này, phòng ban Kinh doanh thực hiện các công việc liên quan đến tìm kiếm và xác định cơ hội bán hàng.

Các task chính trong giai đoạn n
2025-05-19 15:08:47,226 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_150847.txt
2025-05-19 15:08:47,229 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_150831.txt
2025-05-19 15:08:47,229 - chatbot_rag - INFO - Thời gian truy vấn LLM: 15.71 giây
2025-05-19 15:08:47,241 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 15:08:47,242 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 15:08:47,247 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 15:08:47,257 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 441 ký tự phản hồi
2025-05-19 15:08:47,258 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 15:08:47,258 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:07,796 - websockets.server - INFO - connection open
2025-05-19 15:09:07,797 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:08,074 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:08,074 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:09:34,438 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"ukm, team 2D làm gì trong giai đoạn thi công /no_think","session_id":"2180ddf0-1536-4193
2025-05-19 15:09:34,439 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:34,439 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: ukm, team 2D làm gì trong giai đoạn thi công /no_t...
2025-05-19 15:09:34,440 - websocket_server - INFO - Nhận tin nhắn thông thường: ukm, team 2D làm gì trong giai đoạn thi công /no_think, enable_thinking=False
2025-05-19 15:09:34,440 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:09:34,443 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_150934.txt
2025-05-19 15:09:34,444 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạn 1 họ làm gì

ukm, team 2D làm gì trong giai đoạn thi công /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:34,444 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:34,445 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:09:34,445 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team k...
2025-05-19 15:09:34,445 - chatbot_rag - INFO - Kích thước prompt: 854 ký tự
2025-05-19 15:09:34,446 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 15:09:34,447 - chatbot_rag - INFO - Tổng kích thước: 2860 ký tự
2025-05-19 15:09:34,448 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_150934.txt
2025-05-19 15:09:34,449 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:09:34,449 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: xin chào
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team k...
2025-05-19 15:09:34,450 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:09:37,511 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:09:37,511 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": "2D", "query_type": "department_specific", "error": false}
```
2025-05-19 15:09:37,513 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_150937.txt
2025-05-19 15:09:37,514 - chatbot_rag - INFO - [analysis_20250519_150937] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_150937_raw.txt
2025-05-19 15:09:37,514 - chatbot_rag - INFO - [analysis_20250519_150937] Phản hồi gốc: <think>

</think>

```json
{"department": "2D", "query_type": "department_specific", "error": false}...
2025-05-19 15:09:37,515 - chatbot_rag - WARNING - [analysis_20250519_150937] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:09:37,515 - chatbot_rag - INFO - [analysis_20250519_150937] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:09:37,515 - chatbot_rag - INFO - [analysis_20250519_150937] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': '2D', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:09:37,516 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 15:09:37,516 - websocket_server - INFO - Xử lý streaming response cho: 'ukm, team 2D làm gì trong giai đoạn thi công /no_think', phòng ban: 2D, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:37,516 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:37,516 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: ukm, team 2D làm gì trong giai đoạn thi công
2025-05-19 15:09:37,517 - websocket_server - INFO - Xử lý streaming response. Query: 'ukm, team 2D làm gì trong giai đoạn thi công', Mode thinking: False
2025-05-19 15:09:37,517 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:09:37,519 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_150937.txt
2025-05-19 15:09:37,519 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=2D, Loại=department_specific, Thinking=False
2025-05-19 15:09:37,519 - websocket_server - INFO - Query thực tế gửi đến mô hình: ukm, team 2D làm gì trong giai đoạn thi công /no_think
2025-05-19 15:09:37,520 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: 2D, chế độ thinking: False
2025-05-19 15:09:37,520 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: 2D, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:37,524 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:09:37,525 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 15:09:37,525 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 15:09:37,530 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 15:09:37,530 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: 2D, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:37,531 - chatbot_rag - INFO - Số task: 3
2025-05-19 15:09:37,531 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:09:37,531 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 2180ddf0-1536-4193-8fc4-2457575f5714.
2025-05-19 15:09:37,532 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 15:09:37,534 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_150937.txt
2025-05-19 15:09:37,535 - chatbot_rag - INFO - Kích thước prompt: 2077 ký tự
2025-05-19 15:09:37,535 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 15:09:37,536 - chatbot_rag - INFO - Tổng kích thước: 4152 ký tự
2025-05-19 15:09:37,537 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_150937.txt
2025-05-19 15:09:37,538 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 15:09:37,538 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "ukm, team 2D làm gì trong giai đoạn thi công /no_think"

    THÔNG TIN PHÒNG ...
2025-05-19 15:09:37,538 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:09:45,484 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:09:45,484 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**Trả lời ngắn gọn:**

Team 2D trong giai đoạn **CONSTRUCTION** có 2 task, bao gồm:
- Chuẩn bị kick-off nội bộ/ Chuẩn bị họp cập nhật dự án (khảo sát mặt bằng)
- Chuẩn bị kick-off n
2025-05-19 15:09:45,489 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_150945.txt
2025-05-19 15:09:45,492 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_150937.txt
2025-05-19 15:09:45,493 - chatbot_rag - INFO - Thời gian truy vấn LLM: 7.97 giây
2025-05-19 15:09:45,498 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: 2D
2025-05-19 15:09:45,499 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\2d.txt, kích thước: 1707 bytes
2025-05-19 15:09:45,501 - department_info_tool - INFO - Đã tìm thấy 2 giai đoạn và 3 công việc cho phòng ban 2D
2025-05-19 15:09:45,504 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 351 ký tự phản hồi
2025-05-19 15:09:45,504 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 15:09:45,505 - websocket_server - INFO - Đã lưu hội thoại phòng ban 2D vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:25,142 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think","session_
2025-05-19 15:10:25,143 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:25,143 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: vậy team kinh doanh không hoàn thành công viêc thì...
2025-05-19 15:10:25,144 - websocket_server - INFO - Nhận tin nhắn thông thường: vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think, enable_thinking=False
2025-05-19 15:10:25,146 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:10:25,148 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151025.txt
2025-05-19 15:10:25,148 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạn 1 họ làm gì
Người dùng: ukm, team 2D làm gì trong giai đoạn thi công

vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:25,149 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:25,149 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:10:25,149 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký đư...
2025-05-19 15:10:25,150 - chatbot_rag - INFO - Kích thước prompt: 913 ký tự
2025-05-19 15:10:25,150 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 15:10:25,150 - chatbot_rag - INFO - Tổng kích thước: 2919 ký tự
2025-05-19 15:10:25,152 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151025.txt
2025-05-19 15:10:25,152 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:10:25,153 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: môt miếng dất ở thủ thim nhiêu tiền
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký đư...
2025-05-19 15:10:25,153 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:10:28,270 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:10:28,270 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
```
2025-05-19 15:10:28,272 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151028.txt
2025-05-19 15:10:28,274 - chatbot_rag - INFO - [analysis_20250519_151028] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151028_raw.txt
2025-05-19 15:10:28,274 - chatbot_rag - INFO - [analysis_20250519_151028] Phản hồi gốc: <think>

</think>

```json
{"department": "Kinh doanh", "query_type": "department_specific", "error"...
2025-05-19 15:10:28,275 - chatbot_rag - WARNING - [analysis_20250519_151028] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:10:28,275 - chatbot_rag - INFO - [analysis_20250519_151028] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:10:28,275 - chatbot_rag - INFO - [analysis_20250519_151028] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:10:28,276 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 15:10:28,276 - websocket_server - INFO - Xử lý streaming response cho: 'vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think', phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:28,276 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:28,277 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không
2025-05-19 15:10:28,277 - websocket_server - INFO - Xử lý streaming response. Query: 'vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không', Mode thinking: False
2025-05-19 15:10:28,277 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:10:28,278 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151028.txt
2025-05-19 15:10:28,279 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 15:10:28,279 - websocket_server - INFO - Query thực tế gửi đến mô hình: vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think
2025-05-19 15:10:28,279 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 15:10:28,280 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:28,283 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:10:28,283 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 15:10:28,284 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 15:10:28,287 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 15:10:28,288 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:28,288 - chatbot_rag - INFO - Số task: 24
2025-05-19 15:10:28,290 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:10:28,290 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 2180ddf0-1536-4193-8fc4-2457575f5714.
2025-05-19 15:10:28,293 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 15:10:28,294 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_151028.txt
2025-05-19 15:10:28,295 - chatbot_rag - INFO - Kích thước prompt: 10156 ký tự
2025-05-19 15:10:28,296 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 15:10:28,296 - chatbot_rag - INFO - Tổng kích thước: 12231 ký tự
2025-05-19 15:10:28,299 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151028.txt
2025-05-19 15:10:28,299 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 15:10:28,300 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không /no_think...
2025-05-19 15:10:28,300 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:10:43,195 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:10:43,196 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Vâng, team kinh doanh có thể bị đánh nếu không hoàn thành công việc. Trong dữ liệu, có nhiều task liên quan đến quy trình bán hàng và quản lý dự án, bao gồm cả các bước chuyển tiếp 
2025-05-19 15:10:43,198 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151043.txt
2025-05-19 15:10:43,202 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_151028.txt
2025-05-19 15:10:43,203 - chatbot_rag - INFO - Thời gian truy vấn LLM: 14.92 giây
2025-05-19 15:10:43,209 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 15:10:43,210 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 15:10:43,219 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 15:10:43,230 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 463 ký tự phản hồi
2025-05-19 15:10:43,231 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 15:10:43,231 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:21,628 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team IT có tham gia thi công không /no_think","session_id":"2180ddf0-1536-4193-8fc4-2457
2025-05-19 15:11:21,628 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:21,628 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team IT có tham gia thi công không /no_think...
2025-05-19 15:11:21,629 - websocket_server - INFO - Nhận tin nhắn thông thường: team IT có tham gia thi công không /no_think, enable_thinking=False
2025-05-19 15:11:21,629 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:11:21,630 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151121.txt
2025-05-19 15:11:21,630 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạn 1 họ làm gì
Người dùng: ukm, team 2D làm gì trong giai đoạn thi công
Người dùng: vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không

team IT có tham gia thi công không /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:21,631 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:21,631 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:11:21,631 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạ...
2025-05-19 15:11:21,632 - chatbot_rag - INFO - Kích thước prompt: 912 ký tự
2025-05-19 15:11:21,632 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 15:11:21,632 - chatbot_rag - INFO - Tổng kích thước: 2918 ký tự
2025-05-19 15:11:21,633 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151121.txt
2025-05-19 15:11:21,634 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:11:21,634 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạ...
2025-05-19 15:11:21,635 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:11:24,312 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:11:24,313 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "IT", "query_type": "department_specific", "error": false}
2025-05-19 15:11:24,318 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151124.txt
2025-05-19 15:11:24,326 - chatbot_rag - INFO - [analysis_20250519_151124] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151124_raw.txt
2025-05-19 15:11:24,328 - chatbot_rag - INFO - [analysis_20250519_151124] Phản hồi gốc: <think>

</think>

{"department": "IT", "query_type": "department_specific", "error": false}...
2025-05-19 15:11:24,329 - chatbot_rag - WARNING - [analysis_20250519_151124] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:11:24,331 - chatbot_rag - INFO - [analysis_20250519_151124] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:11:24,332 - chatbot_rag - INFO - [analysis_20250519_151124] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'IT', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:11:24,334 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:11:24,335 - websocket_server - INFO - Xử lý streaming response cho: 'team IT có tham gia thi công không /no_think', phòng ban: IT, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:24,336 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:24,337 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team IT có tham gia thi công không
2025-05-19 15:11:24,339 - websocket_server - INFO - Xử lý streaming response. Query: 'team IT có tham gia thi công không', Mode thinking: False
2025-05-19 15:11:24,341 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:11:24,348 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151124.txt
2025-05-19 15:11:24,349 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:11:24,350 - websocket_server - INFO - Query thực tế gửi đến mô hình: team IT có tham gia thi công không /no_think
2025-05-19 15:11:24,351 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: IT, chế độ thinking: False
2025-05-19 15:11:24,352 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: IT, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:24,361 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:11:24,362 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: IT
2025-05-19 15:11:24,363 - department_info_tool - WARNING - Không tìm thấy file cho 'IT' tại đường dẫn C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\it.txt
2025-05-19 15:11:24,370 - department_info_tool - ERROR - Không tìm thấy file nào phù hợp cho phòng ban 'IT'
2025-05-19 15:11:24,371 - websocket_server - ERROR - Lỗi khi xử lý streaming response: 'department'
2025-05-19 15:11:38,713 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team IT có tham gia thi công không /no_think","session_id":"2180ddf0-1536-4193-8fc4-2457
2025-05-19 15:11:38,714 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:38,715 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team IT có tham gia thi công không /no_think...
2025-05-19 15:11:38,715 - websocket_server - INFO - Nhận tin nhắn thông thường: team IT có tham gia thi công không /no_think, enable_thinking=False
2025-05-19 15:11:38,716 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:11:38,720 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151138.txt
2025-05-19 15:11:38,720 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạn 1 họ làm gì
Người dùng: ukm, team 2D làm gì trong giai đoạn thi công
Người dùng: vậy team kinh doanh không hoàn thành công viêc thì có bị đánh không

team IT có tham gia thi công không /no_think, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:38,721 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:38,721 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:11:38,722 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạ...
2025-05-19 15:11:38,723 - chatbot_rag - INFO - Kích thước prompt: 912 ký tự
2025-05-19 15:11:38,723 - chatbot_rag - INFO - Kích thước system prompt: 2006 ký tự
2025-05-19 15:11:38,724 - chatbot_rag - INFO - Tổng kích thước: 2918 ký tự
2025-05-19 15:11:38,726 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151138.txt
2025-05-19 15:11:38,727 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:11:38,728 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: vậy m biết gì
Người dùng: vậy team kinh doanh không ký được với hợp đồng thì sao
Người dùng: vậy giai đoạ...
2025-05-19 15:11:38,729 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:11:39,975 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:11:39,975 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

```json
{"department": "IT", "query_type": "department_specific", "error": false}
```
2025-05-19 15:11:39,978 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151139.txt
2025-05-19 15:11:39,982 - chatbot_rag - INFO - [analysis_20250519_151139] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151139_raw.txt
2025-05-19 15:11:39,983 - chatbot_rag - INFO - [analysis_20250519_151139] Phản hồi gốc: <think>

</think>

```json
{"department": "IT", "query_type": "department_specific", "error": false}...
2025-05-19 15:11:39,983 - chatbot_rag - WARNING - [analysis_20250519_151139] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:11:39,983 - chatbot_rag - INFO - [analysis_20250519_151139] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:11:39,984 - chatbot_rag - INFO - [analysis_20250519_151139] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'IT', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:11:39,984 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:11:39,985 - websocket_server - INFO - Xử lý streaming response cho: 'team IT có tham gia thi công không /no_think', phòng ban: IT, session_id: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:39,986 - websocket_server - INFO - Session ID nhận được: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:39,987 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team IT có tham gia thi công không
2025-05-19 15:11:39,987 - websocket_server - INFO - Xử lý streaming response. Query: 'team IT có tham gia thi công không', Mode thinking: False
2025-05-19 15:11:39,988 - websocket_server - INFO - Đã thêm 5 tin nhắn gần nhất vào prompt
2025-05-19 15:11:39,989 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151139.txt
2025-05-19 15:11:39,989 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:11:39,990 - websocket_server - INFO - Query thực tế gửi đến mô hình: team IT có tham gia thi công không /no_think
2025-05-19 15:11:39,990 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: IT, chế độ thinking: False
2025-05-19 15:11:39,990 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: IT, Session: 2180ddf0-1536-4193-8fc4-2457575f5714
2025-05-19 15:11:39,996 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:11:39,996 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: IT
2025-05-19 15:11:39,997 - department_info_tool - WARNING - Không tìm thấy file cho 'IT' tại đường dẫn C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\it.txt
2025-05-19 15:11:39,998 - department_info_tool - ERROR - Không tìm thấy file nào phù hợp cho phòng ban 'IT'
2025-05-19 15:11:39,999 - websocket_server - ERROR - Lỗi khi xử lý streaming response: 'department'
2025-05-19 15:12:56,062 - websockets.server - INFO - connection closed
2025-05-19 15:12:56,063 - websockets.server - INFO - connection closed
2025-05-19 15:12:56,063 - websockets.server - INFO - connection closed
2025-05-19 15:12:56,064 - websockets.server - INFO - connection closed
2025-05-19 15:12:56,065 - websockets.server - INFO - connection closed
2025-05-19 15:12:56,065 - websockets.server - INFO - server closing
2025-05-19 15:12:56,066 - websockets.server - INFO - server closed
2025-05-19 15:12:56,072 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 15:12:57,668 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 15:12:57,695 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 15:12:57,696 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 15:12:57,696 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 15:13:03,175 - websockets.server - INFO - connection open
2025-05-19 15:13:03,176 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:03,403 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:03,404 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:13:03,406 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:03,407 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:13:04,537 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team IT có tham gia thi công không /no_think","session_id":"9f86cb47-6957-4383-8a08-a964
2025-05-19 15:13:04,538 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:04,538 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team IT có tham gia thi công không /no_think...
2025-05-19 15:13:04,539 - websocket_server - INFO - Nhận tin nhắn thông thường: team IT có tham gia thi công không /no_think, enable_thinking=False
2025-05-19 15:13:04,539 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:13:04,539 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: team IT có tham gia thi công không /no_think, session_id: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:04,544 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:04,545 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:13:04,545 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT có tham gia thi công không /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng...
2025-05-19 15:13:04,546 - chatbot_rag - INFO - Kích thước prompt: 625 ký tự
2025-05-19 15:13:04,546 - chatbot_rag - INFO - Kích thước system prompt: 2098 ký tự
2025-05-19 15:13:04,547 - chatbot_rag - INFO - Tổng kích thước: 2723 ký tự
2025-05-19 15:13:04,549 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151304.txt
2025-05-19 15:13:04,550 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:13:04,551 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT có tham gia thi công không /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng...
2025-05-19 15:13:04,551 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:13:07,246 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:13:07,247 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Team dự án", "query_type": "department_specific", "error": false}
2025-05-19 15:13:07,249 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151307.txt
2025-05-19 15:13:07,252 - chatbot_rag - INFO - [analysis_20250519_151307] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151307_raw.txt
2025-05-19 15:13:07,252 - chatbot_rag - INFO - [analysis_20250519_151307] Phản hồi gốc: <think>

</think>

{"department": "Team dự án", "query_type": "department_specific", "error": false}...
2025-05-19 15:13:07,253 - chatbot_rag - WARNING - [analysis_20250519_151307] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:13:07,253 - chatbot_rag - INFO - [analysis_20250519_151307] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:13:07,254 - chatbot_rag - INFO - [analysis_20250519_151307] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Team dự án', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:13:07,254 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team dự án, Loại=department_specific, Thinking=False
2025-05-19 15:13:07,255 - websocket_server - INFO - Xử lý streaming response cho: 'team IT có tham gia thi công không /no_think', phòng ban: Team dự án, session_id: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:07,255 - websocket_server - INFO - Session ID nhận được: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:07,256 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team IT có tham gia thi công không
2025-05-19 15:13:07,256 - websocket_server - INFO - Xử lý streaming response. Query: 'team IT có tham gia thi công không', Mode thinking: False
2025-05-19 15:13:07,256 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:13:07,256 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team dự án, Loại=department_specific, Thinking=False
2025-05-19 15:13:07,257 - websocket_server - INFO - Query thực tế gửi đến mô hình: team IT có tham gia thi công không /no_think
2025-05-19 15:13:07,257 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Team dự án, chế độ thinking: False
2025-05-19 15:13:07,257 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Team dự án, Session: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:07,263 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:13:07,264 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Team dự án
2025-05-19 15:13:07,265 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\team_dự_án.txt, kích thước: 1009 bytes
2025-05-19 15:13:07,268 - department_info_tool - INFO - Đã tìm thấy 1 giai đoạn và 1 công việc cho phòng ban Team dự án
2025-05-19 15:13:07,269 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Team dự án, session_id: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:07,269 - chatbot_rag - INFO - Số task: 1
2025-05-19 15:13:07,271 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:13:07,271 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 9f86cb47-6957-4383-8a08-a9646899f847.
2025-05-19 15:13:07,273 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 15:13:07,276 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_151307.txt
2025-05-19 15:13:07,276 - chatbot_rag - INFO - Kích thước prompt: 1867 ký tự
2025-05-19 15:13:07,277 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 15:13:07,277 - chatbot_rag - INFO - Tổng kích thước: 3942 ký tự
2025-05-19 15:13:07,279 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151307.txt
2025-05-19 15:13:07,280 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 15:13:07,280 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "team IT có tham gia thi công không /no_think"

    THÔNG TIN PHÒNG BAN Team d...
2025-05-19 15:13:07,281 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:13:13,123 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:13:13,124 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Team IT **không tham gia thi công**.  

Thông tin về task:
- Task: Họp Kick-off nội bộ/ Họp cập nhật dự án  
- Giai đoạn: CONSTRUCTION  
- Mô tả: Đảm bảo team dự án biết rõ nên làm 
2025-05-19 15:13:13,130 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151313.txt
2025-05-19 15:13:13,137 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_151307.txt
2025-05-19 15:13:13,138 - chatbot_rag - INFO - Thời gian truy vấn LLM: 5.87 giây
2025-05-19 15:13:13,443 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Team dự án
2025-05-19 15:13:13,444 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\team_dự_án.txt, kích thước: 1009 bytes
2025-05-19 15:13:13,444 - department_info_tool - INFO - Đã tìm thấy 1 giai đoạn và 1 công việc cho phòng ban Team dự án
2025-05-19 15:13:14,453 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 228 ký tự phản hồi
2025-05-19 15:13:14,454 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 15:13:14,455 - websocket_server - INFO - Đã lưu hội thoại phòng ban Team dự án vào lịch sử của session 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:41,756 - websockets.server - INFO - connection closed
2025-05-19 15:14:42,233 - websockets.server - INFO - connection open
2025-05-19 15:14:42,234 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:42,307 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:42,309 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:14:44,089 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:44,089 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:14:44,091 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:44,091 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:14:47,414 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 9f86cb47-6957-4383-8a08-a9646899f847
2025-05-19 15:14:47,415 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:14:52,920 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:14:52,920 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:15:00,385 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team IT tham gia giai đoạn nào /no_think","session_id":"0d7b300c-e003-4892-8306-5ccb2a23
2025-05-19 15:15:00,385 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:00,386 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team IT tham gia giai đoạn nào /no_think...
2025-05-19 15:15:00,386 - websocket_server - INFO - Nhận tin nhắn thông thường: team IT tham gia giai đoạn nào /no_think, enable_thinking=False
2025-05-19 15:15:00,386 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:00,387 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: team IT tham gia giai đoạn nào /no_think, session_id: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:00,387 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:00,388 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:15:00,388 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia giai đoạn nào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-19 15:15:00,389 - chatbot_rag - INFO - Kích thước prompt: 621 ký tự
2025-05-19 15:15:00,389 - chatbot_rag - INFO - Kích thước system prompt: 2098 ký tự
2025-05-19 15:15:00,390 - chatbot_rag - INFO - Tổng kích thước: 2719 ký tự
2025-05-19 15:15:00,392 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151500.txt
2025-05-19 15:15:00,393 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:15:00,393 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia giai đoạn nào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-19 15:15:00,394 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:15:03,148 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:15:03,148 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Team dự án", "query_type": "department_specific", "error": false}
2025-05-19 15:15:03,150 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151503.txt
2025-05-19 15:15:03,152 - chatbot_rag - INFO - [analysis_20250519_151503] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151503_raw.txt
2025-05-19 15:15:03,152 - chatbot_rag - INFO - [analysis_20250519_151503] Phản hồi gốc: <think>

</think>

{"department": "Team dự án", "query_type": "department_specific", "error": false}...
2025-05-19 15:15:03,153 - chatbot_rag - WARNING - [analysis_20250519_151503] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:15:03,153 - chatbot_rag - INFO - [analysis_20250519_151503] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:15:03,153 - chatbot_rag - INFO - [analysis_20250519_151503] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Team dự án', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:15:03,154 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team dự án, Loại=department_specific, Thinking=False
2025-05-19 15:15:03,154 - websocket_server - INFO - Xử lý streaming response cho: 'team IT tham gia giai đoạn nào /no_think', phòng ban: Team dự án, session_id: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:03,154 - websocket_server - INFO - Session ID nhận được: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:03,155 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team IT tham gia giai đoạn nào
2025-05-19 15:15:03,155 - websocket_server - INFO - Xử lý streaming response. Query: 'team IT tham gia giai đoạn nào', Mode thinking: False
2025-05-19 15:15:03,156 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:03,156 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team dự án, Loại=department_specific, Thinking=False
2025-05-19 15:15:03,157 - websocket_server - INFO - Query thực tế gửi đến mô hình: team IT tham gia giai đoạn nào /no_think
2025-05-19 15:15:03,157 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Team dự án, chế độ thinking: False
2025-05-19 15:15:03,158 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Team dự án, Session: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:03,163 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:15:03,164 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Team dự án
2025-05-19 15:15:03,164 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\team_dự_án.txt, kích thước: 1009 bytes
2025-05-19 15:15:03,165 - department_info_tool - INFO - Đã tìm thấy 1 giai đoạn và 1 công việc cho phòng ban Team dự án
2025-05-19 15:15:03,165 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Team dự án, session_id: 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:03,166 - chatbot_rag - INFO - Số task: 1
2025-05-19 15:15:03,166 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:03,167 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 0d7b300c-e003-4892-8306-5ccb2a238a2d.
2025-05-19 15:15:03,168 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 15:15:03,169 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_151503.txt
2025-05-19 15:15:03,169 - chatbot_rag - INFO - Kích thước prompt: 1863 ký tự
2025-05-19 15:15:03,170 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 15:15:03,170 - chatbot_rag - INFO - Tổng kích thước: 3938 ký tự
2025-05-19 15:15:03,172 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151503.txt
2025-05-19 15:15:03,172 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 15:15:03,173 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "team IT tham gia giai đoạn nào /no_think"

    THÔNG TIN PHÒNG BAN Team dự án...
2025-05-19 15:15:03,173 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:15:08,719 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:15:08,723 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Team IT tham gia giai đoạn **CONSTRUCTION**. 

Cụ thể, task liên quan đến Team IT là:
- **Họp Kick-off nội bộ/ Họp cập nhật dự án** (id: TEA-001) thuộc giai đoạn **CONSTRUCTION**, s
2025-05-19 15:15:08,728 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151508.txt
2025-05-19 15:15:08,772 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_151503.txt
2025-05-19 15:15:08,772 - chatbot_rag - INFO - Thời gian truy vấn LLM: 5.61 giây
2025-05-19 15:15:08,775 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Team dự án
2025-05-19 15:15:08,776 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\team_dự_án.txt, kích thước: 1009 bytes
2025-05-19 15:15:08,777 - department_info_tool - INFO - Đã tìm thấy 1 giai đoạn và 1 công việc cho phòng ban Team dự án
2025-05-19 15:15:08,779 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 207 ký tự phản hồi
2025-05-19 15:15:08,779 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 15:15:08,779 - websocket_server - INFO - Đã lưu hội thoại phòng ban Team dự án vào lịch sử của session 0d7b300c-e003-4892-8306-5ccb2a238a2d
2025-05-19 15:15:25,369 - websockets.server - INFO - connection closed
2025-05-19 15:15:25,370 - websockets.server - INFO - server closing
2025-05-19 15:15:25,371 - websockets.server - INFO - server closed
2025-05-19 15:15:25,373 - websocket_server - INFO - Server bị dừng bởi người dùng
2025-05-19 15:15:27,764 - websocket_server - INFO - Khởi động server WebSocket tại 0.0.0.0:8090
2025-05-19 15:15:27,799 - websockets.server - INFO - server listening on 0.0.0.0:8090
2025-05-19 15:15:27,800 - websocket_server - INFO - Server WebSocket đang chạy tại ws://0.0.0.0:8090
2025-05-19 15:15:27,800 - websocket_server - INFO - Đã cấu hình ping_timeout=6000 giây, ping_interval=60 giây
2025-05-19 15:15:30,324 - websockets.server - INFO - connection open
2025-05-19 15:15:30,325 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:30,407 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:30,412 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:15:36,213 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"Team IT tham gia giai đoạn nào /no_think","session_id":"07839642-ae58-44b2-ab77-c7072ba5
2025-05-19 15:15:36,214 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:36,215 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: Team IT tham gia giai đoạn nào /no_think...
2025-05-19 15:15:36,215 - websocket_server - INFO - Nhận tin nhắn thông thường: Team IT tham gia giai đoạn nào /no_think, enable_thinking=False
2025-05-19 15:15:36,215 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:36,216 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Team IT tham gia giai đoạn nào /no_think, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:36,218 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:36,219 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:15:36,219 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Team IT tham gia giai đoạn nào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-19 15:15:36,219 - chatbot_rag - INFO - Kích thước prompt: 621 ký tự
2025-05-19 15:15:36,221 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:15:36,222 - chatbot_rag - INFO - Tổng kích thước: 2890 ký tự
2025-05-19 15:15:36,226 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151536.txt
2025-05-19 15:15:36,227 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:15:36,228 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Team IT tham gia giai đoạn nào /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban...
2025-05-19 15:15:36,229 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:15:38,914 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:15:38,916 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Team IT", "query_type": "department_specific", "error": false}
2025-05-19 15:15:38,919 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151538.txt
2025-05-19 15:15:38,924 - chatbot_rag - INFO - [analysis_20250519_151538] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151538_raw.txt
2025-05-19 15:15:38,925 - chatbot_rag - INFO - [analysis_20250519_151538] Phản hồi gốc: <think>

</think>

{"department": "Team IT", "query_type": "department_specific", "error": false}...
2025-05-19 15:15:38,927 - chatbot_rag - WARNING - [analysis_20250519_151538] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:15:38,929 - chatbot_rag - INFO - [analysis_20250519_151538] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:15:38,930 - chatbot_rag - INFO - [analysis_20250519_151538] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Team IT', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:15:38,932 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team IT, Loại=department_specific, Thinking=False
2025-05-19 15:15:38,933 - websocket_server - INFO - Xử lý streaming response cho: 'Team IT tham gia giai đoạn nào /no_think', phòng ban: Team IT, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:38,934 - websocket_server - INFO - Session ID nhận được: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:38,935 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: Team IT tham gia giai đoạn nào
2025-05-19 15:15:38,936 - websocket_server - INFO - Xử lý streaming response. Query: 'Team IT tham gia giai đoạn nào', Mode thinking: False
2025-05-19 15:15:38,937 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:38,938 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Team IT, Loại=department_specific, Thinking=False
2025-05-19 15:15:38,939 - websocket_server - INFO - Query thực tế gửi đến mô hình: Team IT tham gia giai đoạn nào /no_think
2025-05-19 15:15:38,940 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Team IT, chế độ thinking: False
2025-05-19 15:15:38,941 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Team IT, Session: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:38,954 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:15:38,955 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Team IT
2025-05-19 15:15:38,957 - department_info_tool - WARNING - Không tìm thấy file cho 'Team IT' tại đường dẫn C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\team_it.txt
2025-05-19 15:15:38,961 - department_info_tool - ERROR - Không tìm thấy file nào phù hợp cho phòng ban 'Team IT'
2025-05-19 15:15:38,962 - websocket_server - ERROR - Lỗi khi xử lý streaming response: 'department'
2025-05-19 15:15:54,506 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"phòng IT có tham gia dự án nào khôgn /no_think","session_id":"07839642-ae58-44b2-ab77-c7
2025-05-19 15:15:54,507 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:54,507 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: phòng IT có tham gia dự án nào khôgn /no_think...
2025-05-19 15:15:54,507 - websocket_server - INFO - Nhận tin nhắn thông thường: phòng IT có tham gia dự án nào khôgn /no_think, enable_thinking=False
2025-05-19 15:15:54,508 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:54,508 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: phòng IT có tham gia dự án nào khôgn /no_think, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:54,508 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:54,508 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:15:54,509 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT có tham gia dự án nào khôgn /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phò...
2025-05-19 15:15:54,509 - chatbot_rag - INFO - Kích thước prompt: 627 ký tự
2025-05-19 15:15:54,509 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:15:54,510 - chatbot_rag - INFO - Tổng kích thước: 2896 ký tự
2025-05-19 15:15:54,511 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151554.txt
2025-05-19 15:15:54,511 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:15:54,512 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT có tham gia dự án nào khôgn /no_think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phò...
2025-05-19 15:15:54,512 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:15:56,269 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:15:56,269 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "IT", "query_type": "department_specific", "error": false}
2025-05-19 15:15:56,270 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151556.txt
2025-05-19 15:15:56,272 - chatbot_rag - INFO - [analysis_20250519_151556] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151556_raw.txt
2025-05-19 15:15:56,272 - chatbot_rag - INFO - [analysis_20250519_151556] Phản hồi gốc: <think>

</think>

{"department": "IT", "query_type": "department_specific", "error": false}...
2025-05-19 15:15:56,272 - chatbot_rag - WARNING - [analysis_20250519_151556] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:15:56,273 - chatbot_rag - INFO - [analysis_20250519_151556] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 15:15:56,273 - chatbot_rag - INFO - [analysis_20250519_151556] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'IT', 'query_type': 'department_specific', 'error': False}
2025-05-19 15:15:56,273 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:15:56,273 - websocket_server - INFO - Xử lý streaming response cho: 'phòng IT có tham gia dự án nào khôgn /no_think', phòng ban: IT, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:56,274 - websocket_server - INFO - Session ID nhận được: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:56,274 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: phòng IT có tham gia dự án nào khôgn
2025-05-19 15:15:56,274 - websocket_server - INFO - Xử lý streaming response. Query: 'phòng IT có tham gia dự án nào khôgn', Mode thinking: False
2025-05-19 15:15:56,274 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:15:56,275 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=IT, Loại=department_specific, Thinking=False
2025-05-19 15:15:56,275 - websocket_server - INFO - Query thực tế gửi đến mô hình: phòng IT có tham gia dự án nào khôgn /no_think
2025-05-19 15:15:56,275 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: IT, chế độ thinking: False
2025-05-19 15:15:56,276 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: IT, Session: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:15:56,284 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:15:56,285 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: IT
2025-05-19 15:15:56,285 - department_info_tool - WARNING - Không tìm thấy file cho 'IT' tại đường dẫn C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\it.txt
2025-05-19 15:15:56,287 - department_info_tool - ERROR - Không tìm thấy file nào phù hợp cho phòng ban 'IT'
2025-05-19 15:15:56,287 - websocket_server - ERROR - Lỗi khi xử lý streaming response: 'department'
2025-05-19 15:16:05,122 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"phòng IT tham gia giai đoạn nào /think","session_id":"07839642-ae58-44b2-ab77-c7072ba5d7
2025-05-19 15:16:05,122 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:05,123 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: phòng IT tham gia giai đoạn nào /think...
2025-05-19 15:16:05,124 - websocket_server - INFO - Nhận tin nhắn thông thường: phòng IT tham gia giai đoạn nào /think, enable_thinking=True
2025-05-19 15:16:05,124 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:16:05,125 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: phòng IT tham gia giai đoạn nào /think, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:05,125 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:05,126 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:16:05,126 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT tham gia giai đoạn nào /think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban h...
2025-05-19 15:16:05,127 - chatbot_rag - INFO - Kích thước prompt: 619 ký tự
2025-05-19 15:16:05,127 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:16:05,127 - chatbot_rag - INFO - Tổng kích thước: 2888 ký tự
2025-05-19 15:16:05,130 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151605.txt
2025-05-19 15:16:05,131 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:16:05,131 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT tham gia giai đoạn nào /think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban h...
2025-05-19 15:16:05,132 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:16:14,113 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:16:14,114 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's tackle this query. The user is asking, "phòng IT tham gia giai đoạn nào." First, I need to determine the department mentioned. The term "phòng IT" translates to "IT Department." Bu
2025-05-19 15:16:14,117 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151614.txt
2025-05-19 15:16:14,120 - chatbot_rag - INFO - [analysis_20250519_151614] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151614_raw.txt
2025-05-19 15:16:14,121 - chatbot_rag - INFO - [analysis_20250519_151614] Phản hồi gốc: <think>
Okay, let's tackle this query. The user is asking, "phòng IT tham gia giai đoạn nào." First,...
2025-05-19 15:16:14,121 - chatbot_rag - WARNING - [analysis_20250519_151614] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:16:14,123 - chatbot_rag - INFO - [analysis_20250519_151614] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:16:14,123 - chatbot_rag - INFO - [analysis_20250519_151614] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:16:14,124 - chatbot_rag - INFO - [analysis_20250519_151614] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:16:14,124 - chatbot_rag - WARNING - [analysis_20250519_151614] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:16:14,124 - chatbot_rag - INFO - [analysis_20250519_151614] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:16:14,130 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:16:14,130 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:16:14,131 - chatbot_rag - ERROR - [analysis_20250519_151614] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:16:14,131 - chatbot_rag - WARNING - [analysis_20250519_151614] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:16:14,132 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:16:14,132 - websocket_server - INFO - Xử lý streaming response cho: 'phòng IT tham gia giai đoạn nào /think', phòng ban: None, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:14,133 - websocket_server - INFO - Session ID nhận được: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:14,133 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: phòng IT tham gia giai đoạn nào
2025-05-19 15:16:14,133 - websocket_server - INFO - Xử lý streaming response. Query: 'phòng IT tham gia giai đoạn nào', Mode thinking: True
2025-05-19 15:16:14,134 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:16:14,134 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: phòng IT tham gia giai đoạn nào, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:14,134 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:14,135 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:16:14,135 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT tham gia giai đoạn nào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc nul...
2025-05-19 15:16:14,135 - chatbot_rag - INFO - Kích thước prompt: 612 ký tự
2025-05-19 15:16:14,136 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:16:14,137 - chatbot_rag - INFO - Tổng kích thước: 2881 ký tự
2025-05-19 15:16:14,139 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151614.txt
2025-05-19 15:16:14,139 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:16:14,140 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "phòng IT tham gia giai đoạn nào"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc nul...
2025-05-19 15:16:14,140 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:16:23,153 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:16:23,154 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user is asking, "phòng IT tham gia giai đoạn nào." First, I need to check if "phòng IT" is in the list of departments provided. The departments listed are 2D, 
2025-05-19 15:16:23,155 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151623.txt
2025-05-19 15:16:23,157 - chatbot_rag - INFO - [analysis_20250519_151623] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151623_raw.txt
2025-05-19 15:16:23,158 - chatbot_rag - INFO - [analysis_20250519_151623] Phản hồi gốc: <think>
Okay, let's break this down. The user is asking, "phòng IT tham gia giai đoạn nào." First, I...
2025-05-19 15:16:23,158 - chatbot_rag - WARNING - [analysis_20250519_151623] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:16:23,159 - chatbot_rag - INFO - [analysis_20250519_151623] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:16:23,159 - chatbot_rag - INFO - [analysis_20250519_151623] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:16:23,159 - chatbot_rag - INFO - [analysis_20250519_151623] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:16:23,159 - chatbot_rag - WARNING - [analysis_20250519_151623] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:16:23,160 - chatbot_rag - INFO - [analysis_20250519_151623] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:16:23,162 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:16:23,163 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:16:23,163 - chatbot_rag - ERROR - [analysis_20250519_151623] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:16:23,163 - chatbot_rag - WARNING - [analysis_20250519_151623] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:16:23,164 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:16:23,164 - websocket_server - INFO - Query thực tế gửi đến mô hình: phòng IT tham gia giai đoạn nào /think
2025-05-19 15:16:23,164 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-19 15:16:23,164 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:23,167 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:16:23,168 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:16:23,168 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:23,170 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_151623.txt
2025-05-19 15:16:23,170 - chatbot_rag - INFO - Kích thước prompt: 1053 ký tự
2025-05-19 15:16:23,170 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 15:16:23,171 - chatbot_rag - INFO - Tổng kích thước: 1969 ký tự
2025-05-19 15:16:23,174 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151623.txt
2025-05-19 15:16:23,174 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 15:16:23,174 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "phòng IT tham gia giai đoạn nào /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chín...
2025-05-19 15:16:23,175 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:16:37,208 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:16:37,209 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user is asking about which stages the IT department participates in. But according to the rules, I can't create connections between departments and stages. I need to just 
2025-05-19 15:16:37,210 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151637.txt
2025-05-19 15:16:37,565 - websocket_server - INFO - Đã trích xuất thinking (883 ký tự) và còn lại 332 ký tự phản hồi
2025-05-19 15:16:37,566 - websocket_server - INFO - Đã trích xuất phần thinking (883 ký tự) từ phản hồi
2025-05-19 15:16:37,566 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:52,009 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:52,010 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:16:52,014 - websocket_server - INFO - Có 1 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 15:16:52,015 - websocket_server - INFO - Gửi danh sách 1 phiên cho client
2025-05-19 15:16:57,586 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:16:57,587 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:16:59,018 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team IT tham gia dự án nào không /think","session_id":"24b839e6-ab34-450d-9677-1764d3925
2025-05-19 15:16:59,019 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:16:59,019 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: team IT tham gia dự án nào không /think...
2025-05-19 15:16:59,020 - websocket_server - INFO - Nhận tin nhắn thông thường: team IT tham gia dự án nào không /think, enable_thinking=True
2025-05-19 15:16:59,020 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:16:59,020 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: team IT tham gia dự án nào không /think, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:16:59,020 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:16:59,021 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:16:59,021 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia dự án nào không /think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban ...
2025-05-19 15:16:59,022 - chatbot_rag - INFO - Kích thước prompt: 620 ký tự
2025-05-19 15:16:59,022 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:16:59,022 - chatbot_rag - INFO - Tổng kích thước: 2889 ký tự
2025-05-19 15:16:59,023 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151659.txt
2025-05-19 15:16:59,024 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:16:59,024 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia dự án nào không /think"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban ...
2025-05-19 15:16:59,025 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:17:09,020 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:17:09,020 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user is asking "team IT tham gia dự án nào không". First, I need to check if "team IT" is a department in the provided list. The list includes 2D, Dự toán, Kin
2025-05-19 15:17:09,023 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151709.txt
2025-05-19 15:17:09,026 - chatbot_rag - INFO - [analysis_20250519_151709] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151709_raw.txt
2025-05-19 15:17:09,027 - chatbot_rag - INFO - [analysis_20250519_151709] Phản hồi gốc: <think>
Okay, let's break this down. The user is asking "team IT tham gia dự án nào không". First, I...
2025-05-19 15:17:09,027 - chatbot_rag - WARNING - [analysis_20250519_151709] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:17:09,027 - chatbot_rag - INFO - [analysis_20250519_151709] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:17:09,027 - chatbot_rag - INFO - [analysis_20250519_151709] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:17:09,028 - chatbot_rag - INFO - [analysis_20250519_151709] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:17:09,028 - chatbot_rag - WARNING - [analysis_20250519_151709] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:17:09,028 - chatbot_rag - INFO - [analysis_20250519_151709] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:17:09,031 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:17:09,032 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:17:09,032 - chatbot_rag - ERROR - [analysis_20250519_151709] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:17:09,033 - chatbot_rag - WARNING - [analysis_20250519_151709] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:17:09,033 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:17:09,034 - websocket_server - INFO - Xử lý streaming response cho: 'team IT tham gia dự án nào không /think', phòng ban: None, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:09,034 - websocket_server - INFO - Session ID nhận được: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:09,034 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: team IT tham gia dự án nào không
2025-05-19 15:17:09,034 - websocket_server - INFO - Xử lý streaming response. Query: 'team IT tham gia dự án nào không', Mode thinking: True
2025-05-19 15:17:09,035 - websocket_server - INFO - Không có lịch sử tin nhắn cho phiên này
2025-05-19 15:17:09,035 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: team IT tham gia dự án nào không, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:09,035 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:09,036 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:17:09,036 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia dự án nào không"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc nu...
2025-05-19 15:17:09,036 - chatbot_rag - INFO - Kích thước prompt: 613 ký tự
2025-05-19 15:17:09,036 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:17:09,037 - chatbot_rag - INFO - Tổng kích thước: 2882 ký tự
2025-05-19 15:17:09,038 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151709.txt
2025-05-19 15:17:09,038 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:17:09,039 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "team IT tham gia dự án nào không"

        Phân tích câu hỏi và trả về JSON có định dạng:
        {"department": "tên phòng ban hoặc nu...
2025-05-19 15:17:09,039 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:17:18,272 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:17:18,272 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user is asking, "team IT tham gia dự án nào không." First, I need to check if "team IT" is a department in the provided list. The list includes 2D, Dự toán, Ki
2025-05-19 15:17:18,274 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151718.txt
2025-05-19 15:17:18,275 - chatbot_rag - INFO - [analysis_20250519_151718] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151718_raw.txt
2025-05-19 15:17:18,275 - chatbot_rag - INFO - [analysis_20250519_151718] Phản hồi gốc: <think>
Okay, let's break this down. The user is asking, "team IT tham gia dự án nào không." First, ...
2025-05-19 15:17:18,276 - chatbot_rag - WARNING - [analysis_20250519_151718] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:17:18,276 - chatbot_rag - INFO - [analysis_20250519_151718] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:17:18,276 - chatbot_rag - INFO - [analysis_20250519_151718] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:17:18,277 - chatbot_rag - INFO - [analysis_20250519_151718] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:17:18,277 - chatbot_rag - WARNING - [analysis_20250519_151718] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:17:18,277 - chatbot_rag - INFO - [analysis_20250519_151718] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:17:18,280 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:17:18,280 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:17:18,280 - chatbot_rag - ERROR - [analysis_20250519_151718] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:17:18,281 - chatbot_rag - WARNING - [analysis_20250519_151718] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:17:18,281 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:17:18,282 - websocket_server - INFO - Query thực tế gửi đến mô hình: team IT tham gia dự án nào không /think
2025-05-19 15:17:18,282 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-19 15:17:18,282 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:18,285 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:17:18,285 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:17:18,285 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:18,287 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_151718.txt
2025-05-19 15:17:18,288 - chatbot_rag - INFO - Kích thước prompt: 1054 ký tự
2025-05-19 15:17:18,288 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 15:17:18,288 - chatbot_rag - INFO - Tổng kích thước: 1970 ký tự
2025-05-19 15:17:18,289 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151718.txt
2025-05-19 15:17:18,290 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 15:17:18,290 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "team IT tham gia dự án nào không /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn chí...
2025-05-19 15:17:18,290 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:17:39,172 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:17:39,172 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's see. The user asked, "team IT tham gia dự án nào không." So they're asking which projects the IT team is involved in. But according to the rules, I need to focus on stages and depa
2025-05-19 15:17:39,173 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151739.txt
2025-05-19 15:17:39,176 - websocket_server - INFO - Đã trích xuất thinking (1658 ký tự) và còn lại 307 ký tự phản hồi
2025-05-19 15:17:39,177 - websocket_server - INFO - Đã trích xuất phần thinking (1658 ký tự) từ phản hồi
2025-05-19 15:17:39,177 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:39,179 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:39,179 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:17:39,181 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:17:39,182 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:18:21,023 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"vậy khi nào team IT tham gia dự án /think","session_id":"24b839e6-ab34-450d-9677-1764d39
2025-05-19 15:18:21,024 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:21,024 - websocket_server - INFO - Bật chế độ thinking cho câu hỏi: vậy khi nào team IT tham gia dự án /think...
2025-05-19 15:18:21,025 - websocket_server - INFO - Nhận tin nhắn thông thường: vậy khi nào team IT tham gia dự án /think, enable_thinking=True
2025-05-19 15:18:21,026 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 15:18:21,027 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151821.txt
2025-05-19 15:18:21,028 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án /think, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:21,028 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:21,029 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:18:21,029 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án /think"

        Phân tích câu hỏi v...
2025-05-19 15:18:21,029 - chatbot_rag - INFO - Kích thước prompt: 686 ký tự
2025-05-19 15:18:21,030 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:18:21,030 - chatbot_rag - INFO - Tổng kích thước: 2955 ký tự
2025-05-19 15:18:21,031 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151821.txt
2025-05-19 15:18:21,032 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:18:21,032 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án /think"

        Phân tích câu hỏi v...
2025-05-19 15:18:21,033 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:18:31,320 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:18:31,321 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "vậy khi nào team IT tham gia dự án". Looking at the history, the previous message was "team IT tham gia dự án nào không". So the us
2025-05-19 15:18:31,323 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151831.txt
2025-05-19 15:18:31,328 - chatbot_rag - INFO - [analysis_20250519_151831] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151831_raw.txt
2025-05-19 15:18:31,328 - chatbot_rag - INFO - [analysis_20250519_151831] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "vậy khi nào team IT tham gia dự...
2025-05-19 15:18:31,329 - chatbot_rag - WARNING - [analysis_20250519_151831] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:18:31,329 - chatbot_rag - INFO - [analysis_20250519_151831] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:18:31,330 - chatbot_rag - INFO - [analysis_20250519_151831] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:18:31,330 - chatbot_rag - INFO - [analysis_20250519_151831] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:18:31,331 - chatbot_rag - WARNING - [analysis_20250519_151831] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:18:31,333 - chatbot_rag - INFO - [analysis_20250519_151831] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:18:31,339 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:18:31,340 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:18:31,341 - chatbot_rag - ERROR - [analysis_20250519_151831] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:18:31,342 - chatbot_rag - WARNING - [analysis_20250519_151831] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:18:31,343 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:18:31,343 - websocket_server - INFO - Xử lý streaming response cho: 'vậy khi nào team IT tham gia dự án /think', phòng ban: None, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:31,344 - websocket_server - INFO - Session ID nhận được: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:31,344 - websocket_server - INFO - Phát hiện lệnh /think, bật chế độ thinking cho: vậy khi nào team IT tham gia dự án
2025-05-19 15:18:31,345 - websocket_server - INFO - Xử lý streaming response. Query: 'vậy khi nào team IT tham gia dự án', Mode thinking: True
2025-05-19 15:18:31,346 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 15:18:31,348 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_151831.txt
2025-05-19 15:18:31,348 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:31,349 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:31,349 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 15:18:31,350 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án"

        Phân tích câu hỏi và trả v...
2025-05-19 15:18:31,350 - chatbot_rag - INFO - Kích thước prompt: 679 ký tự
2025-05-19 15:18:31,350 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 15:18:31,351 - chatbot_rag - INFO - Tổng kích thước: 2948 ký tự
2025-05-19 15:18:31,357 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151831.txt
2025-05-19 15:18:31,357 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 15:18:31,358 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không

vậy khi nào team IT tham gia dự án"

        Phân tích câu hỏi và trả v...
2025-05-19 15:18:31,358 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 15:18:40,508 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:18:40,508 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "vậy khi nào team IT tham gia dự án". Looking at the history, the previous message was "team IT tham gia dự án nào không". So the us
2025-05-19 15:18:40,510 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151840.txt
2025-05-19 15:18:40,511 - chatbot_rag - INFO - [analysis_20250519_151840] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_151840_raw.txt
2025-05-19 15:18:40,512 - chatbot_rag - INFO - [analysis_20250519_151840] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "vậy khi nào team IT tham gia dự...
2025-05-19 15:18:40,512 - chatbot_rag - WARNING - [analysis_20250519_151840] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 15:18:40,513 - chatbot_rag - INFO - [analysis_20250519_151840] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 15:18:40,513 - chatbot_rag - INFO - [analysis_20250519_151840] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 15:18:40,513 - chatbot_rag - INFO - [analysis_20250519_151840] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 15:18:40,513 - chatbot_rag - WARNING - [analysis_20250519_151840] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 15:18:40,514 - chatbot_rag - INFO - [analysis_20250519_151840] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 15:18:40,517 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:18:40,517 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:18:40,517 - chatbot_rag - ERROR - [analysis_20250519_151840] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 15:18:40,519 - chatbot_rag - WARNING - [analysis_20250519_151840] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 15:18:40,520 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=True
2025-05-19 15:18:40,521 - websocket_server - INFO - Query thực tế gửi đến mô hình: vậy khi nào team IT tham gia dự án /think
2025-05-19 15:18:40,522 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: True
2025-05-19 15:18:40,522 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:40,525 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 15:18:40,525 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 15:18:40,526 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:18:40,527 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_151840.txt
2025-05-19 15:18:40,527 - chatbot_rag - INFO - Kích thước prompt: 1056 ký tự
2025-05-19 15:18:40,528 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 15:18:40,528 - chatbot_rag - INFO - Tổng kích thước: 1972 ký tự
2025-05-19 15:18:40,530 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_151840.txt
2025-05-19 15:18:40,530 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 15:18:40,531 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "vậy khi nào team IT tham gia dự án /think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai đoạn c...
2025-05-19 15:18:40,531 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 15:19:06,460 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 15:19:06,461 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let me try to figure out how to respond to the user's question. The user asked, "vậy khi nào team IT tham gia dự án," which translates to "When does the IT team join the project?" 

Firs
2025-05-19 15:19:06,462 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_151906.txt
2025-05-19 15:19:06,465 - websocket_server - INFO - Đã trích xuất thinking (2288 ký tự) và còn lại 259 ký tự phản hồi
2025-05-19 15:19:06,465 - websocket_server - INFO - Đã trích xuất phần thinking (2288 ký tự) từ phản hồi
2025-05-19 15:19:06,465 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:06,468 - websocket_server - INFO - WebSocket connection closed
2025-05-19 15:19:06,469 - websockets.server - INFO - connection closed
2025-05-19 15:19:06,470 - websockets.server - INFO - connection open
2025-05-19 15:19:06,471 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:06,473 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:06,474 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:19:06,474 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:06,475 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 15:19:06,608 - websockets.server - INFO - connection closed
2025-05-19 15:19:07,159 - websockets.server - INFO - connection open
2025-05-19 15:19:07,160 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:07,226 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 15:19:07,228 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:19:41,173 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"cho tôi biết kinh doanh tham gia giai đoạn nào /no_think","session_id":"24b839e6-ab34-45
2025-05-19 16:19:41,192 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:41,201 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: cho tôi biết kinh doanh tham gia giai đoạn nào /no...
2025-05-19 16:19:41,202 - websocket_server - INFO - Nhận tin nhắn thông thường: cho tôi biết kinh doanh tham gia giai đoạn nào /no_think, enable_thinking=False
2025-05-19 16:19:41,203 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 16:19:41,211 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_161941.txt
2025-05-19 16:19:41,214 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không
Người dùng: vậy khi nào team IT tham gia dự án

cho tôi biết kinh doanh tham gia giai đoạn nào /no_think, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:41,216 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:41,217 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 16:19:41,218 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không
Người dùng: vậy khi nào team IT tham gia dự án

cho tôi biết kinh doanh ...
2025-05-19 16:19:41,219 - chatbot_rag - INFO - Kích thước prompt: 748 ký tự
2025-05-19 16:19:41,220 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 16:19:41,220 - chatbot_rag - INFO - Tổng kích thước: 3017 ký tự
2025-05-19 16:19:41,222 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_161941.txt
2025-05-19 16:19:41,222 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 16:19:41,223 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: team IT tham gia dự án nào không
Người dùng: vậy khi nào team IT tham gia dự án

cho tôi biết kinh doanh ...
2025-05-19 16:19:41,223 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 16:19:46,261 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 16:19:46,262 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}
2025-05-19 16:19:46,264 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_161946.txt
2025-05-19 16:19:46,266 - chatbot_rag - INFO - [analysis_20250519_161946] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_161946_raw.txt
2025-05-19 16:19:46,266 - chatbot_rag - INFO - [analysis_20250519_161946] Phản hồi gốc: <think>

</think>

{"department": "Kinh doanh", "query_type": "department_specific", "error": false}...
2025-05-19 16:19:46,266 - chatbot_rag - WARNING - [analysis_20250519_161946] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 16:19:46,267 - chatbot_rag - INFO - [analysis_20250519_161946] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 16:19:46,268 - chatbot_rag - INFO - [analysis_20250519_161946] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': 'Kinh doanh', 'query_type': 'department_specific', 'error': False}
2025-05-19 16:19:46,269 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 16:19:46,269 - websocket_server - INFO - Xử lý streaming response cho: 'cho tôi biết kinh doanh tham gia giai đoạn nào /no_think', phòng ban: Kinh doanh, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:46,270 - websocket_server - INFO - Session ID nhận được: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:46,270 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: cho tôi biết kinh doanh tham gia giai đoạn nào
2025-05-19 16:19:46,271 - websocket_server - INFO - Xử lý streaming response. Query: 'cho tôi biết kinh doanh tham gia giai đoạn nào', Mode thinking: False
2025-05-19 16:19:46,271 - websocket_server - INFO - Đã thêm 2 tin nhắn gần nhất vào prompt
2025-05-19 16:19:46,272 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_161946.txt
2025-05-19 16:19:46,273 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=Kinh doanh, Loại=department_specific, Thinking=False
2025-05-19 16:19:46,273 - websocket_server - INFO - Query thực tế gửi đến mô hình: cho tôi biết kinh doanh tham gia giai đoạn nào /no_think
2025-05-19 16:19:46,273 - websocket_server - INFO - Câu hỏi về phòng ban cụ thể: Kinh doanh, chế độ thinking: False
2025-05-19 16:19:46,274 - chatbot_rag - INFO - Truy vấn Smart RAG - Giai đoạn: None, Phòng ban: Kinh doanh, Session: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:46,287 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 16:19:46,289 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 16:19:46,291 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 16:19:46,311 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 16:19:46,313 - chatbot_rag - INFO - Tạo prompt LLM cho phòng ban: Kinh doanh, session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:46,313 - chatbot_rag - INFO - Số task: 24
2025-05-19 16:19:46,314 - chatbot_rag - INFO - Lấy lịch sử hội thoại từ phiên 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:19:46,314 - chatbot_rag - INFO - [create_llm_prompt] Đã lấy được 0 bản ghi lịch sử từ websocket_server.get_session_history cho session 24b839e6-ab34-450d-9677-1764d39252f5.
2025-05-19 16:19:46,318 - chatbot_rag - INFO - Gọi LLM:  tại 
2025-05-19 16:19:46,319 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_20250519_161946.txt
2025-05-19 16:19:46,320 - chatbot_rag - INFO - Kích thước prompt: 10135 ký tự
2025-05-19 16:19:46,320 - chatbot_rag - INFO - Kích thước system prompt: 2075 ký tự
2025-05-19 16:19:46,321 - chatbot_rag - INFO - Tổng kích thước: 12210 ký tự
2025-05-19 16:19:46,322 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_161946.txt
2025-05-19 16:19:46,322 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về công việc của các phòng ban trong công ty. 
Nhiệm vụ: phân tích thông tin về các task trong phòng ban và cung cấp thông tin hữu ích.

Dự án được chia thành các giai đoạn ch...
2025-05-19 16:19:46,322 - chatbot_rag - INFO - User prompt: 
    Vai trò: Trợ lý thông minh cung cấp thông tin về phòng ban và công việc trong công ty.

    
    Câu hỏi người dùng: "cho tôi biết kinh doanh tham gia giai đoạn nào /no_think"

    THÔNG TIN PHÒN...
2025-05-19 16:19:46,323 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 16:19:46,384 - chatbot_rag - INFO - Mã phản hồi từ API: 400
2025-05-19 16:19:46,385 - chatbot_rag - ERROR - Lỗi 400 Bad Request, thử lại với prompt ngắn hơn
2025-05-19 16:19:46,392 - chatbot_rag - INFO - Thử lại với prompt ngắn hơn: 6081 ký tự
2025-05-19 16:19:54,957 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

**Kinh doanh tham gia các giai đoạn sau:**

- **MKT-SALES**
- **PROPOSAL**
- **CONSTRUCTION**
- **DEFECT-HANDOVER**
- **AFTERSALE-MAINTENANCE**

Tổng số tasks của Kinh doanh: **24**
2025-05-19 16:19:54,963 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_161954.txt
2025-05-19 16:19:54,969 - chatbot_rag - INFO - Đã lưu response vào file: data/logs/response_20250519_161946.txt
2025-05-19 16:19:54,971 - chatbot_rag - INFO - Thời gian truy vấn LLM: 8.68 giây
2025-05-19 16:19:54,981 - department_info_tool - INFO - Đang trích xuất thông tin cho phòng ban: Kinh doanh
2025-05-19 16:19:54,983 - department_info_tool - INFO - Đã đọc thành công file C:\Users\thuon\OneDrive\Desktop\UI-chatbot\backend\data\departments\kinh_doanh.txt, kích thước: 16485 bytes
2025-05-19 16:19:54,988 - department_info_tool - INFO - Đã tìm thấy 5 giai đoạn và 24 công việc cho phòng ban Kinh doanh
2025-05-19 16:19:55,935 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 182 ký tự phản hồi
2025-05-19 16:19:55,936 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 16:19:55,936 - websocket_server - INFO - Đã lưu hội thoại phòng ban Kinh doanh vào lịch sử của session 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:25:44,784 - websockets.server - INFO - connection open
2025-05-19 16:25:44,787 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:25:45,068 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:25:45,068 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:26:42,729 - websockets.server - INFO - connection open
2025-05-19 16:26:42,738 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:26:43,035 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:26:43,036 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:27:03,019 - websockets.server - INFO - connection closed
2025-05-19 16:27:03,020 - websockets.server - INFO - connection closed
2025-05-19 16:27:03,021 - websockets.server - INFO - connection closed
2025-05-19 16:27:03,770 - websockets.server - INFO - connection open
2025-05-19 16:27:03,771 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:27:03,978 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:27:03,979 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:27:03,980 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:27:03,980 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:31:41,916 - websockets.server - INFO - connection open
2025-05-19 16:31:41,925 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:31:42,044 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:31:42,045 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:18,501 - websockets.server - INFO - connection closed
2025-05-19 16:36:18,502 - websockets.server - INFO - connection closed
2025-05-19 16:36:19,130 - websockets.server - INFO - connection open
2025-05-19 16:36:19,132 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:19,342 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:19,342 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:19,344 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:19,344 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,436 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,437 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,441 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,442 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,473 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,474 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,489 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,489 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,497 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,498 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,509 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,509 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,521 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,522 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,529 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,529 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,542 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,543 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,550 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,550 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,561 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,561 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,569 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,569 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,580 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,580 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,589 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,589 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,602 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,602 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,611 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,612 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,627 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,629 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,642 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,643 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,657 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,658 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,664 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,665 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,679 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,680 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,690 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,690 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,701 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,701 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,711 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,711 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,724 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,724 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,732 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,733 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,747 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,748 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,755 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,755 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,770 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,771 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,779 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,779 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,790 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,790 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,796 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,797 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,808 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,808 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,815 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,816 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,830 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,830 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,838 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,838 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,849 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,850 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,856 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,857 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,870 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,870 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,888 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,888 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,891 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,892 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,901 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,902 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,911 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,911 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,919 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,921 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,929 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,929 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,939 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,939 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,945 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,946 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,956 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,957 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,966 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,967 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,974 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,975 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,983 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,983 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,991 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,991 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:30,999 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:30,999 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,008 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,009 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,016 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,016 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,022 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,023 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,030 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,031 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,038 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,039 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,048 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,049 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,055 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,056 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,063 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,064 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,071 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,071 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,078 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,079 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,086 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,086 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,097 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,098 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,105 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,105 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,113 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,113 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,119 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,120 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,127 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,128 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,134 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,134 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,141 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,142 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,149 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,149 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,157 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,158 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,165 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,166 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,173 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,174 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,181 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,182 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,188 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,189 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,195 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,195 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,199 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,200 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,205 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,205 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,209 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,210 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,218 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,219 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,223 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,223 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,228 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,229 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,236 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,236 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,243 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,243 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,250 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,251 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,257 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,257 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,262 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,263 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,304 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,304 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,305 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,305 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,311 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,312 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,321 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,322 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,328 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,328 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,335 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,336 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,342 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,342 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,350 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,351 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,356 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,357 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,366 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,367 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,374 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,375 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,382 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,382 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,391 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,391 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,402 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,402 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,407 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,407 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,416 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,417 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,424 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,425 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,432 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,432 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,439 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,439 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,447 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,447 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,456 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,457 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,466 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,466 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,472 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,473 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,479 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,479 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,486 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,487 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,494 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,495 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,501 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,501 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,510 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,511 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,515 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,516 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,525 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,526 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,534 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,535 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,540 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,541 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,545 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,546 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,553 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,554 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,558 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,558 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,565 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,566 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,572 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,572 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,579 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,579 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,584 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,585 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,590 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,590 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,595 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,596 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,601 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,601 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,607 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,607 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,614 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,614 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,619 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,619 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,626 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,627 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,632 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,632 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,637 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,638 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,642 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,643 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,650 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,651 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,656 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,656 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,662 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,663 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,668 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,668 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,678 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,679 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,684 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,684 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,690 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,691 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,696 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,696 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,701 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,701 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,707 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,707 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,712 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,713 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,718 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,719 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,724 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,725 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,730 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,730 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,735 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,736 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,741 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,742 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,746 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,747 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,753 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,753 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,759 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,759 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,764 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,764 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,770 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,770 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,774 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,775 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,780 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,780 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,786 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,786 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,792 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,792 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,797 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,798 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,802 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,803 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,808 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,809 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,814 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,814 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,819 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,820 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,828 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,829 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,833 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,833 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,837 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,838 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:31,843 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 24b839e6-ab34-450d-9677-1764d39252f5
2025-05-19 16:36:31,844 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:36:37,323 - websocket_server - INFO - Nhận tin nhắn dạng JSON: {"content":"team kinh doanh tham gia giai đoạn nào /no_think","session_id":"07839642-ae58-44b2-ab77-
2025-05-19 16:36:37,324 - websocket_server - INFO - Session ID từ client (sau khi kiểm tra): 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:37,324 - websocket_server - INFO - Tắt chế độ thinking cho câu hỏi: team kinh doanh tham gia giai đoạn nào /no_think...
2025-05-19 16:36:37,326 - websocket_server - INFO - Nhận tin nhắn thông thường: team kinh doanh tham gia giai đoạn nào /no_think, enable_thinking=False
2025-05-19 16:36:37,326 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 16:36:37,342 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_163637.txt
2025-05-19 16:36:37,347 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào /no_think, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:37,350 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:37,350 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 16:36:37,351 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào /no_think"

        Phân tích câu...
2025-05-19 16:36:37,356 - chatbot_rag - INFO - Kích thước prompt: 692 ký tự
2025-05-19 16:36:37,356 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 16:36:37,357 - chatbot_rag - INFO - Tổng kích thước: 2961 ký tự
2025-05-19 16:36:37,361 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_163637.txt
2025-05-19 16:36:37,362 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 16:36:37,363 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào /no_think"

        Phân tích câu...
2025-05-19 16:36:37,366 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 16:36:40,006 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 16:36:40,007 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

{"department": null, "query_type": "general", "error": false}
2025-05-19 16:36:40,009 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_163640.txt
2025-05-19 16:36:40,012 - chatbot_rag - INFO - [analysis_20250519_163640] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_163640_raw.txt
2025-05-19 16:36:40,012 - chatbot_rag - INFO - [analysis_20250519_163640] Phản hồi gốc: <think>

</think>

{"department": null, "query_type": "general", "error": false}...
2025-05-19 16:36:40,013 - chatbot_rag - WARNING - [analysis_20250519_163640] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 16:36:40,014 - chatbot_rag - INFO - [analysis_20250519_163640] Đã tìm thấy 1 mẫu JSON tiềm năng trong phản hồi
2025-05-19 16:36:40,015 - chatbot_rag - INFO - [analysis_20250519_163640] Tìm thấy JSON hợp lệ trong thẻ <think>: {'department': None, 'query_type': 'general', 'error': False}
2025-05-19 16:36:40,016 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 16:36:40,017 - websocket_server - INFO - Xử lý streaming response cho: 'team kinh doanh tham gia giai đoạn nào /no_think', phòng ban: None, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:40,018 - websocket_server - INFO - Session ID nhận được: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:40,019 - websocket_server - INFO - Phát hiện lệnh /no_think, tắt chế độ thinking cho: team kinh doanh tham gia giai đoạn nào
2025-05-19 16:36:40,020 - websocket_server - INFO - Xử lý streaming response. Query: 'team kinh doanh tham gia giai đoạn nào', Mode thinking: False
2025-05-19 16:36:40,020 - websocket_server - INFO - Đã thêm 1 tin nhắn gần nhất vào prompt
2025-05-19 16:36:40,022 - websocket_server - INFO - Đã lưu lịch sử tin nhắn và prompt vào file: data/logs/history_prompt_20250519_163640.txt
2025-05-19 16:36:40,023 - chatbot_rag - INFO - Đang phân tích câu hỏi với LLM: Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào, session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:40,025 - chatbot_rag - INFO - [analyze_query_with_llm] Đã lấy được 0 bản ghi lịch sử từ websocket_server cho session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:40,025 - chatbot_rag - INFO - [analyze_query_with_llm] Sử dụng lịch sử hội thoại: 0 bản ghi
2025-05-19 16:36:40,026 - chatbot_rag - INFO - [analyze_query_with_llm] Prompt cuối cùng: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào"

        Phân tích câu hỏi và tr...
2025-05-19 16:36:40,026 - chatbot_rag - INFO - Kích thước prompt: 682 ký tự
2025-05-19 16:36:40,027 - chatbot_rag - INFO - Kích thước system prompt: 2269 ký tự
2025-05-19 16:36:40,027 - chatbot_rag - INFO - Tổng kích thước: 2951 ký tự
2025-05-19 16:36:40,029 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_163640.txt
2025-05-19 16:36:40,030 - chatbot_rag - INFO - System prompt: 
        Bạn là trợ lý AI phân tích câu hỏi để xác định:
        1. Phòng ban người dùng đang hỏi (department)
        2. Loại câu hỏi: phòng ban cụ thể hay general (query_type)
        3. Nếu câu hỏi...
2025-05-19 16:36:40,031 - chatbot_rag - INFO - User prompt: Lịch sử tin nhắn:
        
        Câu hỏi người dùng hiện tại: "Lịch sử tin nhắn:
Người dùng: phòng IT tham gia giai đoạn nào

team kinh doanh tham gia giai đoạn nào"

        Phân tích câu hỏi và tr...
2025-05-19 16:36:40,032 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=False
2025-05-19 16:36:48,887 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 16:36:48,889 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>
Okay, let's break this down. The user's current question is "Lịch sử tin nhắn: Người dùng: phòng IT tham gia giai đoạn nào team kinh doanh tham gia giai đoạn nào". So first, I need to parse wh
2025-05-19 16:36:48,890 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_163648.txt
2025-05-19 16:36:48,893 - chatbot_rag - INFO - [analysis_20250519_163648] Đã ghi phản hồi gốc vào: data/logs/analysis_20250519_163648_raw.txt
2025-05-19 16:36:48,894 - chatbot_rag - INFO - [analysis_20250519_163648] Phản hồi gốc: <think>
Okay, let's break this down. The user's current question is "Lịch sử tin nhắn: Người dùng: p...
2025-05-19 16:36:48,894 - chatbot_rag - WARNING - [analysis_20250519_163648] Phát hiện thẻ <think> trong phản hồi. Xử lý đặc biệt...
2025-05-19 16:36:48,894 - chatbot_rag - INFO - [analysis_20250519_163648] BƯỚC 1: Thử parse toàn bộ chuỗi phản hồi
2025-05-19 16:36:48,895 - chatbot_rag - INFO - [analysis_20250519_163648] BƯỚC 1: Không phải JSON hợp lệ: Expecting value: line 1 column 1 (char 0)
2025-05-19 16:36:48,895 - chatbot_rag - INFO - [analysis_20250519_163648] BƯỚC 2: Tìm JSON trong chuỗi phản hồi
2025-05-19 16:36:48,895 - chatbot_rag - WARNING - [analysis_20250519_163648] BƯỚC 2: Không tìm thấy mẫu JSON nào trong phản hồi
2025-05-19 16:36:48,896 - chatbot_rag - INFO - [analysis_20250519_163648] BƯỚC 3: Xử lý chuỗi thủ công để trích xuất thông tin
2025-05-19 16:36:48,913 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 16:36:48,914 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 16:36:48,915 - chatbot_rag - INFO - [analysis_20250519_163648] BƯỚC 3: Tìm thấy phòng ban trong câu hỏi: Kinh doanh
2025-05-19 16:36:48,916 - chatbot_rag - ERROR - [analysis_20250519_163648] BƯỚC 3: Lỗi khi xử lý chuỗi thủ công: local variable 'query_type' referenced before assignment
2025-05-19 16:36:48,916 - chatbot_rag - WARNING - [analysis_20250519_163648] Tất cả phương pháp phân tích đều thất bại, trả về kết quả mặc định
2025-05-19 16:36:48,916 - websocket_server - INFO - Phân tích câu hỏi: Phòng ban=None, Loại=general, Thinking=False
2025-05-19 16:36:48,917 - websocket_server - INFO - Query thực tế gửi đến mô hình: team kinh doanh tham gia giai đoạn nào /no_think
2025-05-19 16:36:48,917 - websocket_server - INFO - Câu hỏi chung, chế độ thinking: False
2025-05-19 16:36:48,918 - chatbot_rag - INFO - Xử lý câu hỏi chung cho session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:48,923 - department_info_tool - INFO - Đã tải 11 phòng ban
2025-05-19 16:36:48,923 - department_info_tool - INFO - Đã lấy danh sách 11 phòng ban
2025-05-19 16:36:48,924 - chatbot_rag - INFO - Gọi LLM để trả lời câu hỏi chung cho session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:36:48,928 - chatbot_rag - INFO - Đã lưu prompt vào file: data/logs/prompt_general_20250519_163648.txt
2025-05-19 16:36:48,929 - chatbot_rag - INFO - Kích thước prompt: 1063 ký tự
2025-05-19 16:36:48,929 - chatbot_rag - INFO - Kích thước system prompt: 916 ký tự
2025-05-19 16:36:48,929 - chatbot_rag - INFO - Tổng kích thước: 1979 ký tự
2025-05-19 16:36:48,932 - chatbot_rag - INFO - Đã lưu full prompt vào file: data/logs/llm_full_prompt_20250519_163648.txt
2025-05-19 16:36:48,933 - chatbot_rag - INFO - System prompt: 
Bạn là trợ lý AI chuyên về quy trình và giai đoạn trong công ty.

DANH SÁCH PHÒNG BAN:
- 2D
- Dự toán
- Khách hàng
- Kinh doanh
- Kế toán
- Marketing
- Mua hàng
- Team dự án
- Thi công
- Thiết kế
- Đ...
2025-05-19 16:36:48,935 - chatbot_rag - INFO - User prompt: 
Câu hỏi: "team kinh doanh tham gia giai đoạn nào /no_think"

Đây là câu hỏi chung về quy trình hoặc giai đoạn làm việc.

Thông tin cơ bản:
### Thông tin tổng quan về quy trình và giai đoạn

#### Giai...
2025-05-19 16:36:48,937 - chatbot_rag - INFO - Gửi truy vấn đến LLM API tại http://192.168.0.43:1234/v1/chat/completions với stream=True
2025-05-19 16:36:54,025 - chatbot_rag - INFO - Mã phản hồi từ API: 200
2025-05-19 16:36:54,026 - chatbot_rag - INFO - Phản hồi gốc từ LLM API (200 ký tự đầu): <think>

</think>

Team kinh doanh tham gia vào các giai đoạn:  
- **MKT-SALES**  
- **PROPOSAL**  
- **AFTERSALE-MAINTENANCE**

Để biết chi tiết công việc cụ thể, vui lòng hỏi về một phòng ban cụ thể
2025-05-19 16:36:54,028 - chatbot_rag - INFO - Đã lưu phản hồi đầy đủ vào file: data/logs/llm_response_20250519_163654.txt
2025-05-19 16:36:54,056 - websocket_server - INFO - Đã trích xuất thinking (0 ký tự) và còn lại 241 ký tự phản hồi
2025-05-19 16:36:54,056 - websocket_server - INFO - Đã trích xuất phần thinking (0 ký tự) từ phản hồi
2025-05-19 16:36:54,057 - websocket_server - INFO - Đã lưu hội thoại chung vào lịch sử của session 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:40:05,124 - websockets.server - INFO - connection closed
2025-05-19 16:40:05,807 - websockets.server - INFO - connection open
2025-05-19 16:40:05,809 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:40:05,999 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:40:05,999 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:40:06,000 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:40:06,001 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:42:21,120 - websockets.server - INFO - connection open
2025-05-19 16:42:21,121 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:42:22,053 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:42:22,054 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:42:35,033 - websockets.server - INFO - connection closed
2025-05-19 16:42:35,034 - websockets.server - INFO - connection closed
2025-05-19 16:42:35,407 - websockets.server - INFO - connection open
2025-05-19 16:42:35,408 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:42:35,508 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:42:35,510 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:43:17,061 - websockets.server - INFO - connection closed
2025-05-19 16:43:17,859 - websockets.server - INFO - connection open
2025-05-19 16:43:17,860 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:43:17,951 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:43:17,952 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:44:45,082 - websockets.server - INFO - connection closed
2025-05-19 16:44:46,693 - websockets.server - INFO - connection open
2025-05-19 16:44:46,700 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:44:47,116 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:44:47,117 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:45:52,084 - websockets.server - INFO - connection closed
2025-05-19 16:45:54,360 - websockets.server - INFO - connection open
2025-05-19 16:45:54,361 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:45:54,655 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:45:54,656 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:45:54,658 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:45:54,660 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:46:57,100 - websockets.server - INFO - connection closed
2025-05-19 16:46:58,233 - websockets.server - INFO - connection open
2025-05-19 16:46:58,234 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:46:58,348 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:46:58,349 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:48:13,558 - websockets.server - INFO - connection open
2025-05-19 16:48:13,560 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:48:14,051 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:48:14,056 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:48:38,480 - websockets.server - INFO - connection open
2025-05-19 16:48:38,481 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:48:39,058 - websocket_server - INFO - Có 2 phiên, phiên hiện tại: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:48:39,058 - websocket_server - INFO - Gửi danh sách 2 phiên cho client
2025-05-19 16:49:04,504 - websockets.server - INFO - connection open
2025-05-19 16:49:04,505 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:49:37,199 - websockets.server - INFO - connection open
2025-05-19 16:49:37,203 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:50:19,043 - websockets.server - INFO - connection closed
2025-05-19 16:50:19,053 - websockets.server - INFO - connection open
2025-05-19 16:50:19,055 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:51:24,120 - websockets.server - INFO - connection closed
2025-05-19 16:51:24,122 - websockets.server - INFO - connection closed
2025-05-19 16:51:24,123 - websockets.server - INFO - connection closed
2025-05-19 16:51:24,126 - websockets.server - INFO - connection closed
2025-05-19 16:51:24,127 - websockets.server - INFO - connection closed
2025-05-19 16:51:26,090 - websockets.server - INFO - connection open
2025-05-19 16:51:26,092 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:51:26,110 - websockets.server - INFO - connection open
2025-05-19 16:51:26,111 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 16:51:26,145 - websockets.server - INFO - connection closed
2025-05-19 17:04:06,690 - websockets.server - INFO - connection closed
2025-05-19 17:04:07,583 - websockets.server - INFO - connection open
2025-05-19 17:04:07,592 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:04:07,604 - websockets.server - INFO - connection open
2025-05-19 17:04:07,607 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:04:37,621 - websocket_server - INFO - WebSocket connection closed
2025-05-19 17:04:37,623 - websockets.server - INFO - connection closed
2025-05-19 17:05:53,263 - websockets.server - INFO - connection closed
2025-05-19 17:05:54,888 - websockets.server - INFO - connection open
2025-05-19 17:05:54,889 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:05:54,914 - websockets.server - INFO - connection open
2025-05-19 17:05:54,916 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:05:54,944 - websockets.server - INFO - connection closed
2025-05-19 17:07:26,048 - websockets.server - INFO - connection closed
2025-05-19 17:07:26,054 - websockets.server - INFO - connection open
2025-05-19 17:07:26,055 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:07:58,173 - websockets.server - INFO - connection closed
2025-05-19 17:08:00,481 - websockets.server - INFO - connection open
2025-05-19 17:08:00,482 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:08:00,684 - websockets.server - INFO - connection open
2025-05-19 17:08:00,685 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:08:00,688 - websockets.server - INFO - connection closed
2025-05-19 17:09:07,152 - websockets.server - INFO - connection closed
2025-05-19 17:09:08,805 - websockets.server - INFO - connection open
2025-05-19 17:09:08,807 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:09:08,811 - websockets.server - INFO - connection closed
2025-05-19 17:09:08,826 - websockets.server - INFO - connection open
2025-05-19 17:09:08,827 - websocket_server - INFO - Đã gửi dữ liệu khởi tạo với current_session_id: 07839642-ae58-44b2-ab77-c7072ba5d730
2025-05-19 17:10:29,045 - websockets.server - INFO - connection closed
